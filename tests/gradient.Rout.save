
pqR version 2.15.1 (2019-00-00), based on R 2.15.0 (2012-03-30)

R 2.15.0 is Copyright (C) 2012 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

Modifications to R in pqR are Copyright (C) 2013-2019 Radford M. Neal

Some modules are from R-2.15.1 or later versions distributed by the R Core Team

Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.


No helper threads, task merging enabled, uncompressed pointers.

> # Test gradient computations.
> #
> # Added for pqR, 2019 Radford M. Neal.
> 
> 
> # Check consistency of simple math derivatives using track gradient with 'D'
> 
> x <- 0.32739
> 
> print (identical (track gradient (x) gradient_of (sqrt(x)),
+                   eval (D (quote (sqrt(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (exp(x)),
+                   eval (D (quote (exp(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (expm1(x)),
+                   eval (D (quote (expm1(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (log1p(x)),
+                   eval (D (quote (log1p(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (log(x)),
+                   eval (D (quote (log(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (cos(x)),
+                   eval (D (quote (cos(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (sin(x)),
+                   eval (D (quote (sin(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (tan(x)),
+                   eval (D (quote (tan(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (acos(x)),
+                   eval (D (quote (acos(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (asin(x)),
+                   eval (D (quote (asin(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (cosh(x)),
+                   eval (D (quote (cosh(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (sinh(x)),
+                   eval (D (quote (sinh(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (tanh(x)),
+                   eval (D (quote (tanh(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (lgamma(x)),
+                   eval (D (quote (lgamma(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (gamma(x)),
+                   eval (D (quote (gamma(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (digamma(x)),
+                   eval (D (quote (digamma(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (trigamma(x)),
+                   eval (D (quote (trigamma (x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (+x),
+                   eval (D (quote (+x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (-x),
+                   eval (D (quote (-x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (3.1+x),
+                   eval (D (quote (3.1+x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (3.1-x),
+                   eval (D (quote (3.1-x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (3.1*x),
+                   eval (D (quote (3.1*x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (3.1/x),
+                   eval (D (quote (3.1/x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (3.1^x),
+                   eval (D (quote (3.1^x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x+3.1),
+                   eval (D (quote (x+3.1), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x-3.1),
+                   eval (D (quote (x-3.1), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x*3.1),
+                   eval (D (quote (x*3.1), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x/3.1),
+                   eval (D (quote (x/3.1), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x^3.1),
+                   eval (D (quote (x^3.1), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x+x),
+                   eval (D (quote (x+x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x-x),
+                   eval (D (quote (x-x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x*x),
+                   eval (D (quote (x*x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x/x),
+                   eval (D (quote (x/x), "x")) ))
[1] TRUE
> 
> print (identical (round (track gradient (x) gradient_of (x^x), 14),
+                   round (eval (D (quote (x^x), "x")), 14) ))
[1] TRUE
> 
> 
> # Check gradient computations passing through mathematical function dispatch.
> 
> a <- 256; class(a) <- "fred"
> cos.fred <- function (x) tan(x)
> log2.fred <- function (x) tan(tan(x))
> Math.fred <- function (x,...) {
+     if (.Generic=="log") sqrt(x)
+     else if (.Generic=="log10") sqrt(sqrt(x))
+     else if (.Generic=="exp") sqrt(sqrt(sqrt(x)))
+     else NextMethod()
+ }
> 
> print(cos(a))
[1] 25.11156
attr(,"class")
[1] "fred"
> print(log2(a))
[1] -0.02118493
attr(,"class")
[1] "fred"
> print(log(a))
[1] 16
attr(,"class")
[1] "fred"
> print(log10(a))
[1] 4
attr(,"class")
[1] "fred"
> print(exp(a))
[1] 2
attr(,"class")
[1] "fred"
> print(sin(a))
[1] -0.999208
attr(,"class")
[1] "fred"
> 
> print (with gradient (a) cos(a))
[1] 25.11156
attr(,"class")
[1] "fred"
attr(,"gradient")
[1] 631.5904
> print (with gradient (a) log2(a))
[1] -0.02118493
attr(,"class")
[1] "fred"
attr(,"gradient")
[1] 631.8739
> print (with gradient (a) log(a))
[1] 16
attr(,"class")
[1] "fred"
attr(,"gradient")
[1] 0.03125
> print (with gradient (a) log10(a))
[1] 4
attr(,"class")
[1] "fred"
attr(,"gradient")
[1] 0.00390625
> print (with gradient (a) exp(a))
[1] 2
attr(,"class")
[1] "fred"
attr(,"gradient")
[1] 0.0009765625
> print (with gradient (a) sin(a))
[1] -0.999208
attr(,"class")
[1] "fred"
attr(,"gradient")
[1] -0.03979076
> 
> 
> # Check tracking of gradients through S3 methods.
> 
> fuddle <- function (x,y) UseMethod("fuddle")
> fuddle.default <- function (x,y) x^2+y^3
> fuddle.mary <- function (x,y) sin(x) + log(y)
> fuddle.bert <- function (x,y) NextMethod("fuddle")
> 
> a <- 256; class(a) <- "mary"
> b <- 200; class(b) <- "bert"
> 
> with gradient (a=256,b=200) fuddle(a,b)
[1] 8065536
attr(,"gradient")
attr(,"gradient")$a
[1] 512

attr(,"gradient")$b
[1] 120000

> with gradient (a,b) fuddle(a,b)
[1] 4.299109
attr(,"class")
[1] "mary"
attr(,"gradient")
attr(,"gradient")$a
[1] -0.03979076

attr(,"gradient")$b
[1] 0.005

> with gradient (a,b) fuddle(b,a)
[1] 16817216
attr(,"class")
[1] "bert"
attr(,"gradient")
attr(,"gradient")$a
[1] 196608

attr(,"gradient")$b
[1] 400

> 
> biffle <- function (x) UseMethod("biffle")
> biffle.mary <- function (x) NextMethod("biffle",x,x^2,x^3)
> biffle.bert <- function (x,y,z) sin(x)+cos(y)+exp(-sqrt(z)/2000)
> 
> b <- 200; class(b) <- c("mary","bert")
> biffle(b)
[1] -0.3075931
attr(,"class")
[1] "mary" "bert"
> with gradient (b) biffle(b)
[1] -0.3075931
attr(,"class")
[1] "mary" "bert"
attr(,"gradient")
[1] -378.1313
> 
> `[[.xyzzy` <- 
+   function (x,i) if (i==0) x$x else x$y
> `[[<-.xyzzy` <- 
+   function (x,i,value) { if (i==0) x$x<-value else x$y<-value; x }
> 
> with gradient (a=7) { L <- list(x=1,y=2); class(L)<-"xyzzy"; L$x<-a^2; L[[0]] }
[1] 49
attr(,"gradient")
[1] 14
> with gradient (a=7) { L <- list(x=1,y=2); class(L)<-"xyzzy"; L[[0]]<-a^2; L }
$x
[1] 49

$y
[1] 2

attr(,"class")
[1] "xyzzy"
attr(,"gradient")
attr(,"gradient")$x
[1] 14

attr(,"gradient")$y
[1] 0

> 
> rm(`[[.xyzzy`)
> rm(`[[<-.xyzzy`)
> 
> `$.xyzzy` <- 
+   function (x,i) if (i=="x") x[[1]] else x[[2]]
> `$<-.xyzzy` <- 
+   function (x,i,value) { if (i=="x") x[[1]]<-value else x[[2]]<-value; x }
> 
> with gradient (a=7) { L <- list(x=1,y=2); class(L)<-"xyzzy"; L[[1]]<-a^2; L$x }
[1] 49
attr(,"gradient")
[1] 14
> with gradient (a=7) { L <- list(x=1,y=2); class(L)<-"xyzzy"; L$x<-a^2; L }
$x
[1] 49

$y
[1] 2

attr(,"class")
[1] "xyzzy"
attr(,"gradient")
attr(,"gradient")$x
[1] 14

attr(,"gradient")$y
[1] 0

> 
> rm(`$.xyzzy`)
> rm(`$<-.xyzzy`)
> 
> 
> # Check tracking of gradients through S4 methods.  Not currently implemented,
> # so this is disabled.
> 
> if (FALSE) {
+ 
+ setGeneric ("fiddler", function (x,y) x^2+y^3)
+ fiddler(2,3)
+ with gradient (x=2,y=3) fiddler(x,y)
+ 
+ }
> 
> 
> # Check consistency of results between with gradient and numericDeriv.
> 
> x <- 0.32739
> x1 <- 0.47718; x2 <- 0.89472; x3 <- 0.67325
> y1 <- -0.3721; y2 <- -0.8131; y3 <- 1.22213
> z1 <- 11.4319; z2 <- 13.1133; z3 <- 6.68901
> w1 <- 0.8389; w2 <- 0.1123; w3 <- 4.68701
> v1 <- 3; v2 <- 7; v3 <- 0.6513
> u1 <- -0.3721; u2 <- 1.8131; u3 <- 1.22213
> i1 <- 3
> 
> bindgrads <- function (r1,r2) 
+     cbind (rbind(r1,r2), rbind(attr(r1,"gradient"),unlist(attr(r2,"gradient"))))
> 
> test1 <- function (fun,...)
+     print (bindgrads (numericDeriv(quote(fun(x,...)),"x"),
+                       with gradient (x) fun(x,...)))
> test1p1 <- function (fun,...)
+     print (bindgrads (numericDeriv(quote(fun(x+1,...)),"x"),
+                       with gradient (x) fun(x+1,...)))
> 
> test1r <- function (fun,...) {
+     f <- function (x) { set.seed(179); fun(1,x,...) }
+     print (bindgrads (numericDeriv(quote(f(x)),"x"),
+                       with gradient (x) f(x)))
+ }
> 
> test2 <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(x1,x2,...)),"x1"),
+                       with gradient (x1) fun(x1,x2,...)))
+     print (bindgrads (numericDeriv(quote(fun(x1,x2,...)),"x2"),
+                       with gradient (x2) fun(x1,x2,...)))
+     print (bindgrads (numericDeriv(quote(fun(x1,x2,...)),c("x1","x2")),
+                       with gradient (x1,x2) fun(x1,x2,...)))
+     print (bindgrads (numericDeriv(quote(fun(x1,x2,...)),c("x1","x2")),
+       { r <- with gradient (x1) { s <- with gradient (x2) fun(x1,x2,...); 
+                                   g2 <<- attr(s,"gradient"); s }
+         attr(r,"gradient") <- cbind(g1=attr(r,"gradient"),g2=g2)
+         r
+       }
+     ))
+ }
> 
> test2y <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(y1,y3,...)),"y1"),
+                       with gradient (y1) fun(y1,y3,...)))
+     print (bindgrads (numericDeriv(quote(fun(y1,y3,...)),"y3"),
+                       with gradient (y3) fun(y1,y3,...)))
+     print (bindgrads (numericDeriv(quote(fun(y1,y3,...)),c("y1","y3")),
+                       with gradient (y1,y3) fun(y1,y3,...)))
+     print (bindgrads (numericDeriv(quote(fun(y1,y3,...)),c("y1","y3")),
+       { r <- with gradient (y1) { s <- with gradient (y3) fun(y1,y3,...); 
+                                   g2 <<- attr(s,"gradient"); s }
+         attr(r,"gradient") <- cbind(g1=attr(r,"gradient"),g2=g2)
+         r
+       }
+     ))
+ }
> 
> test2z <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(z1,z2,...)),"z1"),
+                       with gradient (z1) fun(z1,z2,...)))
+     print (bindgrads (numericDeriv(quote(fun(z1,z2,...)),"z2"),
+                       with gradient (z2) fun(z1,z2,...)))
+     print (bindgrads (numericDeriv(quote(fun(z1,z2,...)),c("z1","z2")),
+                       with gradient (z1,z2) fun(z1,z2,...)))
+     print (bindgrads (numericDeriv(quote(fun(z1,z2,...)),c("z1","z2")),
+       { r <- with gradient (z1) { s <- with gradient (z2) fun(z1,z2,...); 
+                                   g2 <<- attr(s,"gradient"); s }
+         attr(r,"gradient") <- cbind(g1=attr(r,"gradient"),g2=g2)
+         r
+       }
+     ))
+ }
> 
> test2u <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(u1,u2,...)),c("u1","u2")),
+                       with gradient (u1,u2) fun(u1,u2,...)))
+ }
> 
> test2i <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(i1,x2,...)),"x2"),
+                       with gradient (x2) fun(i1,x2,...)))
+ }
> 
> test2r <- function (fun,...) {
+     f <- function (x1,x2) { set.seed(179); fun(1,x1,x2,...) }
+     print (bindgrads (numericDeriv(quote(f(x1,x2)),c("x1","x2")),
+                       with gradient (x1,x2) f(x1,x2)))
+ }
> 
> test3 <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(x1,x2,x3,...)),"x1"),
+                       with gradient (x1) fun(x1,x2,x3,...)))
+     print (bindgrads (numericDeriv(quote(fun(x1,x2,x3,...)),"x2"),
+                       with gradient (x2) fun(x1,x2,x3,...)))
+     print (bindgrads (numericDeriv(quote(fun(x1,x2,x3,...)),"x3"),
+                       with gradient (x3) fun(x1,x2,x3,...)))
+     print (bindgrads (numericDeriv(quote(fun(x1,x2,x3,...)),c("x1","x2","x3")),
+                       with gradient (x1,x2,x3) fun(x1,x2,x3,...)))
+ }
> 
> test3y <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(y1,y2,y3,...)),"y1"),
+                       with gradient (y1) fun(y1,y2,y3,...)))
+     print (bindgrads (numericDeriv(quote(fun(y1,y2,y3,...)),"y2"),
+                       with gradient (y2) fun(y1,y2,y3,...)))
+     print (bindgrads (numericDeriv(quote(fun(y1,y2,y3,...)),"y3"),
+                       with gradient (y3) fun(y1,y2,y3,...)))
+     print (bindgrads (numericDeriv(quote(fun(y1,y2,y3,...)),c("y1","y2","y3")),
+                       with gradient (y1,y2,y3) fun(y1,y2,y3,...)))
+ }
> 
> test3z <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(z1,z2,z3,...)),"z1"),
+                       with gradient (z1) fun(z1,z2,z3,...)))
+     print (bindgrads (numericDeriv(quote(fun(z1,z2,z3,...)),"z2"),
+                       with gradient (z2) fun(z1,z2,z3,...)))
+     print (bindgrads (numericDeriv(quote(fun(z1,z2,z3,...)),"z3"),
+                       with gradient (z3) fun(z1,z2,z3,...)))
+     print (bindgrads (numericDeriv(quote(fun(z1,z2,z3,...)),c("z1","z2","z3")),
+                       with gradient (z1,z2,z3) fun(z1,z2,z3,...)))
+ }
> 
> test3w <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(w1,w2,w3,...)),"w1"),
+                       with gradient (w1) fun(w1,w2,w3,...)))
+     print (bindgrads (numericDeriv(quote(fun(w1,w2,w3,...)),"w2"),
+                       with gradient (w2) fun(w1,w2,w3,...)))
+     print (bindgrads (numericDeriv(quote(fun(w1,w2,w3,...)),"w3"),
+                       with gradient (w3) fun(w1,w2,w3,...)))
+     print (bindgrads (numericDeriv(quote(fun(w1,w2,w3,...)),c("w1","w2","w3")),
+                       with gradient (w1,w2,w3) fun(w1,w2,w3,...)))
+ }
> 
> test3u <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(u1,u2,u3,...)),"u1"),
+                       with gradient (u1) fun(u1,u2,u3,...)))
+     print (bindgrads (numericDeriv(quote(fun(u1,u2,u3,...)),"u2"),
+                       with gradient (u2) fun(u1,u2,u3,...)))
+     print (bindgrads (numericDeriv(quote(fun(u1,u2,u3,...)),"u3"),
+                       with gradient (u3) fun(u1,u2,u3,...)))
+     print (bindgrads (numericDeriv(quote(fun(u1,u2,u3,...)),c("u1","u2","u3")),
+                       with gradient (u1,u2,u3) fun(u1,u2,u3,...)))
+ }
> 
> test3v <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(v1,v2,v3,...)),"v3"),
+                       with gradient (v3) fun(v1,v2,v3,...)))
+ }
> 
> test1(abs)
      [,1] [,2]
r1 0.32739    1
r2 0.32739    1
> 
> test1(sqrt)
      [,1]      [,2]
r1 0.57218 0.8738508
r2 0.57218 0.8738508
> 
> test1(exp)
       [,1]     [,2]
r1 1.387342 1.387342
r2 1.387342 1.387342
> test1(expm1)
        [,1]     [,2]
r1 0.3873424 1.387342
r2 0.3873424 1.387342
> 
> test1(log1p)
        [,1]      [,2]
r1 0.2832146 0.7533581
r2 0.2832146 0.7533581
> test1(log)
        [,1]     [,2]
r1 -1.116603 3.054461
r2 -1.116603 3.054461
> test1(log2)
        [,1]     [,2]
r1 -1.610918 4.406656
r2 -1.610918 4.406656
> test1(log10)
         [,1]     [,2]
r1 -0.4849346 1.326536
r2 -0.4849346 1.326536
> 
> test1(cos)
        [,1]       [,2]
r1 0.9468849 -0.3215728
r2 0.9468849 -0.3215728
> test1(sin)
        [,1]      [,2]
r1 0.3215728 0.9468849
r2 0.3215728 0.9468849
> test1(tan)
        [,1]     [,2]
r1 0.3396113 1.115336
r2 0.3396113 1.115336
> 
> test1(acos)
       [,1]      [,2]
r1 1.237256 -1.058325
r2 1.237256 -1.058325
> test1(asin)
      [,1]     [,2]
r1 0.33354 1.058325
r2 0.33354 1.058325
> test1(atan)
        [,1]      [,2]
r1 0.3163921 0.9031921
r2 0.3163921 0.9031921
> 
> test1(cosh)
       [,1]      [,2]
r1 1.054073 0.3332699
r2 1.054073 0.3332699
> test1(sinh)
        [,1]     [,2]
r1 0.3332699 1.054073
r2 0.3332699 1.054073
> test1(tanh)
        [,1]      [,2]
r1 0.3161736 0.9000342
r2 0.3161736 0.9000342
> 
> test1p1(acosh)
        [,1]     [,2]
r1 0.7885917 1.145599
r2 0.7885917 1.145599
> test1(asinh)
        [,1]      [,2]
r1 0.3218068 0.9503642
r2 0.3218068 0.9503642
> test1(atanh)
        [,1]     [,2]
r1 0.3399021 1.120052
r2 0.3399021 1.120052
> 
> test1(gamma)
       [,1]      [,2]
r1 2.729765 -8.716212
r2 2.729765 -8.716212
> test1(lgamma)
       [,1]      [,2]
r1 1.004216 -3.193026
r2 1.004216 -3.193026
> test1(digamma)
        [,1]     [,2]
r1 -3.193026 10.43204
r2 -3.193026 10.43204
> test1(trigamma)
       [,1]      [,2]
r1 10.43204 -58.12982
r2 10.43204 -58.12982
> test1(psigamma)
        [,1]     [,2]
r1 -3.193026 10.43204
r2 -3.193026 10.43204
> test1p1(psigamma)
         [,1]     [,2]
r1 -0.1385652 1.102305
r2 -0.1385652 1.102305
> test1(psigamma,3)
      [,1]      [,2]
r1 524.484 -6387.194
r2 524.484 -6387.194
> test1p1(psigamma,3)
       [,1]      [,2]
r1 2.220627 -6.260744
r2 2.220627 -6.260744
> 
> test2(atan2)
        [,1]      [,2]
r1 0.4899538 0.8701601
r2 0.4899538 0.8701601
        [,1]       [,2]
r1 0.4899538 -0.4640815
r2 0.4899538 -0.4640815
                    x1         x2
r1 0.4899538 0.8701601 -0.4640815
r2 0.4899538 0.8701601 -0.4640815
                    g1         g2
r1 0.4899538 0.8701601 -0.4640815
r2 0.4899538 0.8701601 -0.4640815
> test2z(atan2)
        [,1]      [,2]
r1 0.7170028 0.0433287
r2 0.7170028 0.0433287
        [,1]        [,2]
r1 0.7170028 -0.03777305
r2 0.7170028 -0.03777305
                    z1          z2
r1 0.7170028 0.0433287 -0.03777305
r2 0.7170028 0.0433287 -0.03777305
                    g1          g2
r1 0.7170028 0.0433287 -0.03777305
r2 0.7170028 0.0433287 -0.03777305
> 
> test2(beta)
       [,1]      [,2]
r1 2.239741 -4.457335
r2 2.239741 -4.457335
       [,1]      [,2]
r1 2.239741 -1.510769
r2 2.239741 -1.510769
                   x1        x2
r1 2.239741 -4.457335 -1.510769
r2 2.239741 -4.457335 -1.510769
                   g1        g2
r1 2.239741 -4.457335 -1.510769
r2 2.239741 -4.457335 -1.510769
> test2z(beta)
           [,1]          [,2]
r1 4.434014e-08 -3.493888e-08
r2 4.434014e-08 -3.493888e-08
           [,1]          [,2]
r1 4.434014e-08 -2.859912e-08
r2 4.434014e-08 -2.859912e-08
                           z1            z2
r1 4.434014e-08 -3.493888e-08 -2.859912e-08
r2 4.434014e-08 -3.493888e-08 -2.859912e-08
                           g1            g2
r1 4.434014e-08 -3.493888e-08 -2.859912e-08
r2 4.434014e-08 -3.493888e-08 -2.859912e-08
> 
> test2(lbeta)
        [,1]      [,2]
r1 0.8063602 -1.990112
r2 0.8063602 -1.990112
        [,1]       [,2]
r1 0.8063602 -0.6745284
r2 0.8063602 -0.6745284
                    x1         x2
r1 0.8063602 -1.990112 -0.6745284
r2 0.8063602 -1.990112 -0.6745284
                    g1         g2
r1 0.8063602 -1.990112 -0.6745284
r2 0.8063602 -1.990112 -0.6745284
> test2z(lbeta)
        [,1]       [,2]
r1 -16.93138 -0.7879742
r2 -16.93138 -0.7879742
        [,1]      [,2]
r1 -16.93138 -0.644994
r2 -16.93138 -0.644994
                     z1        z2
r1 -16.93138 -0.7879742 -0.644994
r2 -16.93138 -0.7879742 -0.644994
                     g1        g2
r1 -16.93138 -0.7879742 -0.644994
r2 -16.93138 -0.7879742 -0.644994
> 
> test2(dchisq)
        [,1]       [,2]
r1 0.4391986 -0.7282516
r2 0.4391986 -0.7282516
        [,1]      [,2]
r1 0.4391986 0.1792434
r2 0.4391986 0.1792434
                     x1        x2
r1 0.4391986 -0.7282516 0.1792434
r2 0.4391986 -0.7282516 0.1792434
                     g1        g2
r1 0.4391986 -0.7282516 0.1792434
r2 0.4391986 -0.7282516 0.1792434
> test2(dchisq,log=TRUE)
         [,1]      [,2]
r1 -0.8228036 -1.658137
r2 -0.8228036 -1.658137
         [,1]      [,2]
r1 -0.8228036 0.4081146
r2 -0.8228036 0.4081146
                     x1        x2
r1 -0.8228036 -1.658137 0.4081146
r2 -0.8228036 -1.658137 0.4081146
                     g1        g2
r1 -0.8228036 -1.658137 0.4081146
r2 -0.8228036 -1.658137 0.4081146
> 
> test2(pchisq)
        [,1]      [,2]
r1 0.5537791 0.4391986
r2 0.5537791 0.4391986
        [,1]       [,2]
r1 0.5537791 -0.4241387
r2 0.5537791  0.0000000
                    x1         x2
r1 0.5537791 0.4391986 -0.4241387
r2 0.5537791 0.4391986  0.0000000
                    g1         g2
r1 0.5537791 0.4391986 -0.4241387
r2 0.5537791 0.4391986  0.0000000
> test2(pchisq,log=TRUE)
         [,1]      [,2]
r1 -0.5909893 0.7930934
r2 -0.5909893 0.7930934
         [,1]       [,2]
r1 -0.5909893 -0.7658987
r2 -0.5909893  0.0000000
                     x1         x2
r1 -0.5909893 0.7930934 -0.7658987
r2 -0.5909893 0.7930934  0.0000000
                     g1         g2
r1 -0.5909893 0.7930934 -0.7658987
r2 -0.5909893 0.7930934  0.0000000
> test2(pchisq,lower=FALSE)
        [,1]       [,2]
r1 0.4462209 -0.4391986
r2 0.4462209 -0.4391986
        [,1]      [,2]
r1 0.4462209 0.4241387
r2 0.4462209 0.0000000
                     x1        x2
r1 0.4462209 -0.4391986 0.4241387
r2 0.4462209 -0.4391986 0.0000000
                     g1        g2
r1 0.4462209 -0.4391986 0.4241387
r2 0.4462209 -0.4391986 0.0000000
> test2(pchisq,log=TRUE,lower=FALSE)
         [,1]       [,2]
r1 -0.8069413 -0.9842628
r2 -0.8069413 -0.9842628
         [,1]     [,2]
r1 -0.8069413 0.950513
r2 -0.8069413 0.000000
                      x1       x2
r1 -0.8069413 -0.9842628 0.950513
r2 -0.8069413 -0.9842628 0.000000
                      g1       g2
r1 -0.8069413 -0.9842628 0.950513
r2 -0.8069413 -0.9842628 0.000000
> 
> test2(qchisq)
        [,1]     [,2]
r1 0.3255925 1.708755
r2 0.3255925 1.708755
        [,1]      [,2]
r1 0.3255925 0.7658574
r2 0.3255925 0.0000000
                   x1        x2
r1 0.3255925 1.708755 0.7658574
r2 0.3255925 1.708755 0.0000000
                   g1        g2
r1 0.3255925 1.708755 0.7658574
r2 0.3255925 1.708755 0.0000000
> test2u(qchisq,log=TRUE)
                  u1       u2
r1 2.099363 4.206923 1.282372
r2 2.099363 4.206926 0.000000
> test2(qchisq,lower=FALSE)
        [,1]      [,2]
r1 0.4106392 -2.026963
r2 0.4106392 -2.026963
        [,1]     [,2]
r1 0.4106392 0.882981
r2 0.4106392 0.000000
                    x1       x2
r1 0.4106392 -2.026963 0.882981
r2 0.4106392 -2.026963 0.000000
                    g1       g2
r1 0.4106392 -2.026963 0.882981
r2 0.4106392 -2.026963 0.000000
> test2u(qchisq,log=TRUE,lower=FALSE)
                    u1        u2
r1 0.6196066 -1.791076 0.6534893
r2 0.6196066 -1.791076 0.0000000
> 
> test2(dexp)
        [,1]       [,2]
r1 0.5838058 -0.5223427
r2 0.5838058 -0.5223427
        [,1]      [,2]
r1 0.5838058 0.3739206
r2 0.5838058 0.3739206
                     x1        x2
r1 0.5838058 -0.5223427 0.3739206
r2 0.5838058 -0.5223427 0.3739206
                     g1        g2
r1 0.5838058 -0.5223427 0.3739206
r2 0.5838058 -0.5223427 0.3739206
> test2(dexp,log=TRUE)
         [,1]     [,2]
r1 -0.5381869 -0.89472
r2 -0.5381869 -0.89472
         [,1]      [,2]
r1 -0.5381869 0.6404881
r2 -0.5381869 0.6404881
                    x1        x2
r1 -0.5381869 -0.89472 0.6404881
r2 -0.5381869 -0.89472 0.6404881
                    g1        g2
r1 -0.5381869 -0.89472 0.6404881
r2 -0.5381869 -0.89472 0.6404881
> 
> test2(pexp)
        [,1]      [,2]
r1 0.3474989 0.5838058
r2 0.3474989 0.5838058
        [,1]      [,2]
r1 0.3474989 0.3113605
r2 0.3474989 0.3113605
                    x1        x2
r1 0.3474989 0.5838058 0.3113605
r2 0.3474989 0.5838058 0.3113605
                    g1        g2
r1 0.3474989 0.5838058 0.3113605
r2 0.3474989 0.5838058 0.3113605
> test2(pexp,log=TRUE)
        [,1]     [,2]
r1 -1.056994 1.680022
r2 -1.056994 1.680022
        [,1]      [,2]
r1 -1.056994 0.8960041
r2 -1.056994 0.8960041
                   x1        x2
r1 -1.056994 1.680022 0.8960041
r2 -1.056994 1.680022 0.8960041
                   g1        g2
r1 -1.056994 1.680022 0.8960041
r2 -1.056994 1.680022 0.8960041
> test2(pexp,lower=FALSE)
        [,1]       [,2]
r1 0.6525011 -0.5838057
r2 0.6525011 -0.5838058
        [,1]       [,2]
r1 0.6525011 -0.3113605
r2 0.6525011 -0.3113605
                     x1         x2
r1 0.6525011 -0.5838057 -0.3113605
r2 0.6525011 -0.5838058 -0.3113605
                     g1         g2
r1 0.6525011 -0.5838057 -0.3113605
r2 0.6525011 -0.5838058 -0.3113605
> test2(pexp,log=TRUE,lower=FALSE)
         [,1]     [,2]
r1 -0.4269425 -0.89472
r2 -0.4269425 -0.89472
         [,1]     [,2]
r1 -0.4269425 -0.47718
r2 -0.4269425 -0.47718
                    x1       x2
r1 -0.4269425 -0.89472 -0.47718
r2 -0.4269425 -0.89472 -0.47718
                    g1       g2
r1 -0.4269425 -0.89472 -0.47718
r2 -0.4269425 -0.89472 -0.47718
> 
> test2(qexp)
        [,1]     [,2]
r1 0.7248279 2.137768
r2 0.7248279 2.137768
        [,1]      [,2]
r1 0.7248279 -0.810117
r2 0.7248279 -0.810117
                   x1        x2
r1 0.7248279 2.137768 -0.810117
r2 0.7248279 2.137768 -0.810117
                   g1        g2
r1 0.7248279 2.137768 -0.810117
r2 0.7248279 2.137768 -0.810117
> test2y(qexp,log=TRUE)
        [,1]     [,2]
r1 0.9564287 1.815181
r2 0.9564287 1.815181
        [,1]       [,2]
r1 0.9564287 -0.7825916
r2 0.9564287 -0.7825916
                   y1         y3
r1 0.9564287 1.815181 -0.7825916
r2 0.9564287 1.815181 -0.7825916
                   g1         g2
r1 0.9564287 1.815181 -0.7825916
r2 0.9564287 1.815181 -0.7825916
> test2(qexp,lower=FALSE)
        [,1]      [,2]
r1 0.8269196 -2.342236
r2 0.8269196 -2.342236
        [,1]       [,2]
r1 0.8269196 -0.9242216
r2 0.8269196 -0.9242217
                    x1         x2
r1 0.8269196 -2.342236 -0.9242216
r2 0.8269196 -2.342236 -0.9242217
                    g1         g2
r1 0.8269196 -2.342236 -0.9242216
r2 0.8269196 -2.342236 -0.9242217
> test2y(qexp,log=TRUE,lower=FALSE)
        [,1]       [,2]
r1 0.3044684 -0.8182436
r2 0.3044684 -0.8182436
        [,1]       [,2]
r1 0.3044684 -0.2491293
r2 0.3044684 -0.2491293
                     y1         y3
r1 0.3044684 -0.8182436 -0.2491293
r2 0.3044684 -0.8182436 -0.2491293
                     g1         g2
r1 0.3044684 -0.8182436 -0.2491293
r2 0.3044684 -0.8182436 -0.2491293
> 
> test1r(rexp)
        [,1]      [,2]
r1 0.7957275 -2.430519
r2 0.7957275 -2.430519
> 
> test2i(dgeom)
          [,1]        [,2]
r1 0.001044058 -0.02858399
r2 0.001044058 -0.02858399
> test2i(dgeom,log=TRUE)
       [,1]      [,2]
r1 -6.86464 -27.37777
r2 -6.86464 -27.37777
> 
> test2i(pgeom)
        [,1]        [,2]
r1 0.9998771 0.004667647
r2 0.9998771 0.004667643
> test2i(pgeom,log=TRUE)
            [,1]        [,2]
r1 -0.0001228599 0.004668215
r2 -0.0001228599 0.004668216
> test2i(pgeom,lower=FALSE)
           [,1]         [,2]
r1 0.0001228524 -0.004667642
r2 0.0001228524 -0.004667643
> test2i(pgeom,log=TRUE,lower=FALSE)
        [,1]      [,2]
r1 -9.004527 -37.99392
r2 -9.004527 -37.99392
> 
> test2i(dpois)
         [,1]     [,2]
r1 0.04879083 0.114805
r2 0.04879083 0.114805
> test2i(dpois,log=TRUE)
        [,1]     [,2]
r1 -3.020213 2.353004
r2 -3.020213 2.353004
> 
> test2i(ppois)
        [,1]        [,2]
r1 0.9868005 -0.04879083
r2 0.9868005 -0.04879083
> test2i(ppois,log=TRUE)
          [,1]        [,2]
r1 -0.01328739 -0.04944346
r2 -0.01328739 -0.04944346
> test2i(ppois,lower=FALSE)
        [,1]       [,2]
r1 0.0131995 0.04879083
r2 0.0131995 0.04879083
> test2i(ppois,log=TRUE,lower=FALSE)
        [,1]     [,2]
r1 -4.327576 3.696414
r2 -4.327576 3.696414
> 
> test2(dt)
        [,1]       [,2]
r1 0.2511211 -0.2022809
r2 0.2511211 -0.2022809
        [,1]       [,2]
r1 0.2511211 0.08376621
r2 0.2511211 0.08376621
                     x1         x2
r1 0.2511211 -0.2022809 0.08376621
r2 0.2511211 -0.2022809 0.08376621
                     g1         g2
r1 0.2511211 -0.2022809 0.08376621
r2 0.2511211 -0.2022809 0.08376621
> test2(dt,log=TRUE)
       [,1]       [,2]
r1 -1.38182 -0.8055112
r2 -1.38182 -0.8055112
       [,1]      [,2]
r1 -1.38182 0.3335689
r2 -1.38182 0.3335689
                    x1        x2
r1 -1.38182 -0.8055112 0.3335689
r2 -1.38182 -0.8055112 0.3335689
                    g1        g2
r1 -1.38182 -0.8055112 0.3335689
r2 -1.38182 -0.8055112 0.3335689
> test2z(dt)
           [,1]          [,2]
r1 1.792077e-08 -2.010665e-08
r2 1.792077e-08 -2.010665e-08
           [,1]          [,2]
r1 1.792077e-08 -1.266814e-08
r2 1.792077e-08 -1.266814e-08
                           z1            z2
r1 1.792077e-08 -2.010665e-08 -1.266814e-08
r2 1.792077e-08 -2.010665e-08 -1.266814e-08
                           g1            g2
r1 1.792077e-08 -2.010665e-08 -1.266814e-08
r2 1.792077e-08 -2.010665e-08 -1.266814e-08
> test2z(dt,log=TRUE)
        [,1]      [,2]
r1 -17.83731 -1.121975
r2 -17.83731 -1.121975
        [,1]       [,2]
r1 -17.83731 -0.7068972
r2 -17.83731 -0.7068972
                    z1         z2
r1 -17.83731 -1.121975 -0.7068972
r2 -17.83731 -1.121975 -0.7068972
                    g1         g2
r1 -17.83731 -1.121975 -0.7068972
r2 -17.83731 -1.121975 -0.7068972
> 
> test2(pt)
       [,1]      [,2]
r1 0.638114 0.2511212
r2 0.638114 0.2511211
       [,1]       [,2]
r1 0.638114 0.03712282
r2 0.638114 0.00000000
                   x1         x2
r1 0.638114 0.2511212 0.03712282
r2 0.638114 0.2511211 0.00000000
                   g1         g2
r1 0.638114 0.2511212 0.03712282
r2 0.638114 0.2511211 0.00000000
> test2(pt,log=TRUE)
         [,1]      [,2]
r1 -0.4492383 0.3935365
r2 -0.4492383 0.3935365
         [,1]       [,2]
r1 -0.4492383 0.05817584
r2 -0.4492383 0.00000000
                     x1         x2
r1 -0.4492383 0.3935365 0.05817584
r2 -0.4492383 0.3935365 0.00000000
                     g1         g2
r1 -0.4492383 0.3935365 0.05817584
r2 -0.4492383 0.3935365 0.00000000
> test2(pt,lower=FALSE)
       [,1]       [,2]
r1 0.361886 -0.2511212
r2 0.361886 -0.2511211
       [,1]        [,2]
r1 0.361886 -0.03712282
r2 0.361886  0.00000000
                    x1          x2
r1 0.361886 -0.2511212 -0.03712282
r2 0.361886 -0.2511211  0.00000000
                    g1          g2
r1 0.361886 -0.2511212 -0.03712282
r2 0.361886 -0.2511211  0.00000000
> test2(pt,log=TRUE,lower=FALSE)
        [,1]       [,2]
r1 -1.016426 -0.6939235
r2 -1.016426 -0.6939234
        [,1]       [,2]
r1 -1.016426 -0.1025815
r2 -1.016426  0.0000000
                     x1         x2
r1 -1.016426 -0.6939235 -0.1025815
r2 -1.016426 -0.6939234  0.0000000
                     g1         g2
r1 -1.016426 -0.6939235 -0.1025815
r2 -1.016426 -0.6939234  0.0000000
> test2z(pt)
   [,1]         [,2]
r1    1 1.824861e-08
r2    1 1.792077e-08
   [,1]         [,2]
r1    1 1.363607e-08
r2    1 0.000000e+00
               z1           z2
r1 1 1.824861e-08 1.363607e-08
r2 1 1.792077e-08 0.000000e+00
               g1           g2
r1 1 1.824861e-08 1.363607e-08
r2 1 1.792077e-08 0.000000e+00
> test2z(pt,log=TRUE)
            [,1]         [,2]
r1 -1.707838e-08 1.792077e-08
r2 -1.707838e-08 1.792077e-08
            [,1]         [,2]
r1 -1.707838e-08 1.325737e-08
r2 -1.707838e-08 0.000000e+00
                           z1           z2
r1 -1.707838e-08 1.792077e-08 1.325737e-08
r2 -1.707838e-08 1.792077e-08 0.000000e+00
                           g1           g2
r1 -1.707838e-08 1.792077e-08 1.325737e-08
r2 -1.707838e-08 1.792077e-08 0.000000e+00
> test2z(pt,lower=FALSE)
           [,1]          [,2]
r1 1.707838e-08 -1.792077e-08
r2 1.707838e-08 -1.792077e-08
           [,1]          [,2]
r1 1.707838e-08 -1.325737e-08
r2 1.707838e-08  0.000000e+00
                           z1            z2
r1 1.707838e-08 -1.792077e-08 -1.325737e-08
r2 1.707838e-08 -1.792077e-08  0.000000e+00
                           g1            g2
r1 1.707838e-08 -1.792077e-08 -1.325737e-08
r2 1.707838e-08 -1.792077e-08  0.000000e+00
> test2z(pt,log=TRUE,lower=FALSE)
        [,1]      [,2]
r1 -17.88545 -1.049324
r2 -17.88545 -1.049324
        [,1]       [,2]
r1 -17.88545 -0.7762659
r2 -17.88545  0.0000000
                    z1         z2
r1 -17.88545 -1.049324 -0.7762659
r2 -17.88545 -1.049324  0.0000000
                    g1         g2
r1 -17.88545 -1.049324 -0.7762659
r2 -17.88545 -1.049324  0.0000000
> 
> test2(qt)
          [,1]    [,2]
r1 -0.07344664 3.23076
r2 -0.07344664 3.23076
          [,1]       [,2]
r1 -0.07344664 0.01719656
r2 -0.07344664 0.00000000
                    x1         x2
r1 -0.07344664 3.23076 0.01719656
r2 -0.07344664 3.23076 0.00000000
                    g1         g2
r1 -0.07344664 3.23076 0.01719656
r2 -0.07344664 3.23076 0.00000000
> test2u(qt,log=TRUE)
                   u1          u2
r1 0.5879206 2.521063 -0.05640184
r2 0.5879206 2.521063  0.00000000
> test2(qt,lower=FALSE)
         [,1]     [,2]
r1 0.07344664 -3.23076
r2 0.07344664 -3.23076
         [,1]        [,2]
r1 0.07344664 -0.01719656
r2 0.07344664  0.00000000
                    x1          x2
r1 0.07344664 -3.23076 -0.01719656
r2 0.07344664 -3.23076  0.00000000
                    g1          g2
r1 0.07344664 -3.23076 -0.01719656
r2 0.07344664 -3.23076  0.00000000
> test2u(qt,log=TRUE,lower=FALSE)
                     u1         u2
r1 -0.5879206 -2.521063 0.05640184
r2 -0.5879206 -2.521063 0.00000000
> 
> test3(dbeta)
        [,1]      [,2]
r1 0.8258716 0.3339383
r2 0.8258716 0.3339383
        [,1]      [,2]
r1 0.8258716 0.1019506
r2 0.8258716 0.1019506
        [,1]      [,2]
r1 0.8258716 0.6176604
r2 0.8258716 0.6176604
                    x1        x2        x3
r1 0.8258716 0.3339383 0.1019506 0.6176604
r2 0.8258716 0.3339383 0.1019506 0.6176604
> test3(dbeta,log=TRUE)
        [,1]      [,2]
r1 -0.191316 0.4043466
r2 -0.191316 0.4043466
        [,1]      [,2]
r1 -0.191316 0.1234461
r2 -0.191316 0.1234461
        [,1]      [,2]
r1 -0.191316 0.7478892
r2 -0.191316 0.7478892
                    x1        x2        x3
r1 -0.191316 0.4043466 0.1234461 0.7478892
r2 -0.191316 0.4043466 0.1234461 0.7478892
> test3w(dbeta)
          [,1]         [,2]
r1 0.000194595 -0.004659505
r2 0.000194595 -0.004659506
          [,1]       [,2]
r1 0.000194595 0.00206193
r2 0.000194595 0.00206193
          [,1]          [,2]
r1 0.000194595 -0.0003501507
r2 0.000194595 -0.0003501508
                         w1         w2            w3
r1 0.000194595 -0.004659505 0.00206193 -0.0003501507
r2 0.000194595 -0.004659506 0.00206193 -0.0003501508
> test3w(dbeta,log=TRUE)
       [,1]      [,2]
r1 -8.54459 -23.94464
r2 -8.54459 -23.94464
       [,1]     [,2]
r1 -8.54459 10.59601
r2 -8.54459 10.59601
       [,1]      [,2]
r1 -8.54459 -1.799383
r2 -8.54459 -1.799383
                   w1       w2        w3
r1 -8.54459 -23.94464 10.59601 -1.799383
r2 -8.54459 -23.94464 10.59601 -1.799383
> 
> test3(pbeta)
      [,1]      [,2]
r1 0.39025 0.8258716
r2 0.39025 0.8258716
      [,1]       [,2]
r1 0.39025 -0.3663547
r2 0.39025  0.0000000
      [,1]      [,2]
r1 0.39025 0.4341696
r2 0.39025 0.0000000
                  x1         x2        x3
r1 0.39025 0.8258716 -0.3663547 0.4341696
r2 0.39025 0.8258716  0.0000000 0.0000000
> test3(pbeta,log=TRUE)
         [,1]     [,2]
r1 -0.9409677 2.116263
r2 -0.9409677 2.116263
         [,1]       [,2]
r1 -0.9409677 -0.9387691
r2 -0.9409677  0.0000000
         [,1]     [,2]
r1 -0.9409677 1.112542
r2 -0.9409677 0.000000
                    x1         x2       x3
r1 -0.9409677 2.116263 -0.9387691 1.112542
r2 -0.9409677 2.116263  0.0000000 0.000000
> test3(pbeta,lower=FALSE)
      [,1]       [,2]
r1 0.60975 -0.8258716
r2 0.60975 -0.8258716
      [,1]      [,2]
r1 0.60975 0.3663547
r2 0.60975 0.0000000
      [,1]       [,2]
r1 0.60975 -0.4341696
r2 0.60975  0.0000000
                   x1        x2         x3
r1 0.60975 -0.8258716 0.3663547 -0.4341696
r2 0.60975 -0.8258716 0.0000000  0.0000000
> test3(pbeta,log=TRUE,lower=FALSE)
         [,1]      [,2]
r1 -0.4947063 -1.354443
r2 -0.4947063 -1.354443
         [,1]      [,2]
r1 -0.4947063 0.6008277
r2 -0.4947063 0.0000000
         [,1]       [,2]
r1 -0.4947063 -0.7120453
r2 -0.4947063  0.0000000
                     x1        x2         x3
r1 -0.4947063 -1.354443 0.6008277 -0.7120453
r2 -0.4947063 -1.354443 0.0000000  0.0000000
> 
> test3(qbeta)
        [,1]     [,2]
r1 0.5799465 1.150664
r2 0.5799465 1.150664
        [,1]      [,2]
r1 0.5799465 0.3990489
r2 0.5799465 0.0000000
        [,1]       [,2]
r1 0.5799465 -0.5637529
r2 0.5799465  0.0000000
                   x1        x2         x3
r1 0.5799465 1.150664 0.3990489 -0.5637529
r2 0.5799465 1.150664 0.0000000  0.0000000
> test3u(qbeta,log=TRUE)
        [,1]      [,2]
r1 0.7585227 0.4885164
r2 0.7585227 0.4885164
        [,1]      [,2]
r1 0.7585227 0.1104072
r2 0.7585227 0.0000000
        [,1]       [,2]
r1 0.7585227 -0.2393685
r2 0.7585227  0.0000000
                    u1        u2         u3
r1 0.7585227 0.4885164 0.1104072 -0.2393685
r2 0.7585227 0.4885164 0.0000000  0.0000000
> test3(qbeta,lower=FALSE)
        [,1]      [,2]
r1 0.6316053 -1.112316
r2 0.6316053 -1.112316
        [,1]      [,2]
r1 0.6316053 0.3673725
r2 0.6316053 0.0000000
        [,1]       [,2]
r1 0.6316053 -0.5685447
r2 0.6316053  0.0000000
                    x1        x2         x3
r1 0.6316053 -1.112316 0.3673725 -0.5685447
r2 0.6316053 -1.112316 0.0000000  0.0000000
> test3u(qbeta,log=TRUE,lower=FALSE)
        [,1]       [,2]
r1 0.4680528 -0.6069822
r2 0.4680528 -0.6069822
        [,1]      [,2]
r1 0.4680528 0.1879364
r2 0.4680528 0.0000000
        [,1]       [,2]
r1 0.4680528 -0.2275227
r2 0.4680528  0.0000000
                     u1        u2         u3
r1 0.4680528 -0.6069822 0.1879364 -0.2275227
r2 0.4680528 -0.6069822 0.0000000  0.0000000
> 
> test3v(dbinom)
        [,1]       [,2]
r1 0.1429615 -0.9814315
r2 0.1429615 -0.9814315
> test3v(dbinom,log=TRUE)
       [,1]      [,2]
r1 -1.94518 -6.865007
r2 -1.94518 -6.865006
> 
> test3v(pbinom)
        [,1]      [,2]
r1 0.1977083 -1.639937
r2 0.1977083 -1.639937
> test3v(pbinom,log=TRUE)
        [,1]     [,2]
r1 -1.620963 -8.29473
r2 -1.620963 -8.29473
> test3v(pbinom,lower=FALSE)
        [,1]     [,2]
r1 0.8022917 1.639937
r2 0.8022917 1.639937
> test3v(pbinom,log=TRUE,lower=FALSE)
        [,1]     [,2]
r1 -0.220283 2.044065
r2 -0.220283 2.044065
> 
> test3(dcauchy)
        [,1]      [,2]
r1 0.3414601 0.4543405
r2 0.3414601 0.4543405
        [,1]       [,2]
r1 0.3414601 -0.4543405
r2 0.3414601 -0.4543405
        [,1]       [,2]
r1 0.3414601 -0.2254062
r2 0.3414601 -0.2254062
                    x1         x2         x3
r1 0.3414601 0.4543405 -0.4543405 -0.2254062
r2 0.3414601 0.4543405 -0.4543405 -0.2254062
> test3(dcauchy,log=TRUE)
        [,1]     [,2]
r1 -1.074524 1.330582
r2 -1.074524 1.330582
        [,1]      [,2]
r1 -1.074524 -1.330582
r2 -1.074524 -1.330582
        [,1]       [,2]
r1 -1.074524 -0.6601247
r2 -1.074524 -0.6601247
                   x1        x2         x3
r1 -1.074524 1.330582 -1.330582 -0.6601247
r2 -1.074524 1.330582 -1.330582 -0.6601247
> test3z(dcauchy)
         [,1]       [,2]
r1 0.04475888 0.00316408
r2 0.04475888 0.00316408
         [,1]        [,2]
r1 0.04475888 -0.00316408
r2 0.04475888 -0.00316408
         [,1]         [,2]
r1 0.04475888 -0.005896058
r2 0.04475888 -0.005896058
                      z1          z2           z3
r1 0.04475888 0.00316408 -0.00316408 -0.005896058
r2 0.04475888 0.00316408 -0.00316408 -0.005896058
> test3z(dcauchy,log=TRUE)
        [,1]       [,2]
r1 -3.106465 0.07069167
r2 -3.106465 0.07069167
        [,1]        [,2]
r1 -3.106465 -0.07069168
r2 -3.106465 -0.07069167
        [,1]       [,2]
r1 -3.106465 -0.1317294
r2 -3.106465 -0.1317294
                     z1          z2         z3
r1 -3.106465 0.07069167 -0.07069168 -0.1317294
r2 -3.106465 0.07069167 -0.07069167 -0.1317294
> 
> test3(pcauchy)
        [,1]      [,2]
r1 0.3232967 0.3414601
r2 0.3232967 0.3414601
        [,1]       [,2]
r1 0.3232967 -0.3414601
r2 0.3232967 -0.3414601
        [,1]      [,2]
r1 0.3232967 0.2117686
r2 0.3232967 0.2117687
                    x1         x2        x3
r1 0.3232967 0.3414601 -0.3414601 0.2117686
r2 0.3232967 0.3414601 -0.3414601 0.2117687
> test3(pcauchy,log=TRUE)
        [,1]     [,2]
r1 -1.129185 1.056182
r2 -1.129185 1.056182
        [,1]      [,2]
r1 -1.129185 -1.056182
r2 -1.129185 -1.056182
        [,1]      [,2]
r1 -1.129185 0.6550288
r2 -1.129185 0.6550288
                   x1        x2        x3
r1 -1.129185 1.056182 -1.056182 0.6550288
r2 -1.129185 1.056182 -1.056182 0.6550288
> test3(pcauchy,lower=FALSE)
        [,1]       [,2]
r1 0.6767033 -0.3414601
r2 0.6767033 -0.3414601
        [,1]      [,2]
r1 0.6767033 0.3414601
r2 0.6767033 0.3414601
        [,1]       [,2]
r1 0.6767033 -0.2117686
r2 0.6767033 -0.2117687
                     x1        x2         x3
r1 0.6767033 -0.3414601 0.3414601 -0.2117686
r2 0.6767033 -0.3414601 0.3414601 -0.2117687
> test3(pcauchy,log=TRUE,lower=FALSE)
         [,1]       [,2]
r1 -0.3905223 -0.5045935
r2 -0.3905223 -0.5045935
         [,1]      [,2]
r1 -0.3905223 0.5045935
r2 -0.3905223 0.5045935
         [,1]       [,2]
r1 -0.3905223 -0.3129416
r2 -0.3905223 -0.3129417
                      x1        x2         x3
r1 -0.3905223 -0.5045935 0.5045935 -0.3129416
r2 -0.3905223 -0.5045935 0.5045935 -0.3129417
> test3z(pcauchy)
        [,1]       [,2]
r1 0.4216113 0.04475888
r2 0.4216113 0.04475888
        [,1]        [,2]
r1 0.4216113 -0.04475888
r2 0.4216113 -0.04475888
        [,1]       [,2]
r1 0.4216113 0.01125093
r2 0.4216113 0.01125093
                     z1          z2         z3
r1 0.4216113 0.04475888 -0.04475888 0.01125093
r2 0.4216113 0.04475888 -0.04475888 0.01125093
> test3z(pcauchy,log=TRUE)
         [,1]      [,2]
r1 -0.8636715 0.1061615
r2 -0.8636715 0.1061615
         [,1]       [,2]
r1 -0.8636715 -0.1061615
r2 -0.8636715 -0.1061615
         [,1]       [,2]
r1 -0.8636715 0.02668555
r2 -0.8636715 0.02668555
                     z1         z2         z3
r1 -0.8636715 0.1061615 -0.1061615 0.02668555
r2 -0.8636715 0.1061615 -0.1061615 0.02668555
> test3z(pcauchy,lower=FALSE)
        [,1]        [,2]
r1 0.5783887 -0.04475888
r2 0.5783887 -0.04475888
        [,1]       [,2]
r1 0.5783887 0.04475888
r2 0.5783887 0.04475888
        [,1]        [,2]
r1 0.5783887 -0.01125093
r2 0.5783887 -0.01125093
                      z1         z2          z3
r1 0.5783887 -0.04475888 0.04475888 -0.01125093
r2 0.5783887 -0.04475888 0.04475888 -0.01125093
> test3z(pcauchy,log=TRUE,lower=FALSE)
         [,1]        [,2]
r1 -0.5475092 -0.07738546
r2 -0.5475092 -0.07738546
         [,1]       [,2]
r1 -0.5475092 0.07738546
r2 -0.5475092 0.07738546
         [,1]        [,2]
r1 -0.5475092 -0.01945219
r2 -0.5475092 -0.01945219
                       z1         z2          z3
r1 -0.5475092 -0.07738546 0.07738546 -0.01945219
r2 -0.5475092 -0.07738546 0.07738546 -0.01945219
> 
> test3(qcauchy)
        [,1]     [,2]
r1 0.8463711 2.125985
r2 0.8463711 2.125985
        [,1] [,2]
r1 0.8463711    1
r2 0.8463711    1
        [,1]        [,2]
r1 0.8463711 -0.07181421
r2 0.8463711 -0.07181422
                   x1 x2          x3
r1 0.8463711 2.125985  1 -0.07181421
r2 0.8463711 2.125985  1 -0.07181422
> test3y(qcauchy,log=TRUE)
         [,1]    [,2]
r1 0.01345346 3.85699
r2 0.01345346 3.85699
         [,1] [,2]
r1 0.01345346    1
r2 0.01345346    1
         [,1]     [,2]
r1 0.01345346 0.676322
r2 0.01345346 0.676322
                   y1 y2       y3
r1 0.01345346 3.85699  1 0.676322
r2 0.01345346 3.85699  1 0.676322
> test3(qcauchy,lower=FALSE)
        [,1]      [,2]
r1 0.9430689 -2.125985
r2 0.9430689 -2.125985
        [,1] [,2]
r1 0.9430689    1
r2 0.9430689    1
        [,1]       [,2]
r1 0.9430689 0.07181421
r2 0.9430689 0.07181422
                    x1 x2         x3
r1 0.9430689 -2.125985  1 0.07181421
r2 0.9430689 -2.125985  1 0.07181422
> test3y(qcauchy,log=TRUE,lower=FALSE)
        [,1]     [,2]
r1 -1.639653 -3.85699
r2 -1.639653 -3.85699
        [,1] [,2]
r1 -1.639653    1
r2 -1.639653    1
        [,1]      [,2]
r1 -1.639653 -0.676322
r2 -1.639653 -0.676322
                   y1 y2        y3
r1 -1.639653 -3.85699  1 -0.676322
r2 -1.639653 -3.85699  1 -0.676322
> 
> test2r(rcauchy)
             x1        x2
r1 -1.585831  1 -2.305762
r2 -1.585831  1 -2.305762
> 
> test3(df)
        [,1]       [,2]
r1 0.2620323 -0.4705327
r2 0.2620323 -0.4705327
        [,1]       [,2]
r1 0.2620323 0.08125189
r2 0.2620323 0.08125188
        [,1]      [,2]
r1 0.2620323 0.1546493
r2 0.2620323 0.1546493
                     x1         x2        x3
r1 0.2620323 -0.4705327 0.08125189 0.1546493
r2 0.2620323 -0.4705327 0.08125188 0.1546493
> test3(df,log=TRUE)
        [,1]      [,2]
r1 -1.339288 -1.795705
r2 -1.339288 -1.795705
        [,1]      [,2]
r1 -1.339288 0.3100835
r2 -1.339288 0.3100835
        [,1]      [,2]
r1 -1.339288 0.5901916
r2 -1.339288 0.5901916
                    x1        x2        x3
r1 -1.339288 -1.795705 0.3100835 0.5901916
r2 -1.339288 -1.795705 0.3100835 0.5901916
> 
> test3(pf)
        [,1]      [,2]
r1 0.3626988 0.2620323
r2 0.3626988 0.2620323
        [,1]       [,2]
r1 0.3626988 -0.1846651
r2 0.3626988  0.0000000
        [,1]      [,2]
r1 0.3626988 0.1672481
r2 0.3626988 0.0000000
                    x1         x2        x3
r1 0.3626988 0.2620323 -0.1846651 0.1672481
r2 0.3626988 0.2620323  0.0000000 0.0000000
> test3(pf,log=TRUE)
        [,1]      [,2]
r1 -1.014183 0.7224515
r2 -1.014183 0.7224515
        [,1]       [,2]
r1 -1.014183 -0.5091416
r2 -1.014183  0.0000000
        [,1]      [,2]
r1 -1.014183 0.4611211
r2 -1.014183 0.0000000
                    x1         x2        x3
r1 -1.014183 0.7224515 -0.5091416 0.4611211
r2 -1.014183 0.7224515  0.0000000 0.0000000
> test3(pf,lower=FALSE)
        [,1]       [,2]
r1 0.6373012 -0.2620323
r2 0.6373012 -0.2620323
        [,1]     [,2]
r1 0.6373012 0.184665
r2 0.6373012 0.000000
        [,1]       [,2]
r1 0.6373012 -0.1672481
r2 0.6373012  0.0000000
                     x1       x2         x3
r1 0.6373012 -0.2620323 0.184665 -0.1672481
r2 0.6373012 -0.2620323 0.000000  0.0000000
> test3(pf,log=TRUE,lower=FALSE)
         [,1]       [,2]
r1 -0.4505129 -0.4111593
r2 -0.4505129 -0.4111593
         [,1]     [,2]
r1 -0.4505129 0.289761
r2 -0.4505129 0.000000
         [,1]       [,2]
r1 -0.4505129 -0.2624317
r2 -0.4505129  0.0000000
                      x1       x2         x3
r1 -0.4505129 -0.4111593 0.289761 -0.2624317
r2 -0.4505129 -0.4111593 0.000000  0.0000000
> 
> test3(qf)
       [,1]     [,2]
r1 1.151745 8.750483
r2 1.151745 8.750483
       [,1]     [,2]
r1 1.151745 1.280997
r2 1.151745 0.000000
       [,1]      [,2]
r1 1.151745 -2.079706
r2 1.151745  0.000000
                  x1       x2        x3
r1 1.151745 8.750483 1.280997 -2.079706
r2 1.151745 8.750483 0.000000  0.000000
> test3u(qf,log=TRUE)
       [,1]     [,2]
r1 3.435804 14.76303
r2 3.435804 14.76303
       [,1]      [,2]
r1 3.435804 0.5318211
r2 3.435804 0.0000000
       [,1]      [,2]
r1 3.435804 -3.458197
r2 3.435804  0.000000
                  u1        u2        u3
r1 3.435804 14.76303 0.5318211 -3.458197
r2 3.435804 14.76303 0.0000000  0.000000
> test3(qf,lower=FALSE)
       [,1]      [,2]
r1 1.633886 -12.67081
r2 1.633886 -12.67081
       [,1]     [,2]
r1 1.633886 1.659067
r2 1.633886 0.000000
       [,1]      [,2]
r1 1.633886 -3.367672
r2 1.633886  0.000000
                   x1       x2        x3
r1 1.633886 -12.67081 1.659067 -3.367672
r2 1.633886 -12.67081 0.000000  0.000000
> test3u(qf,log=TRUE,lower=FALSE)
        [,1]      [,2]
r1 0.4791897 -1.785037
r2 0.4791897 -1.785037
        [,1]      [,2]
r1 0.4791897 0.1909383
r2 0.4791897 0.0000000
        [,1]       [,2]
r1 0.4791897 -0.1359218
r2 0.4791897  0.0000000
                    u1        u2         u3
r1 0.4791897 -1.785037 0.1909383 -0.1359218
r2 0.4791897 -1.785037 0.0000000  0.0000000
> 
> test3(dgamma)
        [,1]      [,2]
r1 0.5128645 -0.458439
r2 0.5128645 -0.458439
        [,1]       [,2]
r1 0.5128645 -0.1899533
r2 0.5128645 -0.1899533
        [,1]      [,2]
r1 0.5128645 0.4368459
r2 0.5128645 0.4368459
                    x1         x2        x3
r1 0.5128645 -0.458439 -0.1899533 0.4368459
r2 0.5128645 -0.458439 -0.1899533 0.4368459
> test3(dgamma,log=TRUE)
         [,1]       [,2]
r1 -0.6677437 -0.8938795
r2 -0.6677437 -0.8938795
         [,1]       [,2]
r1 -0.6677437 -0.3703772
r2 -0.6677437 -0.3703772
         [,1]      [,2]
r1 -0.6677437 0.8517766
r2 -0.6677437 0.8517766
                      x1         x2        x3
r1 -0.6677437 -0.8938795 -0.3703772 0.8517766
r2 -0.6677437 -0.8938795 -0.3703772 0.8517766
> test3z(dgamma)
           [,1]          [,2]
r1 4.226687e-19 -2.379372e-18
r2 4.226687e-19 -2.379373e-18
           [,1]         [,2]
r1 4.226687e-19 7.615900e-19
r2 4.226687e-19 7.615899e-19
           [,1]          [,2]
r1 4.226687e-19 -4.003294e-18
r2 4.226687e-19 -4.003296e-18
                           z1           z2            z3
r1 4.226687e-19 -2.379372e-18 7.615900e-19 -4.003294e-18
r2 4.226687e-19 -2.379373e-18 7.615899e-19 -4.003296e-18
> test3z(dgamma,log=TRUE)
       [,1]      [,2]
r1 -42.3077 -5.629405
r2 -42.3077 -5.629405
       [,1]    [,2]
r1 -42.3077 1.80186
r2 -42.3077 1.80186
       [,1]      [,2]
r1 -42.3077 -9.471475
r2 -42.3077 -9.471475
                   z1      z2        z3
r1 -42.3077 -5.629405 1.80186 -9.471475
r2 -42.3077 -5.629405 1.80186 -9.471475
> 
> dgamma_scale <- function (x,a,b,...) dgamma(x,a,scale=b,...)
> test3(dgamma_scale)
        [,1]      [,2]
r1 0.7066063 -1.205443
r2 0.7066063 -1.205443
        [,1]      [,2]
r1 0.7066063 0.2974105
r2 0.7066063 0.2974105
        [,1]      [,2]
r1 0.7066063 -0.195162
r2 0.7066063 -0.195162
                    x1        x2        x3
r1 0.7066063 -1.205443 0.2974105 -0.195162
r2 0.7066063 -1.205443 0.2974105 -0.195162
> test3(dgamma_scale,log=TRUE)
         [,1]      [,2]
r1 -0.3472817 -1.705962
r2 -0.3472817 -1.705962
         [,1]      [,2]
r1 -0.3472817 0.4208999
r2 -0.3472817 0.4208999
         [,1]       [,2]
r1 -0.3472817 -0.2761962
r2 -0.3472817 -0.2761962
                     x1        x2         x3
r1 -0.3472817 -1.705962 0.4208999 -0.2761962
r2 -0.3472817 -1.705962 0.4208999 -0.2761962
> test3z(dgamma_scale)
           [,1]         [,2]
r1 2.798995e-08 2.547383e-08
r2 2.798995e-08 2.547382e-08
           [,1]          [,2]
r1 2.798995e-08 -5.595390e-08
r2 2.798995e-08 -5.595391e-08
           [,1]          [,2]
r1 2.798995e-08 -4.772068e-08
r2 2.798995e-08 -4.772069e-08
                          z1            z2            z3
r1 2.798995e-08 2.547383e-08 -5.595390e-08 -4.772068e-08
r2 2.798995e-08 2.547382e-08 -5.595391e-08 -4.772069e-08
> test3z(dgamma_scale,log=TRUE)
        [,1]      [,2]
r1 -17.39142 0.9101062
r2 -17.39142 0.9101062
        [,1]      [,2]
r1 -17.39142 -1.999072
r2 -17.39142 -1.999072
        [,1]      [,2]
r1 -17.39142 -1.704922
r2 -17.39142 -1.704922
                    z1        z2        z3
r1 -17.39142 0.9101062 -1.999072 -1.704922
r2 -17.39142 0.9101062 -1.999072 -1.704922
> 
> test3(pgamma)
        [,1]      [,2]
r1 0.3255045 0.5128645
r2 0.3255045 0.5128645
        [,1]       [,2]
r1 0.3255045 -0.5138569
r2 0.3255045  0.0000000
        [,1]      [,2]
r1 0.3255045 0.3635034
r2 0.3255045 0.3635034
                    x1         x2        x3
r1 0.3255045 0.5128645 -0.5138569 0.3635034
r2 0.3255045 0.5128645  0.0000000 0.3635034
> test3(pgamma,log=TRUE)
        [,1]     [,2]
r1 -1.122379 1.575599
r2 -1.122379 1.575599
        [,1]      [,2]
r1 -1.122379 -1.578648
r2 -1.122379  0.000000
        [,1]     [,2]
r1 -1.122379 1.116739
r2 -1.122379 1.116739
                   x1        x2       x3
r1 -1.122379 1.575599 -1.578648 1.116739
r2 -1.122379 1.575599  0.000000 1.116739
> test3(pgamma,lower=FALSE)
        [,1]       [,2]
r1 0.6744955 -0.5128644
r2 0.6744955 -0.5128645
        [,1]      [,2]
r1 0.6744955 0.5138569
r2 0.6744955 0.0000000
        [,1]       [,2]
r1 0.6744955 -0.3635034
r2 0.6744955 -0.3635034
                     x1        x2         x3
r1 0.6744955 -0.5128644 0.5138569 -0.3635034
r2 0.6744955 -0.5128645 0.0000000 -0.3635034
> test3(pgamma,log=TRUE,lower=FALSE)
         [,1]       [,2]
r1 -0.3937902 -0.7603675
r2 -0.3937902 -0.7603675
         [,1]      [,2]
r1 -0.3937902 0.7618388
r2 -0.3937902 0.0000000
         [,1]       [,2]
r1 -0.3937902 -0.5389263
r2 -0.3937902 -0.5389263
                      x1        x2         x3
r1 -0.3937902 -0.7603675 0.7618388 -0.5389263
r2 -0.3937902 -0.7603675 0.0000000 -0.5389263
> test3z(pgamma)
   [,1]         [,2]
r1    1 0.000000e+00
r2    1 4.226687e-19
   [,1] [,2]
r1    1    0
r2    1    0
   [,1]        [,2]
r1    1 0.00000e+00
r2    1 7.22365e-19
               z1 z2          z3
r1 1 0.000000e+00  0 0.00000e+00
r2 1 4.226687e-19  0 7.22365e-19
> test3z(pgamma,log=TRUE)
            [,1]         [,2]
r1 -7.487095e-20 4.226685e-19
r2 -7.487095e-20 4.226687e-19
            [,1]          [,2]
r1 -7.487095e-20 -1.360467e-19
r2 -7.487095e-20  0.000000e+00
            [,1]         [,2]
r1 -7.487095e-20 7.223646e-19
r2 -7.487095e-20 7.223650e-19
                           z1            z2           z3
r1 -7.487095e-20 4.226685e-19 -1.360467e-19 7.223646e-19
r2 -7.487095e-20 4.226687e-19  0.000000e+00 7.223650e-19
> test3z(pgamma,lower=FALSE)
           [,1]          [,2]
r1 7.487095e-20 -4.226685e-19
r2 7.487095e-20 -4.226687e-19
           [,1]         [,2]
r1 7.487095e-20 1.360467e-19
r2 7.487095e-20 0.000000e+00
           [,1]          [,2]
r1 7.487095e-20 -7.223646e-19
r2 7.487095e-20 -7.223650e-19
                           z1           z2            z3
r1 7.487095e-20 -4.226685e-19 1.360467e-19 -7.223646e-19
r2 7.487095e-20 -4.226687e-19 0.000000e+00 -7.223650e-19
> test3z(pgamma,log=TRUE,lower=FALSE)
        [,1]      [,2]
r1 -44.03852 -5.645296
r2 -44.03852 -5.645296
        [,1]     [,2]
r1 -44.03852 1.817082
r2 -44.03852 0.000000
        [,1]      [,2]
r1 -44.03852 -9.648134
r2 -44.03852 -9.648134
                    z1       z2        z3
r1 -44.03852 -5.645296 1.817082 -9.648134
r2 -44.03852 -5.645296 0.000000 -9.648134
> 
> test3(qgamma)
        [,1]     [,2]
r1 0.8181445 2.596227
r2 0.8181445 2.596227
        [,1]     [,2]
r1 0.8181445 1.369315
r2 0.8181445 0.000000
        [,1]      [,2]
r1 0.8181445 -1.215217
r2 0.8181445 -1.215217
                   x1       x2        x3
r1 0.8181445 2.596227 1.369315 -1.215217
r2 0.8181445 2.596227 0.000000 -1.215217
> test3u(qgamma,log=TRUE)
      [,1]     [,2]
r1 1.77312 2.455183
r2 1.77312 2.455183
      [,1]      [,2]
r1 1.77312 0.9788234
r2 1.77312 0.0000000
      [,1]      [,2]
r1 1.77312 -1.450844
r2 1.77312 -1.450844
                 u1        u2        u3
r1 1.77312 2.455183 0.9788234 -1.450844
r2 1.77312 2.455183 0.0000000 -1.450844
> test3(qgamma,lower=FALSE)
        [,1]      [,2]
r1 0.9426019 -2.865545
r2 0.9426019 -2.865544
        [,1]     [,2]
r1 0.9426019 1.479961
r2 0.9426019 0.000000
        [,1]      [,2]
r1 0.9426019 -1.400077
r2 0.9426019 -1.400077
                    x1       x2        x3
r1 0.9426019 -2.865545 1.479961 -1.400077
r2 0.9426019 -2.865544 0.000000 -1.400077
> test3u(qgamma,log=TRUE,lower=FALSE)
       [,1]     [,2]
r1 0.800113 -1.42772
r2 0.800113 -1.42772
       [,1]      [,2]
r1 0.800113 0.6460083
r2 0.800113 0.0000000
       [,1]       [,2]
r1 0.800113 -0.6546873
r2 0.800113 -0.6546873
                  u1        u2         u3
r1 0.800113 -1.42772 0.6460083 -0.6546873
r2 0.800113 -1.42772 0.0000000 -0.6546873
> 
> test3(dlnorm)
         [,1]      [,2]
r1 0.06516845 0.3559332
r2 0.06516845 0.3559332
         [,1]       [,2]
r1 0.06516845 -0.2350126
r2 0.06516845 -0.2350126
         [,1]      [,2]
r1 0.06516845 0.4737897
r2 0.06516845 0.4737896
                     x1         x2        x3
r1 0.06516845 0.3559332 -0.2350126 0.4737897
r2 0.06516845 0.3559332 -0.2350126 0.4737896
> test3(dlnorm,log=TRUE)
       [,1]     [,2]
r1 -2.73078 5.461741
r2 -2.73078 5.461741
       [,1]      [,2]
r1 -2.73078 -3.606234
r2 -2.73078 -3.606234
       [,1]     [,2]
r1 -2.73078 7.270230
r2 -2.73078 7.270231
                  x1        x2       x3
r1 -2.73078 5.461741 -3.606234 7.270230
r2 -2.73078 5.461741 -3.606234 7.270231
> test3z(dlnorm)
          [,1]          [,2]
r1 0.001459423 -9.719854e-05
r2 0.001459423 -9.719854e-05
          [,1]         [,2]
r1 0.001459423 -0.000348259
r2 0.001459423 -0.000348259
          [,1]         [,2]
r1 0.001459423 0.0003377033
r2 0.001459423 0.0003377033
                          z1           z2           z3
r1 0.001459423 -9.719854e-05 -0.000348259 0.0003377033
r2 0.001459423 -9.719854e-05 -0.000348259 0.0003377033
> test3z(dlnorm,log=TRUE)
        [,1]        [,2]
r1 -6.529714 -0.06660066
r2 -6.529714 -0.06660066
        [,1]       [,2]
r1 -6.529714 -0.2386279
r2 -6.529714 -0.2386279
        [,1]      [,2]
r1 -6.529714 0.2313951
r2 -6.529714 0.2313951
                      z1         z2        z3
r1 -6.529714 -0.06660066 -0.2386279 0.2313951
r2 -6.529714 -0.06660066 -0.2386279 0.2313951
> 
> test3(plnorm)
          [,1]       [,2]
r1 0.007593333 0.06516845
r2 0.007593333 0.06516845
          [,1]        [,2]
r1 0.007593333 -0.03109708
r2 0.007593333 -0.03109708
          [,1]      [,2]
r1 0.007593333 0.0755005
r2 0.007593333 0.0755005
                       x1          x2        x3
r1 0.007593333 0.06516845 -0.03109708 0.0755005
r2 0.007593333 0.06516845 -0.03109708 0.0755005
> test3(plnorm,log=TRUE)
        [,1]     [,2]
r1 -4.880485 8.582325
r2 -4.880485 8.582325
        [,1]      [,2]
r1 -4.880485 -4.095314
r2 -4.880485 -4.095314
        [,1]     [,2]
r1 -4.880485 9.942999
r2 -4.880485 9.942999
                   x1        x2       x3
r1 -4.880485 8.582325 -4.095314 9.942999
r2 -4.880485 8.582325 -4.095314 9.942999
> test3(plnorm,lower=FALSE)
        [,1]        [,2]
r1 0.9924067 -0.06516846
r2 0.9924067 -0.06516845
        [,1]       [,2]
r1 0.9924067 0.03109708
r2 0.9924067 0.03109708
        [,1]       [,2]
r1 0.9924067 -0.0755005
r2 0.9924067 -0.0755005
                      x1         x2         x3
r1 0.9924067 -0.06516846 0.03109708 -0.0755005
r2 0.9924067 -0.06516845 0.03109708 -0.0755005
> test3(plnorm,log=TRUE,lower=FALSE)
           [,1]        [,2]
r1 -0.007622309 -0.06566708
r2 -0.007622309 -0.06566708
           [,1]       [,2]
r1 -0.007622309 0.03133502
r2 -0.007622309 0.03133502
           [,1]        [,2]
r1 -0.007622309 -0.07607819
r2 -0.007622309 -0.07607819
                         x1         x2          x3
r1 -0.007622309 -0.06566708 0.03133502 -0.07607819
r2 -0.007622309 -0.06566708 0.03133502 -0.07607819
> test3z(plnorm)
         [,1]        [,2]
r1 0.05522383 0.001459423
r2 0.05522383 0.001459423
         [,1]        [,2]
r1 0.05522383 -0.01668398
r2 0.05522383 -0.01668398
         [,1]      [,2]
r1 0.05522383 0.0266307
r2 0.05522383 0.0266307
                       z1          z2        z3
r1 0.05522383 0.001459423 -0.01668398 0.0266307
r2 0.05522383 0.001459423 -0.01668398 0.0266307
> test3z(plnorm,log=TRUE)
        [,1]       [,2]
r1 -2.896361 0.02642741
r2 -2.896361 0.02642741
        [,1]       [,2]
r1 -2.896361 -0.3021155
r2 -2.896361 -0.3021155
        [,1]     [,2]
r1 -2.896361 0.482232
r2 -2.896361 0.482232
                     z1         z2       z3
r1 -2.896361 0.02642741 -0.3021155 0.482232
r2 -2.896361 0.02642741 -0.3021155 0.482232
> test3z(plnorm,lower=FALSE)
        [,1]         [,2]
r1 0.9447762 -0.001459423
r2 0.9447762 -0.001459423
        [,1]       [,2]
r1 0.9447762 0.01668398
r2 0.9447762 0.01668398
        [,1]       [,2]
r1 0.9447762 -0.0266307
r2 0.9447762 -0.0266307
                       z1         z2         z3
r1 0.9447762 -0.001459423 0.01668398 -0.0266307
r2 0.9447762 -0.001459423 0.01668398 -0.0266307
> test3z(plnorm,log=TRUE,lower=FALSE)
          [,1]         [,2]
r1 -0.05680724 -0.001544729
r2 -0.05680724 -0.001544729
          [,1]       [,2]
r1 -0.05680724 0.01765918
r2 -0.05680724 0.01765919
          [,1]        [,2]
r1 -0.05680724 -0.02818731
r2 -0.05680724 -0.02818731
                         z1         z2          z3
r1 -0.05680724 -0.001544729 0.01765918 -0.02818731
r2 -0.05680724 -0.001544729 0.01765919 -0.02818731
> 
> test3(qlnorm)
      [,1]    [,2]
r1 2.35417 3.97938
r2 2.35417 3.97938
      [,1]    [,2]
r1 2.35417 2.35417
r2 2.35417 2.35417
      [,1]      [,2]
r1 2.35417 -0.134735
r2 2.35417 -0.134735
                x1      x2        x3
r1 2.35417 3.97938 2.35417 -0.134735
r2 2.35417 3.97938 2.35417 -0.134735
> test3y(qlnorm,log=TRUE)
       [,1]     [,2]
r1 0.810924 1.934376
r2 0.810924 1.934376
       [,1]     [,2]
r1 0.810924 0.810924
r2 0.810924 0.810924
       [,1]     [,2]
r1 0.810924 0.400455
r2 0.810924 0.400455
                  y1       y2       y3
r1 0.810924 1.934376 0.810924 0.400455
r2 0.810924 1.934376 0.810924 0.400455
> test3(qlnorm,lower=FALSE)
       [,1]      [,2]
r1 2.542764 -4.298171
r2 2.542764 -4.298171
       [,1]     [,2]
r1 2.542764 2.542764
r2 2.542764 2.542764
       [,1]      [,2]
r1 2.542764 0.1455287
r2 2.542764 0.1455287
                   x1       x2        x3
r1 2.542764 -4.298171 2.542764 0.1455287
r2 2.542764 -4.298171 2.542764 0.1455287
> test3y(qlnorm,log=TRUE,lower=FALSE)
        [,1]       [,2]
r1 0.2425326 -0.5785366
r2 0.2425326 -0.5785366
        [,1]      [,2]
r1 0.2425326 0.2425326
r2 0.2425326 0.2425326
        [,1]       [,2]
r1 0.2425326 -0.1197688
r2 0.2425326 -0.1197688
                     y1        y2         y3
r1 0.2425326 -0.5785366 0.2425326 -0.1197688
r2 0.2425326 -0.5785366 0.2425326 -0.1197688
> 
> test2r(rlnorm)
                x1        x2
r1 2.16995 2.16995 0.7215801
r2 2.16995 2.16995 0.7215800
> 
> test3(dlogis)
        [,1]      [,2]
r1 0.3377968 0.1507839
r2 0.3377968 0.1507838
        [,1]       [,2]
r1 0.3377968 -0.1507838
r2 0.3377968 -0.1507838
        [,1]       [,2]
r1 0.3377968 -0.4082265
r2 0.3377968 -0.4082265
                    x1         x2         x3
r1 0.3377968 0.1507839 -0.1507838 -0.4082265
r2 0.3377968 0.1507838 -0.1507838 -0.4082265
> test3(dlogis,log=TRUE)
        [,1]      [,2]
r1 -1.085311 0.4463744
r2 -1.085311 0.4463744
        [,1]       [,2]
r1 -1.085311 -0.4463744
r2 -1.085311 -0.4463744
        [,1]      [,2]
r1 -1.085311 -1.208497
r2 -1.085311 -1.208497
                    x1         x2        x3
r1 -1.085311 0.4463744 -0.4463744 -1.208497
r2 -1.085311 0.4463744 -0.4463744 -1.208497
> test3z(dlogis)
         [,1]         [,2]
r1 0.03679051 0.0006876616
r2 0.03679051 0.0006876617
         [,1]          [,2]
r1 0.03679051 -0.0006876618
r2 0.03679051 -0.0006876617
         [,1]         [,2]
r1 0.03679051 -0.005327287
r2 0.03679051 -0.005327288
                        z1            z2           z3
r1 0.03679051 0.0006876616 -0.0006876618 -0.005327287
r2 0.03679051 0.0006876617 -0.0006876617 -0.005327288
> test3z(dlogis,log=TRUE)
        [,1]       [,2]
r1 -3.302515 0.01869128
r2 -3.302515 0.01869128
        [,1]        [,2]
r1 -3.302515 -0.01869128
r2 -3.302515 -0.01869128
        [,1]       [,2]
r1 -3.302515 -0.1448006
r2 -3.302515 -0.1448006
                     z1          z2         z3
r1 -3.302515 0.01869128 -0.01869128 -0.1448006
r2 -3.302515 0.01869128 -0.01869128 -0.1448006
> 
> test3(plogis)
        [,1]      [,2]
r1 0.3497392 0.3377968
r2 0.3497392 0.3377968
        [,1]       [,2]
r1 0.3497392 -0.3377968
r2 0.3497392 -0.3377968
        [,1]      [,2]
r1 0.3497392 0.2094967
r2 0.3497392 0.2094967
                    x1         x2        x3
r1 0.3497392 0.3377968 -0.3377968 0.2094967
r2 0.3497392 0.3377968 -0.3377968 0.2094967
> test3(plogis,log=TRUE)
        [,1]      [,2]
r1 -1.050567 0.9658534
r2 -1.050567 0.9658534
        [,1]       [,2]
r1 -1.050567 -0.9658534
r2 -1.050567 -0.9658534
        [,1]      [,2]
r1 -1.050567 0.5990084
r2 -1.050567 0.5990084
                    x1         x2        x3
r1 -1.050567 0.9658534 -0.9658534 0.5990084
r2 -1.050567 0.9658534 -0.9658534 0.5990084
> test3(plogis,lower=FALSE)
        [,1]       [,2]
r1 0.6502608 -0.3377968
r2 0.6502608 -0.3377968
        [,1]      [,2]
r1 0.6502608 0.3377968
r2 0.6502608 0.3377968
        [,1]       [,2]
r1 0.6502608 -0.2094967
r2 0.6502608 -0.2094967
                     x1        x2         x3
r1 0.6502608 -0.3377968 0.3377968 -0.2094967
r2 0.6502608 -0.3377968 0.3377968 -0.2094967
> test3(plogis,log=TRUE,lower=FALSE)
         [,1]      [,2]
r1 -0.4303818 -0.519479
r2 -0.4303818 -0.519479
         [,1]     [,2]
r1 -0.4303818 0.519479
r2 -0.4303818 0.519479
         [,1]       [,2]
r1 -0.4303818 -0.3221734
r2 -0.4303818 -0.3221734
                     x1       x2         x3
r1 -0.4303818 -0.519479 0.519479 -0.3221734
r2 -0.4303818 -0.519479 0.519479 -0.3221734
> test3z(plogis)
        [,1]       [,2]
r1 0.4374869 0.03679051
r2 0.4374869 0.03679051
        [,1]        [,2]
r1 0.4374869 -0.03679051
r2 0.4374869 -0.03679051
        [,1]        [,2]
r1 0.4374869 0.009247941
r2 0.4374869 0.009247941
                     z1          z2          z3
r1 0.4374869 0.03679051 -0.03679051 0.009247941
r2 0.4374869 0.03679051 -0.03679051 0.009247941
> test3z(plogis,log=TRUE)
         [,1]       [,2]
r1 -0.8267084 0.08409512
r2 -0.8267084 0.08409512
         [,1]        [,2]
r1 -0.8267084 -0.08409512
r2 -0.8267084 -0.08409512
         [,1]       [,2]
r1 -0.8267084 0.02113878
r2 -0.8267084 0.02113878
                      z1          z2         z3
r1 -0.8267084 0.08409512 -0.08409512 0.02113878
r2 -0.8267084 0.08409512 -0.08409512 0.02113878
> test3z(plogis,lower=FALSE)
        [,1]        [,2]
r1 0.5625131 -0.03679051
r2 0.5625131 -0.03679051
        [,1]       [,2]
r1 0.5625131 0.03679051
r2 0.5625131 0.03679051
        [,1]         [,2]
r1 0.5625131 -0.009247940
r2 0.5625131 -0.009247941
                      z1         z2           z3
r1 0.5625131 -0.03679051 0.03679051 -0.009247940
r2 0.5625131 -0.03679051 0.03679051 -0.009247941
> test3z(plogis,log=TRUE,lower=FALSE)
         [,1]        [,2]
r1 -0.5753409 -0.06540384
r2 -0.5753409 -0.06540384
         [,1]       [,2]
r1 -0.5753409 0.06540384
r2 -0.5753409 0.06540384
         [,1]       [,2]
r1 -0.5753409 -0.0164404
r2 -0.5753409 -0.0164404
                       z1         z2         z3
r1 -0.5753409 -0.06540384 0.06540384 -0.0164404
r2 -0.5753409 -0.06540384 0.06540384 -0.0164404
> 
> test3(qlogis)
       [,1]     [,2]
r1 0.833223 2.698621
r2 0.833223 2.698621
       [,1] [,2]
r1 0.833223    1
r2 0.833223    1
       [,1]        [,2]
r1 0.833223 -0.09134345
r2 0.833223 -0.09134346
                  x1 x2          x3
r1 0.833223 2.698621  1 -0.09134345
r2 0.833223 2.698621  1 -0.09134346
> test3y(qlogis,log=TRUE)
       [,1]     [,2]
r1 0.160669 3.933287
r2 0.160669 3.933287
       [,1] [,2]
r1 0.160669    1
r2 0.160669    1
       [,1]      [,2]
r1 0.160669 0.7967802
r2 0.160669 0.7967802
                  y1 y2        y3
r1 0.160669 3.933287  1 0.7967802
r2 0.160669 3.933287  1 0.7967802
> test3(qlogis,lower=FALSE)
       [,1]      [,2]
r1 0.956217 -2.698621
r2 0.956217 -2.698621
       [,1] [,2]
r1 0.956217    1
r2 0.956217    1
       [,1]       [,2]
r1 0.956217 0.09134345
r2 0.956217 0.09134346
                   x1 x2         x3
r1 0.956217 -2.698621  1 0.09134345
r2 0.956217 -2.698621  1 0.09134346
> test3y(qlogis,log=TRUE,lower=FALSE)
        [,1]      [,2]
r1 -1.786869 -3.933287
r2 -1.786869 -3.933287
        [,1] [,2]
r1 -1.786869    1
r2 -1.786869    1
        [,1]       [,2]
r1 -1.786869 -0.7967802
r2 -1.786869 -0.7967802
                    y1 y2         y3
r1 -1.786869 -3.933287  1 -0.7967802
r2 -1.786869 -3.933287  1 -0.7967802
> 
> test2r(rlogis)
             x1        x2
r1 0.9543501  1 0.5333178
r2 0.9543501  1 0.5333178
> 
> test3v(dnbinom)
        [,1]      [,2]
r1 0.1770527 0.3796633
r2 0.1770527 0.3796633
> test3v(dnbinom,log=TRUE)
        [,1]     [,2]
r1 -1.731308 2.144351
r2 -1.731308 2.144351
> 
> test3v(pnbinom)
        [,1]     [,2]
r1 0.5173596 2.718452
r2 0.5173596 2.718452
> test3v(pnbinom,log=TRUE)
         [,1]     [,2]
r1 -0.6590172 5.254472
r2 -0.6590172 5.254472
> test3v(pnbinom,lower=FALSE)
        [,1]      [,2]
r1 0.4826404 -2.718452
r2 0.4826404 -2.718452
> test3v(pnbinom,log=TRUE,lower=FALSE)
         [,1]      [,2]
r1 -0.7284833 -5.632457
r2 -0.7284833 -5.632457
> 
> dnbinom_mu <- function (x, size, mu, ...) dnbinom(x,size,mu=mu,...)
> test3v(dnbinom_mu)
         [,1]       [,2]
r1 0.02779435 0.09169925
r2 0.02779435 0.09169925
> test3v(dnbinom_mu,log=TRUE)
        [,1]     [,2]
r1 -3.582923 3.299205
r2 -3.582923 3.299205
> 
> pnbinom_mu <- function (q, size, mu, ...) pnbinom(q,size,mu=mu,...)
> test3v(pnbinom_mu)
        [,1]        [,2]
r1 0.9927539 -0.03632630
r2 0.9927539 -0.03632631
> test3v(pnbinom_mu,log=TRUE)
           [,1]        [,2]
r1 -0.007272439 -0.03659145
r2 -0.007272439 -0.03659145
> test3v(pnbinom_mu,lower=FALSE)
          [,1]       [,2]
r1 0.007246059 0.03632631
r2 0.007246059 0.03632631
> test3v(pnbinom_mu,log=TRUE,lower=FALSE)
        [,1]    [,2]
r1 -4.927298 5.01325
r2 -4.927298 5.01325
> 
> test3(dnorm)
        [,1]      [,2]
r1 0.4888913 0.4503578
r2 0.4888913 0.4503578
        [,1]       [,2]
r1 0.4888913 -0.4503578
r2 0.4888913 -0.4503578
        [,1]       [,2]
r1 0.4888913 -0.4468606
r2 0.4888913 -0.4468606
                    x1         x2         x3
r1 0.4888913 0.4503578 -0.4503578 -0.4468606
r2 0.4888913 0.4503578 -0.4503578 -0.4468606
> test3(dnorm,log=TRUE)
         [,1]      [,2]
r1 -0.7156151 0.9211818
r2 -0.7156151 0.9211818
         [,1]       [,2]
r1 -0.7156151 -0.9211819
r2 -0.7156151 -0.9211818
         [,1]       [,2]
r1 -0.7156151 -0.9140286
r2 -0.7156151 -0.9140286
                     x1         x2         x3
r1 -0.7156151 0.9211818 -0.9211819 -0.9140286
r2 -0.7156151 0.9211818 -0.9211818 -0.9140286
> test3z(dnorm)
         [,1]        [,2]
r1 0.05778667 0.002171576
r2 0.05778667 0.002171576
         [,1]         [,2]
r1 0.05778667 -0.002171576
r2 0.05778667 -0.002171576
         [,1]         [,2]
r1 0.05778667 -0.008093182
r2 0.05778667 -0.008093182
                       z1           z2           z3
r1 0.05778667 0.002171576 -0.002171576 -0.008093182
r2 0.05778667 0.002171576 -0.002171576 -0.008093182
> test3z(dnorm,log=TRUE)
        [,1]       [,2]
r1 -2.850997 0.03757919
r2 -2.850997 0.03757918
        [,1]        [,2]
r1 -2.850997 -0.03757918
r2 -2.850997 -0.03757918
        [,1]       [,2]
r1 -2.850997 -0.1400528
r2 -2.850997 -0.1400528
                     z1          z2         z3
r1 -2.850997 0.03757919 -0.03757918 -0.1400528
r2 -2.850997 0.03757918 -0.03757918 -0.1400528
> 
> test3(pnorm)
        [,1]      [,2]
r1 0.2675678 0.4888913
r2 0.2675678 0.4888913
        [,1]       [,2]
r1 0.2675678 -0.4888913
r2 0.2675678 -0.4888913
        [,1]      [,2]
r1 0.2675678 0.3032034
r2 0.2675678 0.3032034
                    x1         x2        x3
r1 0.2675678 0.4888913 -0.4888913 0.3032034
r2 0.2675678 0.4888913 -0.4888913 0.3032034
> test3(pnorm,log=TRUE)
        [,1]     [,2]
r1 -1.318382 1.827168
r2 -1.318382 1.827168
        [,1]      [,2]
r1 -1.318382 -1.827168
r2 -1.318382 -1.827168
        [,1]     [,2]
r1 -1.318382 1.133183
r2 -1.318382 1.133183
                   x1        x2       x3
r1 -1.318382 1.827168 -1.827168 1.133183
r2 -1.318382 1.827168 -1.827168 1.133183
> test3(pnorm,lower=FALSE)
        [,1]       [,2]
r1 0.7324322 -0.4888913
r2 0.7324322 -0.4888913
        [,1]      [,2]
r1 0.7324322 0.4888913
r2 0.7324322 0.4888913
        [,1]       [,2]
r1 0.7324322 -0.3032034
r2 0.7324322 -0.3032034
                     x1        x2         x3
r1 0.7324322 -0.4888913 0.4888913 -0.3032034
r2 0.7324322 -0.4888913 0.4888913 -0.3032034
> test3(pnorm,log=TRUE,lower=FALSE)
         [,1]       [,2]
r1 -0.3113845 -0.6674902
r2 -0.3113845 -0.6674902
         [,1]      [,2]
r1 -0.3113845 0.6674901
r2 -0.3113845 0.6674902
         [,1]       [,2]
r1 -0.3113845 -0.4139678
r2 -0.3113845 -0.4139678
                      x1        x2         x3
r1 -0.3113845 -0.6674902 0.6674901 -0.4139678
r2 -0.3113845 -0.6674902 0.6674902 -0.4139678
> test3z(pnorm)
       [,1]       [,2]
r1 0.400765 0.05778667
r2 0.400765 0.05778667
       [,1]        [,2]
r1 0.400765 -0.05778667
r2 0.400765 -0.05778667
       [,1]       [,2]
r1 0.400765 0.01452569
r2 0.400765 0.01452569
                    z1          z2         z3
r1 0.400765 0.05778667 -0.05778667 0.01452569
r2 0.400765 0.05778667 -0.05778667 0.01452569
> test3z(pnorm,log=TRUE)
         [,1]      [,2]
r1 -0.9143801 0.1441909
r2 -0.9143801 0.1441909
         [,1]       [,2]
r1 -0.9143801 -0.1441909
r2 -0.9143801 -0.1441909
         [,1]       [,2]
r1 -0.9143801 0.03624491
r2 -0.9143801 0.03624491
                     z1         z2         z3
r1 -0.9143801 0.1441909 -0.1441909 0.03624491
r2 -0.9143801 0.1441909 -0.1441909 0.03624491
> test3z(pnorm,lower=FALSE)
       [,1]        [,2]
r1 0.599235 -0.05778667
r2 0.599235 -0.05778667
       [,1]       [,2]
r1 0.599235 0.05778667
r2 0.599235 0.05778667
       [,1]        [,2]
r1 0.599235 -0.01452569
r2 0.599235 -0.01452569
                     z1         z2          z3
r1 0.599235 -0.05778667 0.05778667 -0.01452569
r2 0.599235 -0.05778667 0.05778667 -0.01452569
> test3z(pnorm,log=TRUE,lower=FALSE)
         [,1]        [,2]
r1 -0.5121014 -0.09643406
r2 -0.5121014 -0.09643406
         [,1]       [,2]
r1 -0.5121014 0.09643406
r2 -0.5121014 0.09643406
         [,1]        [,2]
r1 -0.5121014 -0.02424039
r2 -0.5121014 -0.02424039
                       z1         z2          z3
r1 -0.5121014 -0.09643406 0.09643406 -0.02424039
r2 -0.5121014 -0.09643406 0.09643406 -0.02424039
> 
> test3(qnorm)
        [,1]     [,2]
r1 0.8561882 1.690354
r2 0.8561882 1.690354
        [,1] [,2]
r1 0.8561882    1
r2 0.8561882    1
        [,1]        [,2]
r1 0.8561882 -0.05723249
r2 0.8561882 -0.05723249
                   x1 x2          x3
r1 0.8561882 1.690354  1 -0.05723249
r2 0.8561882 1.690354  1 -0.05723249
> test3y(qnorm,log=TRUE)
        [,1]     [,2]
r1 -0.209581 2.385397
r2 -0.209581 2.385397
        [,1] [,2]
r1 -0.209581    1
r2 -0.209581    1
        [,1]      [,2]
r1 -0.209581 0.4938256
r2 -0.209581 0.4938256
                   y1 y2        y3
r1 -0.209581 2.385397  1 0.4938256
r2 -0.209581 2.385397  1 0.4938256
> test3(qnorm,lower=FALSE)
        [,1]      [,2]
r1 0.9332518 -1.690354
r2 0.9332518 -1.690354
        [,1] [,2]
r1 0.9332518    1
r2 0.9332518    1
        [,1]       [,2]
r1 0.9332518 0.05723249
r2 0.9332518 0.05723249
                    x1 x2         x3
r1 0.9332518 -1.690354  1 0.05723249
r2 0.9332518 -1.690354  1 0.05723249
> test3y(qnorm,log=TRUE,lower=FALSE)
        [,1]      [,2]
r1 -1.416619 -2.385397
r2 -1.416619 -2.385397
        [,1] [,2]
r1 -1.416619    1
r2 -1.416619    1
        [,1]       [,2]
r1 -1.416619 -0.4938256
r2 -1.416619 -0.4938256
                    y1 y2         y3
r1 -1.416619 -2.385397  1 -0.4938256
r2 -1.416619 -2.385397  1 -0.4938256
> 
> test2r(rnorm)
            x1        x2
r1 0.774704  1 0.3325331
r2 0.774704  1 0.3325331
> 
> test3w(dunif)
        [,1] [,2]
r1 0.2185931    0
r2 0.2185931    0
        [,1]       [,2]
r1 0.2185931 0.04778294
r2 0.2185931 0.04778294
        [,1]        [,2]
r1 0.2185931 -0.04778294
r2 0.2185931 -0.04778294
             w1         w2          w3
r1 0.2185931  0 0.04778294 -0.04778294
r2 0.2185931  0 0.04778294 -0.04778294
> test3w(dunif,log=TRUE)
        [,1] [,2]
r1 -1.520543    0
r2 -1.520543    0
        [,1]      [,2]
r1 -1.520543 0.2185931
r2 -1.520543 0.2185931
        [,1]       [,2]
r1 -1.520543 -0.2185931
r2 -1.520543 -0.2185931
             w1        w2         w3
r1 -1.520543  0 0.2185931 -0.2185931
r2 -1.520543  0 0.2185931 -0.2185931
> 
> test3w(punif)
        [,1]      [,2]
r1 0.1588297 0.2185931
r2 0.1588297 0.2185931
        [,1]      [,2]
r1 0.1588297 -0.183874
r2 0.1588297 -0.183874
        [,1]        [,2]
r1 0.1588297 -0.03471908
r2 0.1588297 -0.03471908
                    w1        w2          w3
r1 0.1588297 0.2185931 -0.183874 -0.03471908
r2 0.1588297 0.2185931 -0.183874 -0.03471908
> test3w(punif,log=TRUE)
        [,1]     [,2]
r1 -1.839922 1.376273
r2 -1.839922 1.376273
        [,1]     [,2]
r1 -1.839922 -1.15768
r2 -1.839922 -1.15768
        [,1]       [,2]
r1 -1.839922 -0.2185931
r2 -1.839922 -0.2185931
                   w1       w2         w3
r1 -1.839922 1.376273 -1.15768 -0.2185931
r2 -1.839922 1.376273 -1.15768 -0.2185931
> test3w(punif,lower=FALSE)
        [,1]       [,2]
r1 0.8411703 -0.2185931
r2 0.8411703 -0.2185931
        [,1]     [,2]
r1 0.8411703 0.183874
r2 0.8411703 0.183874
        [,1]       [,2]
r1 0.8411703 0.03471908
r2 0.8411703 0.03471908
                     w1       w2         w3
r1 0.8411703 -0.2185931 0.183874 0.03471908
r2 0.8411703 -0.2185931 0.183874 0.03471908
> test3w(punif,log=TRUE,lower=FALSE)
         [,1]       [,2]
r1 -0.1729612 -0.2598678
r2 -0.1729612 -0.2598678
         [,1]      [,2]
r1 -0.1729612 0.2185930
r2 -0.1729612 0.2185931
         [,1]       [,2]
r1 -0.1729612 0.04127474
r2 -0.1729612 0.04127474
                      w1        w2         w3
r1 -0.1729612 -0.2598678 0.2185930 0.04127474
r2 -0.1729612 -0.2598678 0.2185931 0.04127474
> 
> test3w(qunif)
       [,1]    [,2]
r1 3.950024 4.57471
r2 3.950024 4.57471
       [,1]      [,2]
r1 3.950024 0.1611003
r2 3.950024 0.1611000
       [,1]   [,2]
r1 3.950024 0.8389
r2 3.950024 0.8389
                 w1        w2     w3
r1 3.950024 4.57471 0.1611003 0.8389
r2 3.950024 4.57471 0.1611000 0.8389
> test3y(qunif,log=TRUE)
        [,1]     [,2]
r1 0.5897541 1.402854
r2 0.5897541 1.402854
        [,1]      [,2]
r1 0.5897541 0.3107147
r2 0.5897541 0.3107147
        [,1]      [,2]
r1 0.5897541 0.6892853
r2 0.5897541 0.6892853
                   y1        y2        y3
r1 0.5897541 1.402854 0.3107147 0.6892853
r2 0.5897541 1.402854 0.3107147 0.6892853
> test3w(qunif,lower=FALSE)
        [,1]     [,2]
r1 0.8492858 -4.57471
r2 0.8492858 -4.57471
        [,1]      [,2]
r1 0.8492858 0.8389001
r2 0.8492858 0.8389000
        [,1]   [,2]
r1 0.8492858 0.1611
r2 0.8492858 0.1611
                   w1        w2     w3
r1 0.8492858 -4.57471 0.8389001 0.1611
r2 0.8492858 -4.57471 0.8389000 0.1611
> test3y(qunif,log=TRUE,lower=FALSE)
         [,1]      [,2]
r1 -0.1807241 -1.402854
r2 -0.1807241 -1.402854
         [,1]      [,2]
r1 -0.1807241 0.6892853
r2 -0.1807241 0.6892853
         [,1]      [,2]
r1 -0.1807241 0.3107147
r2 -0.1807241 0.3107147
                     y1        y2        y3
r1 -0.1807241 -1.402854 0.6892853 0.3107147
r2 -0.1807241 -1.402854 0.6892853 0.3107147
> 
> test2r(runif)
                    x1        x2
r1 0.7403373 0.3697434 0.6302566
r2 0.7403373 0.3697434 0.6302566
> 
> test3(dweibull)
        [,1]      [,2]
r1 0.6608068 -1.056386
r2 0.6608068 -1.056386
        [,1]     [,2]
r1 0.6608068 0.678268
r2 0.6608068 0.678268
        [,1]       [,2]
r1 0.6608068 -0.2327821
r2 0.6608068 -0.2327821
                    x1       x2         x3
r1 0.6608068 -1.056386 0.678268 -0.2327821
r2 0.6608068 -1.056386 0.678268 -0.2327821
> 
> test3(pweibull)
        [,1]      [,2]
r1 0.5204599 0.6608068
r2 0.5204599 0.6608068
        [,1]       [,2]
r1 0.5204599 -0.1213136
r2 0.5204599  0.1213136
        [,1]       [,2]
r1 0.5204599 -0.4683606
r2 0.5204599 -0.4683606
                    x1         x2         x3
r1 0.5204599 0.6608068 -0.1213136 -0.4683606
r2 0.5204599 0.6608068  0.1213136 -0.4683606
> test3(pweibull,log=TRUE)
         [,1]     [,2]
r1 -0.6530425 1.269659
r2 -0.6530425 1.269659
         [,1]       [,2]
r1 -0.6530425 -0.2330892
r2 -0.6530425  0.2330892
         [,1]       [,2]
r1 -0.6530425 -0.8998976
r2 -0.6530425 -0.8998976
                    x1         x2         x3
r1 -0.6530425 1.269659 -0.2330892 -0.8998976
r2 -0.6530425 1.269659  0.2330892 -0.8998976
> test3(pweibull,lower=FALSE)
        [,1]       [,2]
r1 0.4795401 -0.6608068
r2 0.4795401 -0.6608068
        [,1]       [,2]
r1 0.4795401  0.1213136
r2 0.4795401 -0.1213136
        [,1]      [,2]
r1 0.4795401 0.4683606
r2 0.4795401 0.4683606
                     x1         x2        x3
r1 0.4795401 -0.6608068  0.1213136 0.4683606
r2 0.4795401 -0.6608068 -0.1213136 0.4683606
> test3(pweibull,log=TRUE,lower=FALSE)
         [,1]      [,2]
r1 -0.7349277 -1.378001
r2 -0.7349277 -1.378001
         [,1]      [,2]
r1 -0.7349277  0.252979
r2 -0.7349277 -0.252979
         [,1]      [,2]
r1 -0.7349277 0.9766869
r2 -0.7349277 0.9766870
                     x1        x2        x3
r1 -0.7349277 -1.378001  0.252979 0.9766869
r2 -0.7349277 -1.378001 -0.252979 0.9766870
> 
> test3(qweibull)
        [,1]     [,2]
r1 0.4149231 1.367749
r2 0.4149231 1.367749
        [,1]      [,2]
r1 0.4149231 0.2244641
r2 0.4149231 0.2244641
        [,1]      [,2]
r1 0.4149231 0.6162988
r2 0.4149231 0.6162988
                   x1        x2        x3
r1 0.4149231 1.367749 0.2244641 0.6162988
r2 0.4149231 1.367749 0.2244641 0.6162988
> test3u(qweibull,log=TRUE)
       [,1]     [,2]
r1 1.331973 1.394251
r2 1.331973 1.394251
       [,1]        [,2]
r1 1.331973 -0.06322735
r2 1.331973 -0.06322735
       [,1]     [,2]
r1 1.331973 1.089878
r2 1.331973 1.089878
                  u1          u2       u3
r1 1.331973 1.394251 -0.06322735 1.089878
r2 1.331973 1.394251 -0.06322735 1.089878
> test3(qweibull,lower=FALSE)
        [,1]      [,2]
r1 0.4807618 -1.521984
r2 0.4807618 -1.521984
        [,1]      [,2]
r1 0.4807618 0.1809438
r2 0.4807618 0.1809438
        [,1]      [,2]
r1 0.4807618 0.7140911
r2 0.4807618 0.7140911
                    x1        x2        x3
r1 0.4807618 -1.521984 0.1809438 0.7140911
r2 0.4807618 -1.521984 0.1809438 0.7140911
> test3u(qweibull,log=TRUE,lower=FALSE)
       [,1]      [,2]
r1 0.708465 -1.050115
r2 0.708465 -1.050115
       [,1]      [,2]
r1 0.708465 0.2130552
r2 0.708465 0.2130552
       [,1]      [,2]
r1 0.708465 0.5796969
r2 0.708465 0.5796969
                   u1        u2        u3
r1 0.708465 -1.050115 0.2130552 0.5796969
r2 0.708465 -1.050115 0.2130552 0.5796969
> 
> test2r(rweibull)
                    x1        x2
r1 0.1770773 0.6011398 0.1979137
r2 0.1770773 0.6011398 0.1979137
> 
> 
> # Check gradients of lists.
> 
> with gradient (a=3.1) list (a^2, a^3)
[[1]]
[1] 9.61

[[2]]
[1] 29.791

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 6.2

attr(,"gradient")[[2]]
[1] 28.83

> with gradient (a=3.1) list (list(a^2), xx=sin(a), yy=99, zz=list(7,a^3))
[[1]]
[[1]][[1]]
[1] 9.61


$xx
[1] 0.04158066

$yy
[1] 99

$zz
$zz[[1]]
[1] 7

$zz[[2]]
[1] 29.791


attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 6.2


attr(,"gradient")$xx
[1] -0.9991352

attr(,"gradient")$yy
[1] 0

attr(,"gradient")$zz
attr(,"gradient")$zz[[1]]
[1] 0

attr(,"gradient")$zz[[2]]
[1] 28.83


> with gradient (a=3.1) with gradient (b=7.7) list(a*b,a^2*b^2)
[[1]]
[1] 23.87

[[2]]
[1] 569.7769

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 7.7

attr(,"gradient")[[2]]
[1] 367.598

> 
> with gradient (a=3.1) with gradient (b=100*a) list(a, b, a^2, b^2, a*b, a^2*b^2)
[[1]]
[1] 3.1

[[2]]
[1] 310

[[3]]
[1] 9.61

[[4]]
[1] 96100

[[5]]
[1] 961

[[6]]
[1] 923521

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1

attr(,"gradient")[[2]]
[1] 100

attr(,"gradient")[[3]]
[1] 6.2

attr(,"gradient")[[4]]
[1] 62000

attr(,"gradient")[[5]]
[1] 620

attr(,"gradient")[[6]]
[1] 1191640

> 
> with gradient (a=3.1,b=4.2) list(a,b,a*b)
[[1]]
[1] 3.1

[[2]]
[1] 4.2

[[3]]
[1] 13.02

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 1

attr(,"gradient")$a[[2]]
[1] 0

attr(,"gradient")$a[[3]]
[1] 4.2


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 0

attr(,"gradient")$b[[2]]
[1] 1

attr(,"gradient")$b[[3]]
[1] 3.1


> 
> with gradient (a=3.1,b=4.2) with gradient (c=7.9) list (a*b*c)
[[1]]
[1] 102.858

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 33.18


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 24.49


> with gradient (c=7.9) with gradient (a=3.1,b=4.2) list (a*b*c)
[[1]]
[1] 102.858

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 13.02

> 
> with gradient (a=3.1,b=4.2) with gradient (c=7.9*a) list (a*b*c)
[[1]]
[1] 318.8598

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 205.716


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 75.919


> with gradient (c=7.9) with gradient (a=3.1*c,b=4.2) list (a*b*c)
[[1]]
[1] 812.5782

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 205.716

> 
> with gradient (a=3.1) { x <- list(xxx=a,yyy=a^2); list(qqq=x,rrr=a^3) }
$qqq
$qqq$xxx
[1] 3.1

$qqq$yyy
[1] 9.61


$rrr
[1] 29.791

attr(,"gradient")
attr(,"gradient")$qqq
attr(,"gradient")$qqq$xxx
[1] 1

attr(,"gradient")$qqq$yyy
[1] 6.2


attr(,"gradient")$rrr
[1] 28.83

> 
> with gradient (a=3.1, b=4.2) {
+   r <- list(abc=a^2,pqr=b^2,xyz=a*b)
+   print(gradient_of(r$pqr))
+   print(gradient_of(r$abc))
+   print(gradient_of(r$xyz))
+   r
+ }
$a
[1] 0

$b
[1] 8.4

$a
[1] 6.2

$b
[1] 0

$a
[1] 4.2

$b
[1] 3.1

$abc
[1] 9.61

$pqr
[1] 17.64

$xyz
[1] 13.02

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a$abc
[1] 6.2

attr(,"gradient")$a$pqr
[1] 0

attr(,"gradient")$a$xyz
[1] 4.2


attr(,"gradient")$b
attr(,"gradient")$b$abc
[1] 0

attr(,"gradient")$b$pqr
[1] 8.4

attr(,"gradient")$b$xyz
[1] 3.1


> 
> 
> # Test gradients of list elements found with $ and [[.]].
> 
> with gradient (a=9) { r <- list(x=a,y=a^2,z=a^3); list(r$z,r$y) }
[[1]]
[1] 729

[[2]]
[1] 81

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 243

attr(,"gradient")[[2]]
[1] 18

> with gradient (a=9) { r <- list(x=a,y=a^2,z=a^3); list(r[[3]],r[[2]]) }
[[1]]
[1] 729

[[2]]
[1] 81

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 243

attr(,"gradient")[[2]]
[1] 18

> 
> with gradient (a=9) { r <- list(x=a,y=list(p=a^2,7,q=a^3))
+                       list(r$y$q,r$x) }
[[1]]
[1] 729

[[2]]
[1] 9

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 243

attr(,"gradient")[[2]]
[1] 1

> with gradient (a=9) { r <- list(x=a,y=list(p=a^2,7,q=a^3))
+                       list(r[[2]][[3]],r[[1]]) }
[[1]]
[1] 729

[[2]]
[1] 9

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 243

attr(,"gradient")[[2]]
[1] 1

> with gradient (a=9) { r <- list(x=a,y=list(p=a^2,7,q=a^3))
+                       list(r[[c(2,3)]],r[[1]]) }
[[1]]
[1] 729

[[2]]
[1] 9

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 243

attr(,"gradient")[[2]]
[1] 1

> 
> 
> # Test gradients of sub-lists found with [.].
> 
> with gradient (a=9) { r <- list(x=a,y=a^2,z=a^3); r[2] }
$y
[1] 81

attr(,"gradient")
attr(,"gradient")$y
[1] 18

> with gradient (a=9) { r <- list(x=a,y=a^2,z=a^3); r[c(2,1)] }
$y
[1] 81

$x
[1] 9

attr(,"gradient")
attr(,"gradient")$y
[1] 18

attr(,"gradient")$x
[1] 1

> with gradient (a=9) { r <- list(x=a,y=a^2,z=a^3); r[1..2] }
$x
[1] 9

$y
[1] 81

attr(,"gradient")
attr(,"gradient")$x
[1] 1

attr(,"gradient")$y
[1] 18

> with gradient (a=9) { r <- list(x=a,y=a^2,z=a^3); r[c(2,1,1,3)] }
$y
[1] 81

$x
[1] 9

$x
[1] 9

$z
[1] 729

attr(,"gradient")
attr(,"gradient")$y
[1] 18

attr(,"gradient")$x
[1] 1

attr(,"gradient")$x
[1] 1

attr(,"gradient")$z
[1] 243

> with gradient (a=9) { r <- list(x=a,y=a^2,z=a^3); r[c(5,1)] }
$<NA>
NULL

$x
[1] 9

attr(,"gradient")
attr(,"gradient")$<NA>
NULL

attr(,"gradient")$x
[1] 1

> with gradient (a=9) { r <- list(x=a,y=a^2,z=a^3); r[1..5] }
$x
[1] 9

$y
[1] 81

$z
[1] 729

$<NA>
NULL

$<NA>
NULL

attr(,"gradient")
attr(,"gradient")$x
[1] 1

attr(,"gradient")$y
[1] 18

attr(,"gradient")$z
[1] 243

attr(,"gradient")$<NA>
NULL

attr(,"gradient")$<NA>
NULL

> 
> L <- matrix (list(99,33,44,66,22,11),3,2)
> G <- with gradient (L) L[3,c(2,2,1)]
> L[,]
     [,1] [,2]
[1,] 99   66  
[2,] 33   22  
[3,] 44   11  
> G[]
[[1]]
[1] 11

[[2]]
[1] 11

[[3]]
[1] 44

> str(G)
List of 3
 $ : num 11
 $ : num 11
 $ : num 44
 - attr(*, "gradient")=List of 6
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 3
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
> 
> L <- matrix (list(99,33,44,66,22,11),3,2)
> G <- with gradient (L) L[1,c(2,2,1)]
> L[,]
     [,1] [,2]
[1,] 99   66  
[2,] 33   22  
[3,] 44   11  
> G[]
[[1]]
[1] 66

[[2]]
[1] 66

[[3]]
[1] 99

> str(G)
List of 3
 $ : num 66
 $ : num 66
 $ : num 99
 - attr(*, "gradient")=List of 6
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 3
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
> 
> L <- matrix (list(99,33,44,66,22,11),3,2)
> G <- with gradient (L) L[2..3,c(2,1,2)]
> L[,]
     [,1] [,2]
[1,] 99   66  
[2,] 33   22  
[3,] 44   11  
> G[,]
     [,1] [,2] [,3]
[1,] 22   33   22  
[2,] 11   44   11  
> str(G)
List of 6
 $ : num 22
 $ : num 11
 $ : num 33
 $ : num 44
 $ : num 22
 $ : num 11
 - attr(*, "dim")= int [1:2] 2 3
 - attr(*, "gradient")=List of 6
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
> 
> L <- matrix (list(99,33,44,66,22,11),3,2)
> G <- with gradient (L) L[c(2,3),c(2,1,2)]
> L[,]
     [,1] [,2]
[1,] 99   66  
[2,] 33   22  
[3,] 44   11  
> G[,]
     [,1] [,2] [,3]
[1,] 22   33   22  
[2,] 11   44   11  
> str(G)
List of 6
 $ : num 22
 $ : num 11
 $ : num 33
 $ : num 44
 $ : num 22
 $ : num 11
 - attr(*, "dim")= int [1:2] 2 3
 - attr(*, "gradient")=List of 6
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
> 
> L <- matrix (list(99,33,44,66,22,11),3,2)
> G <- with gradient (L) { L[[2,2]] <- L[[2,2]]^2; L[2..3,c(2,1,2)] }
> L[,]
     [,1] [,2]
[1,] 99   66  
[2,] 33   22  
[3,] 44   11  
> G[,]
     [,1] [,2] [,3]
[1,] 484  33   484 
[2,] 11   44   11  
> str(G)
List of 6
 $ : num 484
 $ : num 11
 $ : num 33
 $ : num 44
 $ : num 484
 $ : num 11
 - attr(*, "dim")= int [1:2] 2 3
 - attr(*, "gradient")=List of 6
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 44
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 44
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
> 
> L <- array (list(9,88,7,33,44,999,20,303,111,1111,222,3333,5555,330,1,0,-3,-2),
+             c(3,2,3))
> G <- with gradient (L) L[c(3,1,1),c(2,2,1),c(2,1,3)]
> L[,,]
, , 1

     [,1] [,2]
[1,] 9    33  
[2,] 88   44  
[3,] 7    999 

, , 2

     [,1] [,2]
[1,] 20   1111
[2,] 303  222 
[3,] 111  3333

, , 3

     [,1] [,2]
[1,] 5555 0   
[2,] 330  -3  
[3,] 1    -2  

> G[,,]
, , 1

     [,1] [,2] [,3]
[1,] 3333 3333 111 
[2,] 1111 1111 20  
[3,] 1111 1111 20  

, , 2

     [,1] [,2] [,3]
[1,] 999  999  7   
[2,] 33   33   9   
[3,] 33   33   9   

, , 3

     [,1] [,2] [,3]
[1,] -2   -2   1   
[2,] 0    0    5555
[3,] 0    0    5555

> str(G)
List of 27
 $ : num 3333
 $ : num 1111
 $ : num 1111
 $ : num 3333
 $ : num 1111
 $ : num 1111
 $ : num 111
 $ : num 20
 $ : num 20
 $ : num 999
 $ : num 33
 $ : num 33
 $ : num 999
 $ : num 33
 $ : num 33
 $ : num 7
 $ : num 9
 $ : num 9
 $ : num -2
 $ : num 0
 $ : num 0
 $ : num -2
 $ : num 0
 $ : num 0
 $ : num 1
 $ : num 5555
 $ : num 5555
 - attr(*, "dim")= int [1:3] 3 3 3
 - attr(*, "gradient")=List of 18
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
> 
> 
> # Test gradients of vector elements found with [[.]].
> 
> with gradient (a=9) {
+   r <- numeric(4); r[[1]] <- a; r[[2]] <- a^2; r[[3]] <- a^3; r[[4]] <- sin(a)
+   list(r[[3]],r[[2]])
+ }
[[1]]
[1] 729

[[2]]
[1] 81

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 243

attr(,"gradient")[[2]]
[1] 18

> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(4)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[4]] <- sin(a[[1]])
+   list(r[[3]],r[[2]],r[[4]],r[[1]])
+ }
[[1]]
[1] 8

[[2]]
[1] 13

[[3]]
[1] 0.4121185

[[4]]
[1] 5

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3]
[1,]    0    0   12

attr(,"gradient")[[2]]
     [,1] [,2] [,3]
[1,]    1    0    4

attr(,"gradient")[[3]]
           [,1] [,2] [,3]
[1,] -0.9111303    0    0

attr(,"gradient")[[4]]
     [,1] [,2] [,3]
[1,]    0    1    0

> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(4)
+   dim(r) <- c(2,2)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[4]] <- sin(a[[1]])
+   list(r[[2,1]],r[[1,2]],r[[1,1]],r[[2,2]])
+ }
[[1]]
[1] 13

[[2]]
[1] 8

[[3]]
[1] 5

[[4]]
[1] 0.4121185

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3]
[1,]    1    0    4

attr(,"gradient")[[2]]
     [,1] [,2] [,3]
[1,]    0    0   12

attr(,"gradient")[[3]]
     [,1] [,2] [,3]
[1,]    0    1    0

attr(,"gradient")[[4]]
           [,1] [,2] [,3]
[1,] -0.9111303    0    0

> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(12)
+   dim(r) <- c(2,3,2)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[12]] <- sin(a[[1]])
+   list(r[[1,1,1]],r[[2,1,1]],r[[2,3,2]])
+ }
[[1]]
[1] 5

[[2]]
[1] 13

[[3]]
[1] 0.4121185

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3]
[1,]    0    1    0

attr(,"gradient")[[2]]
     [,1] [,2] [,3]
[1,]    1    0    4

attr(,"gradient")[[3]]
           [,1] [,2] [,3]
[1,] -0.9111303    0    0

> 
> 
> # Test gradients of sub-vectors found with [.].
> 
> with gradient (a=9) {
+   r <- numeric(4); r[[1]] <- a; r[[2]] <- a^2; r[[3]] <- a^3; r[[4]] <- sin(a)
+   r[c(2,1,1,4)]
+ }
[1] 81.0000000  9.0000000  9.0000000  0.4121185
attr(,"gradient")
[1] 18.0000000  1.0000000  1.0000000 -0.9111303
> 
> with gradient (a=9) {
+   r <- numeric(4); r[[1]] <- a; r[[2]] <- a^2; r[[3]] <- a^3; r[[4]] <- sin(a)
+   r[2..3]
+ }
[1]  81 729
attr(,"gradient")
[1]  18 243
> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(4)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[4]] <- sin(a[[1]])
+   r[c(2,1,1,4)]
+ }
[1] 13.0000000  5.0000000  5.0000000  0.4121185
attr(,"gradient")
           [,1] [,2] [,3]
[1,]  1.0000000    0    4
[2,]  0.0000000    1    0
[3,]  0.0000000    1    0
[4,] -0.9111303    0    0
> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(4)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[4]] <- sin(a[[1]])
+   r[2..3]
+ }
[1] 13  8
attr(,"gradient")
     [,1] [,2] [,3]
[1,]    1    0    4
[2,]    0    0   12
> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(4)
+   dim(r) <- c(2,2)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[4]] <- sin(a[[1]])
+   list(r[2,1],r[1,2],r[1,1],r[2,2])
+ }
[[1]]
[1] 13

[[2]]
[1] 8

[[3]]
[1] 5

[[4]]
[1] 0.4121185

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3]
[1,]    1    0    4

attr(,"gradient")[[2]]
     [,1] [,2] [,3]
[1,]    0    0   12

attr(,"gradient")[[3]]
     [,1] [,2] [,3]
[1,]    0    1    0

attr(,"gradient")[[4]]
           [,1] [,2] [,3]
[1,] -0.9111303    0    0

> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(6)
+   dim(r) <- c(3,2)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[4]] <- sin(a[[1]])
+   list(r[2..3,1],r[1..2,c(2,1)])
+ }
[[1]]
[1] 13  8

[[2]]
          [,1] [,2]
[1,] 0.4121185    5
[2,] 0.0000000   13

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3]
[1,]    1    0    4
[2,]    0    0   12

attr(,"gradient")[[2]]
           [,1] [,2] [,3]
[1,] -0.9111303    0    0
[2,]  0.0000000    0    0
[3,]  0.0000000    1    0
[4,]  1.0000000    0    4

> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(6)
+   dim(r) <- c(3,2)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[4]] <- sin(a[[1]])
+   list(r[c(2,3),1],r[c(1,2),c(2,1)])
+ }
[[1]]
[1] 13  8

[[2]]
          [,1] [,2]
[1,] 0.4121185    5
[2,] 0.0000000   13

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3]
[1,]    1    0    4
[2,]    0    0   12

attr(,"gradient")[[2]]
           [,1] [,2] [,3]
[1,] -0.9111303    0    0
[2,]  0.0000000    0    0
[3,]  0.0000000    1    0
[4,]  1.0000000    0    4

> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(4)
+   dim(r) <- c(2,2)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[4]] <- sin(a[[1]])
+   list(r[2,c(1,1,2)],r[2,c(1,1,2)]^2)
+ }
[[1]]
[1] 13.0000000 13.0000000  0.4121185

[[2]]
[1] 169.0000000 169.0000000   0.1698416

attr(,"gradient")
attr(,"gradient")[[1]]
           [,1] [,2] [,3]
[1,]  1.0000000    0    4
[2,]  1.0000000    0    4
[3,] -0.9111303    0    0

attr(,"gradient")[[2]]
           [,1] [,2] [,3]
[1,] 26.0000000    0  104
[2,] 26.0000000    0  104
[3,] -0.7509872    0    0

> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(12)
+   dim(r) <- c(2,3,2)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[12]] <- sin(a[[1]])
+   list(r[1,1,1],r[2,1,1],r[2,3,2])
+ }
[[1]]
[1] 5

[[2]]
[1] 13

[[3]]
[1] 0.4121185

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3]
[1,]    0    1    0

attr(,"gradient")[[2]]
     [,1] [,2] [,3]
[1,]    1    0    4

attr(,"gradient")[[3]]
           [,1] [,2] [,3]
[1,] -0.9111303    0    0

> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(12)
+   dim(r) <- c(2,3,2)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[8]] <- a[[3]]
+   r[[10]] <- sqrt(a[[1]])
+   r[[12]] <- sin(a[[1]])
+   list(r[c(2,1),1,1],r[2,2,2],r[2,c(3,1,1,2),2])
+ }
[[1]]
[1] 13  5

[[2]]
[1] 3

[[3]]
[1] 0.4121185 2.0000000 2.0000000 3.0000000

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3]
[1,]    1    0    4
[2,]    0    1    0

attr(,"gradient")[[2]]
          [,1] [,2] [,3]
[1,] 0.1666667    0    0

attr(,"gradient")[[3]]
           [,1] [,2] [,3]
[1,] -0.9111303    0    0
[2,]  0.0000000    0    1
[3,]  0.0000000    0    1
[4,]  0.1666667    0    0

> 
> 
> # Test 'compute gradient'.
> 
> f <- function (x) compute gradient (x) x^2 as (123*x) # wrong, see if happens
> 
> with gradient (a=12) f(a)
[1] 144
attr(,"gradient")
[1] 1476
> with gradient (a=12) f(a^2)
[1] 20736
attr(,"gradient")
[1] 425088
> 
> g <- function (x,y)
+   compute gradient (x,y) list(x,y,x*y)
+   as (list(8,9,x+y), list(x,y,7))  # wrong, but see if it happens
> 
> with gradient (z=9) g(100*z,z+1)
[[1]]
[1] 900

[[2]]
[1] 10

[[3]]
[1] 9000

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1700

attr(,"gradient")[[2]]
[1] 910

attr(,"gradient")[[3]]
[1] 91007

> 
> 
> # Test subassign operations.
> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r$y <- 1/a
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$y
[1] 0.3322259

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$y
[1] -0.1103741

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[2]] <- 1/a
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$y
[1] 0.3322259

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$y
[1] -0.1103741

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r$y <- NULL
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[2]] <- NULL
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[2] <- NULL
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[1..2] <- NULL
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[c(2,2,1,1,2)] <- NULL
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r$w <- -a
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$y
[1] 27.2709

$z
[1] 82.08541

$w
[1] -3.01

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

attr(,"gradient")$w
[1] -1

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[4]] <- -a
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$y
[1] 27.2709

$z
[1] 82.08541

[[4]]
[1] -3.01

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

attr(,"gradient")[[4]]
[1] -1

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[4] <- list(-a)
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$y
[1] 27.2709

$z
[1] 82.08541

[[4]]
[1] -3.01

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

attr(,"gradient")[[4]]
[1] -1

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[4] <- -a
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$y
[1] 27.2709

$z
[1] 82.08541

[[4]]
[1] -3.01

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

attr(,"gradient")[[4]]
[1] -1

> 
> with gradient (a=c(6,3,5)) { a[2] <- list(a[[1]]^2); a }
[[1]]
[1] 6

[[2]]
[1] 36

[[3]]
[1] 5

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3]
[1,]    1    0    0

attr(,"gradient")[[2]]
     [,1] [,2] [,3]
[1,]   12    0    0

attr(,"gradient")[[3]]
     [,1] [,2] [,3]
[1,]    0    0    1

> 
> with gradient (a=3.01) {
+   r <- list(w=-a,x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[c(2,4)] <- list(10*a,7*a)
+   r
+ }
$w
[1] -1

$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$w
[1] -3.01

$x
[1] 30.1

$y
[1] 27.2709

$z
[1] 21.07

attr(,"gradient")
attr(,"gradient")$w
[1] -1

attr(,"gradient")$x
[1] 10

attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 7

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r$x$w <- 1/a
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$w
[1] 0.3322259

$x$x
[1] 12.04


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$w
[1] -0.1103741

attr(,"gradient")$x$x
[1] 4


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[2]]$w <- 1/a
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$w
[1] 0.3322259

$x$x
[1] 12.04


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$w
[1] -0.1103741

attr(,"gradient")$x$x
[1] 4


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r$x[[2]] <- 1/a
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$w
[1] 0.3322259

$x$x
[1] 12.04


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$w
[1] -0.1103741

attr(,"gradient")$x$x
[1] 4


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r$x[2] <- list(1/a)
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$w
[1] 0.3322259

$x$x
[1] 12.04


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$w
[1] -0.1103741

attr(,"gradient")$x$x
[1] 4


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[2]][[2]] <- 1/a
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$w
[1] 0.3322259

$x$x
[1] 12.04


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$w
[1] -0.1103741

attr(,"gradient")$x$x
[1] 4


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[2]][2] <- list(1/a)
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$w
[1] 0.3322259

$x$x
[1] 12.04


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$w
[1] -0.1103741

attr(,"gradient")$x$x
[1] 4


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r$x$w <- NULL
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$x
[1] 12.04


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$x
[1] 4


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[2]][[2]] <- NULL
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$x
[1] 12.04


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$x
[1] 4


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> if (FALSE)  # not supported yet
+ with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[c(2,2)]] <- NULL
+   r
+ }
> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r$x$u <- -a
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$w
[1] 9.03

$x$x
[1] 12.04

$x$u
[1] -3.01


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$w
[1] 3

attr(,"gradient")$x$x
[1] 4

attr(,"gradient")$x$u
[1] -1


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[2]][[4]] <- -a
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$w
[1] 9.03

$x$x
[1] 12.04

$x[[4]]
[1] -3.01


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$w
[1] 3

attr(,"gradient")$x$x
[1] 4

attr(,"gradient")$x[[4]]
[1] -1


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=c(5.1,7.2,3.9,0.7)) { a[3] <- 4; a }
[1] 5.1 7.2 4.0 0.7
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    0    0
[4,]    0    0    0    1
> with gradient (a=c(5.1,7.2,3.9,0.7)) { a[c(3,1)] <- 4; a }
[1] 4.0 7.2 4.0 0.7
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    0    0    0    0
[2,]    0    1    0    0
[3,]    0    0    0    0
[4,]    0    0    0    1
> with gradient (a=c(5.1,7.2,3.9,0.7)) { a[c(3,1)] <- a[4]^2; a }
[1] 0.49 7.20 0.49 0.70
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    0    0    0  1.4
[2,]    0    1    0  0.0
[3,]    0    0    0  1.4
[4,]    0    0    0  1.0
> with gradient (a=c(5.1,7.2,3.9,0.7)) { b<-numeric(5); b[4..5]<-a[c(3,1)]; b }
[1] 0.0 0.0 0.0 3.9 5.1
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    0    0    0    0
[2,]    0    0    0    0
[3,]    0    0    0    0
[4,]    0    0    1    0
[5,]    1    0    0    0
> 
> with gradient (a=matrix(list(1.0,7.2,3.9,0.7,9.9,1.2,8.8,6.0),2,4)) { 
+   a[1,1] <- a[2,4]
+   a[2,c(1,3)] <- a[[1,1]]^2
+   a[1,c(1,2)] <- list(a[[1,1]]^3,a[[1,1]]^4)
+   a[1,4] <- 99
+   a
+ }
     [,1] [,2] [,3] [,4]
[1,] 216  1296 9.9  99  
[2,] 36   0.7  36   6   
attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 0

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
[1] 0

attr(,"gradient")[[1]][[4]]
[1] 0

attr(,"gradient")[[1]][[5]]
[1] 0

attr(,"gradient")[[1]][[6]]
[1] 0

attr(,"gradient")[[1]][[7]]
[1] 0

attr(,"gradient")[[1]][[8]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 0

attr(,"gradient")[[2]][[3]]
[1] 0

attr(,"gradient")[[2]][[4]]
[1] 0

attr(,"gradient")[[2]][[5]]
[1] 0

attr(,"gradient")[[2]][[6]]
[1] 0

attr(,"gradient")[[2]][[7]]
[1] 0

attr(,"gradient")[[2]][[8]]
[1] 0


attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]]
[1] 0

attr(,"gradient")[[3]][[3]]
[1] 0

attr(,"gradient")[[3]][[4]]
[1] 0

attr(,"gradient")[[3]][[5]]
[1] 0

attr(,"gradient")[[3]][[6]]
[1] 0

attr(,"gradient")[[3]][[7]]
[1] 0

attr(,"gradient")[[3]][[8]]
[1] 0


attr(,"gradient")[[4]]
attr(,"gradient")[[4]][[1]]
[1] 0

attr(,"gradient")[[4]][[2]]
[1] 0

attr(,"gradient")[[4]][[3]]
[1] 0

attr(,"gradient")[[4]][[4]]
[1] 1

attr(,"gradient")[[4]][[5]]
[1] 0

attr(,"gradient")[[4]][[6]]
[1] 0

attr(,"gradient")[[4]][[7]]
[1] 0

attr(,"gradient")[[4]][[8]]
[1] 0


attr(,"gradient")[[5]]
attr(,"gradient")[[5]][[1]]
[1] 0

attr(,"gradient")[[5]][[2]]
[1] 0

attr(,"gradient")[[5]][[3]]
[1] 0

attr(,"gradient")[[5]][[4]]
[1] 0

attr(,"gradient")[[5]][[5]]
[1] 1

attr(,"gradient")[[5]][[6]]
[1] 0

attr(,"gradient")[[5]][[7]]
[1] 0

attr(,"gradient")[[5]][[8]]
[1] 0


attr(,"gradient")[[6]]
attr(,"gradient")[[6]][[1]]
[1] 0

attr(,"gradient")[[6]][[2]]
[1] 0

attr(,"gradient")[[6]][[3]]
[1] 0

attr(,"gradient")[[6]][[4]]
[1] 0

attr(,"gradient")[[6]][[5]]
[1] 0

attr(,"gradient")[[6]][[6]]
[1] 0

attr(,"gradient")[[6]][[7]]
[1] 0

attr(,"gradient")[[6]][[8]]
[1] 0


attr(,"gradient")[[7]]
attr(,"gradient")[[7]][[1]]
[1] 0

attr(,"gradient")[[7]][[2]]
[1] 0

attr(,"gradient")[[7]][[3]]
[1] 0

attr(,"gradient")[[7]][[4]]
[1] 0

attr(,"gradient")[[7]][[5]]
[1] 0

attr(,"gradient")[[7]][[6]]
[1] 0

attr(,"gradient")[[7]][[7]]
[1] 0

attr(,"gradient")[[7]][[8]]
[1] 0


attr(,"gradient")[[8]]
attr(,"gradient")[[8]][[1]]
[1] 108

attr(,"gradient")[[8]][[2]]
[1] 12

attr(,"gradient")[[8]][[3]]
[1] 864

attr(,"gradient")[[8]][[4]]
[1] 0

attr(,"gradient")[[8]][[5]]
[1] 0

attr(,"gradient")[[8]][[6]]
[1] 12

attr(,"gradient")[[8]][[7]]
[1] 0

attr(,"gradient")[[8]][[8]]
[1] 1


> 
> with gradient (a=matrix(c(1.0,7.2,3.9,0.7,9.9,1.2,8.8,6.0),2,4)) { 
+   a[1,1] <- a[2,4]
+   a[2,c(1,3)] <- a[[1,1]]^2
+   a[1,c(1,2)] <- a[[1,1]]^c(3,4)
+   a[1,4] <- 99
+   a
+ }
     [,1]   [,2] [,3] [,4]
[1,]  216 1296.0  9.9   99
[2,]   36    0.7 36.0    6
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    0    0    0    0    0    0  108
[2,]    0    0    0    0    0    0    0   12
[3,]    0    0    0    0    0    0    0  864
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    0    0   12
[7,]    0    0    0    0    0    0    0    0
[8,]    0    0    0    0    0    0    0    1
> 
> with gradient (a=array(list(1.0,7.2,3.9,0.7,9.9,1.2,8.8,6.0),c(2,2,2))) { 
+   a[1,1,1] <- a[2,2,2]
+   a[2,c(1,2),c(2,1)] <- a[[1,1,1]]^2
+   a[1,c(1,2),1] <- list(a[[1,1,1]]^3,a[[1,1,1]]^4)
+   a[1,2,2] <- 99
+   a
+ }
, , 1

     [,1] [,2]
[1,] 216  1296
[2,] 36   36  

, , 2

     [,1] [,2]
[1,] 9.9  99  
[2,] 36   36  

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 0

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
[1] 0

attr(,"gradient")[[1]][[4]]
[1] 0

attr(,"gradient")[[1]][[5]]
[1] 0

attr(,"gradient")[[1]][[6]]
[1] 0

attr(,"gradient")[[1]][[7]]
[1] 0

attr(,"gradient")[[1]][[8]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 0

attr(,"gradient")[[2]][[3]]
[1] 0

attr(,"gradient")[[2]][[4]]
[1] 0

attr(,"gradient")[[2]][[5]]
[1] 0

attr(,"gradient")[[2]][[6]]
[1] 0

attr(,"gradient")[[2]][[7]]
[1] 0

attr(,"gradient")[[2]][[8]]
[1] 0


attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]]
[1] 0

attr(,"gradient")[[3]][[3]]
[1] 0

attr(,"gradient")[[3]][[4]]
[1] 0

attr(,"gradient")[[3]][[5]]
[1] 0

attr(,"gradient")[[3]][[6]]
[1] 0

attr(,"gradient")[[3]][[7]]
[1] 0

attr(,"gradient")[[3]][[8]]
[1] 0


attr(,"gradient")[[4]]
attr(,"gradient")[[4]][[1]]
[1] 0

attr(,"gradient")[[4]][[2]]
[1] 0

attr(,"gradient")[[4]][[3]]
[1] 0

attr(,"gradient")[[4]][[4]]
[1] 0

attr(,"gradient")[[4]][[5]]
[1] 0

attr(,"gradient")[[4]][[6]]
[1] 0

attr(,"gradient")[[4]][[7]]
[1] 0

attr(,"gradient")[[4]][[8]]
[1] 0


attr(,"gradient")[[5]]
attr(,"gradient")[[5]][[1]]
[1] 0

attr(,"gradient")[[5]][[2]]
[1] 0

attr(,"gradient")[[5]][[3]]
[1] 0

attr(,"gradient")[[5]][[4]]
[1] 0

attr(,"gradient")[[5]][[5]]
[1] 1

attr(,"gradient")[[5]][[6]]
[1] 0

attr(,"gradient")[[5]][[7]]
[1] 0

attr(,"gradient")[[5]][[8]]
[1] 0


attr(,"gradient")[[6]]
attr(,"gradient")[[6]][[1]]
[1] 0

attr(,"gradient")[[6]][[2]]
[1] 0

attr(,"gradient")[[6]][[3]]
[1] 0

attr(,"gradient")[[6]][[4]]
[1] 0

attr(,"gradient")[[6]][[5]]
[1] 0

attr(,"gradient")[[6]][[6]]
[1] 0

attr(,"gradient")[[6]][[7]]
[1] 0

attr(,"gradient")[[6]][[8]]
[1] 0


attr(,"gradient")[[7]]
attr(,"gradient")[[7]][[1]]
[1] 0

attr(,"gradient")[[7]][[2]]
[1] 0

attr(,"gradient")[[7]][[3]]
[1] 0

attr(,"gradient")[[7]][[4]]
[1] 0

attr(,"gradient")[[7]][[5]]
[1] 0

attr(,"gradient")[[7]][[6]]
[1] 0

attr(,"gradient")[[7]][[7]]
[1] 0

attr(,"gradient")[[7]][[8]]
[1] 0


attr(,"gradient")[[8]]
attr(,"gradient")[[8]][[1]]
[1] 108

attr(,"gradient")[[8]][[2]]
[1] 12

attr(,"gradient")[[8]][[3]]
[1] 864

attr(,"gradient")[[8]][[4]]
[1] 12

attr(,"gradient")[[8]][[5]]
[1] 0

attr(,"gradient")[[8]][[6]]
[1] 12

attr(,"gradient")[[8]][[7]]
[1] 0

attr(,"gradient")[[8]][[8]]
[1] 12


> 
> with gradient (a=array(c(1.0,7.2,3.9,0.7,9.9,1.2,8.8,6.0),c(2,2,2))) { 
+   a[1,1,1] <- a[2,2,2]
+   a[2,c(1,2),c(2,1)] <- a[[1,1,1]]^2
+   a[1,c(1,2),1] <- a[[1,1,1]]^c(3,4)
+   a[1,2,2] <- 99
+   a
+ }
, , 1

     [,1] [,2]
[1,]  216 1296
[2,]   36   36

, , 2

     [,1] [,2]
[1,]  9.9   99
[2,] 36.0   36

attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    0    0    0    0    0    0  108
[2,]    0    0    0    0    0    0    0   12
[3,]    0    0    0    0    0    0    0  864
[4,]    0    0    0    0    0    0    0   12
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    0    0   12
[7,]    0    0    0    0    0    0    0    0
[8,]    0    0    0    0    0    0    0   12
> 
> 
> # Subassignment with user-defined subassignment functions.
> 
> xel <- function (a) a$x
> `xel<-` <- function (a,value) { a$x <- value; a }
> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   xel(r) <- 1/a
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 0.3322259

$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
[1] -0.1103741

attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   xel(r) <- NULL
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   xel(r) <- -a^2
+   r
+ }
$y
[1] 27.1803

$z
[1] 109.0836

--
$y
[1] 27.2709

$z
[1] 82.08541

$x
[1] -9.0601

attr(,"gradient")
attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

attr(,"gradient")$x
[1] -6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=list(w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   xel(xel(r)) <- 1/a;
+   r
+ }
$x
$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$x
$x$w
[1] 9.03

$x$x
[1] 0.3322259


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x$w
[1] 3

attr(,"gradient")$x$x
[1] -0.1103741


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=list(w=3*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   xel(xel(r)) <- -a^2
+   r
+ }
$x
$x$w
[1] 3


$y
[1] 27.1803

$z
[1] 109.0836

--
$x
$x$w
[1] 9.03

$x$x
[1] -9.0601


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x$w
[1] 3

attr(,"gradient")$x$x
[1] -6.02


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> elip1 <- function (a,i) a[[i+1]]
> `elip1<-` <- function (a,i,value) { a[[i+1]] <- value; a }
> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   elip1(r,0) <- 1/a
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 0.3322259

$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
[1] -0.1103741

attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   elip1(r,0) <- NULL
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   elip1(r,2) <- -a^2
+   r
+ }
$y
[1] 27.1803

$z
[1] 109.0836

--
$y
[1] 27.2709

$z
[1] 82.08541

[[3]]
[1] -9.0601

attr(,"gradient")
attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

attr(,"gradient")[[3]]
[1] -6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=list(w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   elip1(elip1(r,0),1) <- 1/a;
+   r
+ }
$x
$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$x
$x$w
[1] 9.03

$x$x
[1] 0.3322259


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x$w
[1] 3

attr(,"gradient")$x$x
[1] -0.1103741


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=list(w=3*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   elip1(elip1(r,0),1) <- -a^2
+   r
+ }
$x
$x$w
[1] 3


$y
[1] 27.1803

$z
[1] 109.0836

--
$x
$x$w
[1] 9.03

$x[[2]]
[1] -9.0601


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x$w
[1] 3

attr(,"gradient")$x[[2]]
[1] -6.02


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=1,y=2)
+   class(r) <- "fred"
+   r$y <- a^2
+   r
+ }
$x
[1] 1

$y
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] 0

attr(,"gradient")$y
[1] 6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=1,y=2)
+   class(r) <- "fred"
+   r[[2]] <- a^2
+   r
+ }
$x
[1] 1

$y
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] 0

attr(,"gradient")$y
[1] 6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=1,y=2)
+   class(r) <- "fred"
+   r$x <- -a
+   r$y <- a^2
+   r
+ }
$x
[1] -3.01

$y
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] -1

attr(,"gradient")$y
[1] 6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=1,y=2)
+   class(r) <- "fred"
+   r$x <- -a
+   r[[2]] <- a^2
+   r
+ }
$x
[1] -3.01

$y
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] -1

attr(,"gradient")$y
[1] 6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=1,y=2)
+   class(r) <- "fred"
+   r <- `$<-` (r, "y", a^2)
+   r
+ }
$x
[1] 1

$y
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] 0

attr(,"gradient")$y
[1] 6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=1,y=2)
+   class(r) <- "fred"
+   r <- `[[<-` (r, 2, a^2)
+   r
+ }
$x
[1] 1

$y
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] 0

attr(,"gradient")$y
[1] 6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=-1,y=2)
+   class(r) <- "fred"
+   r$x <- -a
+   r <- `$<-` (r, "y", a^2)
+   r
+ }
$x
[1] -3.01

$y
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] -1

attr(,"gradient")$y
[1] 6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=-1,y=2)
+   class(r) <- "fred"
+   r$x <- -a
+   r <- `[[<-` (r, 2, a^2)
+   r
+ }
$x
[1] -3.01

$y
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] -1

attr(,"gradient")$y
[1] 6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=-1,y=2,z=7)
+   class(r) <- "fred"
+   r$x <- -a
+   r <- `[<-` (r, c(3,2), list(a^2,a^3))
+   r
+ }
$x
[1] -3.01

$y
[1] 27.2709

$z
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] -1

attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 6.02

> 
> 
> # Test gradients w.r.t. list values.
> 
> with gradient (a=list(5,55,555)) a
[[1]]
[1] 5

[[2]]
[1] 55

[[3]]
[1] 555

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 1

attr(,"gradient")[[2]][[3]]
[1] 0


attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]]
[1] 0

attr(,"gradient")[[3]][[3]]
[1] 1


> 
> with gradient (a=list(x=5,y=55,z=555)) a$x
[1] 5
attr(,"gradient")
attr(,"gradient")$x
[1] 1

attr(,"gradient")$y
[1] 0

attr(,"gradient")$z
[1] 0

> with gradient (a=list(x=5,y=55,z=555)) a$y
[1] 55
attr(,"gradient")
attr(,"gradient")$x
[1] 0

attr(,"gradient")$y
[1] 1

attr(,"gradient")$z
[1] 0

> with gradient (a=list(x=5,y=55,z=555)) a$z
[1] 555
attr(,"gradient")
attr(,"gradient")$x
[1] 0

attr(,"gradient")$y
[1] 0

attr(,"gradient")$z
[1] 1

> 
> with gradient (a=list(x=5,y=55,z=555)) sqrt(a$y)
[1] 7.416198
attr(,"gradient")
attr(,"gradient")$x
[1] 0

attr(,"gradient")$y
[1] 0.06741999

attr(,"gradient")$z
[1] 0

> with gradient (a=list(x=5,y=55,z=555)) a$z+a$x
[1] 560
attr(,"gradient")
attr(,"gradient")$x
[1] 1

attr(,"gradient")$y
[1] 0

attr(,"gradient")$z
[1] 1

> with gradient (a=list(x=5,y=55,z=555)) a$z*a$x
[1] 2775
attr(,"gradient")
attr(,"gradient")$x
[1] 555

attr(,"gradient")$y
[1] 0

attr(,"gradient")$z
[1] 5

> 
> with gradient (a=list(x=5,y=55,z=555)) list(a$z,a$x^2, a$x*a$y*a$z)
[[1]]
[1] 555

[[2]]
[1] 25

[[3]]
[1] 152625

attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x[[1]]
[1] 0

attr(,"gradient")$x[[2]]
[1] 10

attr(,"gradient")$x[[3]]
[1] 30525


attr(,"gradient")$y
attr(,"gradient")$y[[1]]
[1] 0

attr(,"gradient")$y[[2]]
[1] 0

attr(,"gradient")$y[[3]]
[1] 2775


attr(,"gradient")$z
attr(,"gradient")$z[[1]]
[1] 1

attr(,"gradient")$z[[2]]
[1] 0

attr(,"gradient")$z[[3]]
[1] 275


> 
> with gradient (a=list(x=7,y=list(3,z=10))) a
$x
[1] 7

$y
$y[[1]]
[1] 3

$y$z
[1] 10


attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x$x
[1] 1

attr(,"gradient")$x$y
attr(,"gradient")$x$y[[1]]
[1] 0

attr(,"gradient")$x$y$z
[1] 0



attr(,"gradient")$y
attr(,"gradient")$y[[1]]
attr(,"gradient")$y[[1]]$x
[1] 0

attr(,"gradient")$y[[1]]$y
attr(,"gradient")$y[[1]]$y[[1]]
[1] 1

attr(,"gradient")$y[[1]]$y$z
[1] 0



attr(,"gradient")$y$z
attr(,"gradient")$y$z$x
[1] 0

attr(,"gradient")$y$z$y
attr(,"gradient")$y$z$y[[1]]
[1] 0

attr(,"gradient")$y$z$y$z
[1] 1




> with gradient (a=list(x=7,y=list(3,z=10))) list(a$y$z,a$x,-a$x)
[[1]]
[1] 10

[[2]]
[1] 7

[[3]]
[1] -7

attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x[[1]]
[1] 0

attr(,"gradient")$x[[2]]
[1] 1

attr(,"gradient")$x[[3]]
[1] -1


attr(,"gradient")$y
attr(,"gradient")$y[[1]]
attr(,"gradient")$y[[1]][[1]]
[1] 0

attr(,"gradient")$y[[1]][[2]]
[1] 0

attr(,"gradient")$y[[1]][[3]]
[1] 0


attr(,"gradient")$y$z
attr(,"gradient")$y$z[[1]]
[1] 1

attr(,"gradient")$y$z[[2]]
[1] 0

attr(,"gradient")$y$z[[3]]
[1] 0



> with gradient (a=list(x=7,y=list(3,z=10))) list(a$y,a$x,-a$x)
[[1]]
[[1]][[1]]
[1] 3

[[1]]$z
[1] 10


[[2]]
[1] 7

[[3]]
[1] -7

attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x[[1]]
attr(,"gradient")$x[[1]][[1]]
[1] 0

attr(,"gradient")$x[[1]]$z
[1] 0


attr(,"gradient")$x[[2]]
[1] 1

attr(,"gradient")$x[[3]]
[1] -1


attr(,"gradient")$y
attr(,"gradient")$y[[1]]
attr(,"gradient")$y[[1]][[1]]
attr(,"gradient")$y[[1]][[1]][[1]]
[1] 1

attr(,"gradient")$y[[1]][[1]]$z
[1] 0


attr(,"gradient")$y[[1]][[2]]
[1] 0

attr(,"gradient")$y[[1]][[3]]
[1] 0


attr(,"gradient")$y$z
attr(,"gradient")$y$z[[1]]
attr(,"gradient")$y$z[[1]][[1]]
[1] 0

attr(,"gradient")$y$z[[1]]$z
[1] 1


attr(,"gradient")$y$z[[2]]
[1] 0

attr(,"gradient")$y$z[[3]]
[1] 0



> 
> with gradient (b=list(3,abc=4)) {
+   r <- list(x=b,y=b$abc,z=b$abc^2)
+   r$y <- NULL
+   r
+ }
$x
$x[[1]]
[1] 3

$x$abc
[1] 4


$z
[1] 16

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]]$x
attr(,"gradient")[[1]]$x[[1]]
[1] 1

attr(,"gradient")[[1]]$x$abc
[1] 0


attr(,"gradient")[[1]]$z
[1] 0


attr(,"gradient")$abc
attr(,"gradient")$abc$x
attr(,"gradient")$abc$x[[1]]
[1] 0

attr(,"gradient")$abc$x$abc
[1] 1


attr(,"gradient")$abc$z
[1] 8


> 
> with gradient (b=list(3,abc=4)) {
+   r <- list(x=b,y=b$abc,z=b$abc^2)
+   r$x <- NULL
+   r
+ }
$y
[1] 4

$z
[1] 16

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]]$y
[1] 0

attr(,"gradient")[[1]]$z
[1] 0


attr(,"gradient")$abc
attr(,"gradient")$abc$y
[1] 1

attr(,"gradient")$abc$z
[1] 8


> 
> with gradient (b=list(10,bb=list(bbb=3,4),20)) {
+   r <- list(a1=7,a2=-b$bb$bbb,a3=b)
+   r$a3 <- NULL
+   r
+ }
$a1
[1] 7

$a2
[1] -3

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]]$a1
[1] 0

attr(,"gradient")[[1]]$a2
[1] 0


attr(,"gradient")$bb
attr(,"gradient")$bb$bbb
attr(,"gradient")$bb$bbb$a1
[1] 0

attr(,"gradient")$bb$bbb$a2
[1] -1


attr(,"gradient")$bb[[2]]
attr(,"gradient")$bb[[2]]$a1
[1] 0

attr(,"gradient")$bb[[2]]$a2
[1] 0



attr(,"gradient")[[3]]
attr(,"gradient")[[3]]$a1
[1] 0

attr(,"gradient")[[3]]$a2
[1] 0


> 
> with gradient (b=list(3,abc=4)) {
+   r <- list(x=b,y=b$abc,z=b$abc^2)
+   r$y <- b$abc^3
+   r
+ }
$x
$x[[1]]
[1] 3

$x$abc
[1] 4


$y
[1] 64

$z
[1] 16

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]]$x
attr(,"gradient")[[1]]$x[[1]]
[1] 1

attr(,"gradient")[[1]]$x$abc
[1] 0


attr(,"gradient")[[1]]$y
[1] 0

attr(,"gradient")[[1]]$z
[1] 0


attr(,"gradient")$abc
attr(,"gradient")$abc$x
attr(,"gradient")$abc$x[[1]]
[1] 0

attr(,"gradient")$abc$x$abc
[1] 1


attr(,"gradient")$abc$y
[1] 48

attr(,"gradient")$abc$z
[1] 8


> 
> with gradient (b=list(3,abc=4)) {
+   r <- list(x=b,y=b$abc,z=b$abc^2)
+   r$w <- b$abc^3
+   r
+ }
$x
$x[[1]]
[1] 3

$x$abc
[1] 4


$y
[1] 4

$z
[1] 16

$w
[1] 64

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]]$x
attr(,"gradient")[[1]]$x[[1]]
[1] 1

attr(,"gradient")[[1]]$x$abc
[1] 0


attr(,"gradient")[[1]]$y
[1] 0

attr(,"gradient")[[1]]$z
[1] 0

attr(,"gradient")[[1]]$w
[1] 0


attr(,"gradient")$abc
attr(,"gradient")$abc$x
attr(,"gradient")$abc$x[[1]]
[1] 0

attr(,"gradient")$abc$x$abc
[1] 1


attr(,"gradient")$abc$y
[1] 1

attr(,"gradient")$abc$z
[1] 8

attr(,"gradient")$abc$w
[1] 48


> 
> fsub <- function (...) `[[`(...)
> with gradient (a=list(7,8)) fsub(a,1)
[1] 7
attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1

attr(,"gradient")[[2]]
[1] 0

> 
> 
> # Test gradients w.r.t. numeric vectors.
> 
> with gradient (a=c(5,55,555)) a
[1]   5  55 555
attr(,"gradient")
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1
> 
> with gradient (a=c(x=5,y=55,z=555)) a[["x"]]
[1] 5
attr(,"gradient")
     [,1] [,2] [,3]
[1,]    1    0    0
> with gradient (a=c(x=5,y=55,z=555)) a[["y"]]
[1] 55
attr(,"gradient")
     [,1] [,2] [,3]
[1,]    0    1    0
> with gradient (a=c(x=5,y=55,z=555)) a[["z"]]
[1] 555
attr(,"gradient")
     [,1] [,2] [,3]
[1,]    0    0    1
> 
> with gradient (a=c(x=5,y=55,z=555)) sqrt(a[["y"]])
[1] 7.416198
attr(,"gradient")
     [,1]       [,2] [,3]
[1,]    0 0.06741999    0
> with gradient (a=c(x=5,y=55,z=555)) a[["z"]]+a[["x"]]
[1] 560
attr(,"gradient")
     [,1] [,2] [,3]
[1,]    1    0    1
> with gradient (a=c(x=5,y=55,z=555)) 2.1*a[["z"]]+3.4*a[["x"]]
[1] 1182.5
attr(,"gradient")
     [,1] [,2] [,3]
[1,]  3.4    0  2.1
> 
> with gradient (a=c(9.1,4.1)) {
+   b <- numeric(3)
+   b[[2]] <- a[[1]]
+   b[[1]] <- 3*a[[2]] + b[[2]]
+   b[[3]] <- sin(a[[2]])
+   b[[5]] <- b[[1]]^2
+   b
+ }
[1]  21.4000000   9.1000000  -0.8182771          NA 457.9600000
attr(,"gradient")
     [,1]        [,2]
[1,]  1.0   3.0000000
[2,]  1.0   0.0000000
[3,]  0.0  -0.5748239
[4,]  0.0   0.0000000
[5,] 42.8 128.4000000
> 
> with gradient (a=c(5.1,2.2,3.7)) {
+   x <- numeric(2)
+   x[[1]] <- a[[2]]^2
+   x[[2]] <- a[[3]]
+   sin(x)
+ }
[1] -0.9918688 -0.5298361
attr(,"gradient")
     [,1]      [,2]    [,3]
[1,]    0 0.5599658  0.0000
[2,]    0 0.0000000 -0.8481
> 
> with gradient (a=c(5.1,2.2,3.7),b=c(7.3,6.4)) {
+   x <- numeric(2)
+   x[[1]] <- a[[2]]^2
+   x[[2]] <- a[[3]]*b[[2]]
+   sin(x)
+ }
[1] -0.9918688 -0.9930396
attr(,"gradient")
attr(,"gradient")$a
     [,1]      [,2]      [,3]
[1,]    0 0.5599658 0.0000000
[2,]    0 0.0000000 0.7537988

attr(,"gradient")$b
     [,1]      [,2]
[1,]    0 0.0000000
[2,]    0 0.4357899

> 
> with gradient (a=c(-1.1,2.3)) {
+   x <- numeric(2)
+   x[[1]] <- a[[2]]^2
+   x[[2]] <- a[[1]]*a[[2]]
+   abs(x)
+ }
[1] 5.29 2.53
attr(,"gradient")
     [,1] [,2]
[1,]  0.0  4.6
[2,] -2.3  1.1
> 
> with gradient (a=c(1.1,2.3),b=3.4) {
+   list (dt(a,5), dt(5,a), dt(a,a), dt(a,b), dt(b,a))
+ }
[[1]]
[1] 0.19813859 0.04355096

[[2]]
[1] 0.011656861 0.006055387

[[3]]
[1] 0.14868309 0.05005083

[[4]]
[1] 0.18989332 0.04707694

[[5]]
[1] 0.02491717 0.01853109

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
           [,1]        [,2]
[1,] -0.2105821  0.00000000
[2,]  0.0000000 -0.05840654

attr(,"gradient")$a[[2]]
             [,1]         [,2]
[1,] -0.005880715  0.000000000
[2,]  0.000000000 -0.003246953

attr(,"gradient")$a[[3]]
           [,1]        [,2]
[1,] -0.1050382  0.00000000
[2,]  0.0000000 -0.05271019

attr(,"gradient")$a[[4]]
           [,1]        [,2]
[1,] -0.1993674  0.00000000
[2,]  0.0000000 -0.05482378

attr(,"gradient")$a[[5]]
             [,1]         [,2]
[1,] -0.004620887  0.000000000
[2,]  0.000000000 -0.004741683


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 0 0

attr(,"gradient")$b[[2]]
[1] 0 0

attr(,"gradient")$b[[3]]
[1] 0 0

attr(,"gradient")$b[[4]]
[1]  0.007296298 -0.002565247

attr(,"gradient")$b[[5]]
[1] -0.01405281 -0.01500136


> 
> with gradient (a=c(1.1,2.3),b=3.4) {
+   list (dnorm(a,2,5), dnorm(5,a,2), dnorm(5,2,a), dnorm(a,a,a), 
+         dnorm(a,a,b), dnorm(a,b,a), dnorm(b,a,a), dnorm(b,a,b))
+ }
[[1]]
[1] 0.07850630 0.07964497

[[2]]
[1] 0.02979735 0.08019166

[[3]]
[1] 0.00879777 0.07408744

[[4]]
[1] 0.3626748 0.1734532

[[5]]
[1] 0.117336 0.117336

[[6]]
[1] 0.04075409 0.15470822

[[7]]
[1] 0.04075409 0.15470822

[[8]]
[1] 0.09333873 0.11135304

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
            [,1]          [,2]
[1,] 0.002826227  0.0000000000
[2,] 0.000000000 -0.0009557396

attr(,"gradient")$a[[2]]
           [,1]       [,2]
[1,] 0.02905242 0.00000000
[2,] 0.00000000 0.05412937

attr(,"gradient")$a[[3]]
           [,1]       [,2]
[1,] 0.05149108 0.00000000
[2,] 0.00000000 0.02259098

attr(,"gradient")$a[[4]]
           [,1]        [,2]
[1,] -0.3297044  0.00000000
[2,]  0.0000000 -0.07541442

attr(,"gradient")$a[[5]]
     [,1] [,2]
[1,]    0    0
[2,]    0    0

attr(,"gradient")$a[[6]]
          [,1]        [,2]
[1,] 0.2023926  0.00000000
[2,] 0.0000000 -0.01970886

attr(,"gradient")$a[[7]]
          [,1]        [,2]
[1,] 0.2023926  0.00000000
[2,] 0.0000000 -0.01970886

attr(,"gradient")$a[[8]]
           [,1]       [,2]
[1,] 0.01857085 0.00000000
[2,] 0.00000000 0.01059588


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 0 0

attr(,"gradient")$b[[2]]
[1] 0 0

attr(,"gradient")$b[[3]]
[1] 0 0

attr(,"gradient")$b[[4]]
[1] 0 0

attr(,"gradient")$b[[5]]
[1] -0.03451058 -0.03451058

attr(,"gradient")$b[[6]]
[1] -0.07746645 -0.03216995

attr(,"gradient")$b[[7]]
[1] -0.07746645 -0.03216995

attr(,"gradient")$b[[8]]
[1] -0.03346078 -0.03991869


> 
> with gradient (a=c(1.1,2.3)) list (+a, -a)
[[1]]
[1] 1.1 2.3

[[2]]
[1] -1.1 -2.3

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")[[2]]
     [,1] [,2]
[1,]   -1    0
[2,]    0   -1

> with gradient (a=c(1.1,2.3)) list (+sin(a), -sin(a))
[[1]]
[1] 0.8912074 0.7457052

[[2]]
[1] -0.8912074 -0.7457052

attr(,"gradient")
attr(,"gradient")[[1]]
          [,1]      [,2]
[1,] 0.4535961  0.000000
[2,] 0.0000000 -0.666276

attr(,"gradient")[[2]]
           [,1]     [,2]
[1,] -0.4535961 0.000000
[2,]  0.0000000 0.666276

> 
> with gradient (a=c(1.1,2.3),b=c(5.2,3.1)) list (a+b, a-b, a*b, a/b, a^b)
[[1]]
[1] 6.3 5.4

[[2]]
[1] -4.1 -0.8

[[3]]
[1] 5.72 7.13

[[4]]
[1] 0.2115385 0.7419355

[[5]]
[1]  1.641504 13.223801

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")$a[[2]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")$a[[3]]
     [,1] [,2]
[1,]  5.2  0.0
[2,]  0.0  3.1

attr(,"gradient")$a[[4]]
          [,1]      [,2]
[1,] 0.1923077 0.0000000
[2,] 0.0000000 0.3225806

attr(,"gradient")$a[[5]]
         [,1]     [,2]
[1,] 7.759837  0.00000
[2,] 0.000000 17.82338


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")$b[[2]]
     [,1] [,2]
[1,]   -1    0
[2,]    0   -1

attr(,"gradient")$b[[3]]
     [,1] [,2]
[1,]  1.1  0.0
[2,]  0.0  2.3

attr(,"gradient")$b[[4]]
            [,1]      [,2]
[1,] -0.04068047  0.000000
[2,]  0.00000000 -0.239334

attr(,"gradient")$b[[5]]
         [,1]     [,2]
[1,] 0.156452  0.00000
[2,] 0.000000 11.01422


> with gradient (a=c(1.1,2.3,3.7),b=c(5.2,3.1)) list (a+b, a-b, a*b, a/b, a^b)
[[1]]
[1] 6.3 5.4 8.9

[[2]]
[1] -4.1 -0.8 -1.5

[[3]]
[1]  5.72  7.13 19.24

[[4]]
[1] 0.2115385 0.7419355 0.7115385

[[5]]
[1]   1.641504  13.223801 900.842703

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1

attr(,"gradient")$a[[2]]
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1

attr(,"gradient")$a[[3]]
     [,1] [,2] [,3]
[1,]  5.2  0.0  0.0
[2,]  0.0  3.1  0.0
[3,]  0.0  0.0  5.2

attr(,"gradient")$a[[4]]
          [,1]      [,2]      [,3]
[1,] 0.1923077 0.0000000 0.0000000
[2,] 0.0000000 0.3225806 0.0000000
[3,] 0.0000000 0.0000000 0.1923077

attr(,"gradient")$a[[5]]
         [,1]     [,2]     [,3]
[1,] 7.759837  0.00000    0.000
[2,] 0.000000 17.82338    0.000
[3,] 0.000000  0.00000 1266.049


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1
[3,]    1    0

attr(,"gradient")$b[[2]]
     [,1] [,2]
[1,]   -1    0
[2,]    0   -1
[3,]   -1    0

attr(,"gradient")$b[[3]]
     [,1] [,2]
[1,]  1.1  0.0
[2,]  0.0  2.3
[3,]  3.7  0.0

attr(,"gradient")$b[[4]]
            [,1]      [,2]
[1,] -0.04068047  0.000000
[2,]  0.00000000 -0.239334
[3,] -0.13683432  0.000000

attr(,"gradient")$b[[5]]
            [,1]     [,2]
[1,]    0.156452  0.00000
[2,]    0.000000 11.01422
[3,] 1178.602074  0.00000


Warning messages:
1: In a + b :
  longer object length is not a multiple of shorter object length
2: In a - b :
  longer object length is not a multiple of shorter object length
3: In a * b :
  longer object length is not a multiple of shorter object length
4: In a/b :
  longer object length is not a multiple of shorter object length
5: In a^b :
  longer object length is not a multiple of shorter object length
> with gradient (a=c(1.1,2.3),b=c(5.2,3.1,1.9)) list (a+b, a-b, a*b, a/b, a^b)
[[1]]
[1] 6.3 5.4 3.0

[[2]]
[1] -4.1 -0.8 -0.8

[[3]]
[1] 5.72 7.13 2.09

[[4]]
[1] 0.2115385 0.7419355 0.5789474

[[5]]
[1]  1.641504 13.223801  1.198522

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1
[3,]    1    0

attr(,"gradient")$a[[2]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1
[3,]    1    0

attr(,"gradient")$a[[3]]
     [,1] [,2]
[1,]  5.2  0.0
[2,]  0.0  3.1
[3,]  1.9  0.0

attr(,"gradient")$a[[4]]
          [,1]      [,2]
[1,] 0.1923077 0.0000000
[2,] 0.0000000 0.3225806
[3,] 0.5263158 0.0000000

attr(,"gradient")$a[[5]]
         [,1]     [,2]
[1,] 7.759837  0.00000
[2,] 0.000000 17.82338
[3,] 2.070175  0.00000


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1

attr(,"gradient")$b[[2]]
     [,1] [,2] [,3]
[1,]   -1    0    0
[2,]    0   -1    0
[3,]    0    0   -1

attr(,"gradient")$b[[3]]
     [,1] [,2] [,3]
[1,]  1.1  0.0  0.0
[2,]  0.0  2.3  0.0
[3,]  0.0  0.0  1.1

attr(,"gradient")$b[[4]]
            [,1]      [,2]       [,3]
[1,] -0.04068047  0.000000  0.0000000
[2,]  0.00000000 -0.239334  0.0000000
[3,]  0.00000000  0.000000 -0.3047091

attr(,"gradient")$b[[5]]
         [,1]     [,2]      [,3]
[1,] 0.156452  0.00000 0.0000000
[2,] 0.000000 11.01422 0.0000000
[3,] 0.000000  0.00000 0.1142314


Warning messages:
1: In a + b :
  longer object length is not a multiple of shorter object length
2: In a - b :
  longer object length is not a multiple of shorter object length
3: In a * b :
  longer object length is not a multiple of shorter object length
4: In a/b :
  longer object length is not a multiple of shorter object length
5: In a^b :
  longer object length is not a multiple of shorter object length
> with gradient (a=c(1.1,2.3)) list (1+a, 1-a, a+1, a-1, a+a, a-a)
[[1]]
[1] 2.1 3.3

[[2]]
[1] -0.1 -1.3

[[3]]
[1] 2.1 3.3

[[4]]
[1] 0.1 1.3

[[5]]
[1] 2.2 4.6

[[6]]
[1] 0 0

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")[[2]]
     [,1] [,2]
[1,]   -1    0
[2,]    0   -1

attr(,"gradient")[[3]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")[[4]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")[[5]]
     [,1] [,2]
[1,]    2    0
[2,]    0    2

attr(,"gradient")[[6]]
     [,1] [,2]
[1,]    0    0
[2,]    0    0

> with gradient (a=c(1.1,2.3)) list (2.1*a, 2.1/a, a*2.1, a/2.1, a*a, a/a)
[[1]]
[1] 2.31 4.83

[[2]]
[1] 1.9090909 0.9130435

[[3]]
[1] 2.31 4.83

[[4]]
[1] 0.5238095 1.0952381

[[5]]
[1] 1.21 5.29

[[6]]
[1] 1 1

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2]
[1,]  2.1  0.0
[2,]  0.0  2.1

attr(,"gradient")[[2]]
          [,1]       [,2]
[1,] -1.735537  0.0000000
[2,]  0.000000 -0.3969754

attr(,"gradient")[[3]]
     [,1] [,2]
[1,]  2.1  0.0
[2,]  0.0  2.1

attr(,"gradient")[[4]]
          [,1]      [,2]
[1,] 0.4761905 0.0000000
[2,] 0.0000000 0.4761905

attr(,"gradient")[[5]]
     [,1] [,2]
[1,]  2.2  0.0
[2,]  0.0  4.6

attr(,"gradient")[[6]]
     [,1] [,2]
[1,]    0    0
[2,]    0    0

> with gradient (a=c(1.1,2.3)) list (2.1^a, a^2.1, a^a)
[[1]]
[1] 2.261732 5.509401

[[2]]
[1] 1.221588 5.749479

[[3]]
[1] 1.110534 6.791630

attr(,"gradient")
attr(,"gradient")[[1]]
         [,1]    [,2]
[1,] 1.678064 0.00000
[2,] 0.000000 4.08763

attr(,"gradient")[[2]]
         [,1]     [,2]
[1,] 2.332122 0.000000
[2,] 0.000000 5.249524

attr(,"gradient")[[3]]
         [,1]     [,2]
[1,] 1.216379  0.00000
[2,] 0.000000 12.44844

> 
> with gradient (a=c(1.7,-34.9)) list ((a+2)*(a+1), sin(a)^2+a)
[[1]]
[1]    9.99 1115.31

[[2]]
[1]   2.683399 -34.787222

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1]  [,2]
[1,]  6.4   0.0
[2,]  0.0 -66.8

attr(,"gradient")[[2]]
          [,1]      [,2]
[1,] 0.7444589 0.0000000
[2,] 0.0000000 0.3673567

> with gradient (a=1.7) list ((a+2)*(a+1), sin(a)^2+a)
[[1]]
[1] 9.99

[[2]]
[1] 2.683399

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 6.4

attr(,"gradient")[[2]]
[1] 0.7444589

> with gradient (a=-34.9) list ((a+2)*(a+1), sin(a)^2+a)
[[1]]
[1] 1115.31

[[2]]
[1] -34.78722

attr(,"gradient")
attr(,"gradient")[[1]]
[1] -66.8

attr(,"gradient")[[2]]
[1] 0.3673567

> 
> with gradient (a=1.7) 
+   list (a+3L, a-3L, a*3L, 3L*a, a^3L, a/3L, 3L/a, 3L^a)
[[1]]
[1] 4.7

[[2]]
[1] -1.3

[[3]]
[1] 5.1

[[4]]
[1] 5.1

[[5]]
[1] 4.913

[[6]]
[1] 0.5666667

[[7]]
[1] 1.764706

[[8]]
[1] 6.473008

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1

attr(,"gradient")[[2]]
[1] 1

attr(,"gradient")[[3]]
[1] 3

attr(,"gradient")[[4]]
[1] 3

attr(,"gradient")[[5]]
[1] 8.67

attr(,"gradient")[[6]]
[1] 0.3333333

attr(,"gradient")[[7]]
[1] -1.038062

attr(,"gradient")[[8]]
[1] 7.111326

> with gradient (a=c(1.7,1.7)) 
+   list (a+3L, a-3L, a*3L, 3L*a, a^3L, a/3L, 3L/a, 3L^a)
[[1]]
[1] 4.7 4.7

[[2]]
[1] -1.3 -1.3

[[3]]
[1] 5.1 5.1

[[4]]
[1] 5.1 5.1

[[5]]
[1] 4.913 4.913

[[6]]
[1] 0.5666667 0.5666667

[[7]]
[1] 1.764706 1.764706

[[8]]
[1] 6.473008 6.473008

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")[[2]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")[[3]]
     [,1] [,2]
[1,]    3    0
[2,]    0    3

attr(,"gradient")[[4]]
     [,1] [,2]
[1,]    3    0
[2,]    0    3

attr(,"gradient")[[5]]
     [,1] [,2]
[1,] 8.67 0.00
[2,] 0.00 8.67

attr(,"gradient")[[6]]
          [,1]      [,2]
[1,] 0.3333333 0.0000000
[2,] 0.0000000 0.3333333

attr(,"gradient")[[7]]
          [,1]      [,2]
[1,] -1.038062  0.000000
[2,]  0.000000 -1.038062

attr(,"gradient")[[8]]
         [,1]     [,2]
[1,] 7.111326 0.000000
[2,] 0.000000 7.111326

> with gradient (a=1.7)
+   list (a+3, a-3, a*3, 3*a, a^3, a/3, 3/a, 3^a)
[[1]]
[1] 4.7

[[2]]
[1] -1.3

[[3]]
[1] 5.1

[[4]]
[1] 5.1

[[5]]
[1] 4.913

[[6]]
[1] 0.5666667

[[7]]
[1] 1.764706

[[8]]
[1] 6.473008

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1

attr(,"gradient")[[2]]
[1] 1

attr(,"gradient")[[3]]
[1] 3

attr(,"gradient")[[4]]
[1] 3

attr(,"gradient")[[5]]
[1] 8.67

attr(,"gradient")[[6]]
[1] 0.3333333

attr(,"gradient")[[7]]
[1] -1.038062

attr(,"gradient")[[8]]
[1] 7.111326

> with gradient (a=c(1.7,1.7))
+   list (a+3, a-3, a*3, 3*a, a^3, a/3, 3/a, 3^a)
[[1]]
[1] 4.7 4.7

[[2]]
[1] -1.3 -1.3

[[3]]
[1] 5.1 5.1

[[4]]
[1] 5.1 5.1

[[5]]
[1] 4.913 4.913

[[6]]
[1] 0.5666667 0.5666667

[[7]]
[1] 1.764706 1.764706

[[8]]
[1] 6.473008 6.473008

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")[[2]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")[[3]]
     [,1] [,2]
[1,]    3    0
[2,]    0    3

attr(,"gradient")[[4]]
     [,1] [,2]
[1,]    3    0
[2,]    0    3

attr(,"gradient")[[5]]
     [,1] [,2]
[1,] 8.67 0.00
[2,] 0.00 8.67

attr(,"gradient")[[6]]
          [,1]      [,2]
[1,] 0.3333333 0.0000000
[2,] 0.0000000 0.3333333

attr(,"gradient")[[7]]
          [,1]      [,2]
[1,] -1.038062  0.000000
[2,]  0.000000 -1.038062

attr(,"gradient")[[8]]
         [,1]     [,2]
[1,] 7.111326 0.000000
[2,] 0.000000 7.111326

> 
> set.seed(179)
> with gradient (a=3.1) rexp(1,a)
[1] 0.08403653
attr(,"gradient")
[1] -0.02710856
> with gradient (a=0.2) rexp(1,a)
[1] 3.193164
attr(,"gradient")
[1] -15.96582
> with gradient (a=7.5) rexp(1,a)
[1] 0.05260134
attr(,"gradient")
[1] -0.007013512
> with gradient (a=3.1) rexp(1,a^2)
[1] 0.01189765
attr(,"gradient")
[1] -0.007675904
> with gradient (a=0.2) rexp(1,a^2)
[1] 62.80972
attr(,"gradient")
[1] -628.0972
> with gradient (a=7.5) rexp(1,a^2)
[1] 0.01199416
attr(,"gradient")
[1] -0.003198441
> 
> set.seed(179)
> with gradient (a=c(3.1,0.2,7.5)) rexp(3,a)
[1] 0.08403653 3.19316357 0.05260134
attr(,"gradient")
            [,1]      [,2]         [,3]
[1,] -0.02710856   0.00000  0.000000000
[2,]  0.00000000 -15.96582  0.000000000
[3,]  0.00000000   0.00000 -0.007013512
> with gradient (a=c(3.1,0.2,7.5)) rexp(3,a^2)
[1]  0.01189765 62.80972133  0.01199416
attr(,"gradient")
             [,1]      [,2]         [,3]
[1,] -0.007675904    0.0000  0.000000000
[2,]  0.000000000 -628.0972  0.000000000
[3,]  0.000000000    0.0000 -0.003198441
> 
> set.seed(179)
> with gradient (a=3.1,b=2.4) rnorm(1,a,b)
[1] 3.898079
attr(,"gradient")
attr(,"gradient")$a
[1] 1

attr(,"gradient")$b
[1] 0.3325331

> with gradient (a=0.2,b=0.9) rnorm(1,a,b)
[1] 0.6648697
attr(,"gradient")
attr(,"gradient")$a
[1] 1

attr(,"gradient")$b
[1] 0.5165219

> with gradient (a=3.1,b=2.4) rnorm(1,cos(a),sin(b)^2)
[1] -1.392109
attr(,"gradient")
attr(,"gradient")$a
[1] -0.04158066

attr(,"gradient")$b
[1] 0.8580087

> with gradient (a=0.2,b=0.9) rnorm(1,cos(a),sin(b)^2)
[1] 0.1557093
attr(,"gradient")
attr(,"gradient")$a
[1] -0.1986693

attr(,"gradient")$b
[1] -1.308339

> with gradient (a=3.1,b=2.4) rnorm(1,a,3)
[1] 2.990818
attr(,"gradient")
attr(,"gradient")$a
[1] 1

attr(,"gradient")$b
[1] 0

> with gradient (a=0.2,b=0.9) rnorm(1,a,3)
[1] 2.683433
attr(,"gradient")
attr(,"gradient")$a
[1] 1

attr(,"gradient")$b
[1] 0

> with gradient (a=3.1,b=2.4) rnorm(1,4,b)
[1] 4.17983
attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$b
[1] 0.0749291

> with gradient (a=0.2,b=0.9) rnorm(1,4,b)
[1] 5.014541
attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$b
[1] 1.127268

> with gradient (a=0.7,b=1.8) rnorm(1,a^2,b)
[1] 1.333681
attr(,"gradient")
attr(,"gradient")$a
[1] 1.4

attr(,"gradient")$b
[1] 0.4687117

> with gradient (a=0.9,b=1.6) rnorm(1,a^2,b)
[1] 1.896644
attr(,"gradient")
attr(,"gradient")$a
[1] 1.8

attr(,"gradient")$b
[1] 0.6791523

> with gradient (a=0.7,b=1.2) rnorm(1,a^2,b)
[1] 0.7410938
attr(,"gradient")
attr(,"gradient")$a
[1] 1.4

attr(,"gradient")$b
[1] 0.2092448

> 
> set.seed(179)
> with gradient (a=c(3.1,0.2),b=c(2.4,0.9)) rnorm(2,a,b)
[1] 3.8980794 0.6648697
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")$b
          [,1]      [,2]
[1,] 0.3325331 0.0000000
[2,] 0.0000000 0.5165219

> with gradient (a=c(3.1,0.2),b=c(2.4,0.9)) rnorm(2,cos(a),sin(b)^2)
[1] -1.3921093  0.1557093
attr(,"gradient")
attr(,"gradient")$a
            [,1]       [,2]
[1,] -0.04158066  0.0000000
[2,]  0.00000000 -0.1986693

attr(,"gradient")$b
          [,1]      [,2]
[1,] 0.8580087  0.000000
[2,] 0.0000000 -1.308339

> with gradient (a=c(3.1,0.2),b=c(2.4,0.9)) rnorm(2,a,3)
[1] 2.990818 2.683433
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")$b
     [,1] [,2]
[1,]    0    0
[2,]    0    0

> with gradient (a=c(3.1,0.2),b=c(2.4,0.9)) rnorm(2,4,b)
[1] 4.179830 5.014541
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2]
[1,]    0    0
[2,]    0    0

attr(,"gradient")$b
          [,1]     [,2]
[1,] 0.0749291 0.000000
[2,] 0.0000000 1.127268

> with gradient (a=c(0.7,0.9),b=c(1.8,1.6,1.2)) rnorm(3,a^2,b)
[1] 1.3336810 1.8966437 0.7410938
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2]
[1,]  1.4  0.0
[2,]  0.0  1.8
[3,]  1.4  0.0

attr(,"gradient")$b
          [,1]      [,2]      [,3]
[1,] 0.4687117 0.0000000 0.0000000
[2,] 0.0000000 0.6791523 0.0000000
[3,] 0.0000000 0.0000000 0.2092448

> 
> 
> # Test preservation of gradients through attribute setting.
> 
> with gradient (a=c(33,11,0.7,99)) { attr(a,"fred") <- 123; a }
[1] 33.0 11.0  0.7 99.0
attr(,"fred")
[1] 123
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> with gradient (a=c(33,11,0.7,99)) { attr(a,"fred") <- NULL; a }
[1] 33.0 11.0  0.7 99.0
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> 
> with gradient (a=c(33,11,0.7,99)) { attributes(a) <- list(X=1,y=2); a }
[1] 33.0 11.0  0.7 99.0
attr(,"X")
[1] 1
attr(,"y")
[1] 2
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> with gradient (a=c(33,11,0.7,99)) { attributes(a) <- NULL; a }
[1] 33.0 11.0  0.7 99.0
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> 
> with gradient (a=c(33,11,0.7,99)) { dim(a) <- c(2,2); a }
     [,1] [,2]
[1,]   33  0.7
[2,]   11 99.0
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> with gradient (a=c(33,11,0.7,99)) { dim(a) <- NULL; a }
[1] 33.0 11.0  0.7 99.0
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> 
> with gradient (a=c(33,11,0.7,99)) { names(a) <- c("ww","xx","yy","zz"); a }
  ww   xx   yy   zz 
33.0 11.0  0.7 99.0 
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> with gradient (a=c(33,11,0.7,99)) { names(a) <- NULL; a }
[1] 33.0 11.0  0.7 99.0
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> 
> with gradient (a=matrix(c(33,11,0.7,99),2,2)) {
+   dimnames(a) <- list(c("ww","xx"),c("yy","zz"))
+   a
+ }
   yy   zz
ww 33  0.7
xx 11 99.0
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> 
> with gradient (a=matrix(c(33,11,0.7,99),2,2)) { dimnames(a) <- NULL; a }
     [,1] [,2]
[1,]   33  0.7
[2,]   11 99.0
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> 
> 
> # Test backpropagation.
> 
> with gradient (a=5) 
+   with gradient (d=a^2) sin(d)
[1] -0.1323518
attr(,"gradient")
[1] 9.912028
> 
> with gradient (a=5,b=7) 
+   with gradient (d=a^2+b,e=a*b) sin(d)+sqrt(e)
[1] 6.467506
attr(,"gradient")
attr(,"gradient")$a
[1] 8.933842

attr(,"gradient")$b
[1] 1.2568

> 
> with gradient (a=5,b=7) 
+   with gradient (d=a^2+b,e=a*b) list(sin(d)+sqrt(e),55)
[[1]]
[1] 6.467506

[[2]]
[1] 55

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 8.933842

attr(,"gradient")$a[[2]]
[1] 0


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 1.2568

attr(,"gradient")$b[[2]]
[1] 0


> 
> with gradient (L=list(a=5,b=7))
+   with gradient (d=L$a^2+L$b,e=L$a*L$b) sin(d)+sqrt(e)
[1] 6.467506
attr(,"gradient")
attr(,"gradient")$a
[1] 8.933842

attr(,"gradient")$b
[1] 1.2568

> 
> with gradient (a=5,b=7)
+   with gradient (M=list(d=a^2+b,e=a*b)) sin(M$d)+sqrt(M$e)
[1] 6.467506
attr(,"gradient")
attr(,"gradient")$a
[1] 8.933842

attr(,"gradient")$b
[1] 1.2568

> 
> with gradient (a=5,b=7)
+   with gradient (M=list(d=a^2+b,e=a*b)) list(sin(M$d)+sqrt(M$e),55)
[[1]]
[1] 6.467506

[[2]]
[1] 55

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 8.933842

attr(,"gradient")$a[[2]]
[1] 0


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 1.2568

attr(,"gradient")$b[[2]]
[1] 0


> 
> with gradient (L=list(a=5,b=7))
+   with gradient (M=list(d=L$a^2+L$b,e=L$a*L$b)) sin(M$d)+sqrt(M$e)
[1] 6.467506
attr(,"gradient")
attr(,"gradient")$a
[1] 8.933842

attr(,"gradient")$b
[1] 1.2568

> 
> with gradient (L=list(a=5,b=7))
+   with gradient (d=L$a^2+L$b,e=L$a*L$b) list(sin(d)+sqrt(e),55)
[[1]]
[1] 6.467506

[[2]]
[1] 55

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 8.933842

attr(,"gradient")$a[[2]]
[1] 0


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 1.2568

attr(,"gradient")$b[[2]]
[1] 0


> 
> with gradient (L=list(a=5,b=7))
+   with gradient (M=list(d=L$a^2+L$b,e=L$a*L$b)) list(sin(M$d)+sqrt(M$e),55)
[[1]]
[1] 6.467506

[[2]]
[1] 55

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 8.933842

attr(,"gradient")$a[[2]]
[1] 0


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 1.2568

attr(,"gradient")$b[[2]]
[1] 0


> 
> with gradient (L=list(a=5,b=7))
+   track gradient (M=list(d=L$a^2+L$b,e=L$a*L$b)) list(sin(M$d)+sqrt(M$e),55)
[[1]]
[1] 6.467506

[[2]]
[1] 55

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 8.933842

attr(,"gradient")$a[[2]]
[1] 0


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 1.2568

attr(,"gradient")$b[[2]]
[1] 0


> 
> with gradient (L=list(a=5,b=7))
+   back gradient (M=list(d=L$a^2+L$b,e=L$a*L$b)) list(sin(M$d)+sqrt(M$e),55)
[[1]]
[1] 6.467506

[[2]]
[1] 55

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 8.933842

attr(,"gradient")$a[[2]]
[1] 0


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 1.2568

attr(,"gradient")$b[[2]]
[1] 0


> 
> with gradient (L=c(a=5,b=7)) {
+   M <- c(d=0,e=0)
+   M[[1]] <- L[["a"]]^2+L[["b"]]
+   M[[2]] <- L[["a"]]*L[["b"]]
+   back gradient (M) {
+     c <- c(0,55)
+     c[[1]] <- sin(M[["d"]])+sqrt(M[["e"]])
+     c
+   }
+ }
[1]  6.467506 55.000000
attr(,"gradient")
         [,1]   [,2]
[1,] 8.933842 1.2568
[2,] 0.000000 0.0000
> 
> with gradient (a=list(4.1,2.7,3.1,5.2)) {
+   back gradient (b=list(a[[2]],sin(a[[1]]+a[[4]]),a[[1]]^2)) {
+     c <- list(0,0)
+     c[[1]] <- b[[1]] + 4*b[[2]]
+     c[[2]] <- b[[3]]^2 + b[[2]]
+     c
+   }
+ }
[[1]]
[1] 3.197818

[[2]]
[1] 282.7006

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] -3.968901

attr(,"gradient")[[1]][[2]]
[1] 274.6918


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 1

attr(,"gradient")[[2]][[2]]
[1] 0


attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]]
[1] 0


attr(,"gradient")[[4]]
attr(,"gradient")[[4]][[1]]
[1] -3.968901

attr(,"gradient")[[4]][[2]]
[1] -0.9922253


> 
> with gradient (a=c(4.1,2.7,3.1,5.2)) {
+   b <- numeric(3)
+   b[[1]] <- a[[2]]
+   b[[2]] <- sin(a[[1]]+a[[4]])
+   b[[3]] <- a[[1]]^2
+   back gradient (b) {
+     c <- numeric(2)
+     c[[1]] <- b[[1]] + 4*b[[2]]
+     c[[2]] <- b[[3]]^2 + b[[2]]
+     c
+   }
+ }
[1]   3.197818 282.700554
attr(,"gradient")
           [,1] [,2] [,3]       [,4]
[1,]  -3.968901    1    0 -3.9689013
[2,] 274.691775    0    0 -0.9922253
> 
> 
