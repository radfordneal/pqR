
pqR version 2.15.1 (2020-00-00), based on R 2.15.0 (2012-03-30)

R 2.15.0 is Copyright (C) 2012 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

Modifications to R in pqR are Copyright (C) 2013-2020 Radford M. Neal

Some modules are from R-2.15.1 or later versions distributed by the R Core Team

Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.


3 helper threads, task merging enabled, uncompressed pointers.

> # Test gradient computations.
> #
> # Added for pqR, 2019 Radford M. Neal.
> 
> 
> #gctorture()  # Can enable for testing, but slow
> 
> 
> # Check consistency of simple math derivatives using track gradient with 'D'
> 
> x <- 0.32739
> 
> print (identical (track gradient (x) gradient_of (sqrt(x)),
+                   eval (D (quote (sqrt(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (exp(x)),
+                   eval (D (quote (exp(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (expm1(x)),
+                   eval (D (quote (expm1(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (log1p(x)),
+                   eval (D (quote (log1p(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (log(x)),
+                   eval (D (quote (log(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (cos(x)),
+                   eval (D (quote (cos(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (sin(x)),
+                   eval (D (quote (sin(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (tan(x)),
+                   eval (D (quote (tan(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (acos(x)),
+                   eval (D (quote (acos(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (asin(x)),
+                   eval (D (quote (asin(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (cosh(x)),
+                   eval (D (quote (cosh(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (sinh(x)),
+                   eval (D (quote (sinh(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (tanh(x)),
+                   eval (D (quote (tanh(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (lgamma(x)),
+                   eval (D (quote (lgamma(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (gamma(x)),
+                   eval (D (quote (gamma(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (digamma(x)),
+                   eval (D (quote (digamma(x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (trigamma(x)),
+                   eval (D (quote (trigamma (x)), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (+x),
+                   eval (D (quote (+x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (-x),
+                   eval (D (quote (-x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (3.1+x),
+                   eval (D (quote (3.1+x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (3.1-x),
+                   eval (D (quote (3.1-x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (3.1*x),
+                   eval (D (quote (3.1*x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (3.1/x),
+                   eval (D (quote (3.1/x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (3.1^x),
+                   eval (D (quote (3.1^x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x+3.1),
+                   eval (D (quote (x+3.1), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x-3.1),
+                   eval (D (quote (x-3.1), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x*3.1),
+                   eval (D (quote (x*3.1), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x/3.1),
+                   eval (D (quote (x/3.1), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x^3.1),
+                   eval (D (quote (x^3.1), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x+x),
+                   eval (D (quote (x+x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x-x),
+                   eval (D (quote (x-x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x*x),
+                   eval (D (quote (x*x), "x")) ))
[1] TRUE
> 
> print (identical (track gradient (x) gradient_of (x/x),
+                   eval (D (quote (x/x), "x")) ))
[1] TRUE
> 
> print (identical (round (track gradient (x) gradient_of (x^x), 14),
+                   round (eval (D (quote (x^x), "x")), 14) ))
[1] TRUE
> 
> 
> # Check gradient computations passing through mathematical function dispatch.
> 
> a <- 256; class(a) <- "fred"
> cos.fred <- function (x) tan(x)
> log2.fred <- function (x) tan(tan(x))
> Math.fred <- function (x,...) {
+     if (.Generic=="log") sqrt(x)
+     else if (.Generic=="log10") sqrt(sqrt(x))
+     else if (.Generic=="exp") sqrt(sqrt(sqrt(x)))
+     else NextMethod()
+ }
> 
> print(cos(a))
[1] 25.11156
attr(,"class")
[1] "fred"
> print(log2(a))
[1] -0.02118493
attr(,"class")
[1] "fred"
> print(log(a))
[1] 16
attr(,"class")
[1] "fred"
> print(log10(a))
[1] 4
attr(,"class")
[1] "fred"
> print(exp(a))
[1] 2
attr(,"class")
[1] "fred"
> print(sin(a))
[1] -0.999208
attr(,"class")
[1] "fred"
> 
> print (with gradient (a) cos(a))
[1] 25.11156
attr(,"class")
[1] "fred"
attr(,"gradient")
[1] 631.5904
> print (with gradient (a) log2(a))
[1] -0.02118493
attr(,"class")
[1] "fred"
attr(,"gradient")
[1] 631.8739
> print (with gradient (a) log(a))
[1] 16
attr(,"class")
[1] "fred"
attr(,"gradient")
[1] 0.03125
> print (with gradient (a) log10(a))
[1] 4
attr(,"class")
[1] "fred"
attr(,"gradient")
[1] 0.00390625
> print (with gradient (a) exp(a))
[1] 2
attr(,"class")
[1] "fred"
attr(,"gradient")
[1] 0.0009765625
> print (with gradient (a) sin(a))
[1] -0.999208
attr(,"class")
[1] "fred"
attr(,"gradient")
[1] -0.03979076
> 
> 
> # Check tracking of gradients through S3 methods.
> 
> fuddle <- function (x,y) UseMethod("fuddle")
> fuddle.default <- function (x,y) x^2+y^3
> fuddle.mary <- function (x,y) sin(x) + log(y)
> fuddle.bert <- function (x,y) NextMethod("fuddle")
> 
> a <- 256; class(a) <- "mary"
> b <- 200; class(b) <- "bert"
> 
> with gradient (a=256,b=200) fuddle(a,b)
[1] 8065536
attr(,"gradient")
attr(,"gradient")$a
[1] 512

attr(,"gradient")$b
[1] 120000

> with gradient (a,b) fuddle(a,b)
[1] 4.299109
attr(,"class")
[1] "mary"
attr(,"gradient")
attr(,"gradient")$a
[1] -0.03979076

attr(,"gradient")$b
[1] 0.005

> with gradient (a,b) fuddle(b,a)
[1] 16817216
attr(,"class")
[1] "bert"
attr(,"gradient")
attr(,"gradient")$a
[1] 196608

attr(,"gradient")$b
[1] 400

> 
> biffle <- function (x) UseMethod("biffle")
> biffle.mary <- function (x) NextMethod("biffle",x,x^2,x^3)
> biffle.bert <- function (x,y,z) sin(x)+cos(y)+exp(-sqrt(z)/2000)
> 
> b <- 200; class(b) <- c("mary","bert")
> biffle(b)
[1] -0.3075931
attr(,"class")
[1] "mary" "bert"
> with gradient (b) biffle(b)
[1] -0.3075931
attr(,"class")
[1] "mary" "bert"
attr(,"gradient")
[1] -378.1313
> 
> `[[.xyzzy` <- 
+   function (x,i) if (i==0) x$x else x$y
> `[[<-.xyzzy` <- 
+   function (x,i,value) { if (i==0) x$x<-value else x$y<-value; x }
> 
> with gradient (a=7) { L <- list(x=1,y=2); class(L)<-"xyzzy"; L$x<-a^2; L[[0]] }
[1] 49
attr(,"gradient")
[1] 14
> with gradient (a=7) { L <- list(x=1,y=2); class(L)<-"xyzzy"; L[[0]]<-a^2; L }
$x
[1] 49

$y
[1] 2

attr(,"class")
[1] "xyzzy"
attr(,"gradient")
attr(,"gradient")$x
[1] 14

attr(,"gradient")$y
[1] 0

> 
> rm(`[[.xyzzy`)
> rm(`[[<-.xyzzy`)
> 
> `$.xyzzy` <- 
+   function (x,i) if (i=="x") x[[1]] else x[[2]]
> `$<-.xyzzy` <- 
+   function (x,i,value) { if (i=="x") x[[1]]<-value else x[[2]]<-value; x }
> 
> with gradient (a=7) { L <- list(x=1,y=2); class(L)<-"xyzzy"; L[[1]]<-a^2; L$x }
[1] 49
attr(,"gradient")
[1] 14
> with gradient (a=7) { L <- list(x=1,y=2); class(L)<-"xyzzy"; L$x<-a^2; L }
$x
[1] 49

$y
[1] 2

attr(,"class")
[1] "xyzzy"
attr(,"gradient")
attr(,"gradient")$x
[1] 14

attr(,"gradient")$y
[1] 0

> 
> rm(`$.xyzzy`)
> rm(`$<-.xyzzy`)
> 
> 
> # Check tracking of gradients through S4 methods.  Not currently implemented,
> # so this is disabled.
> 
> if (FALSE) {
+ 
+ setGeneric ("fiddler", function (x,y) x^2+y^3)
+ fiddler(2,3)
+ with gradient (x=2,y=3) fiddler(x,y)
+ 
+ }
> 
> 
> # Check consistency of results between with gradient and numericDeriv.
> 
> x <- 0.32739
> x1 <- 0.47718; x2 <- 0.89472; x3 <- 0.67325
> y1 <- -0.3721; y2 <- -0.8131; y3 <- 1.22213
> z1 <- 11.4319; z2 <- 13.1133; z3 <- 6.68901
> w1 <- 0.8389; w2 <- 0.1123; w3 <- 4.68701
> v1 <- 3; v2 <- 7; v3 <- 0.6513
> u1 <- -0.3721; u2 <- 1.8131; u3 <- 1.22213
> i1 <- 3
> 
> bindgrads <- function (r1,r2) 
+     cbind (rbind(r1,r2), rbind(attr(r1,"gradient"),unlist(attr(r2,"gradient"))))
> 
> test1 <- function (fun,...)
+     print (bindgrads (numericDeriv(quote(fun(x,...)),"x"),
+                       with gradient (x) fun(x,...)))
> test1p1 <- function (fun,...)
+     print (bindgrads (numericDeriv(quote(fun(x+1,...)),"x"),
+                       with gradient (x) fun(x+1,...)))
> 
> test1r <- function (fun,...) {
+     f <- function (x) { set.seed(179); fun(1,x,...) }
+     print (bindgrads (numericDeriv(quote(f(x)),"x"),
+                       with gradient (x) f(x)))
+ }
> 
> test2 <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(x1,x2,...)),"x1"),
+                       with gradient (x1) fun(x1,x2,...)))
+     print (bindgrads (numericDeriv(quote(fun(x1,x2,...)),"x2"),
+                       with gradient (x2) fun(x1,x2,...)))
+     print (bindgrads (numericDeriv(quote(fun(x1,x2,...)),c("x1","x2")),
+                       with gradient (x1,x2) fun(x1,x2,...)))
+     print (bindgrads (numericDeriv(quote(fun(x1,x2,...)),c("x1","x2")),
+       { r <- with gradient (x1) { s <- with gradient (x2) fun(x1,x2,...); 
+                                   g2 <<- attr(s,"gradient"); s }
+         attr(r,"gradient") <- cbind(g1=attr(r,"gradient"),g2=g2)
+         r
+       }
+     ))
+ }
> 
> test2y <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(y1,y3,...)),"y1"),
+                       with gradient (y1) fun(y1,y3,...)))
+     print (bindgrads (numericDeriv(quote(fun(y1,y3,...)),"y3"),
+                       with gradient (y3) fun(y1,y3,...)))
+     print (bindgrads (numericDeriv(quote(fun(y1,y3,...)),c("y1","y3")),
+                       with gradient (y1,y3) fun(y1,y3,...)))
+     print (bindgrads (numericDeriv(quote(fun(y1,y3,...)),c("y1","y3")),
+       { r <- with gradient (y1) { s <- with gradient (y3) fun(y1,y3,...); 
+                                   g2 <<- attr(s,"gradient"); s }
+         attr(r,"gradient") <- cbind(g1=attr(r,"gradient"),g2=g2)
+         r
+       }
+     ))
+ }
> 
> test2z <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(z1,z2,...)),"z1"),
+                       with gradient (z1) fun(z1,z2,...)))
+     print (bindgrads (numericDeriv(quote(fun(z1,z2,...)),"z2"),
+                       with gradient (z2) fun(z1,z2,...)))
+     print (bindgrads (numericDeriv(quote(fun(z1,z2,...)),c("z1","z2")),
+                       with gradient (z1,z2) fun(z1,z2,...)))
+     print (bindgrads (numericDeriv(quote(fun(z1,z2,...)),c("z1","z2")),
+       { r <- with gradient (z1) { s <- with gradient (z2) fun(z1,z2,...); 
+                                   g2 <<- attr(s,"gradient"); s }
+         attr(r,"gradient") <- cbind(g1=attr(r,"gradient"),g2=g2)
+         r
+       }
+     ))
+ }
> 
> test2u <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(u1,u2,...)),c("u1","u2")),
+                       with gradient (u1,u2) fun(u1,u2,...)))
+ }
> 
> test2i <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(i1,x2,...)),"x2"),
+                       with gradient (x2) fun(i1,x2,...)))
+ }
> 
> test2r <- function (fun,...) {
+     f <- function (x1,x2) { set.seed(179); fun(1,x1,x2,...) }
+     print (bindgrads (numericDeriv(quote(f(x1,x2)),c("x1","x2")),
+                       with gradient (x1,x2) f(x1,x2)))
+ }
> 
> test3 <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(x1,x2,x3,...)),"x1"),
+                       with gradient (x1) fun(x1,x2,x3,...)))
+     print (bindgrads (numericDeriv(quote(fun(x1,x2,x3,...)),"x2"),
+                       with gradient (x2) fun(x1,x2,x3,...)))
+     print (bindgrads (numericDeriv(quote(fun(x1,x2,x3,...)),"x3"),
+                       with gradient (x3) fun(x1,x2,x3,...)))
+     print (bindgrads (numericDeriv(quote(fun(x1,x2,x3,...)),c("x1","x2","x3")),
+                       with gradient (x1,x2,x3) fun(x1,x2,x3,...)))
+ }
> 
> test3y <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(y1,y2,y3,...)),"y1"),
+                       with gradient (y1) fun(y1,y2,y3,...)))
+     print (bindgrads (numericDeriv(quote(fun(y1,y2,y3,...)),"y2"),
+                       with gradient (y2) fun(y1,y2,y3,...)))
+     print (bindgrads (numericDeriv(quote(fun(y1,y2,y3,...)),"y3"),
+                       with gradient (y3) fun(y1,y2,y3,...)))
+     print (bindgrads (numericDeriv(quote(fun(y1,y2,y3,...)),c("y1","y2","y3")),
+                       with gradient (y1,y2,y3) fun(y1,y2,y3,...)))
+ }
> 
> test3z <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(z1,z2,z3,...)),"z1"),
+                       with gradient (z1) fun(z1,z2,z3,...)))
+     print (bindgrads (numericDeriv(quote(fun(z1,z2,z3,...)),"z2"),
+                       with gradient (z2) fun(z1,z2,z3,...)))
+     print (bindgrads (numericDeriv(quote(fun(z1,z2,z3,...)),"z3"),
+                       with gradient (z3) fun(z1,z2,z3,...)))
+     print (bindgrads (numericDeriv(quote(fun(z1,z2,z3,...)),c("z1","z2","z3")),
+                       with gradient (z1,z2,z3) fun(z1,z2,z3,...)))
+ }
> 
> test3w <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(w1,w2,w3,...)),"w1"),
+                       with gradient (w1) fun(w1,w2,w3,...)))
+     print (bindgrads (numericDeriv(quote(fun(w1,w2,w3,...)),"w2"),
+                       with gradient (w2) fun(w1,w2,w3,...)))
+     print (bindgrads (numericDeriv(quote(fun(w1,w2,w3,...)),"w3"),
+                       with gradient (w3) fun(w1,w2,w3,...)))
+     print (bindgrads (numericDeriv(quote(fun(w1,w2,w3,...)),c("w1","w2","w3")),
+                       with gradient (w1,w2,w3) fun(w1,w2,w3,...)))
+ }
> 
> test3u <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(u1,u2,u3,...)),"u1"),
+                       with gradient (u1) fun(u1,u2,u3,...)))
+     print (bindgrads (numericDeriv(quote(fun(u1,u2,u3,...)),"u2"),
+                       with gradient (u2) fun(u1,u2,u3,...)))
+     print (bindgrads (numericDeriv(quote(fun(u1,u2,u3,...)),"u3"),
+                       with gradient (u3) fun(u1,u2,u3,...)))
+     print (bindgrads (numericDeriv(quote(fun(u1,u2,u3,...)),c("u1","u2","u3")),
+                       with gradient (u1,u2,u3) fun(u1,u2,u3,...)))
+ }
> 
> test3v <- function (fun,...) {
+     print (bindgrads (numericDeriv(quote(fun(v1,v2,v3,...)),"v3"),
+                       with gradient (v3) fun(v1,v2,v3,...)))
+ }
> 
> test1(abs)
      [,1] [,2]
r1 0.32739    1
r2 0.32739    1
> 
> test1(sqrt)
      [,1]      [,2]
r1 0.57218 0.8738508
r2 0.57218 0.8738508
> 
> test1(exp)
       [,1]     [,2]
r1 1.387342 1.387342
r2 1.387342 1.387342
> test1(expm1)
        [,1]     [,2]
r1 0.3873424 1.387342
r2 0.3873424 1.387342
> 
> test1(log1p)
        [,1]      [,2]
r1 0.2832146 0.7533581
r2 0.2832146 0.7533581
> test1(log)
        [,1]     [,2]
r1 -1.116603 3.054461
r2 -1.116603 3.054461
> test1(log2)
        [,1]     [,2]
r1 -1.610918 4.406656
r2 -1.610918 4.406656
> test1(log10)
         [,1]     [,2]
r1 -0.4849346 1.326536
r2 -0.4849346 1.326536
> 
> test1(cos)
        [,1]       [,2]
r1 0.9468849 -0.3215728
r2 0.9468849 -0.3215728
> test1(sin)
        [,1]      [,2]
r1 0.3215728 0.9468849
r2 0.3215728 0.9468849
> test1(tan)
        [,1]     [,2]
r1 0.3396113 1.115336
r2 0.3396113 1.115336
> 
> test1(acos)
       [,1]      [,2]
r1 1.237256 -1.058325
r2 1.237256 -1.058325
> test1(asin)
      [,1]     [,2]
r1 0.33354 1.058325
r2 0.33354 1.058325
> test1(atan)
        [,1]      [,2]
r1 0.3163921 0.9031921
r2 0.3163921 0.9031921
> 
> test1(cosh)
       [,1]      [,2]
r1 1.054073 0.3332699
r2 1.054073 0.3332699
> test1(sinh)
        [,1]     [,2]
r1 0.3332699 1.054073
r2 0.3332699 1.054073
> test1(tanh)
        [,1]      [,2]
r1 0.3161736 0.9000342
r2 0.3161736 0.9000342
> 
> test1p1(acosh)
        [,1]     [,2]
r1 0.7885917 1.145599
r2 0.7885917 1.145599
> test1(asinh)
        [,1]      [,2]
r1 0.3218068 0.9503642
r2 0.3218068 0.9503642
> test1(atanh)
        [,1]     [,2]
r1 0.3399021 1.120052
r2 0.3399021 1.120052
> 
> test1(gamma)
       [,1]      [,2]
r1 2.729765 -8.716212
r2 2.729765 -8.716212
> test1(lgamma)
       [,1]      [,2]
r1 1.004216 -3.193026
r2 1.004216 -3.193026
> test1(digamma)
        [,1]     [,2]
r1 -3.193026 10.43204
r2 -3.193026 10.43204
> test1(trigamma)
       [,1]      [,2]
r1 10.43204 -58.12982
r2 10.43204 -58.12982
> test1(psigamma)
        [,1]     [,2]
r1 -3.193026 10.43204
r2 -3.193026 10.43204
> test1p1(psigamma)
         [,1]     [,2]
r1 -0.1385652 1.102305
r2 -0.1385652 1.102305
> test1(psigamma,3)
      [,1]      [,2]
r1 524.484 -6387.194
r2 524.484 -6387.194
> test1p1(psigamma,3)
       [,1]      [,2]
r1 2.220627 -6.260744
r2 2.220627 -6.260744
> 
> test2(atan2)
        [,1]      [,2]
r1 0.4899538 0.8701601
r2 0.4899538 0.8701601
        [,1]       [,2]
r1 0.4899538 -0.4640815
r2 0.4899538 -0.4640815
                    x1         x2
r1 0.4899538 0.8701601 -0.4640815
r2 0.4899538 0.8701601 -0.4640815
                    g1         g2
r1 0.4899538 0.8701601 -0.4640815
r2 0.4899538 0.8701601 -0.4640815
> test2z(atan2)
        [,1]      [,2]
r1 0.7170028 0.0433287
r2 0.7170028 0.0433287
        [,1]        [,2]
r1 0.7170028 -0.03777305
r2 0.7170028 -0.03777305
                    z1          z2
r1 0.7170028 0.0433287 -0.03777305
r2 0.7170028 0.0433287 -0.03777305
                    g1          g2
r1 0.7170028 0.0433287 -0.03777305
r2 0.7170028 0.0433287 -0.03777305
> 
> test2(beta)
       [,1]      [,2]
r1 2.239741 -4.457335
r2 2.239741 -4.457335
       [,1]      [,2]
r1 2.239741 -1.510769
r2 2.239741 -1.510769
                   x1        x2
r1 2.239741 -4.457335 -1.510769
r2 2.239741 -4.457335 -1.510769
                   g1        g2
r1 2.239741 -4.457335 -1.510769
r2 2.239741 -4.457335 -1.510769
> test2z(beta)
           [,1]          [,2]
r1 4.434014e-08 -3.493888e-08
r2 4.434014e-08 -3.493888e-08
           [,1]          [,2]
r1 4.434014e-08 -2.859912e-08
r2 4.434014e-08 -2.859912e-08
                           z1            z2
r1 4.434014e-08 -3.493888e-08 -2.859912e-08
r2 4.434014e-08 -3.493888e-08 -2.859912e-08
                           g1            g2
r1 4.434014e-08 -3.493888e-08 -2.859912e-08
r2 4.434014e-08 -3.493888e-08 -2.859912e-08
> 
> test2(lbeta)
        [,1]      [,2]
r1 0.8063602 -1.990112
r2 0.8063602 -1.990112
        [,1]       [,2]
r1 0.8063602 -0.6745284
r2 0.8063602 -0.6745284
                    x1         x2
r1 0.8063602 -1.990112 -0.6745284
r2 0.8063602 -1.990112 -0.6745284
                    g1         g2
r1 0.8063602 -1.990112 -0.6745284
r2 0.8063602 -1.990112 -0.6745284
> test2z(lbeta)
        [,1]       [,2]
r1 -16.93138 -0.7879742
r2 -16.93138 -0.7879742
        [,1]      [,2]
r1 -16.93138 -0.644994
r2 -16.93138 -0.644994
                     z1        z2
r1 -16.93138 -0.7879742 -0.644994
r2 -16.93138 -0.7879742 -0.644994
                     g1        g2
r1 -16.93138 -0.7879742 -0.644994
r2 -16.93138 -0.7879742 -0.644994
> 
> test2(dchisq)
        [,1]       [,2]
r1 0.4391986 -0.7282516
r2 0.4391986 -0.7282516
        [,1]      [,2]
r1 0.4391986 0.1792434
r2 0.4391986 0.1792434
                     x1        x2
r1 0.4391986 -0.7282516 0.1792434
r2 0.4391986 -0.7282516 0.1792434
                     g1        g2
r1 0.4391986 -0.7282516 0.1792434
r2 0.4391986 -0.7282516 0.1792434
> test2(dchisq,log=TRUE)
         [,1]      [,2]
r1 -0.8228036 -1.658137
r2 -0.8228036 -1.658137
         [,1]      [,2]
r1 -0.8228036 0.4081146
r2 -0.8228036 0.4081146
                     x1        x2
r1 -0.8228036 -1.658137 0.4081146
r2 -0.8228036 -1.658137 0.4081146
                     g1        g2
r1 -0.8228036 -1.658137 0.4081146
r2 -0.8228036 -1.658137 0.4081146
> 
> test2(pchisq)
        [,1]      [,2]
r1 0.5537791 0.4391986
r2 0.5537791 0.4391986
        [,1]       [,2]
r1 0.5537791 -0.4241387
r2 0.5537791  0.0000000
                    x1         x2
r1 0.5537791 0.4391986 -0.4241387
r2 0.5537791 0.4391986  0.0000000
                    g1         g2
r1 0.5537791 0.4391986 -0.4241387
r2 0.5537791 0.4391986  0.0000000
> test2(pchisq,log=TRUE)
         [,1]      [,2]
r1 -0.5909893 0.7930934
r2 -0.5909893 0.7930934
         [,1]       [,2]
r1 -0.5909893 -0.7658987
r2 -0.5909893  0.0000000
                     x1         x2
r1 -0.5909893 0.7930934 -0.7658987
r2 -0.5909893 0.7930934  0.0000000
                     g1         g2
r1 -0.5909893 0.7930934 -0.7658987
r2 -0.5909893 0.7930934  0.0000000
> test2(pchisq,lower=FALSE)
        [,1]       [,2]
r1 0.4462209 -0.4391986
r2 0.4462209 -0.4391986
        [,1]      [,2]
r1 0.4462209 0.4241387
r2 0.4462209 0.0000000
                     x1        x2
r1 0.4462209 -0.4391986 0.4241387
r2 0.4462209 -0.4391986 0.0000000
                     g1        g2
r1 0.4462209 -0.4391986 0.4241387
r2 0.4462209 -0.4391986 0.0000000
> test2(pchisq,log=TRUE,lower=FALSE)
         [,1]       [,2]
r1 -0.8069413 -0.9842628
r2 -0.8069413 -0.9842628
         [,1]     [,2]
r1 -0.8069413 0.950513
r2 -0.8069413 0.000000
                      x1       x2
r1 -0.8069413 -0.9842628 0.950513
r2 -0.8069413 -0.9842628 0.000000
                      g1       g2
r1 -0.8069413 -0.9842628 0.950513
r2 -0.8069413 -0.9842628 0.000000
> 
> test2(qchisq)
        [,1]     [,2]
r1 0.3255925 1.708755
r2 0.3255925 1.708755
        [,1]      [,2]
r1 0.3255925 0.7658574
r2 0.3255925 0.0000000
                   x1        x2
r1 0.3255925 1.708755 0.7658574
r2 0.3255925 1.708755 0.0000000
                   g1        g2
r1 0.3255925 1.708755 0.7658574
r2 0.3255925 1.708755 0.0000000
> test2u(qchisq,log=TRUE)
                  u1       u2
r1 2.099363 4.206923 1.282372
r2 2.099363 4.206926 0.000000
> test2(qchisq,lower=FALSE)
        [,1]      [,2]
r1 0.4106392 -2.026963
r2 0.4106392 -2.026963
        [,1]     [,2]
r1 0.4106392 0.882981
r2 0.4106392 0.000000
                    x1       x2
r1 0.4106392 -2.026963 0.882981
r2 0.4106392 -2.026963 0.000000
                    g1       g2
r1 0.4106392 -2.026963 0.882981
r2 0.4106392 -2.026963 0.000000
> test2u(qchisq,log=TRUE,lower=FALSE)
                    u1        u2
r1 0.6196066 -1.791076 0.6534893
r2 0.6196066 -1.791076 0.0000000
> 
> test2(dexp)
        [,1]       [,2]
r1 0.5838058 -0.5223427
r2 0.5838058 -0.5223427
        [,1]      [,2]
r1 0.5838058 0.3739206
r2 0.5838058 0.3739206
                     x1        x2
r1 0.5838058 -0.5223427 0.3739206
r2 0.5838058 -0.5223427 0.3739206
                     g1        g2
r1 0.5838058 -0.5223427 0.3739206
r2 0.5838058 -0.5223427 0.3739206
> test2(dexp,log=TRUE)
         [,1]     [,2]
r1 -0.5381869 -0.89472
r2 -0.5381869 -0.89472
         [,1]      [,2]
r1 -0.5381869 0.6404881
r2 -0.5381869 0.6404881
                    x1        x2
r1 -0.5381869 -0.89472 0.6404881
r2 -0.5381869 -0.89472 0.6404881
                    g1        g2
r1 -0.5381869 -0.89472 0.6404881
r2 -0.5381869 -0.89472 0.6404881
> 
> test2(pexp)
        [,1]      [,2]
r1 0.3474989 0.5838058
r2 0.3474989 0.5838058
        [,1]      [,2]
r1 0.3474989 0.3113605
r2 0.3474989 0.3113605
                    x1        x2
r1 0.3474989 0.5838058 0.3113605
r2 0.3474989 0.5838058 0.3113605
                    g1        g2
r1 0.3474989 0.5838058 0.3113605
r2 0.3474989 0.5838058 0.3113605
> test2(pexp,log=TRUE)
        [,1]     [,2]
r1 -1.056994 1.680022
r2 -1.056994 1.680022
        [,1]      [,2]
r1 -1.056994 0.8960041
r2 -1.056994 0.8960041
                   x1        x2
r1 -1.056994 1.680022 0.8960041
r2 -1.056994 1.680022 0.8960041
                   g1        g2
r1 -1.056994 1.680022 0.8960041
r2 -1.056994 1.680022 0.8960041
> test2(pexp,lower=FALSE)
        [,1]       [,2]
r1 0.6525011 -0.5838057
r2 0.6525011 -0.5838058
        [,1]       [,2]
r1 0.6525011 -0.3113605
r2 0.6525011 -0.3113605
                     x1         x2
r1 0.6525011 -0.5838057 -0.3113605
r2 0.6525011 -0.5838058 -0.3113605
                     g1         g2
r1 0.6525011 -0.5838057 -0.3113605
r2 0.6525011 -0.5838058 -0.3113605
> test2(pexp,log=TRUE,lower=FALSE)
         [,1]     [,2]
r1 -0.4269425 -0.89472
r2 -0.4269425 -0.89472
         [,1]     [,2]
r1 -0.4269425 -0.47718
r2 -0.4269425 -0.47718
                    x1       x2
r1 -0.4269425 -0.89472 -0.47718
r2 -0.4269425 -0.89472 -0.47718
                    g1       g2
r1 -0.4269425 -0.89472 -0.47718
r2 -0.4269425 -0.89472 -0.47718
> 
> test2(qexp)
        [,1]     [,2]
r1 0.7248279 2.137768
r2 0.7248279 2.137768
        [,1]      [,2]
r1 0.7248279 -0.810117
r2 0.7248279 -0.810117
                   x1        x2
r1 0.7248279 2.137768 -0.810117
r2 0.7248279 2.137768 -0.810117
                   g1        g2
r1 0.7248279 2.137768 -0.810117
r2 0.7248279 2.137768 -0.810117
> test2y(qexp,log=TRUE)
        [,1]     [,2]
r1 0.9564287 1.815181
r2 0.9564287 1.815181
        [,1]       [,2]
r1 0.9564287 -0.7825916
r2 0.9564287 -0.7825916
                   y1         y3
r1 0.9564287 1.815181 -0.7825916
r2 0.9564287 1.815181 -0.7825916
                   g1         g2
r1 0.9564287 1.815181 -0.7825916
r2 0.9564287 1.815181 -0.7825916
> test2(qexp,lower=FALSE)
        [,1]      [,2]
r1 0.8269196 -2.342236
r2 0.8269196 -2.342236
        [,1]       [,2]
r1 0.8269196 -0.9242216
r2 0.8269196 -0.9242217
                    x1         x2
r1 0.8269196 -2.342236 -0.9242216
r2 0.8269196 -2.342236 -0.9242217
                    g1         g2
r1 0.8269196 -2.342236 -0.9242216
r2 0.8269196 -2.342236 -0.9242217
> test2y(qexp,log=TRUE,lower=FALSE)
        [,1]       [,2]
r1 0.3044684 -0.8182436
r2 0.3044684 -0.8182436
        [,1]       [,2]
r1 0.3044684 -0.2491293
r2 0.3044684 -0.2491293
                     y1         y3
r1 0.3044684 -0.8182436 -0.2491293
r2 0.3044684 -0.8182436 -0.2491293
                     g1         g2
r1 0.3044684 -0.8182436 -0.2491293
r2 0.3044684 -0.8182436 -0.2491293
> 
> test1r(rexp)
        [,1]      [,2]
r1 0.7957275 -2.430519
r2 0.7957275 -2.430519
> 
> test2i(dgeom)
          [,1]        [,2]
r1 0.001044058 -0.02858399
r2 0.001044058 -0.02858399
> test2i(dgeom,log=TRUE)
       [,1]      [,2]
r1 -6.86464 -27.37777
r2 -6.86464 -27.37777
> 
> test2i(pgeom)
        [,1]        [,2]
r1 0.9998771 0.004667647
r2 0.9998771 0.004667643
> test2i(pgeom,log=TRUE)
            [,1]        [,2]
r1 -0.0001228599 0.004668215
r2 -0.0001228599 0.004668216
> test2i(pgeom,lower=FALSE)
           [,1]         [,2]
r1 0.0001228524 -0.004667642
r2 0.0001228524 -0.004667643
> test2i(pgeom,log=TRUE,lower=FALSE)
        [,1]      [,2]
r1 -9.004527 -37.99392
r2 -9.004527 -37.99392
> 
> test2i(dpois)
         [,1]     [,2]
r1 0.04879083 0.114805
r2 0.04879083 0.114805
> test2i(dpois,log=TRUE)
        [,1]     [,2]
r1 -3.020213 2.353004
r2 -3.020213 2.353004
> 
> test2i(ppois)
        [,1]        [,2]
r1 0.9868005 -0.04879083
r2 0.9868005 -0.04879083
> test2i(ppois,log=TRUE)
          [,1]        [,2]
r1 -0.01328739 -0.04944346
r2 -0.01328739 -0.04944346
> test2i(ppois,lower=FALSE)
        [,1]       [,2]
r1 0.0131995 0.04879083
r2 0.0131995 0.04879083
> test2i(ppois,log=TRUE,lower=FALSE)
        [,1]     [,2]
r1 -4.327576 3.696414
r2 -4.327576 3.696414
> 
> test2(dt)
        [,1]       [,2]
r1 0.2511211 -0.2022809
r2 0.2511211 -0.2022809
        [,1]       [,2]
r1 0.2511211 0.08376621
r2 0.2511211 0.08376621
                     x1         x2
r1 0.2511211 -0.2022809 0.08376621
r2 0.2511211 -0.2022809 0.08376621
                     g1         g2
r1 0.2511211 -0.2022809 0.08376621
r2 0.2511211 -0.2022809 0.08376621
> test2(dt,log=TRUE)
       [,1]       [,2]
r1 -1.38182 -0.8055112
r2 -1.38182 -0.8055112
       [,1]      [,2]
r1 -1.38182 0.3335689
r2 -1.38182 0.3335689
                    x1        x2
r1 -1.38182 -0.8055112 0.3335689
r2 -1.38182 -0.8055112 0.3335689
                    g1        g2
r1 -1.38182 -0.8055112 0.3335689
r2 -1.38182 -0.8055112 0.3335689
> test2z(dt)
           [,1]          [,2]
r1 1.792077e-08 -2.010665e-08
r2 1.792077e-08 -2.010665e-08
           [,1]          [,2]
r1 1.792077e-08 -1.266814e-08
r2 1.792077e-08 -1.266814e-08
                           z1            z2
r1 1.792077e-08 -2.010665e-08 -1.266814e-08
r2 1.792077e-08 -2.010665e-08 -1.266814e-08
                           g1            g2
r1 1.792077e-08 -2.010665e-08 -1.266814e-08
r2 1.792077e-08 -2.010665e-08 -1.266814e-08
> test2z(dt,log=TRUE)
        [,1]      [,2]
r1 -17.83731 -1.121975
r2 -17.83731 -1.121975
        [,1]       [,2]
r1 -17.83731 -0.7068972
r2 -17.83731 -0.7068972
                    z1         z2
r1 -17.83731 -1.121975 -0.7068972
r2 -17.83731 -1.121975 -0.7068972
                    g1         g2
r1 -17.83731 -1.121975 -0.7068972
r2 -17.83731 -1.121975 -0.7068972
> 
> test2(pt)
       [,1]      [,2]
r1 0.638114 0.2511212
r2 0.638114 0.2511211
       [,1]       [,2]
r1 0.638114 0.03712282
r2 0.638114 0.00000000
                   x1         x2
r1 0.638114 0.2511212 0.03712282
r2 0.638114 0.2511211 0.00000000
                   g1         g2
r1 0.638114 0.2511212 0.03712282
r2 0.638114 0.2511211 0.00000000
> test2(pt,log=TRUE)
         [,1]      [,2]
r1 -0.4492383 0.3935365
r2 -0.4492383 0.3935365
         [,1]       [,2]
r1 -0.4492383 0.05817584
r2 -0.4492383 0.00000000
                     x1         x2
r1 -0.4492383 0.3935365 0.05817584
r2 -0.4492383 0.3935365 0.00000000
                     g1         g2
r1 -0.4492383 0.3935365 0.05817584
r2 -0.4492383 0.3935365 0.00000000
> test2(pt,lower=FALSE)
       [,1]       [,2]
r1 0.361886 -0.2511212
r2 0.361886 -0.2511211
       [,1]        [,2]
r1 0.361886 -0.03712282
r2 0.361886  0.00000000
                    x1          x2
r1 0.361886 -0.2511212 -0.03712282
r2 0.361886 -0.2511211  0.00000000
                    g1          g2
r1 0.361886 -0.2511212 -0.03712282
r2 0.361886 -0.2511211  0.00000000
> test2(pt,log=TRUE,lower=FALSE)
        [,1]       [,2]
r1 -1.016426 -0.6939235
r2 -1.016426 -0.6939234
        [,1]       [,2]
r1 -1.016426 -0.1025815
r2 -1.016426  0.0000000
                     x1         x2
r1 -1.016426 -0.6939235 -0.1025815
r2 -1.016426 -0.6939234  0.0000000
                     g1         g2
r1 -1.016426 -0.6939235 -0.1025815
r2 -1.016426 -0.6939234  0.0000000
> test2z(pt)
   [,1]         [,2]
r1    1 1.824861e-08
r2    1 1.792077e-08
   [,1]         [,2]
r1    1 1.363607e-08
r2    1 0.000000e+00
               z1           z2
r1 1 1.824861e-08 1.363607e-08
r2 1 1.792077e-08 0.000000e+00
               g1           g2
r1 1 1.824861e-08 1.363607e-08
r2 1 1.792077e-08 0.000000e+00
> test2z(pt,log=TRUE)
            [,1]         [,2]
r1 -1.707838e-08 1.792077e-08
r2 -1.707838e-08 1.792077e-08
            [,1]         [,2]
r1 -1.707838e-08 1.325737e-08
r2 -1.707838e-08 0.000000e+00
                           z1           z2
r1 -1.707838e-08 1.792077e-08 1.325737e-08
r2 -1.707838e-08 1.792077e-08 0.000000e+00
                           g1           g2
r1 -1.707838e-08 1.792077e-08 1.325737e-08
r2 -1.707838e-08 1.792077e-08 0.000000e+00
> test2z(pt,lower=FALSE)
           [,1]          [,2]
r1 1.707838e-08 -1.792077e-08
r2 1.707838e-08 -1.792077e-08
           [,1]          [,2]
r1 1.707838e-08 -1.325737e-08
r2 1.707838e-08  0.000000e+00
                           z1            z2
r1 1.707838e-08 -1.792077e-08 -1.325737e-08
r2 1.707838e-08 -1.792077e-08  0.000000e+00
                           g1            g2
r1 1.707838e-08 -1.792077e-08 -1.325737e-08
r2 1.707838e-08 -1.792077e-08  0.000000e+00
> test2z(pt,log=TRUE,lower=FALSE)
        [,1]      [,2]
r1 -17.88545 -1.049324
r2 -17.88545 -1.049324
        [,1]       [,2]
r1 -17.88545 -0.7762659
r2 -17.88545  0.0000000
                    z1         z2
r1 -17.88545 -1.049324 -0.7762659
r2 -17.88545 -1.049324  0.0000000
                    g1         g2
r1 -17.88545 -1.049324 -0.7762659
r2 -17.88545 -1.049324  0.0000000
> 
> test2(qt)
          [,1]    [,2]
r1 -0.07344664 3.23076
r2 -0.07344664 3.23076
          [,1]       [,2]
r1 -0.07344664 0.01719656
r2 -0.07344664 0.00000000
                    x1         x2
r1 -0.07344664 3.23076 0.01719656
r2 -0.07344664 3.23076 0.00000000
                    g1         g2
r1 -0.07344664 3.23076 0.01719656
r2 -0.07344664 3.23076 0.00000000
> test2u(qt,log=TRUE)
                   u1          u2
r1 0.5879206 2.521063 -0.05640184
r2 0.5879206 2.521063  0.00000000
> test2(qt,lower=FALSE)
         [,1]     [,2]
r1 0.07344664 -3.23076
r2 0.07344664 -3.23076
         [,1]        [,2]
r1 0.07344664 -0.01719656
r2 0.07344664  0.00000000
                    x1          x2
r1 0.07344664 -3.23076 -0.01719656
r2 0.07344664 -3.23076  0.00000000
                    g1          g2
r1 0.07344664 -3.23076 -0.01719656
r2 0.07344664 -3.23076  0.00000000
> test2u(qt,log=TRUE,lower=FALSE)
                     u1         u2
r1 -0.5879206 -2.521063 0.05640184
r2 -0.5879206 -2.521063 0.00000000
> 
> test3(dbeta)
        [,1]      [,2]
r1 0.8258716 0.3339383
r2 0.8258716 0.3339383
        [,1]      [,2]
r1 0.8258716 0.1019506
r2 0.8258716 0.1019506
        [,1]      [,2]
r1 0.8258716 0.6176604
r2 0.8258716 0.6176604
                    x1        x2        x3
r1 0.8258716 0.3339383 0.1019506 0.6176604
r2 0.8258716 0.3339383 0.1019506 0.6176604
> test3(dbeta,log=TRUE)
        [,1]      [,2]
r1 -0.191316 0.4043466
r2 -0.191316 0.4043466
        [,1]      [,2]
r1 -0.191316 0.1234461
r2 -0.191316 0.1234461
        [,1]      [,2]
r1 -0.191316 0.7478892
r2 -0.191316 0.7478892
                    x1        x2        x3
r1 -0.191316 0.4043466 0.1234461 0.7478892
r2 -0.191316 0.4043466 0.1234461 0.7478892
> test3w(dbeta)
          [,1]         [,2]
r1 0.000194595 -0.004659505
r2 0.000194595 -0.004659506
          [,1]       [,2]
r1 0.000194595 0.00206193
r2 0.000194595 0.00206193
          [,1]          [,2]
r1 0.000194595 -0.0003501507
r2 0.000194595 -0.0003501508
                         w1         w2            w3
r1 0.000194595 -0.004659505 0.00206193 -0.0003501507
r2 0.000194595 -0.004659506 0.00206193 -0.0003501508
> test3w(dbeta,log=TRUE)
       [,1]      [,2]
r1 -8.54459 -23.94464
r2 -8.54459 -23.94464
       [,1]     [,2]
r1 -8.54459 10.59601
r2 -8.54459 10.59601
       [,1]      [,2]
r1 -8.54459 -1.799383
r2 -8.54459 -1.799383
                   w1       w2        w3
r1 -8.54459 -23.94464 10.59601 -1.799383
r2 -8.54459 -23.94464 10.59601 -1.799383
> 
> test3(pbeta)
      [,1]      [,2]
r1 0.39025 0.8258716
r2 0.39025 0.8258716
      [,1]       [,2]
r1 0.39025 -0.3663547
r2 0.39025  0.0000000
      [,1]      [,2]
r1 0.39025 0.4341696
r2 0.39025 0.0000000
                  x1         x2        x3
r1 0.39025 0.8258716 -0.3663547 0.4341696
r2 0.39025 0.8258716  0.0000000 0.0000000
> test3(pbeta,log=TRUE)
         [,1]     [,2]
r1 -0.9409677 2.116263
r2 -0.9409677 2.116263
         [,1]       [,2]
r1 -0.9409677 -0.9387691
r2 -0.9409677  0.0000000
         [,1]     [,2]
r1 -0.9409677 1.112542
r2 -0.9409677 0.000000
                    x1         x2       x3
r1 -0.9409677 2.116263 -0.9387691 1.112542
r2 -0.9409677 2.116263  0.0000000 0.000000
> test3(pbeta,lower=FALSE)
      [,1]       [,2]
r1 0.60975 -0.8258716
r2 0.60975 -0.8258716
      [,1]      [,2]
r1 0.60975 0.3663547
r2 0.60975 0.0000000
      [,1]       [,2]
r1 0.60975 -0.4341696
r2 0.60975  0.0000000
                   x1        x2         x3
r1 0.60975 -0.8258716 0.3663547 -0.4341696
r2 0.60975 -0.8258716 0.0000000  0.0000000
> test3(pbeta,log=TRUE,lower=FALSE)
         [,1]      [,2]
r1 -0.4947063 -1.354443
r2 -0.4947063 -1.354443
         [,1]      [,2]
r1 -0.4947063 0.6008277
r2 -0.4947063 0.0000000
         [,1]       [,2]
r1 -0.4947063 -0.7120453
r2 -0.4947063  0.0000000
                     x1        x2         x3
r1 -0.4947063 -1.354443 0.6008277 -0.7120453
r2 -0.4947063 -1.354443 0.0000000  0.0000000
> 
> test3(qbeta)
        [,1]     [,2]
r1 0.5799465 1.150664
r2 0.5799465 1.150664
        [,1]      [,2]
r1 0.5799465 0.3990489
r2 0.5799465 0.0000000
        [,1]       [,2]
r1 0.5799465 -0.5637529
r2 0.5799465  0.0000000
                   x1        x2         x3
r1 0.5799465 1.150664 0.3990489 -0.5637529
r2 0.5799465 1.150664 0.0000000  0.0000000
> test3u(qbeta,log=TRUE)
        [,1]      [,2]
r1 0.7585227 0.4885164
r2 0.7585227 0.4885164
        [,1]      [,2]
r1 0.7585227 0.1104072
r2 0.7585227 0.0000000
        [,1]       [,2]
r1 0.7585227 -0.2393685
r2 0.7585227  0.0000000
                    u1        u2         u3
r1 0.7585227 0.4885164 0.1104072 -0.2393685
r2 0.7585227 0.4885164 0.0000000  0.0000000
> test3(qbeta,lower=FALSE)
        [,1]      [,2]
r1 0.6316053 -1.112316
r2 0.6316053 -1.112316
        [,1]      [,2]
r1 0.6316053 0.3673725
r2 0.6316053 0.0000000
        [,1]       [,2]
r1 0.6316053 -0.5685447
r2 0.6316053  0.0000000
                    x1        x2         x3
r1 0.6316053 -1.112316 0.3673725 -0.5685447
r2 0.6316053 -1.112316 0.0000000  0.0000000
> test3u(qbeta,log=TRUE,lower=FALSE)
        [,1]       [,2]
r1 0.4680528 -0.6069822
r2 0.4680528 -0.6069822
        [,1]      [,2]
r1 0.4680528 0.1879364
r2 0.4680528 0.0000000
        [,1]       [,2]
r1 0.4680528 -0.2275227
r2 0.4680528  0.0000000
                     u1        u2         u3
r1 0.4680528 -0.6069822 0.1879364 -0.2275227
r2 0.4680528 -0.6069822 0.0000000  0.0000000
> 
> test3v(dbinom)
        [,1]       [,2]
r1 0.1429615 -0.9814315
r2 0.1429615 -0.9814315
> test3v(dbinom,log=TRUE)
       [,1]      [,2]
r1 -1.94518 -6.865007
r2 -1.94518 -6.865006
> 
> test3v(pbinom)
        [,1]      [,2]
r1 0.1977083 -1.639937
r2 0.1977083 -1.639937
> test3v(pbinom,log=TRUE)
        [,1]     [,2]
r1 -1.620963 -8.29473
r2 -1.620963 -8.29473
> test3v(pbinom,lower=FALSE)
        [,1]     [,2]
r1 0.8022917 1.639937
r2 0.8022917 1.639937
> test3v(pbinom,log=TRUE,lower=FALSE)
        [,1]     [,2]
r1 -0.220283 2.044065
r2 -0.220283 2.044065
> 
> test3(dcauchy)
        [,1]      [,2]
r1 0.3414601 0.4543405
r2 0.3414601 0.4543405
        [,1]       [,2]
r1 0.3414601 -0.4543405
r2 0.3414601 -0.4543405
        [,1]       [,2]
r1 0.3414601 -0.2254062
r2 0.3414601 -0.2254062
                    x1         x2         x3
r1 0.3414601 0.4543405 -0.4543405 -0.2254062
r2 0.3414601 0.4543405 -0.4543405 -0.2254062
> test3(dcauchy,log=TRUE)
        [,1]     [,2]
r1 -1.074524 1.330582
r2 -1.074524 1.330582
        [,1]      [,2]
r1 -1.074524 -1.330582
r2 -1.074524 -1.330582
        [,1]       [,2]
r1 -1.074524 -0.6601247
r2 -1.074524 -0.6601247
                   x1        x2         x3
r1 -1.074524 1.330582 -1.330582 -0.6601247
r2 -1.074524 1.330582 -1.330582 -0.6601247
> test3z(dcauchy)
         [,1]       [,2]
r1 0.04475888 0.00316408
r2 0.04475888 0.00316408
         [,1]        [,2]
r1 0.04475888 -0.00316408
r2 0.04475888 -0.00316408
         [,1]         [,2]
r1 0.04475888 -0.005896058
r2 0.04475888 -0.005896058
                      z1          z2           z3
r1 0.04475888 0.00316408 -0.00316408 -0.005896058
r2 0.04475888 0.00316408 -0.00316408 -0.005896058
> test3z(dcauchy,log=TRUE)
        [,1]       [,2]
r1 -3.106465 0.07069167
r2 -3.106465 0.07069167
        [,1]        [,2]
r1 -3.106465 -0.07069168
r2 -3.106465 -0.07069167
        [,1]       [,2]
r1 -3.106465 -0.1317294
r2 -3.106465 -0.1317294
                     z1          z2         z3
r1 -3.106465 0.07069167 -0.07069168 -0.1317294
r2 -3.106465 0.07069167 -0.07069167 -0.1317294
> 
> test3(pcauchy)
        [,1]      [,2]
r1 0.3232967 0.3414601
r2 0.3232967 0.3414601
        [,1]       [,2]
r1 0.3232967 -0.3414601
r2 0.3232967 -0.3414601
        [,1]      [,2]
r1 0.3232967 0.2117686
r2 0.3232967 0.2117687
                    x1         x2        x3
r1 0.3232967 0.3414601 -0.3414601 0.2117686
r2 0.3232967 0.3414601 -0.3414601 0.2117687
> test3(pcauchy,log=TRUE)
        [,1]     [,2]
r1 -1.129185 1.056182
r2 -1.129185 1.056182
        [,1]      [,2]
r1 -1.129185 -1.056182
r2 -1.129185 -1.056182
        [,1]      [,2]
r1 -1.129185 0.6550288
r2 -1.129185 0.6550288
                   x1        x2        x3
r1 -1.129185 1.056182 -1.056182 0.6550288
r2 -1.129185 1.056182 -1.056182 0.6550288
> test3(pcauchy,lower=FALSE)
        [,1]       [,2]
r1 0.6767033 -0.3414601
r2 0.6767033 -0.3414601
        [,1]      [,2]
r1 0.6767033 0.3414601
r2 0.6767033 0.3414601
        [,1]       [,2]
r1 0.6767033 -0.2117686
r2 0.6767033 -0.2117687
                     x1        x2         x3
r1 0.6767033 -0.3414601 0.3414601 -0.2117686
r2 0.6767033 -0.3414601 0.3414601 -0.2117687
> test3(pcauchy,log=TRUE,lower=FALSE)
         [,1]       [,2]
r1 -0.3905223 -0.5045935
r2 -0.3905223 -0.5045935
         [,1]      [,2]
r1 -0.3905223 0.5045935
r2 -0.3905223 0.5045935
         [,1]       [,2]
r1 -0.3905223 -0.3129416
r2 -0.3905223 -0.3129417
                      x1        x2         x3
r1 -0.3905223 -0.5045935 0.5045935 -0.3129416
r2 -0.3905223 -0.5045935 0.5045935 -0.3129417
> test3z(pcauchy)
        [,1]       [,2]
r1 0.4216113 0.04475888
r2 0.4216113 0.04475888
        [,1]        [,2]
r1 0.4216113 -0.04475888
r2 0.4216113 -0.04475888
        [,1]       [,2]
r1 0.4216113 0.01125093
r2 0.4216113 0.01125093
                     z1          z2         z3
r1 0.4216113 0.04475888 -0.04475888 0.01125093
r2 0.4216113 0.04475888 -0.04475888 0.01125093
> test3z(pcauchy,log=TRUE)
         [,1]      [,2]
r1 -0.8636715 0.1061615
r2 -0.8636715 0.1061615
         [,1]       [,2]
r1 -0.8636715 -0.1061615
r2 -0.8636715 -0.1061615
         [,1]       [,2]
r1 -0.8636715 0.02668555
r2 -0.8636715 0.02668555
                     z1         z2         z3
r1 -0.8636715 0.1061615 -0.1061615 0.02668555
r2 -0.8636715 0.1061615 -0.1061615 0.02668555
> test3z(pcauchy,lower=FALSE)
        [,1]        [,2]
r1 0.5783887 -0.04475888
r2 0.5783887 -0.04475888
        [,1]       [,2]
r1 0.5783887 0.04475888
r2 0.5783887 0.04475888
        [,1]        [,2]
r1 0.5783887 -0.01125093
r2 0.5783887 -0.01125093
                      z1         z2          z3
r1 0.5783887 -0.04475888 0.04475888 -0.01125093
r2 0.5783887 -0.04475888 0.04475888 -0.01125093
> test3z(pcauchy,log=TRUE,lower=FALSE)
         [,1]        [,2]
r1 -0.5475092 -0.07738546
r2 -0.5475092 -0.07738546
         [,1]       [,2]
r1 -0.5475092 0.07738546
r2 -0.5475092 0.07738546
         [,1]        [,2]
r1 -0.5475092 -0.01945219
r2 -0.5475092 -0.01945219
                       z1         z2          z3
r1 -0.5475092 -0.07738546 0.07738546 -0.01945219
r2 -0.5475092 -0.07738546 0.07738546 -0.01945219
> 
> test3(qcauchy)
        [,1]     [,2]
r1 0.8463711 2.125985
r2 0.8463711 2.125985
        [,1] [,2]
r1 0.8463711    1
r2 0.8463711    1
        [,1]        [,2]
r1 0.8463711 -0.07181421
r2 0.8463711 -0.07181422
                   x1 x2          x3
r1 0.8463711 2.125985  1 -0.07181421
r2 0.8463711 2.125985  1 -0.07181422
> test3y(qcauchy,log=TRUE)
         [,1]    [,2]
r1 0.01345346 3.85699
r2 0.01345346 3.85699
         [,1] [,2]
r1 0.01345346    1
r2 0.01345346    1
         [,1]     [,2]
r1 0.01345346 0.676322
r2 0.01345346 0.676322
                   y1 y2       y3
r1 0.01345346 3.85699  1 0.676322
r2 0.01345346 3.85699  1 0.676322
> test3(qcauchy,lower=FALSE)
        [,1]      [,2]
r1 0.9430689 -2.125985
r2 0.9430689 -2.125985
        [,1] [,2]
r1 0.9430689    1
r2 0.9430689    1
        [,1]       [,2]
r1 0.9430689 0.07181421
r2 0.9430689 0.07181422
                    x1 x2         x3
r1 0.9430689 -2.125985  1 0.07181421
r2 0.9430689 -2.125985  1 0.07181422
> test3y(qcauchy,log=TRUE,lower=FALSE)
        [,1]     [,2]
r1 -1.639653 -3.85699
r2 -1.639653 -3.85699
        [,1] [,2]
r1 -1.639653    1
r2 -1.639653    1
        [,1]      [,2]
r1 -1.639653 -0.676322
r2 -1.639653 -0.676322
                   y1 y2        y3
r1 -1.639653 -3.85699  1 -0.676322
r2 -1.639653 -3.85699  1 -0.676322
> 
> test2r(rcauchy)
             x1        x2
r1 -1.585831  1 -2.305762
r2 -1.585831  1 -2.305762
> 
> test3(df)
        [,1]       [,2]
r1 0.2620323 -0.4705327
r2 0.2620323 -0.4705327
        [,1]       [,2]
r1 0.2620323 0.08125189
r2 0.2620323 0.08125188
        [,1]      [,2]
r1 0.2620323 0.1546493
r2 0.2620323 0.1546493
                     x1         x2        x3
r1 0.2620323 -0.4705327 0.08125189 0.1546493
r2 0.2620323 -0.4705327 0.08125188 0.1546493
> test3(df,log=TRUE)
        [,1]      [,2]
r1 -1.339288 -1.795705
r2 -1.339288 -1.795705
        [,1]      [,2]
r1 -1.339288 0.3100835
r2 -1.339288 0.3100835
        [,1]      [,2]
r1 -1.339288 0.5901916
r2 -1.339288 0.5901916
                    x1        x2        x3
r1 -1.339288 -1.795705 0.3100835 0.5901916
r2 -1.339288 -1.795705 0.3100835 0.5901916
> 
> test3(pf)
        [,1]      [,2]
r1 0.3626988 0.2620323
r2 0.3626988 0.2620323
        [,1]       [,2]
r1 0.3626988 -0.1846651
r2 0.3626988  0.0000000
        [,1]      [,2]
r1 0.3626988 0.1672481
r2 0.3626988 0.0000000
                    x1         x2        x3
r1 0.3626988 0.2620323 -0.1846651 0.1672481
r2 0.3626988 0.2620323  0.0000000 0.0000000
> test3(pf,log=TRUE)
        [,1]      [,2]
r1 -1.014183 0.7224515
r2 -1.014183 0.7224515
        [,1]       [,2]
r1 -1.014183 -0.5091416
r2 -1.014183  0.0000000
        [,1]      [,2]
r1 -1.014183 0.4611211
r2 -1.014183 0.0000000
                    x1         x2        x3
r1 -1.014183 0.7224515 -0.5091416 0.4611211
r2 -1.014183 0.7224515  0.0000000 0.0000000
> test3(pf,lower=FALSE)
        [,1]       [,2]
r1 0.6373012 -0.2620323
r2 0.6373012 -0.2620323
        [,1]     [,2]
r1 0.6373012 0.184665
r2 0.6373012 0.000000
        [,1]       [,2]
r1 0.6373012 -0.1672481
r2 0.6373012  0.0000000
                     x1       x2         x3
r1 0.6373012 -0.2620323 0.184665 -0.1672481
r2 0.6373012 -0.2620323 0.000000  0.0000000
> test3(pf,log=TRUE,lower=FALSE)
         [,1]       [,2]
r1 -0.4505129 -0.4111593
r2 -0.4505129 -0.4111593
         [,1]     [,2]
r1 -0.4505129 0.289761
r2 -0.4505129 0.000000
         [,1]       [,2]
r1 -0.4505129 -0.2624317
r2 -0.4505129  0.0000000
                      x1       x2         x3
r1 -0.4505129 -0.4111593 0.289761 -0.2624317
r2 -0.4505129 -0.4111593 0.000000  0.0000000
> 
> test3(qf)
       [,1]     [,2]
r1 1.151745 8.750483
r2 1.151745 8.750483
       [,1]     [,2]
r1 1.151745 1.280997
r2 1.151745 0.000000
       [,1]      [,2]
r1 1.151745 -2.079706
r2 1.151745  0.000000
                  x1       x2        x3
r1 1.151745 8.750483 1.280997 -2.079706
r2 1.151745 8.750483 0.000000  0.000000
> test3u(qf,log=TRUE)
       [,1]     [,2]
r1 3.435804 14.76303
r2 3.435804 14.76303
       [,1]      [,2]
r1 3.435804 0.5318211
r2 3.435804 0.0000000
       [,1]      [,2]
r1 3.435804 -3.458197
r2 3.435804  0.000000
                  u1        u2        u3
r1 3.435804 14.76303 0.5318211 -3.458197
r2 3.435804 14.76303 0.0000000  0.000000
> test3(qf,lower=FALSE)
       [,1]      [,2]
r1 1.633886 -12.67081
r2 1.633886 -12.67081
       [,1]     [,2]
r1 1.633886 1.659067
r2 1.633886 0.000000
       [,1]      [,2]
r1 1.633886 -3.367672
r2 1.633886  0.000000
                   x1       x2        x3
r1 1.633886 -12.67081 1.659067 -3.367672
r2 1.633886 -12.67081 0.000000  0.000000
> test3u(qf,log=TRUE,lower=FALSE)
        [,1]      [,2]
r1 0.4791897 -1.785037
r2 0.4791897 -1.785037
        [,1]      [,2]
r1 0.4791897 0.1909383
r2 0.4791897 0.0000000
        [,1]       [,2]
r1 0.4791897 -0.1359218
r2 0.4791897  0.0000000
                    u1        u2         u3
r1 0.4791897 -1.785037 0.1909383 -0.1359218
r2 0.4791897 -1.785037 0.0000000  0.0000000
> 
> test3(dgamma)
        [,1]      [,2]
r1 0.5128645 -0.458439
r2 0.5128645 -0.458439
        [,1]       [,2]
r1 0.5128645 -0.1899533
r2 0.5128645 -0.1899533
        [,1]      [,2]
r1 0.5128645 0.4368459
r2 0.5128645 0.4368459
                    x1         x2        x3
r1 0.5128645 -0.458439 -0.1899533 0.4368459
r2 0.5128645 -0.458439 -0.1899533 0.4368459
> test3(dgamma,log=TRUE)
         [,1]       [,2]
r1 -0.6677437 -0.8938795
r2 -0.6677437 -0.8938795
         [,1]       [,2]
r1 -0.6677437 -0.3703772
r2 -0.6677437 -0.3703772
         [,1]      [,2]
r1 -0.6677437 0.8517766
r2 -0.6677437 0.8517766
                      x1         x2        x3
r1 -0.6677437 -0.8938795 -0.3703772 0.8517766
r2 -0.6677437 -0.8938795 -0.3703772 0.8517766
> test3z(dgamma)
           [,1]          [,2]
r1 4.226687e-19 -2.379372e-18
r2 4.226687e-19 -2.379373e-18
           [,1]         [,2]
r1 4.226687e-19 7.615900e-19
r2 4.226687e-19 7.615899e-19
           [,1]          [,2]
r1 4.226687e-19 -4.003294e-18
r2 4.226687e-19 -4.003296e-18
                           z1           z2            z3
r1 4.226687e-19 -2.379372e-18 7.615900e-19 -4.003294e-18
r2 4.226687e-19 -2.379373e-18 7.615899e-19 -4.003296e-18
> test3z(dgamma,log=TRUE)
       [,1]      [,2]
r1 -42.3077 -5.629405
r2 -42.3077 -5.629405
       [,1]    [,2]
r1 -42.3077 1.80186
r2 -42.3077 1.80186
       [,1]      [,2]
r1 -42.3077 -9.471475
r2 -42.3077 -9.471475
                   z1      z2        z3
r1 -42.3077 -5.629405 1.80186 -9.471475
r2 -42.3077 -5.629405 1.80186 -9.471475
> 
> dgamma_scale <- function (x,a,b,...) dgamma(x,a,scale=b,...)
> test3(dgamma_scale)
        [,1]      [,2]
r1 0.7066063 -1.205443
r2 0.7066063 -1.205443
        [,1]      [,2]
r1 0.7066063 0.2974105
r2 0.7066063 0.2974105
        [,1]      [,2]
r1 0.7066063 -0.195162
r2 0.7066063 -0.195162
                    x1        x2        x3
r1 0.7066063 -1.205443 0.2974105 -0.195162
r2 0.7066063 -1.205443 0.2974105 -0.195162
> test3(dgamma_scale,log=TRUE)
         [,1]      [,2]
r1 -0.3472817 -1.705962
r2 -0.3472817 -1.705962
         [,1]      [,2]
r1 -0.3472817 0.4208999
r2 -0.3472817 0.4208999
         [,1]       [,2]
r1 -0.3472817 -0.2761962
r2 -0.3472817 -0.2761962
                     x1        x2         x3
r1 -0.3472817 -1.705962 0.4208999 -0.2761962
r2 -0.3472817 -1.705962 0.4208999 -0.2761962
> test3z(dgamma_scale)
           [,1]         [,2]
r1 2.798995e-08 2.547383e-08
r2 2.798995e-08 2.547382e-08
           [,1]          [,2]
r1 2.798995e-08 -5.595390e-08
r2 2.798995e-08 -5.595391e-08
           [,1]          [,2]
r1 2.798995e-08 -4.772068e-08
r2 2.798995e-08 -4.772069e-08
                          z1            z2            z3
r1 2.798995e-08 2.547383e-08 -5.595390e-08 -4.772068e-08
r2 2.798995e-08 2.547382e-08 -5.595391e-08 -4.772069e-08
> test3z(dgamma_scale,log=TRUE)
        [,1]      [,2]
r1 -17.39142 0.9101062
r2 -17.39142 0.9101062
        [,1]      [,2]
r1 -17.39142 -1.999072
r2 -17.39142 -1.999072
        [,1]      [,2]
r1 -17.39142 -1.704922
r2 -17.39142 -1.704922
                    z1        z2        z3
r1 -17.39142 0.9101062 -1.999072 -1.704922
r2 -17.39142 0.9101062 -1.999072 -1.704922
> 
> test3(pgamma)
        [,1]      [,2]
r1 0.3255045 0.5128645
r2 0.3255045 0.5128645
        [,1]       [,2]
r1 0.3255045 -0.5138569
r2 0.3255045  0.0000000
        [,1]      [,2]
r1 0.3255045 0.3635034
r2 0.3255045 0.3635034
                    x1         x2        x3
r1 0.3255045 0.5128645 -0.5138569 0.3635034
r2 0.3255045 0.5128645  0.0000000 0.3635034
> test3(pgamma,log=TRUE)
        [,1]     [,2]
r1 -1.122379 1.575599
r2 -1.122379 1.575599
        [,1]      [,2]
r1 -1.122379 -1.578648
r2 -1.122379  0.000000
        [,1]     [,2]
r1 -1.122379 1.116739
r2 -1.122379 1.116739
                   x1        x2       x3
r1 -1.122379 1.575599 -1.578648 1.116739
r2 -1.122379 1.575599  0.000000 1.116739
> test3(pgamma,lower=FALSE)
        [,1]       [,2]
r1 0.6744955 -0.5128644
r2 0.6744955 -0.5128645
        [,1]      [,2]
r1 0.6744955 0.5138569
r2 0.6744955 0.0000000
        [,1]       [,2]
r1 0.6744955 -0.3635034
r2 0.6744955 -0.3635034
                     x1        x2         x3
r1 0.6744955 -0.5128644 0.5138569 -0.3635034
r2 0.6744955 -0.5128645 0.0000000 -0.3635034
> test3(pgamma,log=TRUE,lower=FALSE)
         [,1]       [,2]
r1 -0.3937902 -0.7603675
r2 -0.3937902 -0.7603675
         [,1]      [,2]
r1 -0.3937902 0.7618388
r2 -0.3937902 0.0000000
         [,1]       [,2]
r1 -0.3937902 -0.5389263
r2 -0.3937902 -0.5389263
                      x1        x2         x3
r1 -0.3937902 -0.7603675 0.7618388 -0.5389263
r2 -0.3937902 -0.7603675 0.0000000 -0.5389263
> test3z(pgamma)
   [,1]         [,2]
r1    1 0.000000e+00
r2    1 4.226687e-19
   [,1] [,2]
r1    1    0
r2    1    0
   [,1]        [,2]
r1    1 0.00000e+00
r2    1 7.22365e-19
               z1 z2          z3
r1 1 0.000000e+00  0 0.00000e+00
r2 1 4.226687e-19  0 7.22365e-19
> test3z(pgamma,log=TRUE)
            [,1]         [,2]
r1 -7.487095e-20 4.226685e-19
r2 -7.487095e-20 4.226687e-19
            [,1]          [,2]
r1 -7.487095e-20 -1.360467e-19
r2 -7.487095e-20  0.000000e+00
            [,1]         [,2]
r1 -7.487095e-20 7.223646e-19
r2 -7.487095e-20 7.223650e-19
                           z1            z2           z3
r1 -7.487095e-20 4.226685e-19 -1.360467e-19 7.223646e-19
r2 -7.487095e-20 4.226687e-19  0.000000e+00 7.223650e-19
> test3z(pgamma,lower=FALSE)
           [,1]          [,2]
r1 7.487095e-20 -4.226685e-19
r2 7.487095e-20 -4.226687e-19
           [,1]         [,2]
r1 7.487095e-20 1.360467e-19
r2 7.487095e-20 0.000000e+00
           [,1]          [,2]
r1 7.487095e-20 -7.223646e-19
r2 7.487095e-20 -7.223650e-19
                           z1           z2            z3
r1 7.487095e-20 -4.226685e-19 1.360467e-19 -7.223646e-19
r2 7.487095e-20 -4.226687e-19 0.000000e+00 -7.223650e-19
> test3z(pgamma,log=TRUE,lower=FALSE)
        [,1]      [,2]
r1 -44.03852 -5.645296
r2 -44.03852 -5.645296
        [,1]     [,2]
r1 -44.03852 1.817082
r2 -44.03852 0.000000
        [,1]      [,2]
r1 -44.03852 -9.648134
r2 -44.03852 -9.648134
                    z1       z2        z3
r1 -44.03852 -5.645296 1.817082 -9.648134
r2 -44.03852 -5.645296 0.000000 -9.648134
> 
> test3(qgamma)
        [,1]     [,2]
r1 0.8181445 2.596227
r2 0.8181445 2.596227
        [,1]     [,2]
r1 0.8181445 1.369315
r2 0.8181445 0.000000
        [,1]      [,2]
r1 0.8181445 -1.215217
r2 0.8181445 -1.215217
                   x1       x2        x3
r1 0.8181445 2.596227 1.369315 -1.215217
r2 0.8181445 2.596227 0.000000 -1.215217
> test3u(qgamma,log=TRUE)
      [,1]     [,2]
r1 1.77312 2.455183
r2 1.77312 2.455183
      [,1]      [,2]
r1 1.77312 0.9788234
r2 1.77312 0.0000000
      [,1]      [,2]
r1 1.77312 -1.450844
r2 1.77312 -1.450844
                 u1        u2        u3
r1 1.77312 2.455183 0.9788234 -1.450844
r2 1.77312 2.455183 0.0000000 -1.450844
> test3(qgamma,lower=FALSE)
        [,1]      [,2]
r1 0.9426019 -2.865545
r2 0.9426019 -2.865544
        [,1]     [,2]
r1 0.9426019 1.479961
r2 0.9426019 0.000000
        [,1]      [,2]
r1 0.9426019 -1.400077
r2 0.9426019 -1.400077
                    x1       x2        x3
r1 0.9426019 -2.865545 1.479961 -1.400077
r2 0.9426019 -2.865544 0.000000 -1.400077
> test3u(qgamma,log=TRUE,lower=FALSE)
       [,1]     [,2]
r1 0.800113 -1.42772
r2 0.800113 -1.42772
       [,1]      [,2]
r1 0.800113 0.6460083
r2 0.800113 0.0000000
       [,1]       [,2]
r1 0.800113 -0.6546873
r2 0.800113 -0.6546873
                  u1        u2         u3
r1 0.800113 -1.42772 0.6460083 -0.6546873
r2 0.800113 -1.42772 0.0000000 -0.6546873
> 
> test3(dlnorm)
         [,1]      [,2]
r1 0.06516845 0.3559332
r2 0.06516845 0.3559332
         [,1]       [,2]
r1 0.06516845 -0.2350126
r2 0.06516845 -0.2350126
         [,1]      [,2]
r1 0.06516845 0.4737897
r2 0.06516845 0.4737896
                     x1         x2        x3
r1 0.06516845 0.3559332 -0.2350126 0.4737897
r2 0.06516845 0.3559332 -0.2350126 0.4737896
> test3(dlnorm,log=TRUE)
       [,1]     [,2]
r1 -2.73078 5.461741
r2 -2.73078 5.461741
       [,1]      [,2]
r1 -2.73078 -3.606234
r2 -2.73078 -3.606234
       [,1]     [,2]
r1 -2.73078 7.270230
r2 -2.73078 7.270231
                  x1        x2       x3
r1 -2.73078 5.461741 -3.606234 7.270230
r2 -2.73078 5.461741 -3.606234 7.270231
> test3z(dlnorm)
          [,1]          [,2]
r1 0.001459423 -9.719854e-05
r2 0.001459423 -9.719854e-05
          [,1]         [,2]
r1 0.001459423 -0.000348259
r2 0.001459423 -0.000348259
          [,1]         [,2]
r1 0.001459423 0.0003377033
r2 0.001459423 0.0003377033
                          z1           z2           z3
r1 0.001459423 -9.719854e-05 -0.000348259 0.0003377033
r2 0.001459423 -9.719854e-05 -0.000348259 0.0003377033
> test3z(dlnorm,log=TRUE)
        [,1]        [,2]
r1 -6.529714 -0.06660066
r2 -6.529714 -0.06660066
        [,1]       [,2]
r1 -6.529714 -0.2386279
r2 -6.529714 -0.2386279
        [,1]      [,2]
r1 -6.529714 0.2313951
r2 -6.529714 0.2313951
                      z1         z2        z3
r1 -6.529714 -0.06660066 -0.2386279 0.2313951
r2 -6.529714 -0.06660066 -0.2386279 0.2313951
> 
> test3(plnorm)
          [,1]       [,2]
r1 0.007593333 0.06516845
r2 0.007593333 0.06516845
          [,1]        [,2]
r1 0.007593333 -0.03109708
r2 0.007593333 -0.03109708
          [,1]      [,2]
r1 0.007593333 0.0755005
r2 0.007593333 0.0755005
                       x1          x2        x3
r1 0.007593333 0.06516845 -0.03109708 0.0755005
r2 0.007593333 0.06516845 -0.03109708 0.0755005
> test3(plnorm,log=TRUE)
        [,1]     [,2]
r1 -4.880485 8.582325
r2 -4.880485 8.582325
        [,1]      [,2]
r1 -4.880485 -4.095314
r2 -4.880485 -4.095314
        [,1]     [,2]
r1 -4.880485 9.942999
r2 -4.880485 9.942999
                   x1        x2       x3
r1 -4.880485 8.582325 -4.095314 9.942999
r2 -4.880485 8.582325 -4.095314 9.942999
> test3(plnorm,lower=FALSE)
        [,1]        [,2]
r1 0.9924067 -0.06516846
r2 0.9924067 -0.06516845
        [,1]       [,2]
r1 0.9924067 0.03109708
r2 0.9924067 0.03109708
        [,1]       [,2]
r1 0.9924067 -0.0755005
r2 0.9924067 -0.0755005
                      x1         x2         x3
r1 0.9924067 -0.06516846 0.03109708 -0.0755005
r2 0.9924067 -0.06516845 0.03109708 -0.0755005
> test3(plnorm,log=TRUE,lower=FALSE)
           [,1]        [,2]
r1 -0.007622309 -0.06566708
r2 -0.007622309 -0.06566708
           [,1]       [,2]
r1 -0.007622309 0.03133502
r2 -0.007622309 0.03133502
           [,1]        [,2]
r1 -0.007622309 -0.07607819
r2 -0.007622309 -0.07607819
                         x1         x2          x3
r1 -0.007622309 -0.06566708 0.03133502 -0.07607819
r2 -0.007622309 -0.06566708 0.03133502 -0.07607819
> test3z(plnorm)
         [,1]        [,2]
r1 0.05522383 0.001459423
r2 0.05522383 0.001459423
         [,1]        [,2]
r1 0.05522383 -0.01668398
r2 0.05522383 -0.01668398
         [,1]      [,2]
r1 0.05522383 0.0266307
r2 0.05522383 0.0266307
                       z1          z2        z3
r1 0.05522383 0.001459423 -0.01668398 0.0266307
r2 0.05522383 0.001459423 -0.01668398 0.0266307
> test3z(plnorm,log=TRUE)
        [,1]       [,2]
r1 -2.896361 0.02642741
r2 -2.896361 0.02642741
        [,1]       [,2]
r1 -2.896361 -0.3021155
r2 -2.896361 -0.3021155
        [,1]     [,2]
r1 -2.896361 0.482232
r2 -2.896361 0.482232
                     z1         z2       z3
r1 -2.896361 0.02642741 -0.3021155 0.482232
r2 -2.896361 0.02642741 -0.3021155 0.482232
> test3z(plnorm,lower=FALSE)
        [,1]         [,2]
r1 0.9447762 -0.001459423
r2 0.9447762 -0.001459423
        [,1]       [,2]
r1 0.9447762 0.01668398
r2 0.9447762 0.01668398
        [,1]       [,2]
r1 0.9447762 -0.0266307
r2 0.9447762 -0.0266307
                       z1         z2         z3
r1 0.9447762 -0.001459423 0.01668398 -0.0266307
r2 0.9447762 -0.001459423 0.01668398 -0.0266307
> test3z(plnorm,log=TRUE,lower=FALSE)
          [,1]         [,2]
r1 -0.05680724 -0.001544729
r2 -0.05680724 -0.001544729
          [,1]       [,2]
r1 -0.05680724 0.01765918
r2 -0.05680724 0.01765919
          [,1]        [,2]
r1 -0.05680724 -0.02818731
r2 -0.05680724 -0.02818731
                         z1         z2          z3
r1 -0.05680724 -0.001544729 0.01765918 -0.02818731
r2 -0.05680724 -0.001544729 0.01765919 -0.02818731
> 
> test3(qlnorm)
      [,1]    [,2]
r1 2.35417 3.97938
r2 2.35417 3.97938
      [,1]    [,2]
r1 2.35417 2.35417
r2 2.35417 2.35417
      [,1]      [,2]
r1 2.35417 -0.134735
r2 2.35417 -0.134735
                x1      x2        x3
r1 2.35417 3.97938 2.35417 -0.134735
r2 2.35417 3.97938 2.35417 -0.134735
> test3y(qlnorm,log=TRUE)
       [,1]     [,2]
r1 0.810924 1.934376
r2 0.810924 1.934376
       [,1]     [,2]
r1 0.810924 0.810924
r2 0.810924 0.810924
       [,1]     [,2]
r1 0.810924 0.400455
r2 0.810924 0.400455
                  y1       y2       y3
r1 0.810924 1.934376 0.810924 0.400455
r2 0.810924 1.934376 0.810924 0.400455
> test3(qlnorm,lower=FALSE)
       [,1]      [,2]
r1 2.542764 -4.298171
r2 2.542764 -4.298171
       [,1]     [,2]
r1 2.542764 2.542764
r2 2.542764 2.542764
       [,1]      [,2]
r1 2.542764 0.1455287
r2 2.542764 0.1455287
                   x1       x2        x3
r1 2.542764 -4.298171 2.542764 0.1455287
r2 2.542764 -4.298171 2.542764 0.1455287
> test3y(qlnorm,log=TRUE,lower=FALSE)
        [,1]       [,2]
r1 0.2425326 -0.5785366
r2 0.2425326 -0.5785366
        [,1]      [,2]
r1 0.2425326 0.2425326
r2 0.2425326 0.2425326
        [,1]       [,2]
r1 0.2425326 -0.1197688
r2 0.2425326 -0.1197688
                     y1        y2         y3
r1 0.2425326 -0.5785366 0.2425326 -0.1197688
r2 0.2425326 -0.5785366 0.2425326 -0.1197688
> 
> test2r(rlnorm)
                x1        x2
r1 2.16995 2.16995 0.7215801
r2 2.16995 2.16995 0.7215800
> 
> test3(dlogis)
        [,1]      [,2]
r1 0.3377968 0.1507839
r2 0.3377968 0.1507838
        [,1]       [,2]
r1 0.3377968 -0.1507838
r2 0.3377968 -0.1507838
        [,1]       [,2]
r1 0.3377968 -0.4082265
r2 0.3377968 -0.4082265
                    x1         x2         x3
r1 0.3377968 0.1507839 -0.1507838 -0.4082265
r2 0.3377968 0.1507838 -0.1507838 -0.4082265
> test3(dlogis,log=TRUE)
        [,1]      [,2]
r1 -1.085311 0.4463744
r2 -1.085311 0.4463744
        [,1]       [,2]
r1 -1.085311 -0.4463744
r2 -1.085311 -0.4463744
        [,1]      [,2]
r1 -1.085311 -1.208497
r2 -1.085311 -1.208497
                    x1         x2        x3
r1 -1.085311 0.4463744 -0.4463744 -1.208497
r2 -1.085311 0.4463744 -0.4463744 -1.208497
> test3z(dlogis)
         [,1]         [,2]
r1 0.03679051 0.0006876616
r2 0.03679051 0.0006876617
         [,1]          [,2]
r1 0.03679051 -0.0006876618
r2 0.03679051 -0.0006876617
         [,1]         [,2]
r1 0.03679051 -0.005327287
r2 0.03679051 -0.005327288
                        z1            z2           z3
r1 0.03679051 0.0006876616 -0.0006876618 -0.005327287
r2 0.03679051 0.0006876617 -0.0006876617 -0.005327288
> test3z(dlogis,log=TRUE)
        [,1]       [,2]
r1 -3.302515 0.01869128
r2 -3.302515 0.01869128
        [,1]        [,2]
r1 -3.302515 -0.01869128
r2 -3.302515 -0.01869128
        [,1]       [,2]
r1 -3.302515 -0.1448006
r2 -3.302515 -0.1448006
                     z1          z2         z3
r1 -3.302515 0.01869128 -0.01869128 -0.1448006
r2 -3.302515 0.01869128 -0.01869128 -0.1448006
> 
> test3(plogis)
        [,1]      [,2]
r1 0.3497392 0.3377968
r2 0.3497392 0.3377968
        [,1]       [,2]
r1 0.3497392 -0.3377968
r2 0.3497392 -0.3377968
        [,1]      [,2]
r1 0.3497392 0.2094967
r2 0.3497392 0.2094967
                    x1         x2        x3
r1 0.3497392 0.3377968 -0.3377968 0.2094967
r2 0.3497392 0.3377968 -0.3377968 0.2094967
> test3(plogis,log=TRUE)
        [,1]      [,2]
r1 -1.050567 0.9658534
r2 -1.050567 0.9658534
        [,1]       [,2]
r1 -1.050567 -0.9658534
r2 -1.050567 -0.9658534
        [,1]      [,2]
r1 -1.050567 0.5990084
r2 -1.050567 0.5990084
                    x1         x2        x3
r1 -1.050567 0.9658534 -0.9658534 0.5990084
r2 -1.050567 0.9658534 -0.9658534 0.5990084
> test3(plogis,lower=FALSE)
        [,1]       [,2]
r1 0.6502608 -0.3377968
r2 0.6502608 -0.3377968
        [,1]      [,2]
r1 0.6502608 0.3377968
r2 0.6502608 0.3377968
        [,1]       [,2]
r1 0.6502608 -0.2094967
r2 0.6502608 -0.2094967
                     x1        x2         x3
r1 0.6502608 -0.3377968 0.3377968 -0.2094967
r2 0.6502608 -0.3377968 0.3377968 -0.2094967
> test3(plogis,log=TRUE,lower=FALSE)
         [,1]      [,2]
r1 -0.4303818 -0.519479
r2 -0.4303818 -0.519479
         [,1]     [,2]
r1 -0.4303818 0.519479
r2 -0.4303818 0.519479
         [,1]       [,2]
r1 -0.4303818 -0.3221734
r2 -0.4303818 -0.3221734
                     x1       x2         x3
r1 -0.4303818 -0.519479 0.519479 -0.3221734
r2 -0.4303818 -0.519479 0.519479 -0.3221734
> test3z(plogis)
        [,1]       [,2]
r1 0.4374869 0.03679051
r2 0.4374869 0.03679051
        [,1]        [,2]
r1 0.4374869 -0.03679051
r2 0.4374869 -0.03679051
        [,1]        [,2]
r1 0.4374869 0.009247941
r2 0.4374869 0.009247941
                     z1          z2          z3
r1 0.4374869 0.03679051 -0.03679051 0.009247941
r2 0.4374869 0.03679051 -0.03679051 0.009247941
> test3z(plogis,log=TRUE)
         [,1]       [,2]
r1 -0.8267084 0.08409512
r2 -0.8267084 0.08409512
         [,1]        [,2]
r1 -0.8267084 -0.08409512
r2 -0.8267084 -0.08409512
         [,1]       [,2]
r1 -0.8267084 0.02113878
r2 -0.8267084 0.02113878
                      z1          z2         z3
r1 -0.8267084 0.08409512 -0.08409512 0.02113878
r2 -0.8267084 0.08409512 -0.08409512 0.02113878
> test3z(plogis,lower=FALSE)
        [,1]        [,2]
r1 0.5625131 -0.03679051
r2 0.5625131 -0.03679051
        [,1]       [,2]
r1 0.5625131 0.03679051
r2 0.5625131 0.03679051
        [,1]         [,2]
r1 0.5625131 -0.009247940
r2 0.5625131 -0.009247941
                      z1         z2           z3
r1 0.5625131 -0.03679051 0.03679051 -0.009247940
r2 0.5625131 -0.03679051 0.03679051 -0.009247941
> test3z(plogis,log=TRUE,lower=FALSE)
         [,1]        [,2]
r1 -0.5753409 -0.06540384
r2 -0.5753409 -0.06540384
         [,1]       [,2]
r1 -0.5753409 0.06540384
r2 -0.5753409 0.06540384
         [,1]       [,2]
r1 -0.5753409 -0.0164404
r2 -0.5753409 -0.0164404
                       z1         z2         z3
r1 -0.5753409 -0.06540384 0.06540384 -0.0164404
r2 -0.5753409 -0.06540384 0.06540384 -0.0164404
> 
> test3(qlogis)
       [,1]     [,2]
r1 0.833223 2.698621
r2 0.833223 2.698621
       [,1] [,2]
r1 0.833223    1
r2 0.833223    1
       [,1]        [,2]
r1 0.833223 -0.09134345
r2 0.833223 -0.09134346
                  x1 x2          x3
r1 0.833223 2.698621  1 -0.09134345
r2 0.833223 2.698621  1 -0.09134346
> test3y(qlogis,log=TRUE)
       [,1]     [,2]
r1 0.160669 3.933287
r2 0.160669 3.933287
       [,1] [,2]
r1 0.160669    1
r2 0.160669    1
       [,1]      [,2]
r1 0.160669 0.7967802
r2 0.160669 0.7967802
                  y1 y2        y3
r1 0.160669 3.933287  1 0.7967802
r2 0.160669 3.933287  1 0.7967802
> test3(qlogis,lower=FALSE)
       [,1]      [,2]
r1 0.956217 -2.698621
r2 0.956217 -2.698621
       [,1] [,2]
r1 0.956217    1
r2 0.956217    1
       [,1]       [,2]
r1 0.956217 0.09134345
r2 0.956217 0.09134346
                   x1 x2         x3
r1 0.956217 -2.698621  1 0.09134345
r2 0.956217 -2.698621  1 0.09134346
> test3y(qlogis,log=TRUE,lower=FALSE)
        [,1]      [,2]
r1 -1.786869 -3.933287
r2 -1.786869 -3.933287
        [,1] [,2]
r1 -1.786869    1
r2 -1.786869    1
        [,1]       [,2]
r1 -1.786869 -0.7967802
r2 -1.786869 -0.7967802
                    y1 y2         y3
r1 -1.786869 -3.933287  1 -0.7967802
r2 -1.786869 -3.933287  1 -0.7967802
> 
> test2r(rlogis)
             x1        x2
r1 0.9543501  1 0.5333178
r2 0.9543501  1 0.5333178
> 
> test3v(dnbinom)
        [,1]      [,2]
r1 0.1770527 0.3796633
r2 0.1770527 0.3796633
> test3v(dnbinom,log=TRUE)
        [,1]     [,2]
r1 -1.731308 2.144351
r2 -1.731308 2.144351
> 
> test3v(pnbinom)
        [,1]     [,2]
r1 0.5173596 2.718452
r2 0.5173596 2.718452
> test3v(pnbinom,log=TRUE)
         [,1]     [,2]
r1 -0.6590172 5.254472
r2 -0.6590172 5.254472
> test3v(pnbinom,lower=FALSE)
        [,1]      [,2]
r1 0.4826404 -2.718452
r2 0.4826404 -2.718452
> test3v(pnbinom,log=TRUE,lower=FALSE)
         [,1]      [,2]
r1 -0.7284833 -5.632457
r2 -0.7284833 -5.632457
> 
> dnbinom_mu <- function (x, size, mu, ...) dnbinom(x,size,mu=mu,...)
> test3v(dnbinom_mu)
         [,1]       [,2]
r1 0.02779435 0.09169925
r2 0.02779435 0.09169925
> test3v(dnbinom_mu,log=TRUE)
        [,1]     [,2]
r1 -3.582923 3.299205
r2 -3.582923 3.299205
> 
> pnbinom_mu <- function (q, size, mu, ...) pnbinom(q,size,mu=mu,...)
> test3v(pnbinom_mu)
        [,1]        [,2]
r1 0.9927539 -0.03632630
r2 0.9927539 -0.03632631
> test3v(pnbinom_mu,log=TRUE)
           [,1]        [,2]
r1 -0.007272439 -0.03659145
r2 -0.007272439 -0.03659145
> test3v(pnbinom_mu,lower=FALSE)
          [,1]       [,2]
r1 0.007246059 0.03632631
r2 0.007246059 0.03632631
> test3v(pnbinom_mu,log=TRUE,lower=FALSE)
        [,1]    [,2]
r1 -4.927298 5.01325
r2 -4.927298 5.01325
> 
> test3(dnorm)
        [,1]      [,2]
r1 0.4888913 0.4503578
r2 0.4888913 0.4503578
        [,1]       [,2]
r1 0.4888913 -0.4503578
r2 0.4888913 -0.4503578
        [,1]       [,2]
r1 0.4888913 -0.4468606
r2 0.4888913 -0.4468606
                    x1         x2         x3
r1 0.4888913 0.4503578 -0.4503578 -0.4468606
r2 0.4888913 0.4503578 -0.4503578 -0.4468606
> test3(dnorm,log=TRUE)
         [,1]      [,2]
r1 -0.7156151 0.9211818
r2 -0.7156151 0.9211818
         [,1]       [,2]
r1 -0.7156151 -0.9211819
r2 -0.7156151 -0.9211818
         [,1]       [,2]
r1 -0.7156151 -0.9140286
r2 -0.7156151 -0.9140286
                     x1         x2         x3
r1 -0.7156151 0.9211818 -0.9211819 -0.9140286
r2 -0.7156151 0.9211818 -0.9211818 -0.9140286
> test3z(dnorm)
         [,1]        [,2]
r1 0.05778667 0.002171576
r2 0.05778667 0.002171576
         [,1]         [,2]
r1 0.05778667 -0.002171576
r2 0.05778667 -0.002171576
         [,1]         [,2]
r1 0.05778667 -0.008093182
r2 0.05778667 -0.008093182
                       z1           z2           z3
r1 0.05778667 0.002171576 -0.002171576 -0.008093182
r2 0.05778667 0.002171576 -0.002171576 -0.008093182
> test3z(dnorm,log=TRUE)
        [,1]       [,2]
r1 -2.850997 0.03757919
r2 -2.850997 0.03757918
        [,1]        [,2]
r1 -2.850997 -0.03757918
r2 -2.850997 -0.03757918
        [,1]       [,2]
r1 -2.850997 -0.1400528
r2 -2.850997 -0.1400528
                     z1          z2         z3
r1 -2.850997 0.03757919 -0.03757918 -0.1400528
r2 -2.850997 0.03757918 -0.03757918 -0.1400528
> 
> test3(pnorm)
        [,1]      [,2]
r1 0.2675678 0.4888913
r2 0.2675678 0.4888913
        [,1]       [,2]
r1 0.2675678 -0.4888913
r2 0.2675678 -0.4888913
        [,1]      [,2]
r1 0.2675678 0.3032034
r2 0.2675678 0.3032034
                    x1         x2        x3
r1 0.2675678 0.4888913 -0.4888913 0.3032034
r2 0.2675678 0.4888913 -0.4888913 0.3032034
> test3(pnorm,log=TRUE)
        [,1]     [,2]
r1 -1.318382 1.827168
r2 -1.318382 1.827168
        [,1]      [,2]
r1 -1.318382 -1.827168
r2 -1.318382 -1.827168
        [,1]     [,2]
r1 -1.318382 1.133183
r2 -1.318382 1.133183
                   x1        x2       x3
r1 -1.318382 1.827168 -1.827168 1.133183
r2 -1.318382 1.827168 -1.827168 1.133183
> test3(pnorm,lower=FALSE)
        [,1]       [,2]
r1 0.7324322 -0.4888913
r2 0.7324322 -0.4888913
        [,1]      [,2]
r1 0.7324322 0.4888913
r2 0.7324322 0.4888913
        [,1]       [,2]
r1 0.7324322 -0.3032034
r2 0.7324322 -0.3032034
                     x1        x2         x3
r1 0.7324322 -0.4888913 0.4888913 -0.3032034
r2 0.7324322 -0.4888913 0.4888913 -0.3032034
> test3(pnorm,log=TRUE,lower=FALSE)
         [,1]       [,2]
r1 -0.3113845 -0.6674902
r2 -0.3113845 -0.6674902
         [,1]      [,2]
r1 -0.3113845 0.6674901
r2 -0.3113845 0.6674902
         [,1]       [,2]
r1 -0.3113845 -0.4139678
r2 -0.3113845 -0.4139678
                      x1        x2         x3
r1 -0.3113845 -0.6674902 0.6674901 -0.4139678
r2 -0.3113845 -0.6674902 0.6674902 -0.4139678
> test3z(pnorm)
       [,1]       [,2]
r1 0.400765 0.05778667
r2 0.400765 0.05778667
       [,1]        [,2]
r1 0.400765 -0.05778667
r2 0.400765 -0.05778667
       [,1]       [,2]
r1 0.400765 0.01452569
r2 0.400765 0.01452569
                    z1          z2         z3
r1 0.400765 0.05778667 -0.05778667 0.01452569
r2 0.400765 0.05778667 -0.05778667 0.01452569
> test3z(pnorm,log=TRUE)
         [,1]      [,2]
r1 -0.9143801 0.1441909
r2 -0.9143801 0.1441909
         [,1]       [,2]
r1 -0.9143801 -0.1441909
r2 -0.9143801 -0.1441909
         [,1]       [,2]
r1 -0.9143801 0.03624491
r2 -0.9143801 0.03624491
                     z1         z2         z3
r1 -0.9143801 0.1441909 -0.1441909 0.03624491
r2 -0.9143801 0.1441909 -0.1441909 0.03624491
> test3z(pnorm,lower=FALSE)
       [,1]        [,2]
r1 0.599235 -0.05778667
r2 0.599235 -0.05778667
       [,1]       [,2]
r1 0.599235 0.05778667
r2 0.599235 0.05778667
       [,1]        [,2]
r1 0.599235 -0.01452569
r2 0.599235 -0.01452569
                     z1         z2          z3
r1 0.599235 -0.05778667 0.05778667 -0.01452569
r2 0.599235 -0.05778667 0.05778667 -0.01452569
> test3z(pnorm,log=TRUE,lower=FALSE)
         [,1]        [,2]
r1 -0.5121014 -0.09643406
r2 -0.5121014 -0.09643406
         [,1]       [,2]
r1 -0.5121014 0.09643406
r2 -0.5121014 0.09643406
         [,1]        [,2]
r1 -0.5121014 -0.02424039
r2 -0.5121014 -0.02424039
                       z1         z2          z3
r1 -0.5121014 -0.09643406 0.09643406 -0.02424039
r2 -0.5121014 -0.09643406 0.09643406 -0.02424039
> 
> test3(qnorm)
        [,1]     [,2]
r1 0.8561882 1.690354
r2 0.8561882 1.690354
        [,1] [,2]
r1 0.8561882    1
r2 0.8561882    1
        [,1]        [,2]
r1 0.8561882 -0.05723249
r2 0.8561882 -0.05723249
                   x1 x2          x3
r1 0.8561882 1.690354  1 -0.05723249
r2 0.8561882 1.690354  1 -0.05723249
> test3y(qnorm,log=TRUE)
        [,1]     [,2]
r1 -0.209581 2.385397
r2 -0.209581 2.385397
        [,1] [,2]
r1 -0.209581    1
r2 -0.209581    1
        [,1]      [,2]
r1 -0.209581 0.4938256
r2 -0.209581 0.4938256
                   y1 y2        y3
r1 -0.209581 2.385397  1 0.4938256
r2 -0.209581 2.385397  1 0.4938256
> test3(qnorm,lower=FALSE)
        [,1]      [,2]
r1 0.9332518 -1.690354
r2 0.9332518 -1.690354
        [,1] [,2]
r1 0.9332518    1
r2 0.9332518    1
        [,1]       [,2]
r1 0.9332518 0.05723249
r2 0.9332518 0.05723249
                    x1 x2         x3
r1 0.9332518 -1.690354  1 0.05723249
r2 0.9332518 -1.690354  1 0.05723249
> test3y(qnorm,log=TRUE,lower=FALSE)
        [,1]      [,2]
r1 -1.416619 -2.385397
r2 -1.416619 -2.385397
        [,1] [,2]
r1 -1.416619    1
r2 -1.416619    1
        [,1]       [,2]
r1 -1.416619 -0.4938256
r2 -1.416619 -0.4938256
                    y1 y2         y3
r1 -1.416619 -2.385397  1 -0.4938256
r2 -1.416619 -2.385397  1 -0.4938256
> 
> test2r(rnorm)
            x1        x2
r1 0.774704  1 0.3325331
r2 0.774704  1 0.3325331
> 
> test3w(dunif)
        [,1] [,2]
r1 0.2185931    0
r2 0.2185931    0
        [,1]       [,2]
r1 0.2185931 0.04778294
r2 0.2185931 0.04778294
        [,1]        [,2]
r1 0.2185931 -0.04778294
r2 0.2185931 -0.04778294
             w1         w2          w3
r1 0.2185931  0 0.04778294 -0.04778294
r2 0.2185931  0 0.04778294 -0.04778294
> test3w(dunif,log=TRUE)
        [,1] [,2]
r1 -1.520543    0
r2 -1.520543    0
        [,1]      [,2]
r1 -1.520543 0.2185931
r2 -1.520543 0.2185931
        [,1]       [,2]
r1 -1.520543 -0.2185931
r2 -1.520543 -0.2185931
             w1        w2         w3
r1 -1.520543  0 0.2185931 -0.2185931
r2 -1.520543  0 0.2185931 -0.2185931
> 
> test3w(punif)
        [,1]      [,2]
r1 0.1588297 0.2185931
r2 0.1588297 0.2185931
        [,1]      [,2]
r1 0.1588297 -0.183874
r2 0.1588297 -0.183874
        [,1]        [,2]
r1 0.1588297 -0.03471908
r2 0.1588297 -0.03471908
                    w1        w2          w3
r1 0.1588297 0.2185931 -0.183874 -0.03471908
r2 0.1588297 0.2185931 -0.183874 -0.03471908
> test3w(punif,log=TRUE)
        [,1]     [,2]
r1 -1.839922 1.376273
r2 -1.839922 1.376273
        [,1]     [,2]
r1 -1.839922 -1.15768
r2 -1.839922 -1.15768
        [,1]       [,2]
r1 -1.839922 -0.2185931
r2 -1.839922 -0.2185931
                   w1       w2         w3
r1 -1.839922 1.376273 -1.15768 -0.2185931
r2 -1.839922 1.376273 -1.15768 -0.2185931
> test3w(punif,lower=FALSE)
        [,1]       [,2]
r1 0.8411703 -0.2185931
r2 0.8411703 -0.2185931
        [,1]     [,2]
r1 0.8411703 0.183874
r2 0.8411703 0.183874
        [,1]       [,2]
r1 0.8411703 0.03471908
r2 0.8411703 0.03471908
                     w1       w2         w3
r1 0.8411703 -0.2185931 0.183874 0.03471908
r2 0.8411703 -0.2185931 0.183874 0.03471908
> test3w(punif,log=TRUE,lower=FALSE)
         [,1]       [,2]
r1 -0.1729612 -0.2598678
r2 -0.1729612 -0.2598678
         [,1]      [,2]
r1 -0.1729612 0.2185930
r2 -0.1729612 0.2185931
         [,1]       [,2]
r1 -0.1729612 0.04127474
r2 -0.1729612 0.04127474
                      w1        w2         w3
r1 -0.1729612 -0.2598678 0.2185930 0.04127474
r2 -0.1729612 -0.2598678 0.2185931 0.04127474
> 
> test3w(qunif)
       [,1]    [,2]
r1 3.950024 4.57471
r2 3.950024 4.57471
       [,1]      [,2]
r1 3.950024 0.1611003
r2 3.950024 0.1611000
       [,1]   [,2]
r1 3.950024 0.8389
r2 3.950024 0.8389
                 w1        w2     w3
r1 3.950024 4.57471 0.1611003 0.8389
r2 3.950024 4.57471 0.1611000 0.8389
> test3y(qunif,log=TRUE)
        [,1]     [,2]
r1 0.5897541 1.402854
r2 0.5897541 1.402854
        [,1]      [,2]
r1 0.5897541 0.3107147
r2 0.5897541 0.3107147
        [,1]      [,2]
r1 0.5897541 0.6892853
r2 0.5897541 0.6892853
                   y1        y2        y3
r1 0.5897541 1.402854 0.3107147 0.6892853
r2 0.5897541 1.402854 0.3107147 0.6892853
> test3w(qunif,lower=FALSE)
        [,1]     [,2]
r1 0.8492858 -4.57471
r2 0.8492858 -4.57471
        [,1]      [,2]
r1 0.8492858 0.8389001
r2 0.8492858 0.8389000
        [,1]   [,2]
r1 0.8492858 0.1611
r2 0.8492858 0.1611
                   w1        w2     w3
r1 0.8492858 -4.57471 0.8389001 0.1611
r2 0.8492858 -4.57471 0.8389000 0.1611
> test3y(qunif,log=TRUE,lower=FALSE)
         [,1]      [,2]
r1 -0.1807241 -1.402854
r2 -0.1807241 -1.402854
         [,1]      [,2]
r1 -0.1807241 0.6892853
r2 -0.1807241 0.6892853
         [,1]      [,2]
r1 -0.1807241 0.3107147
r2 -0.1807241 0.3107147
                     y1        y2        y3
r1 -0.1807241 -1.402854 0.6892853 0.3107147
r2 -0.1807241 -1.402854 0.6892853 0.3107147
> 
> test2r(runif)
                    x1        x2
r1 0.7403373 0.3697434 0.6302566
r2 0.7403373 0.3697434 0.6302566
> 
> test3(dweibull)
        [,1]      [,2]
r1 0.6608068 -1.056386
r2 0.6608068 -1.056386
        [,1]     [,2]
r1 0.6608068 0.678268
r2 0.6608068 0.678268
        [,1]       [,2]
r1 0.6608068 -0.2327821
r2 0.6608068 -0.2327821
                    x1       x2         x3
r1 0.6608068 -1.056386 0.678268 -0.2327821
r2 0.6608068 -1.056386 0.678268 -0.2327821
> 
> test3(pweibull)
        [,1]      [,2]
r1 0.5204599 0.6608068
r2 0.5204599 0.6608068
        [,1]       [,2]
r1 0.5204599 -0.1213136
r2 0.5204599  0.1213136
        [,1]       [,2]
r1 0.5204599 -0.4683606
r2 0.5204599 -0.4683606
                    x1         x2         x3
r1 0.5204599 0.6608068 -0.1213136 -0.4683606
r2 0.5204599 0.6608068  0.1213136 -0.4683606
> test3(pweibull,log=TRUE)
         [,1]     [,2]
r1 -0.6530425 1.269659
r2 -0.6530425 1.269659
         [,1]       [,2]
r1 -0.6530425 -0.2330892
r2 -0.6530425  0.2330892
         [,1]       [,2]
r1 -0.6530425 -0.8998976
r2 -0.6530425 -0.8998976
                    x1         x2         x3
r1 -0.6530425 1.269659 -0.2330892 -0.8998976
r2 -0.6530425 1.269659  0.2330892 -0.8998976
> test3(pweibull,lower=FALSE)
        [,1]       [,2]
r1 0.4795401 -0.6608068
r2 0.4795401 -0.6608068
        [,1]       [,2]
r1 0.4795401  0.1213136
r2 0.4795401 -0.1213136
        [,1]      [,2]
r1 0.4795401 0.4683606
r2 0.4795401 0.4683606
                     x1         x2        x3
r1 0.4795401 -0.6608068  0.1213136 0.4683606
r2 0.4795401 -0.6608068 -0.1213136 0.4683606
> test3(pweibull,log=TRUE,lower=FALSE)
         [,1]      [,2]
r1 -0.7349277 -1.378001
r2 -0.7349277 -1.378001
         [,1]      [,2]
r1 -0.7349277  0.252979
r2 -0.7349277 -0.252979
         [,1]      [,2]
r1 -0.7349277 0.9766869
r2 -0.7349277 0.9766870
                     x1        x2        x3
r1 -0.7349277 -1.378001  0.252979 0.9766869
r2 -0.7349277 -1.378001 -0.252979 0.9766870
> 
> test3(qweibull)
        [,1]     [,2]
r1 0.4149231 1.367749
r2 0.4149231 1.367749
        [,1]      [,2]
r1 0.4149231 0.2244641
r2 0.4149231 0.2244641
        [,1]      [,2]
r1 0.4149231 0.6162988
r2 0.4149231 0.6162988
                   x1        x2        x3
r1 0.4149231 1.367749 0.2244641 0.6162988
r2 0.4149231 1.367749 0.2244641 0.6162988
> test3u(qweibull,log=TRUE)
       [,1]     [,2]
r1 1.331973 1.394251
r2 1.331973 1.394251
       [,1]        [,2]
r1 1.331973 -0.06322735
r2 1.331973 -0.06322735
       [,1]     [,2]
r1 1.331973 1.089878
r2 1.331973 1.089878
                  u1          u2       u3
r1 1.331973 1.394251 -0.06322735 1.089878
r2 1.331973 1.394251 -0.06322735 1.089878
> test3(qweibull,lower=FALSE)
        [,1]      [,2]
r1 0.4807618 -1.521984
r2 0.4807618 -1.521984
        [,1]      [,2]
r1 0.4807618 0.1809438
r2 0.4807618 0.1809438
        [,1]      [,2]
r1 0.4807618 0.7140911
r2 0.4807618 0.7140911
                    x1        x2        x3
r1 0.4807618 -1.521984 0.1809438 0.7140911
r2 0.4807618 -1.521984 0.1809438 0.7140911
> test3u(qweibull,log=TRUE,lower=FALSE)
       [,1]      [,2]
r1 0.708465 -1.050115
r2 0.708465 -1.050115
       [,1]      [,2]
r1 0.708465 0.2130552
r2 0.708465 0.2130552
       [,1]      [,2]
r1 0.708465 0.5796969
r2 0.708465 0.5796969
                   u1        u2        u3
r1 0.708465 -1.050115 0.2130552 0.5796969
r2 0.708465 -1.050115 0.2130552 0.5796969
> 
> test2r(rweibull)
                    x1        x2
r1 0.1770773 0.6011398 0.1979137
r2 0.1770773 0.6011398 0.1979137
> 
> 
> # Check gradients of lists.
> 
> with gradient (a=3.1) list (a^2, a^3)
[[1]]
[1] 9.61

[[2]]
[1] 29.791

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 6.2

attr(,"gradient")[[2]]
[1] 28.83

> with gradient (a=3.1) list (list(a^2), xx=sin(a), yy=99, zz=list(7,a^3))
[[1]]
[[1]][[1]]
[1] 9.61


$xx
[1] 0.04158066

$yy
[1] 99

$zz
$zz[[1]]
[1] 7

$zz[[2]]
[1] 29.791


attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 6.2


attr(,"gradient")$xx
[1] -0.9991352

attr(,"gradient")$yy
[1] 0

attr(,"gradient")$zz
attr(,"gradient")$zz[[1]]
[1] 0

attr(,"gradient")$zz[[2]]
[1] 28.83


> with gradient (a=3.1) with gradient (b=7.7) list(a*b,a^2*b^2)
[[1]]
[1] 23.87

[[2]]
[1] 569.7769

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 7.7

attr(,"gradient")[[2]]
[1] 367.598

> 
> with gradient (a=3.1) with gradient (b=100*a) list(a, b, a^2, b^2, a*b, a^2*b^2)
[[1]]
[1] 3.1

[[2]]
[1] 310

[[3]]
[1] 9.61

[[4]]
[1] 96100

[[5]]
[1] 961

[[6]]
[1] 923521

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1

attr(,"gradient")[[2]]
[1] 100

attr(,"gradient")[[3]]
[1] 6.2

attr(,"gradient")[[4]]
[1] 62000

attr(,"gradient")[[5]]
[1] 620

attr(,"gradient")[[6]]
[1] 1191640

> 
> with gradient (a=3.1,b=4.2) list(a,b,a*b)
[[1]]
[1] 3.1

[[2]]
[1] 4.2

[[3]]
[1] 13.02

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 1

attr(,"gradient")$a[[2]]
[1] 0

attr(,"gradient")$a[[3]]
[1] 4.2


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 0

attr(,"gradient")$b[[2]]
[1] 1

attr(,"gradient")$b[[3]]
[1] 3.1


> 
> with gradient (a=3.1,b=4.2) with gradient (c=7.9) list (a*b*c)
[[1]]
[1] 102.858

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 33.18


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 24.49


> with gradient (c=7.9) with gradient (a=3.1,b=4.2) list (a*b*c)
[[1]]
[1] 102.858

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 13.02

> 
> with gradient (a=3.1,b=4.2) with gradient (c=7.9*a) list (a*b*c)
[[1]]
[1] 318.8598

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 205.716


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 75.919


> with gradient (c=7.9) with gradient (a=3.1*c,b=4.2) list (a*b*c)
[[1]]
[1] 812.5782

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 205.716

> 
> with gradient (a=3.1) { x <- list(xxx=a,yyy=a^2); list(qqq=x,rrr=a^3) }
$qqq
$qqq$xxx
[1] 3.1

$qqq$yyy
[1] 9.61


$rrr
[1] 29.791

attr(,"gradient")
attr(,"gradient")$qqq
attr(,"gradient")$qqq$xxx
[1] 1

attr(,"gradient")$qqq$yyy
[1] 6.2


attr(,"gradient")$rrr
[1] 28.83

> 
> with gradient (a=3.1, b=4.2) {
+   r <- list(abc=a^2,pqr=b^2,xyz=a*b)
+   print(gradient_of(r$pqr))
+   print(gradient_of(r$abc))
+   print(gradient_of(r$xyz))
+   r
+ }
$a
[1] 0

$b
[1] 8.4

$a
[1] 6.2

$b
[1] 0

$a
[1] 4.2

$b
[1] 3.1

$abc
[1] 9.61

$pqr
[1] 17.64

$xyz
[1] 13.02

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a$abc
[1] 6.2

attr(,"gradient")$a$pqr
[1] 0

attr(,"gradient")$a$xyz
[1] 4.2


attr(,"gradient")$b
attr(,"gradient")$b$abc
[1] 0

attr(,"gradient")$b$pqr
[1] 8.4

attr(,"gradient")$b$xyz
[1] 3.1


> 
> 
> # Test gradients of list elements found with $ and [[.]].
> 
> with gradient (a=9) { r <- list(x=a,y=a^2,z=a^3); list(r$z,r$y) }
[[1]]
[1] 729

[[2]]
[1] 81

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 243

attr(,"gradient")[[2]]
[1] 18

> with gradient (a=9) { r <- list(x=a,y=a^2,z=a^3); list(r[[3]],r[[2]]) }
[[1]]
[1] 729

[[2]]
[1] 81

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 243

attr(,"gradient")[[2]]
[1] 18

> 
> with gradient (a=9) { r <- list(x=a,y=list(p=a^2,7,q=a^3))
+                       list(r$y$q,r$x) }
[[1]]
[1] 729

[[2]]
[1] 9

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 243

attr(,"gradient")[[2]]
[1] 1

> with gradient (a=9) { r <- list(x=a,y=list(p=a^2,7,q=a^3))
+                       list(r[[2]][[3]],r[[1]]) }
[[1]]
[1] 729

[[2]]
[1] 9

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 243

attr(,"gradient")[[2]]
[1] 1

> with gradient (a=9) { r <- list(x=a,y=list(p=a^2,7,q=a^3))
+                       list(r[[c(2,3)]],r[[1]]) }
[[1]]
[1] 729

[[2]]
[1] 9

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 243

attr(,"gradient")[[2]]
[1] 1

> 
> 
> # Test gradients of sub-lists found with [.].
> 
> with gradient (a=9) { r <- list(x=a,y=a^2,z=a^3); r[2] }
$y
[1] 81

attr(,"gradient")
attr(,"gradient")$y
[1] 18

> with gradient (a=9) { r <- list(x=a,y=a^2,z=a^3); r[c(2,1)] }
$y
[1] 81

$x
[1] 9

attr(,"gradient")
attr(,"gradient")$y
[1] 18

attr(,"gradient")$x
[1] 1

> with gradient (a=9) { r <- list(x=a,y=a^2,z=a^3); r[1..2] }
$x
[1] 9

$y
[1] 81

attr(,"gradient")
attr(,"gradient")$x
[1] 1

attr(,"gradient")$y
[1] 18

> with gradient (a=9) { r <- list(x=a,y=a^2,z=a^3); r[c(2,1,1,3)] }
$y
[1] 81

$x
[1] 9

$x
[1] 9

$z
[1] 729

attr(,"gradient")
attr(,"gradient")$y
[1] 18

attr(,"gradient")$x
[1] 1

attr(,"gradient")$x
[1] 1

attr(,"gradient")$z
[1] 243

> with gradient (a=9) { r <- list(x=a,y=a^2,z=a^3); r[c(5,1)] }
$<NA>
NULL

$x
[1] 9

attr(,"gradient")
attr(,"gradient")$<NA>
NULL

attr(,"gradient")$x
[1] 1

> with gradient (a=9) { r <- list(x=a,y=a^2,z=a^3); r[1..5] }
$x
[1] 9

$y
[1] 81

$z
[1] 729

$<NA>
NULL

$<NA>
NULL

attr(,"gradient")
attr(,"gradient")$x
[1] 1

attr(,"gradient")$y
[1] 18

attr(,"gradient")$z
[1] 243

attr(,"gradient")$<NA>
NULL

attr(,"gradient")$<NA>
NULL

> 
> L <- matrix (list(99,33,44,66,22,11),3,2)
> G <- with gradient (L) L[3,c(2,2,1)]
> L[,]
     [,1] [,2]
[1,] 99   66  
[2,] 33   22  
[3,] 44   11  
> G[]
[[1]]
[1] 11

[[2]]
[1] 11

[[3]]
[1] 44

> str(G)
List of 3
 $ : num 11
 $ : num 11
 $ : num 44
 - attr(*, "gradient")=List of 6
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 3
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
> 
> L <- matrix (list(99,33,44,66,22,11),3,2)
> G <- with gradient (L) L[1,c(2,2,1)]
> L[,]
     [,1] [,2]
[1,] 99   66  
[2,] 33   22  
[3,] 44   11  
> G[]
[[1]]
[1] 66

[[2]]
[1] 66

[[3]]
[1] 99

> str(G)
List of 3
 $ : num 66
 $ : num 66
 $ : num 99
 - attr(*, "gradient")=List of 6
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 3
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 3
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
> 
> L <- matrix (list(99,33,44,66,22,11),3,2)
> G <- with gradient (L) L[2..3,c(2,1,2)]
> L[,]
     [,1] [,2]
[1,] 99   66  
[2,] 33   22  
[3,] 44   11  
> G[,]
     [,1] [,2] [,3]
[1,] 22   33   22  
[2,] 11   44   11  
> str(G)
List of 6
 $ : num 22
 $ : num 11
 $ : num 33
 $ : num 44
 $ : num 22
 $ : num 11
 - attr(*, "dim")= int [1:2] 2 3
 - attr(*, "gradient")=List of 6
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
> 
> L <- matrix (list(99,33,44,66,22,11),3,2)
> G <- with gradient (L) L[c(2,3),c(2,1,2)]
> L[,]
     [,1] [,2]
[1,] 99   66  
[2,] 33   22  
[3,] 44   11  
> G[,]
     [,1] [,2] [,3]
[1,] 22   33   22  
[2,] 11   44   11  
> str(G)
List of 6
 $ : num 22
 $ : num 11
 $ : num 33
 $ : num 44
 $ : num 22
 $ : num 11
 - attr(*, "dim")= int [1:2] 2 3
 - attr(*, "gradient")=List of 6
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
> 
> L <- matrix (list(99,33,44,66,22,11),3,2)
> G <- with gradient (L) { L[[2,2]] <- L[[2,2]]^2; L[2..3,c(2,1,2)] }
> L[,]
     [,1] [,2]
[1,] 99   66  
[2,] 33   22  
[3,] 44   11  
> G[,]
     [,1] [,2] [,3]
[1,] 484  33   484 
[2,] 11   44   11  
> str(G)
List of 6
 $ : num 484
 $ : num 11
 $ : num 33
 $ : num 44
 $ : num 484
 $ : num 11
 - attr(*, "dim")= int [1:2] 2 3
 - attr(*, "gradient")=List of 6
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 44
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 44
  .. ..$ : num 0
  ..$ :List of 6
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
> 
> L <- array (list(9,88,7,33,44,999,20,303,111,1111,222,3333,5555,330,1,0,-3,-2),
+             c(3,2,3))
> G <- with gradient (L) L[c(3,1,1),c(2,2,1),c(2,1,3)]
> L[,,]
, , 1

     [,1] [,2]
[1,] 9    33  
[2,] 88   44  
[3,] 7    999 

, , 2

     [,1] [,2]
[1,] 20   1111
[2,] 303  222 
[3,] 111  3333

, , 3

     [,1] [,2]
[1,] 5555 0   
[2,] 330  -3  
[3,] 1    -2  

> G[,,]
, , 1

     [,1] [,2] [,3]
[1,] 3333 3333 111 
[2,] 1111 1111 20  
[3,] 1111 1111 20  

, , 2

     [,1] [,2] [,3]
[1,] 999  999  7   
[2,] 33   33   9   
[3,] 33   33   9   

, , 3

     [,1] [,2] [,3]
[1,] -2   -2   1   
[2,] 0    0    5555
[3,] 0    0    5555

> str(G)
List of 27
 $ : num 3333
 $ : num 1111
 $ : num 1111
 $ : num 3333
 $ : num 1111
 $ : num 1111
 $ : num 111
 $ : num 20
 $ : num 20
 $ : num 999
 $ : num 33
 $ : num 33
 $ : num 999
 $ : num 33
 $ : num 33
 $ : num 7
 $ : num 9
 $ : num 9
 $ : num -2
 $ : num 0
 $ : num 0
 $ : num -2
 $ : num 0
 $ : num 0
 $ : num 1
 $ : num 5555
 $ : num 5555
 - attr(*, "dim")= int [1:3] 3 3 3
 - attr(*, "gradient")=List of 18
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  ..$ :List of 27
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 1
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
  .. ..$ : num 0
> 
> 
> # Test gradients of vector elements found with [[.]].
> 
> with gradient (a=9) {
+   r <- numeric(4); r[[1]] <- a; r[[2]] <- a^2; r[[3]] <- a^3; r[[4]] <- sin(a)
+   list(r[[3]],r[[2]])
+ }
[[1]]
[1] 729

[[2]]
[1] 81

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 243

attr(,"gradient")[[2]]
[1] 18

> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(4)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[4]] <- sin(a[[1]])
+   list(r[[3]],r[[2]],r[[4]],r[[1]])
+ }
[[1]]
[1] 8

[[2]]
[1] 13

[[3]]
[1] 0.4121185

[[4]]
[1] 5

attr(,"gradient")
attr(,"gradient")[[1]]
[1]  0  0 12

attr(,"gradient")[[2]]
[1] 1 0 4

attr(,"gradient")[[3]]
[1] -0.9111303  0.0000000  0.0000000

attr(,"gradient")[[4]]
[1] 0 1 0

> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(4)
+   dim(r) <- c(2,2)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[4]] <- sin(a[[1]])
+   list(r[[2,1]],r[[1,2]],r[[1,1]],r[[2,2]])
+ }
[[1]]
[1] 13

[[2]]
[1] 8

[[3]]
[1] 5

[[4]]
[1] 0.4121185

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1 0 4

attr(,"gradient")[[2]]
[1]  0  0 12

attr(,"gradient")[[3]]
[1] 0 1 0

attr(,"gradient")[[4]]
[1] -0.9111303  0.0000000  0.0000000

> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(12)
+   dim(r) <- c(2,3,2)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[12]] <- sin(a[[1]])
+   list(r[[1,1,1]],r[[2,1,1]],r[[2,3,2]])
+ }
[[1]]
[1] 5

[[2]]
[1] 13

[[3]]
[1] 0.4121185

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 0 1 0

attr(,"gradient")[[2]]
[1] 1 0 4

attr(,"gradient")[[3]]
[1] -0.9111303  0.0000000  0.0000000

> 
> 
> # Test gradients of sub-vectors found with [.].
> 
> with gradient (a=9) {
+   r <- numeric(4); r[[1]] <- a; r[[2]] <- a^2; r[[3]] <- a^3; r[[4]] <- sin(a)
+   r[c(2,1,1,4)]
+ }
[1] 81.0000000  9.0000000  9.0000000  0.4121185
attr(,"gradient")
[1] 18.0000000  1.0000000  1.0000000 -0.9111303
> 
> with gradient (a=9) {
+   r <- numeric(4); r[[1]] <- a; r[[2]] <- a^2; r[[3]] <- a^3; r[[4]] <- sin(a)
+   r[2..3]
+ }
[1]  81 729
attr(,"gradient")
[1]  18 243
> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(4)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[4]] <- sin(a[[1]])
+   r[c(2,1,1,4)]
+ }
[1] 13.0000000  5.0000000  5.0000000  0.4121185
attr(,"gradient")
           [,1] [,2] [,3]
[1,]  1.0000000    0    4
[2,]  0.0000000    1    0
[3,]  0.0000000    1    0
[4,] -0.9111303    0    0
> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(4)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[4]] <- sin(a[[1]])
+   r[2..3]
+ }
[1] 13  8
attr(,"gradient")
     [,1] [,2] [,3]
[1,]    1    0    4
[2,]    0    0   12
> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(4)
+   dim(r) <- c(2,2)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[4]] <- sin(a[[1]])
+   list(r[2,1],r[1,2],r[1,1],r[2,2])
+ }
[[1]]
[1] 13

[[2]]
[1] 8

[[3]]
[1] 5

[[4]]
[1] 0.4121185

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1 0 4

attr(,"gradient")[[2]]
[1]  0  0 12

attr(,"gradient")[[3]]
[1] 0 1 0

attr(,"gradient")[[4]]
[1] -0.9111303  0.0000000  0.0000000

> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(6)
+   dim(r) <- c(3,2)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[4]] <- sin(a[[1]])
+   list(r[2..3,1],r[1..2,c(2,1)])
+ }
[[1]]
[1] 13  8

[[2]]
          [,1] [,2]
[1,] 0.4121185    5
[2,] 0.0000000   13

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3]
[1,]    1    0    4
[2,]    0    0   12

attr(,"gradient")[[2]]
           [,1] [,2] [,3]
[1,] -0.9111303    0    0
[2,]  0.0000000    0    0
[3,]  0.0000000    1    0
[4,]  1.0000000    0    4

> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(6)
+   dim(r) <- c(3,2)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[4]] <- sin(a[[1]])
+   list(r[c(2,3),1],r[c(1,2),c(2,1)])
+ }
[[1]]
[1] 13  8

[[2]]
          [,1] [,2]
[1,] 0.4121185    5
[2,] 0.0000000   13

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3]
[1,]    1    0    4
[2,]    0    0   12

attr(,"gradient")[[2]]
           [,1] [,2] [,3]
[1,] -0.9111303    0    0
[2,]  0.0000000    0    0
[3,]  0.0000000    1    0
[4,]  1.0000000    0    4

> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(4)
+   dim(r) <- c(2,2)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[4]] <- sin(a[[1]])
+   list(r[2,c(1,1,2)],r[2,c(1,1,2)]^2)
+ }
[[1]]
[1] 13.0000000 13.0000000  0.4121185

[[2]]
[1] 169.0000000 169.0000000   0.1698416

attr(,"gradient")
attr(,"gradient")[[1]]
           [,1] [,2] [,3]
[1,]  1.0000000    0    4
[2,]  1.0000000    0    4
[3,] -0.9111303    0    0

attr(,"gradient")[[2]]
           [,1] [,2] [,3]
[1,] 26.0000000    0  104
[2,] 26.0000000    0  104
[3,] -0.7509872    0    0

> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(12)
+   dim(r) <- c(2,3,2)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[12]] <- sin(a[[1]])
+   list(r[1,1,1],r[2,1,1],r[2,3,2])
+ }
[[1]]
[1] 5

[[2]]
[1] 13

[[3]]
[1] 0.4121185

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 0 1 0

attr(,"gradient")[[2]]
[1] 1 0 4

attr(,"gradient")[[3]]
[1] -0.9111303  0.0000000  0.0000000

> 
> with gradient (a=c(9,5,2)) {
+   r <- numeric(12)
+   dim(r) <- c(2,3,2)
+   r[[1]] <- a[[2]]
+   r[[2]] <- a[[3]]^2 + a[[1]]
+   r[[3]] <- a[[3]]^3
+   r[[8]] <- a[[3]]
+   r[[10]] <- sqrt(a[[1]])
+   r[[12]] <- sin(a[[1]])
+   list(r[c(2,1),1,1],r[2,2,2],r[2,c(3,1,1,2),2])
+ }
[[1]]
[1] 13  5

[[2]]
[1] 3

[[3]]
[1] 0.4121185 2.0000000 2.0000000 3.0000000

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3]
[1,]    1    0    4
[2,]    0    1    0

attr(,"gradient")[[2]]
[1] 0.1666667 0.0000000 0.0000000

attr(,"gradient")[[3]]
           [,1] [,2] [,3]
[1,] -0.9111303    0    0
[2,]  0.0000000    0    1
[3,]  0.0000000    0    1
[4,]  0.1666667    0    0

> 
> with gradient (a=c(3,5)) a[1..5]
[1]  3  5 NA NA NA
attr(,"gradient")
     [,1] [,2]
[1,]    1    0
[2,]    0    1
[3,]    0    0
[4,]    0    0
[5,]    0    0
> with gradient (a=c(3,5)) a[c(5,1,7,2,3)]
[1] NA  3 NA  5 NA
attr(,"gradient")
     [,1] [,2]
[1,]    0    0
[2,]    1    0
[3,]    0    0
[4,]    0    1
[5,]    0    0
> with gradient (a=list(3,5)) a[1..5]
[[1]]
[1] 3

[[2]]
[1] 5

[[3]]
NULL

[[4]]
NULL

[[5]]
NULL

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
NULL

attr(,"gradient")[[1]][[4]]
NULL

attr(,"gradient")[[1]][[5]]
NULL


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 1

attr(,"gradient")[[2]][[3]]
NULL

attr(,"gradient")[[2]][[4]]
NULL

attr(,"gradient")[[2]][[5]]
NULL


> with gradient (a=list(3,5)) a[c(5,1,7,2,3)]
[[1]]
NULL

[[2]]
[1] 3

[[3]]
NULL

[[4]]
[1] 5

[[5]]
NULL

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
NULL

attr(,"gradient")[[1]][[2]]
[1] 1

attr(,"gradient")[[1]][[3]]
NULL

attr(,"gradient")[[1]][[4]]
[1] 0

attr(,"gradient")[[1]][[5]]
NULL


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
NULL

attr(,"gradient")[[2]][[2]]
[1] 0

attr(,"gradient")[[2]][[3]]
NULL

attr(,"gradient")[[2]][[4]]
[1] 1

attr(,"gradient")[[2]][[5]]
NULL


> 
> 
> # Test 'compute gradient'.
> 
> f <- function (x) compute gradient (x) x^2 as 123*x # wrong, see if happens
> 
> with gradient (a=12) f(a)
[1] 144
attr(,"gradient")
[1] 1476
> with gradient (a=12) f(a^2)
[1] 20736
attr(,"gradient")
[1] 425088
> with gradient (a=c(1,12)) f(a^2)
[1]     1 20736
attr(,"gradient")
     [,1]   [,2]
[1,]  246      0
[2,]    0 425088
> 
> g <- function (x,y)  # assume length(x) == length(y)
+   compute gradient (x,y) list(x+y,x-y,x*y)
+   as # wrong, but see if it happens
+      list (diag(x*y,length(x)), diag(x+y,length(x)), diag(x+y,length(x))), 
+      list (diag(x-y,length(x)), diag(x-y,length(x)), diag(7*x*y,length(x)))
> 
> with gradient (z=9) g(100*z,z+1)
[[1]]
[1] 910

[[2]]
[1] 890

[[3]]
[1] 9000

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 900890

attr(,"gradient")[[2]]
[1] 91890

attr(,"gradient")[[3]]
[1] 154000

> with gradient (z=c(9,7)) g(100*z,z+1)
[[1]]
[1] 910 708

[[2]]
[1] 890 692

[[3]]
[1] 9000 5600

attr(,"gradient")
attr(,"gradient")[[1]]
       [,1]   [,2]
[1,] 900890      0
[2,]      0 560692

attr(,"gradient")[[2]]
      [,1]  [,2]
[1,] 91890     0
[2,]     0 71492

attr(,"gradient")[[3]]
       [,1]   [,2]
[1,] 154000      0
[2,]      0 110000

> 
> g <- function (x,y)  # assume length(x) == length(y)
+   compute gradient (x,y) list(x+y,x-y,x*y)
+   as # wrong, but see if it happens
+      list (x*y, x+y, x+y), 
+      list (x-y, x-y, 7*x*y)
> 
> with gradient (z=9) g(100*z,z+1)
[[1]]
[1] 910

[[2]]
[1] 890

[[3]]
[1] 9000

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 900890

attr(,"gradient")[[2]]
[1] 91890

attr(,"gradient")[[3]]
[1] 154000

> with gradient (z=c(9,7)) g(100*z,z+1)
[[1]]
[1] 910 708

[[2]]
[1] 890 692

[[3]]
[1] 9000 5600

attr(,"gradient")
attr(,"gradient")[[1]]
       [,1]   [,2]
[1,] 900890      0
[2,]      0 560692

attr(,"gradient")[[2]]
      [,1]  [,2]
[1,] 91890     0
[2,]     0 71492

attr(,"gradient")[[3]]
       [,1]   [,2]
[1,] 154000      0
[2,]      0 110000

> 
> g <- function (x,y)  # assume length(x) == length(y)
+   compute gradient (x,y) list(x+y,x-y,x*y)
+   as # wrong, but see if it happens
+      list (function () x*y, function () x+y, function () x+y),
+      list (function () x-y, function () x-y, function () 7*x*y)
> 
> with gradient (z=9) g(100*z,z+1)
[[1]]
[1] 910

[[2]]
[1] 890

[[3]]
[1] 9000

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 900890

attr(,"gradient")[[2]]
[1] 91890

attr(,"gradient")[[3]]
[1] 154000

> with gradient (z=c(9,7)) g(100*z,z+1)
[[1]]
[1] 910 708

[[2]]
[1] 890 692

[[3]]
[1] 9000 5600

attr(,"gradient")
attr(,"gradient")[[1]]
       [,1]   [,2]
[1,] 900890      0
[2,]      0 560692

attr(,"gradient")[[2]]
      [,1]  [,2]
[1,] 91890     0
[2,]     0 71492

attr(,"gradient")[[3]]
       [,1]   [,2]
[1,] 154000      0
[2,]      0 110000

> 
> 
> # Test subassign operations.
> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r$y <- 1/a
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$y
[1] 0.3322259

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$y
[1] -0.1103741

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[2]] <- 1/a
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$y
[1] 0.3322259

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$y
[1] -0.1103741

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r$y <- NULL
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[2]] <- NULL
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[2] <- NULL
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[1..2] <- NULL
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[c(2,2,1,1,2)] <- NULL
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r$w <- -a
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$y
[1] 27.2709

$z
[1] 82.08541

$w
[1] -3.01

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

attr(,"gradient")$w
[1] -1

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[4]] <- -a
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$y
[1] 27.2709

$z
[1] 82.08541

[[4]]
[1] -3.01

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

attr(,"gradient")[[4]]
[1] -1

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[4] <- list(-a)
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$y
[1] 27.2709

$z
[1] 82.08541

[[4]]
[1] -3.01

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

attr(,"gradient")[[4]]
[1] -1

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[4] <- -a
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 9.0601

$y
[1] 27.2709

$z
[1] 82.08541

[[4]]
[1] -3.01

attr(,"gradient")
attr(,"gradient")$x
[1] 6.02

attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

attr(,"gradient")[[4]]
[1] -1

> 
> with gradient (a=c(6,3,5)) { a[2] <- list(a[[1]]^2); a }
[[1]]
[1] 6

[[2]]
[1] 36

[[3]]
[1] 5

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1 0 0

attr(,"gradient")[[2]]
[1] 12  0  0

attr(,"gradient")[[3]]
[1] 0 0 1

> 
> with gradient (a=3.01) {
+   r <- list(w=-a,x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[c(2,4)] <- list(10*a,7*a)
+   r
+ }
$w
[1] -1

$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$w
[1] -3.01

$x
[1] 30.1

$y
[1] 27.2709

$z
[1] 21.07

attr(,"gradient")
attr(,"gradient")$w
[1] -1

attr(,"gradient")$x
[1] 10

attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 7

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r$x$w <- 1/a
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$w
[1] 0.3322259

$x$x
[1] 12.04


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$w
[1] -0.1103741

attr(,"gradient")$x$x
[1] 4


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[2]]$w <- 1/a
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$w
[1] 0.3322259

$x$x
[1] 12.04


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$w
[1] -0.1103741

attr(,"gradient")$x$x
[1] 4


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r$x[[2]] <- 1/a
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$w
[1] 0.3322259

$x$x
[1] 12.04


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$w
[1] -0.1103741

attr(,"gradient")$x$x
[1] 4


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r$x[2] <- list(1/a)
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$w
[1] 0.3322259

$x$x
[1] 12.04


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$w
[1] -0.1103741

attr(,"gradient")$x$x
[1] 4


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[2]][[2]] <- 1/a
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$w
[1] 0.3322259

$x$x
[1] 12.04


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$w
[1] -0.1103741

attr(,"gradient")$x$x
[1] 4


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[2]][2] <- list(1/a)
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$w
[1] 0.3322259

$x$x
[1] 12.04


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$w
[1] -0.1103741

attr(,"gradient")$x$x
[1] 4


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r$x$w <- NULL
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$x
[1] 12.04


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$x
[1] 4


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[2]][[2]] <- NULL
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$x
[1] 12.04


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$x
[1] 4


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> if (FALSE)  # not supported yet
+ with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[c(2,2)]] <- NULL
+   r
+ }
> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r$x$u <- -a
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$w
[1] 9.03

$x$x
[1] 12.04

$x$u
[1] -3.01


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$w
[1] 3

attr(,"gradient")$x$x
[1] 4

attr(,"gradient")$x$u
[1] -1


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(a=3,x=list(v=8,w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   r[[2]][[4]] <- -a
+   r
+ }
$a
[1] 0

$x
$x$v
[1] 0

$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$a
[1] 3

$x
$x$v
[1] 8

$x$w
[1] 9.03

$x$x
[1] 12.04

$x[[4]]
[1] -3.01


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$x
attr(,"gradient")$x$v
[1] 0

attr(,"gradient")$x$w
[1] 3

attr(,"gradient")$x$x
[1] 4

attr(,"gradient")$x[[4]]
[1] -1


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=c(5.1,7.2,3.9,0.7)) { a[3] <- 4; a }
[1] 5.1 7.2 4.0 0.7
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    0    0
[4,]    0    0    0    1
> with gradient (a=c(5.1,7.2,3.9,0.7)) { a[c(3,1)] <- 4; a }
[1] 4.0 7.2 4.0 0.7
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    0    0    0    0
[2,]    0    1    0    0
[3,]    0    0    0    0
[4,]    0    0    0    1
> with gradient (a=c(5.1,7.2,3.9,0.7)) { a[c(3,1)] <- a[4]^2; a }
[1] 0.49 7.20 0.49 0.70
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    0    0    0  1.4
[2,]    0    1    0  0.0
[3,]    0    0    0  1.4
[4,]    0    0    0  1.0
> with gradient (a=c(5.1,7.2,3.9,0.7)) { b<-numeric(5); b[4..5]<-a[c(3,1)]; b }
[1] 0.0 0.0 0.0 3.9 5.1
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    0    0    0    0
[2,]    0    0    0    0
[3,]    0    0    0    0
[4,]    0    0    1    0
[5,]    1    0    0    0
> 
> with gradient (a=matrix(list(1.0,7.2,3.9,0.7,9.9,1.2,8.8,6.0),2,4)) { 
+   a[1,1] <- a[2,4]
+   a[2,c(1,3)] <- a[[1,1]]^2
+   a[1,c(1,2)] <- list(a[[1,1]]^3,a[[1,1]]^4)
+   a[1,4] <- 99
+   a
+ }
     [,1] [,2] [,3] [,4]
[1,] 216  1296 9.9  99  
[2,] 36   0.7  36   6   
attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 0

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
[1] 0

attr(,"gradient")[[1]][[4]]
[1] 0

attr(,"gradient")[[1]][[5]]
[1] 0

attr(,"gradient")[[1]][[6]]
[1] 0

attr(,"gradient")[[1]][[7]]
[1] 0

attr(,"gradient")[[1]][[8]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 0

attr(,"gradient")[[2]][[3]]
[1] 0

attr(,"gradient")[[2]][[4]]
[1] 0

attr(,"gradient")[[2]][[5]]
[1] 0

attr(,"gradient")[[2]][[6]]
[1] 0

attr(,"gradient")[[2]][[7]]
[1] 0

attr(,"gradient")[[2]][[8]]
[1] 0


attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]]
[1] 0

attr(,"gradient")[[3]][[3]]
[1] 0

attr(,"gradient")[[3]][[4]]
[1] 0

attr(,"gradient")[[3]][[5]]
[1] 0

attr(,"gradient")[[3]][[6]]
[1] 0

attr(,"gradient")[[3]][[7]]
[1] 0

attr(,"gradient")[[3]][[8]]
[1] 0


attr(,"gradient")[[4]]
attr(,"gradient")[[4]][[1]]
[1] 0

attr(,"gradient")[[4]][[2]]
[1] 0

attr(,"gradient")[[4]][[3]]
[1] 0

attr(,"gradient")[[4]][[4]]
[1] 1

attr(,"gradient")[[4]][[5]]
[1] 0

attr(,"gradient")[[4]][[6]]
[1] 0

attr(,"gradient")[[4]][[7]]
[1] 0

attr(,"gradient")[[4]][[8]]
[1] 0


attr(,"gradient")[[5]]
attr(,"gradient")[[5]][[1]]
[1] 0

attr(,"gradient")[[5]][[2]]
[1] 0

attr(,"gradient")[[5]][[3]]
[1] 0

attr(,"gradient")[[5]][[4]]
[1] 0

attr(,"gradient")[[5]][[5]]
[1] 1

attr(,"gradient")[[5]][[6]]
[1] 0

attr(,"gradient")[[5]][[7]]
[1] 0

attr(,"gradient")[[5]][[8]]
[1] 0


attr(,"gradient")[[6]]
attr(,"gradient")[[6]][[1]]
[1] 0

attr(,"gradient")[[6]][[2]]
[1] 0

attr(,"gradient")[[6]][[3]]
[1] 0

attr(,"gradient")[[6]][[4]]
[1] 0

attr(,"gradient")[[6]][[5]]
[1] 0

attr(,"gradient")[[6]][[6]]
[1] 0

attr(,"gradient")[[6]][[7]]
[1] 0

attr(,"gradient")[[6]][[8]]
[1] 0


attr(,"gradient")[[7]]
attr(,"gradient")[[7]][[1]]
[1] 0

attr(,"gradient")[[7]][[2]]
[1] 0

attr(,"gradient")[[7]][[3]]
[1] 0

attr(,"gradient")[[7]][[4]]
[1] 0

attr(,"gradient")[[7]][[5]]
[1] 0

attr(,"gradient")[[7]][[6]]
[1] 0

attr(,"gradient")[[7]][[7]]
[1] 0

attr(,"gradient")[[7]][[8]]
[1] 0


attr(,"gradient")[[8]]
attr(,"gradient")[[8]][[1]]
[1] 108

attr(,"gradient")[[8]][[2]]
[1] 12

attr(,"gradient")[[8]][[3]]
[1] 864

attr(,"gradient")[[8]][[4]]
[1] 0

attr(,"gradient")[[8]][[5]]
[1] 0

attr(,"gradient")[[8]][[6]]
[1] 12

attr(,"gradient")[[8]][[7]]
[1] 0

attr(,"gradient")[[8]][[8]]
[1] 1


> 
> with gradient (a=matrix(c(1.0,7.2,3.9,0.7,9.9,1.2,8.8,6.0),2,4)) { 
+   a[1,1] <- a[2,4]
+   a[2,c(1,3)] <- a[[1,1]]^2
+   a[1,c(1,2)] <- a[[1,1]]^c(3,4)
+   a[1,4] <- 99
+   a
+ }
     [,1]   [,2] [,3] [,4]
[1,]  216 1296.0  9.9   99
[2,]   36    0.7 36.0    6
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    0    0    0    0    0    0  108
[2,]    0    0    0    0    0    0    0   12
[3,]    0    0    0    0    0    0    0  864
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    0    0   12
[7,]    0    0    0    0    0    0    0    0
[8,]    0    0    0    0    0    0    0    1
> 
> with gradient (a=array(list(1.0,7.2,3.9,0.7,9.9,1.2,8.8,6.0),c(2,2,2))) { 
+   a[1,1,1] <- a[2,2,2]
+   a[2,c(1,2),c(2,1)] <- a[[1,1,1]]^2
+   a[1,c(1,2),1] <- list(a[[1,1,1]]^3,a[[1,1,1]]^4)
+   a[1,2,2] <- 99
+   a
+ }
, , 1

     [,1] [,2]
[1,] 216  1296
[2,] 36   36  

, , 2

     [,1] [,2]
[1,] 9.9  99  
[2,] 36   36  

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 0

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
[1] 0

attr(,"gradient")[[1]][[4]]
[1] 0

attr(,"gradient")[[1]][[5]]
[1] 0

attr(,"gradient")[[1]][[6]]
[1] 0

attr(,"gradient")[[1]][[7]]
[1] 0

attr(,"gradient")[[1]][[8]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 0

attr(,"gradient")[[2]][[3]]
[1] 0

attr(,"gradient")[[2]][[4]]
[1] 0

attr(,"gradient")[[2]][[5]]
[1] 0

attr(,"gradient")[[2]][[6]]
[1] 0

attr(,"gradient")[[2]][[7]]
[1] 0

attr(,"gradient")[[2]][[8]]
[1] 0


attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]]
[1] 0

attr(,"gradient")[[3]][[3]]
[1] 0

attr(,"gradient")[[3]][[4]]
[1] 0

attr(,"gradient")[[3]][[5]]
[1] 0

attr(,"gradient")[[3]][[6]]
[1] 0

attr(,"gradient")[[3]][[7]]
[1] 0

attr(,"gradient")[[3]][[8]]
[1] 0


attr(,"gradient")[[4]]
attr(,"gradient")[[4]][[1]]
[1] 0

attr(,"gradient")[[4]][[2]]
[1] 0

attr(,"gradient")[[4]][[3]]
[1] 0

attr(,"gradient")[[4]][[4]]
[1] 0

attr(,"gradient")[[4]][[5]]
[1] 0

attr(,"gradient")[[4]][[6]]
[1] 0

attr(,"gradient")[[4]][[7]]
[1] 0

attr(,"gradient")[[4]][[8]]
[1] 0


attr(,"gradient")[[5]]
attr(,"gradient")[[5]][[1]]
[1] 0

attr(,"gradient")[[5]][[2]]
[1] 0

attr(,"gradient")[[5]][[3]]
[1] 0

attr(,"gradient")[[5]][[4]]
[1] 0

attr(,"gradient")[[5]][[5]]
[1] 1

attr(,"gradient")[[5]][[6]]
[1] 0

attr(,"gradient")[[5]][[7]]
[1] 0

attr(,"gradient")[[5]][[8]]
[1] 0


attr(,"gradient")[[6]]
attr(,"gradient")[[6]][[1]]
[1] 0

attr(,"gradient")[[6]][[2]]
[1] 0

attr(,"gradient")[[6]][[3]]
[1] 0

attr(,"gradient")[[6]][[4]]
[1] 0

attr(,"gradient")[[6]][[5]]
[1] 0

attr(,"gradient")[[6]][[6]]
[1] 0

attr(,"gradient")[[6]][[7]]
[1] 0

attr(,"gradient")[[6]][[8]]
[1] 0


attr(,"gradient")[[7]]
attr(,"gradient")[[7]][[1]]
[1] 0

attr(,"gradient")[[7]][[2]]
[1] 0

attr(,"gradient")[[7]][[3]]
[1] 0

attr(,"gradient")[[7]][[4]]
[1] 0

attr(,"gradient")[[7]][[5]]
[1] 0

attr(,"gradient")[[7]][[6]]
[1] 0

attr(,"gradient")[[7]][[7]]
[1] 0

attr(,"gradient")[[7]][[8]]
[1] 0


attr(,"gradient")[[8]]
attr(,"gradient")[[8]][[1]]
[1] 108

attr(,"gradient")[[8]][[2]]
[1] 12

attr(,"gradient")[[8]][[3]]
[1] 864

attr(,"gradient")[[8]][[4]]
[1] 12

attr(,"gradient")[[8]][[5]]
[1] 0

attr(,"gradient")[[8]][[6]]
[1] 12

attr(,"gradient")[[8]][[7]]
[1] 0

attr(,"gradient")[[8]][[8]]
[1] 12


> 
> with gradient (a=array(c(1.0,7.2,3.9,0.7,9.9,1.2,8.8,6.0),c(2,2,2))) { 
+   a[1,1,1] <- a[2,2,2]
+   a[2,c(1,2),c(2,1)] <- a[[1,1,1]]^2
+   a[1,c(1,2),1] <- a[[1,1,1]]^c(3,4)
+   a[1,2,2] <- 99
+   a
+ }
, , 1

     [,1] [,2]
[1,]  216 1296
[2,]   36   36

, , 2

     [,1] [,2]
[1,]  9.9   99
[2,] 36.0   36

attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    0    0    0    0    0    0  108
[2,]    0    0    0    0    0    0    0   12
[3,]    0    0    0    0    0    0    0  864
[4,]    0    0    0    0    0    0    0   12
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    0    0   12
[7,]    0    0    0    0    0    0    0    0
[8,]    0    0    0    0    0    0    0   12
> 
> with gradient (L=list(c(9,7,6),-2)) { L[[1]][[2]] <- 3; L }
[[1]]
[1] 9 3 6

[[2]]
[1] -2

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    0    0
[3,]    0    0    1

attr(,"gradient")[[1]][[2]]
[1] 0 0 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0 0 0

attr(,"gradient")[[2]][[2]]
[1] 1


> 
> 
> # Subassignment with user-defined subassignment functions.
> 
> xel <- function (a) a$x
> `xel<-` <- function (a,value) { a$x <- value; a }
> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   xel(r) <- 1/a
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 0.3322259

$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
[1] -0.1103741

attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   xel(r) <- NULL
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   xel(r) <- -a^2
+   r
+ }
$y
[1] 27.1803

$z
[1] 109.0836

--
$y
[1] 27.2709

$z
[1] 82.08541

$x
[1] -9.0601

attr(,"gradient")
attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

attr(,"gradient")$x
[1] -6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=list(w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   xel(xel(r)) <- 1/a;
+   r
+ }
$x
$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$x
$x$w
[1] 9.03

$x$x
[1] 0.3322259


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x$w
[1] 3

attr(,"gradient")$x$x
[1] -0.1103741


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=list(w=3*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   xel(xel(r)) <- -a^2
+   r
+ }
$x
$x$w
[1] 3


$y
[1] 27.1803

$z
[1] 109.0836

--
$x
$x$w
[1] 9.03

$x$x
[1] -9.0601


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x$w
[1] 3

attr(,"gradient")$x$x
[1] -6.02


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> elip1 <- function (a,i) a[[i+1]]
> `elip1<-` <- function (a,i,value) { a[[i+1]] <- value; a }
> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   elip1(r,0) <- 1/a
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$x
[1] 0.3322259

$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
[1] -0.1103741

attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=a^2,y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   elip1(r,0) <- NULL
+   r
+ }
$x
[1] 6.02

$y
[1] 27.1803

$z
[1] 109.0836

--
$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   elip1(r,2) <- -a^2
+   r
+ }
$y
[1] 27.1803

$z
[1] 109.0836

--
$y
[1] 27.2709

$z
[1] 82.08541

[[3]]
[1] -9.0601

attr(,"gradient")
attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

attr(,"gradient")[[3]]
[1] -6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=list(w=3*a,x=4*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   elip1(elip1(r,0),1) <- 1/a;
+   r
+ }
$x
$x$w
[1] 3

$x$x
[1] 4


$y
[1] 27.1803

$z
[1] 109.0836

--
$x
$x$w
[1] 9.03

$x$x
[1] 0.3322259


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x$w
[1] 3

attr(,"gradient")$x$x
[1] -0.1103741


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=list(w=3*a),y=a^3,z=a^4)
+   print(gradient_of(r))
+   cat("--\n")
+   elip1(elip1(r,0),1) <- -a^2
+   r
+ }
$x
$x$w
[1] 3


$y
[1] 27.1803

$z
[1] 109.0836

--
$x
$x$w
[1] 9.03

$x[[2]]
[1] -9.0601


$y
[1] 27.2709

$z
[1] 82.08541

attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x$w
[1] 3

attr(,"gradient")$x[[2]]
[1] -6.02


attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 109.0836

> 
> with gradient (a=3.01) {
+   r <- list(x=1,y=2)
+   class(r) <- "fred"
+   r$y <- a^2
+   r
+ }
$x
[1] 1

$y
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] 0

attr(,"gradient")$y
[1] 6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=1,y=2)
+   class(r) <- "fred"
+   r[[2]] <- a^2
+   r
+ }
$x
[1] 1

$y
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] 0

attr(,"gradient")$y
[1] 6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=1,y=2)
+   class(r) <- "fred"
+   r$x <- -a
+   r$y <- a^2
+   r
+ }
$x
[1] -3.01

$y
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] -1

attr(,"gradient")$y
[1] 6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=1,y=2)
+   class(r) <- "fred"
+   r$x <- -a
+   r[[2]] <- a^2
+   r
+ }
$x
[1] -3.01

$y
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] -1

attr(,"gradient")$y
[1] 6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=1,y=2)
+   class(r) <- "fred"
+   r <- `$<-` (r, "y", a^2)
+   r
+ }
$x
[1] 1

$y
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] 0

attr(,"gradient")$y
[1] 6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=1,y=2)
+   class(r) <- "fred"
+   r <- `[[<-` (r, 2, a^2)
+   r
+ }
$x
[1] 1

$y
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] 0

attr(,"gradient")$y
[1] 6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=-1,y=2)
+   class(r) <- "fred"
+   r$x <- -a
+   r <- `$<-` (r, "y", a^2)
+   r
+ }
$x
[1] -3.01

$y
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] -1

attr(,"gradient")$y
[1] 6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=-1,y=2)
+   class(r) <- "fred"
+   r$x <- -a
+   r <- `[[<-` (r, 2, a^2)
+   r
+ }
$x
[1] -3.01

$y
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] -1

attr(,"gradient")$y
[1] 6.02

> 
> with gradient (a=3.01) {
+   r <- list(x=-1,y=2,z=7)
+   class(r) <- "fred"
+   r$x <- -a
+   r <- `[<-` (r, c(3,2), list(a^2,a^3))
+   r
+ }
$x
[1] -3.01

$y
[1] 27.2709

$z
[1] 9.0601

attr(,"class")
[1] "fred"
attr(,"gradient")
attr(,"gradient")$x
[1] -1

attr(,"gradient")$y
[1] 27.1803

attr(,"gradient")$z
[1] 6.02

> 
> 
> # Test gradients w.r.t. list values.
> 
> with gradient (a=list(5,55,555)) a
[[1]]
[1] 5

[[2]]
[1] 55

[[3]]
[1] 555

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 1

attr(,"gradient")[[2]][[3]]
[1] 0


attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]]
[1] 0

attr(,"gradient")[[3]][[3]]
[1] 1


> 
> with gradient (a=list(x=5,y=55,z=555)) a$x
[1] 5
attr(,"gradient")
attr(,"gradient")$x
[1] 1

attr(,"gradient")$y
[1] 0

attr(,"gradient")$z
[1] 0

> with gradient (a=list(x=5,y=55,z=555)) a$y
[1] 55
attr(,"gradient")
attr(,"gradient")$x
[1] 0

attr(,"gradient")$y
[1] 1

attr(,"gradient")$z
[1] 0

> with gradient (a=list(x=5,y=55,z=555)) a$z
[1] 555
attr(,"gradient")
attr(,"gradient")$x
[1] 0

attr(,"gradient")$y
[1] 0

attr(,"gradient")$z
[1] 1

> 
> with gradient (a=list(x=5,y=55,z=555)) sqrt(a$y)
[1] 7.416198
attr(,"gradient")
attr(,"gradient")$x
[1] 0

attr(,"gradient")$y
[1] 0.06741999

attr(,"gradient")$z
[1] 0

> with gradient (a=list(x=5,y=55,z=555)) a$z+a$x
[1] 560
attr(,"gradient")
attr(,"gradient")$x
[1] 1

attr(,"gradient")$y
[1] 0

attr(,"gradient")$z
[1] 1

> with gradient (a=list(x=5,y=55,z=555)) a$z*a$x
[1] 2775
attr(,"gradient")
attr(,"gradient")$x
[1] 555

attr(,"gradient")$y
[1] 0

attr(,"gradient")$z
[1] 5

> 
> with gradient (a=list(x=5,y=55,z=555)) list(a$z,a$x^2, a$x*a$y*a$z)
[[1]]
[1] 555

[[2]]
[1] 25

[[3]]
[1] 152625

attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x[[1]]
[1] 0

attr(,"gradient")$x[[2]]
[1] 10

attr(,"gradient")$x[[3]]
[1] 30525


attr(,"gradient")$y
attr(,"gradient")$y[[1]]
[1] 0

attr(,"gradient")$y[[2]]
[1] 0

attr(,"gradient")$y[[3]]
[1] 2775


attr(,"gradient")$z
attr(,"gradient")$z[[1]]
[1] 1

attr(,"gradient")$z[[2]]
[1] 0

attr(,"gradient")$z[[3]]
[1] 275


> 
> with gradient (a=list(x=7,y=list(3,z=10))) a
$x
[1] 7

$y
$y[[1]]
[1] 3

$y$z
[1] 10


attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x$x
[1] 1

attr(,"gradient")$x$y
attr(,"gradient")$x$y[[1]]
[1] 0

attr(,"gradient")$x$y$z
[1] 0



attr(,"gradient")$y
attr(,"gradient")$y[[1]]
attr(,"gradient")$y[[1]]$x
[1] 0

attr(,"gradient")$y[[1]]$y
attr(,"gradient")$y[[1]]$y[[1]]
[1] 1

attr(,"gradient")$y[[1]]$y$z
[1] 0



attr(,"gradient")$y$z
attr(,"gradient")$y$z$x
[1] 0

attr(,"gradient")$y$z$y
attr(,"gradient")$y$z$y[[1]]
[1] 0

attr(,"gradient")$y$z$y$z
[1] 1




> with gradient (a=list(x=7,y=list(3,z=10))) list(a$y$z,a$x,-a$x)
[[1]]
[1] 10

[[2]]
[1] 7

[[3]]
[1] -7

attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x[[1]]
[1] 0

attr(,"gradient")$x[[2]]
[1] 1

attr(,"gradient")$x[[3]]
[1] -1


attr(,"gradient")$y
attr(,"gradient")$y[[1]]
attr(,"gradient")$y[[1]][[1]]
[1] 0

attr(,"gradient")$y[[1]][[2]]
[1] 0

attr(,"gradient")$y[[1]][[3]]
[1] 0


attr(,"gradient")$y$z
attr(,"gradient")$y$z[[1]]
[1] 1

attr(,"gradient")$y$z[[2]]
[1] 0

attr(,"gradient")$y$z[[3]]
[1] 0



> with gradient (a=list(x=7,y=list(3,z=10))) list(a$y,a$x,-a$x)
[[1]]
[[1]][[1]]
[1] 3

[[1]]$z
[1] 10


[[2]]
[1] 7

[[3]]
[1] -7

attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x[[1]]
attr(,"gradient")$x[[1]][[1]]
[1] 0

attr(,"gradient")$x[[1]]$z
[1] 0


attr(,"gradient")$x[[2]]
[1] 1

attr(,"gradient")$x[[3]]
[1] -1


attr(,"gradient")$y
attr(,"gradient")$y[[1]]
attr(,"gradient")$y[[1]][[1]]
attr(,"gradient")$y[[1]][[1]][[1]]
[1] 1

attr(,"gradient")$y[[1]][[1]]$z
[1] 0


attr(,"gradient")$y[[1]][[2]]
[1] 0

attr(,"gradient")$y[[1]][[3]]
[1] 0


attr(,"gradient")$y$z
attr(,"gradient")$y$z[[1]]
attr(,"gradient")$y$z[[1]][[1]]
[1] 0

attr(,"gradient")$y$z[[1]]$z
[1] 1


attr(,"gradient")$y$z[[2]]
[1] 0

attr(,"gradient")$y$z[[3]]
[1] 0



> 
> with gradient (b=list(3,abc=4)) {
+   r <- list(x=b,y=b$abc,z=b$abc^2)
+   r$y <- NULL
+   r
+ }
$x
$x[[1]]
[1] 3

$x$abc
[1] 4


$z
[1] 16

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]]$x
attr(,"gradient")[[1]]$x[[1]]
[1] 1

attr(,"gradient")[[1]]$x$abc
[1] 0


attr(,"gradient")[[1]]$z
[1] 0


attr(,"gradient")$abc
attr(,"gradient")$abc$x
attr(,"gradient")$abc$x[[1]]
[1] 0

attr(,"gradient")$abc$x$abc
[1] 1


attr(,"gradient")$abc$z
[1] 8


> 
> with gradient (b=list(3,abc=4)) {
+   r <- list(x=b,y=b$abc,z=b$abc^2)
+   r$x <- NULL
+   r
+ }
$y
[1] 4

$z
[1] 16

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]]$y
[1] 0

attr(,"gradient")[[1]]$z
[1] 0


attr(,"gradient")$abc
attr(,"gradient")$abc$y
[1] 1

attr(,"gradient")$abc$z
[1] 8


> 
> with gradient (b=list(10,bb=list(bbb=3,4),20)) {
+   r <- list(a1=7,a2=-b$bb$bbb,a3=b)
+   r$a3 <- NULL
+   r
+ }
$a1
[1] 7

$a2
[1] -3

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]]$a1
[1] 0

attr(,"gradient")[[1]]$a2
[1] 0


attr(,"gradient")$bb
attr(,"gradient")$bb$bbb
attr(,"gradient")$bb$bbb$a1
[1] 0

attr(,"gradient")$bb$bbb$a2
[1] -1


attr(,"gradient")$bb[[2]]
attr(,"gradient")$bb[[2]]$a1
[1] 0

attr(,"gradient")$bb[[2]]$a2
[1] 0



attr(,"gradient")[[3]]
attr(,"gradient")[[3]]$a1
[1] 0

attr(,"gradient")[[3]]$a2
[1] 0


> 
> with gradient (b=list(3,abc=4)) {
+   r <- list(x=b,y=b$abc,z=b$abc^2)
+   r$y <- b$abc^3
+   r
+ }
$x
$x[[1]]
[1] 3

$x$abc
[1] 4


$y
[1] 64

$z
[1] 16

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]]$x
attr(,"gradient")[[1]]$x[[1]]
[1] 1

attr(,"gradient")[[1]]$x$abc
[1] 0


attr(,"gradient")[[1]]$y
[1] 0

attr(,"gradient")[[1]]$z
[1] 0


attr(,"gradient")$abc
attr(,"gradient")$abc$x
attr(,"gradient")$abc$x[[1]]
[1] 0

attr(,"gradient")$abc$x$abc
[1] 1


attr(,"gradient")$abc$y
[1] 48

attr(,"gradient")$abc$z
[1] 8


> 
> with gradient (b=list(3,abc=4)) {
+   r <- list(x=b,y=b$abc,z=b$abc^2)
+   r$w <- b$abc^3
+   r
+ }
$x
$x[[1]]
[1] 3

$x$abc
[1] 4


$y
[1] 4

$z
[1] 16

$w
[1] 64

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]]$x
attr(,"gradient")[[1]]$x[[1]]
[1] 1

attr(,"gradient")[[1]]$x$abc
[1] 0


attr(,"gradient")[[1]]$y
[1] 0

attr(,"gradient")[[1]]$z
[1] 0

attr(,"gradient")[[1]]$w
[1] 0


attr(,"gradient")$abc
attr(,"gradient")$abc$x
attr(,"gradient")$abc$x[[1]]
[1] 0

attr(,"gradient")$abc$x$abc
[1] 1


attr(,"gradient")$abc$y
[1] 1

attr(,"gradient")$abc$z
[1] 8

attr(,"gradient")$abc$w
[1] 48


> 
> fsub <- function (...) `[[`(...)
> with gradient (a=list(7,8)) fsub(a,1)
[1] 7
attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1

attr(,"gradient")[[2]]
[1] 0

> 
> 
> # Test gradients w.r.t. numeric vectors.
> 
> with gradient (a=c(5,55,555)) a
[1]   5  55 555
attr(,"gradient")
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1
> 
> with gradient (a=c(x=5,y=55,z=555)) a[["x"]]
[1] 5
attr(,"gradient")
[1] 1 0 0
> with gradient (a=c(x=5,y=55,z=555)) a[["y"]]
[1] 55
attr(,"gradient")
[1] 0 1 0
> with gradient (a=c(x=5,y=55,z=555)) a[["z"]]
[1] 555
attr(,"gradient")
[1] 0 0 1
> 
> with gradient (a=c(x=5,y=55,z=555)) sqrt(a[["y"]])
[1] 7.416198
attr(,"gradient")
[1] 0.00000000 0.06741999 0.00000000
> with gradient (a=c(x=5,y=55,z=555)) a[["z"]]+a[["x"]]
[1] 560
attr(,"gradient")
[1] 1 0 1
> with gradient (a=c(x=5,y=55,z=555)) 2.1*a[["z"]]+3.4*a[["x"]]
[1] 1182.5
attr(,"gradient")
[1] 3.4 0.0 2.1
> 
> with gradient (a=c(9.1,4.1)) {
+   b <- numeric(3)
+   b[[2]] <- a[[1]]
+   b[[1]] <- 3*a[[2]] + b[[2]]
+   b[[3]] <- sin(a[[2]])
+   b[[5]] <- b[[1]]^2
+   b
+ }
[1]  21.4000000   9.1000000  -0.8182771          NA 457.9600000
attr(,"gradient")
     [,1]        [,2]
[1,]  1.0   3.0000000
[2,]  1.0   0.0000000
[3,]  0.0  -0.5748239
[4,]  0.0   0.0000000
[5,] 42.8 128.4000000
> 
> with gradient (a=c(5.1,2.2,3.7)) {
+   x <- numeric(2)
+   x[[1]] <- a[[2]]^2
+   x[[2]] <- a[[3]]
+   sin(x)
+ }
[1] -0.9918688 -0.5298361
attr(,"gradient")
     [,1]      [,2]    [,3]
[1,]    0 0.5599658  0.0000
[2,]    0 0.0000000 -0.8481
> 
> with gradient (a=c(5.1,2.2,3.7),b=c(7.3,6.4)) {
+   x <- numeric(2)
+   x[[1]] <- a[[2]]^2
+   x[[2]] <- a[[3]]*b[[2]]
+   sin(x)
+ }
[1] -0.9918688 -0.9930396
attr(,"gradient")
attr(,"gradient")$a
     [,1]      [,2]      [,3]
[1,]    0 0.5599658 0.0000000
[2,]    0 0.0000000 0.7537988

attr(,"gradient")$b
     [,1]      [,2]
[1,]    0 0.0000000
[2,]    0 0.4357899

> 
> with gradient (a=c(-1.1,2.3)) {
+   x <- numeric(2)
+   x[[1]] <- a[[2]]^2
+   x[[2]] <- a[[1]]*a[[2]]
+   abs(x)
+ }
[1] 5.29 2.53
attr(,"gradient")
     [,1] [,2]
[1,]  0.0  4.6
[2,] -2.3  1.1
> 
> with gradient (a=c(1.1,2.3),b=3.4) {
+   list (dt(a,5), dt(5,a), dt(a,a), dt(a,b), dt(b,a))
+ }
[[1]]
[1] 0.19813859 0.04355096

[[2]]
[1] 0.011656861 0.006055387

[[3]]
[1] 0.14868309 0.05005083

[[4]]
[1] 0.18989332 0.04707694

[[5]]
[1] 0.02491717 0.01853109

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
           [,1]        [,2]
[1,] -0.2105821  0.00000000
[2,]  0.0000000 -0.05840654

attr(,"gradient")$a[[2]]
             [,1]         [,2]
[1,] -0.005880715  0.000000000
[2,]  0.000000000 -0.003246953

attr(,"gradient")$a[[3]]
           [,1]        [,2]
[1,] -0.1050382  0.00000000
[2,]  0.0000000 -0.05271019

attr(,"gradient")$a[[4]]
           [,1]        [,2]
[1,] -0.1993674  0.00000000
[2,]  0.0000000 -0.05482378

attr(,"gradient")$a[[5]]
             [,1]         [,2]
[1,] -0.004620887  0.000000000
[2,]  0.000000000 -0.004741683


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 0 0

attr(,"gradient")$b[[2]]
[1] 0 0

attr(,"gradient")$b[[3]]
[1] 0 0

attr(,"gradient")$b[[4]]
[1]  0.007296298 -0.002565247

attr(,"gradient")$b[[5]]
[1] -0.01405281 -0.01500136


> 
> with gradient (a=c(1.1,2.3),b=3.4) {
+   list (dnorm(a,2,5), dnorm(5,a,2), dnorm(5,2,a), dnorm(a,a,a), 
+         dnorm(a,a,b), dnorm(a,b,a), dnorm(b,a,a), dnorm(b,a,b))
+ }
[[1]]
[1] 0.07850630 0.07964497

[[2]]
[1] 0.02979735 0.08019166

[[3]]
[1] 0.00879777 0.07408744

[[4]]
[1] 0.3626748 0.1734532

[[5]]
[1] 0.117336 0.117336

[[6]]
[1] 0.04075409 0.15470822

[[7]]
[1] 0.04075409 0.15470822

[[8]]
[1] 0.09333873 0.11135304

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
            [,1]          [,2]
[1,] 0.002826227  0.0000000000
[2,] 0.000000000 -0.0009557396

attr(,"gradient")$a[[2]]
           [,1]       [,2]
[1,] 0.02905242 0.00000000
[2,] 0.00000000 0.05412937

attr(,"gradient")$a[[3]]
           [,1]       [,2]
[1,] 0.05149108 0.00000000
[2,] 0.00000000 0.02259098

attr(,"gradient")$a[[4]]
           [,1]        [,2]
[1,] -0.3297044  0.00000000
[2,]  0.0000000 -0.07541442

attr(,"gradient")$a[[5]]
     [,1] [,2]
[1,]    0    0
[2,]    0    0

attr(,"gradient")$a[[6]]
          [,1]        [,2]
[1,] 0.2023926  0.00000000
[2,] 0.0000000 -0.01970886

attr(,"gradient")$a[[7]]
          [,1]        [,2]
[1,] 0.2023926  0.00000000
[2,] 0.0000000 -0.01970886

attr(,"gradient")$a[[8]]
           [,1]       [,2]
[1,] 0.01857085 0.00000000
[2,] 0.00000000 0.01059588


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 0 0

attr(,"gradient")$b[[2]]
[1] 0 0

attr(,"gradient")$b[[3]]
[1] 0 0

attr(,"gradient")$b[[4]]
[1] 0 0

attr(,"gradient")$b[[5]]
[1] -0.03451058 -0.03451058

attr(,"gradient")$b[[6]]
[1] -0.07746645 -0.03216995

attr(,"gradient")$b[[7]]
[1] -0.07746645 -0.03216995

attr(,"gradient")$b[[8]]
[1] -0.03346078 -0.03991869


> 
> with gradient (a=c(1.1,2.3)) list (+a, -a)
[[1]]
[1] 1.1 2.3

[[2]]
[1] -1.1 -2.3

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")[[2]]
     [,1] [,2]
[1,]   -1    0
[2,]    0   -1

> with gradient (a=c(1.1,2.3)) list (+sin(a), -sin(a))
[[1]]
[1] 0.8912074 0.7457052

[[2]]
[1] -0.8912074 -0.7457052

attr(,"gradient")
attr(,"gradient")[[1]]
          [,1]      [,2]
[1,] 0.4535961  0.000000
[2,] 0.0000000 -0.666276

attr(,"gradient")[[2]]
           [,1]     [,2]
[1,] -0.4535961 0.000000
[2,]  0.0000000 0.666276

> 
> with gradient (a=c(1.1,2.3),b=c(5.2,3.1)) list (a+b, a-b, a*b, a/b, a^b)
[[1]]
[1] 6.3 5.4

[[2]]
[1] -4.1 -0.8

[[3]]
[1] 5.72 7.13

[[4]]
[1] 0.2115385 0.7419355

[[5]]
[1]  1.641504 13.223801

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")$a[[2]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")$a[[3]]
     [,1] [,2]
[1,]  5.2  0.0
[2,]  0.0  3.1

attr(,"gradient")$a[[4]]
          [,1]      [,2]
[1,] 0.1923077 0.0000000
[2,] 0.0000000 0.3225806

attr(,"gradient")$a[[5]]
         [,1]     [,2]
[1,] 7.759837  0.00000
[2,] 0.000000 17.82338


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")$b[[2]]
     [,1] [,2]
[1,]   -1    0
[2,]    0   -1

attr(,"gradient")$b[[3]]
     [,1] [,2]
[1,]  1.1  0.0
[2,]  0.0  2.3

attr(,"gradient")$b[[4]]
            [,1]      [,2]
[1,] -0.04068047  0.000000
[2,]  0.00000000 -0.239334

attr(,"gradient")$b[[5]]
         [,1]     [,2]
[1,] 0.156452  0.00000
[2,] 0.000000 11.01422


> with gradient (a=c(1.1,2.3,3.7),b=c(5.2,3.1)) list (a+b, a-b, a*b, a/b, a^b)
[[1]]
[1] 6.3 5.4 8.9

[[2]]
[1] -4.1 -0.8 -1.5

[[3]]
[1]  5.72  7.13 19.24

[[4]]
[1] 0.2115385 0.7419355 0.7115385

[[5]]
[1]   1.641504  13.223801 900.842703

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1

attr(,"gradient")$a[[2]]
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1

attr(,"gradient")$a[[3]]
     [,1] [,2] [,3]
[1,]  5.2  0.0  0.0
[2,]  0.0  3.1  0.0
[3,]  0.0  0.0  5.2

attr(,"gradient")$a[[4]]
          [,1]      [,2]      [,3]
[1,] 0.1923077 0.0000000 0.0000000
[2,] 0.0000000 0.3225806 0.0000000
[3,] 0.0000000 0.0000000 0.1923077

attr(,"gradient")$a[[5]]
         [,1]     [,2]     [,3]
[1,] 7.759837  0.00000    0.000
[2,] 0.000000 17.82338    0.000
[3,] 0.000000  0.00000 1266.049


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1
[3,]    1    0

attr(,"gradient")$b[[2]]
     [,1] [,2]
[1,]   -1    0
[2,]    0   -1
[3,]   -1    0

attr(,"gradient")$b[[3]]
     [,1] [,2]
[1,]  1.1  0.0
[2,]  0.0  2.3
[3,]  3.7  0.0

attr(,"gradient")$b[[4]]
            [,1]      [,2]
[1,] -0.04068047  0.000000
[2,]  0.00000000 -0.239334
[3,] -0.13683432  0.000000

attr(,"gradient")$b[[5]]
            [,1]     [,2]
[1,]    0.156452  0.00000
[2,]    0.000000 11.01422
[3,] 1178.602074  0.00000


Warning messages:
1: In a + b :
  longer object length is not a multiple of shorter object length
2: In a - b :
  longer object length is not a multiple of shorter object length
3: In a * b :
  longer object length is not a multiple of shorter object length
4: In a/b :
  longer object length is not a multiple of shorter object length
5: In a^b :
  longer object length is not a multiple of shorter object length
> with gradient (a=c(1.1,2.3),b=c(5.2,3.1,1.9)) list (a+b, a-b, a*b, a/b, a^b)
[[1]]
[1] 6.3 5.4 3.0

[[2]]
[1] -4.1 -0.8 -0.8

[[3]]
[1] 5.72 7.13 2.09

[[4]]
[1] 0.2115385 0.7419355 0.5789474

[[5]]
[1]  1.641504 13.223801  1.198522

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1
[3,]    1    0

attr(,"gradient")$a[[2]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1
[3,]    1    0

attr(,"gradient")$a[[3]]
     [,1] [,2]
[1,]  5.2  0.0
[2,]  0.0  3.1
[3,]  1.9  0.0

attr(,"gradient")$a[[4]]
          [,1]      [,2]
[1,] 0.1923077 0.0000000
[2,] 0.0000000 0.3225806
[3,] 0.5263158 0.0000000

attr(,"gradient")$a[[5]]
         [,1]     [,2]
[1,] 7.759837  0.00000
[2,] 0.000000 17.82338
[3,] 2.070175  0.00000


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1

attr(,"gradient")$b[[2]]
     [,1] [,2] [,3]
[1,]   -1    0    0
[2,]    0   -1    0
[3,]    0    0   -1

attr(,"gradient")$b[[3]]
     [,1] [,2] [,3]
[1,]  1.1  0.0  0.0
[2,]  0.0  2.3  0.0
[3,]  0.0  0.0  1.1

attr(,"gradient")$b[[4]]
            [,1]      [,2]       [,3]
[1,] -0.04068047  0.000000  0.0000000
[2,]  0.00000000 -0.239334  0.0000000
[3,]  0.00000000  0.000000 -0.3047091

attr(,"gradient")$b[[5]]
         [,1]     [,2]      [,3]
[1,] 0.156452  0.00000 0.0000000
[2,] 0.000000 11.01422 0.0000000
[3,] 0.000000  0.00000 0.1142314


Warning messages:
1: In a + b :
  longer object length is not a multiple of shorter object length
2: In a - b :
  longer object length is not a multiple of shorter object length
3: In a * b :
  longer object length is not a multiple of shorter object length
4: In a/b :
  longer object length is not a multiple of shorter object length
5: In a^b :
  longer object length is not a multiple of shorter object length
> with gradient (a=c(1.1,2.3)) list (1+a, 1-a, a+1, a-1, a+a, a-a)
[[1]]
[1] 2.1 3.3

[[2]]
[1] -0.1 -1.3

[[3]]
[1] 2.1 3.3

[[4]]
[1] 0.1 1.3

[[5]]
[1] 2.2 4.6

[[6]]
[1] 0 0

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")[[2]]
     [,1] [,2]
[1,]   -1    0
[2,]    0   -1

attr(,"gradient")[[3]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")[[4]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")[[5]]
     [,1] [,2]
[1,]    2    0
[2,]    0    2

attr(,"gradient")[[6]]
     [,1] [,2]
[1,]    0    0
[2,]    0    0

> with gradient (a=c(1.1,2.3)) list (2.1*a, 2.1/a, a*2.1, a/2.1, a*a, a/a)
[[1]]
[1] 2.31 4.83

[[2]]
[1] 1.9090909 0.9130435

[[3]]
[1] 2.31 4.83

[[4]]
[1] 0.5238095 1.0952381

[[5]]
[1] 1.21 5.29

[[6]]
[1] 1 1

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2]
[1,]  2.1  0.0
[2,]  0.0  2.1

attr(,"gradient")[[2]]
          [,1]       [,2]
[1,] -1.735537  0.0000000
[2,]  0.000000 -0.3969754

attr(,"gradient")[[3]]
     [,1] [,2]
[1,]  2.1  0.0
[2,]  0.0  2.1

attr(,"gradient")[[4]]
          [,1]      [,2]
[1,] 0.4761905 0.0000000
[2,] 0.0000000 0.4761905

attr(,"gradient")[[5]]
     [,1] [,2]
[1,]  2.2  0.0
[2,]  0.0  4.6

attr(,"gradient")[[6]]
     [,1] [,2]
[1,]    0    0
[2,]    0    0

> with gradient (a=c(1.1,2.3)) list (2.1^a, a^2.1, a^a)
[[1]]
[1] 2.261732 5.509401

[[2]]
[1] 1.221588 5.749479

[[3]]
[1] 1.110534 6.791630

attr(,"gradient")
attr(,"gradient")[[1]]
         [,1]    [,2]
[1,] 1.678064 0.00000
[2,] 0.000000 4.08763

attr(,"gradient")[[2]]
         [,1]     [,2]
[1,] 2.332122 0.000000
[2,] 0.000000 5.249524

attr(,"gradient")[[3]]
         [,1]     [,2]
[1,] 1.216379  0.00000
[2,] 0.000000 12.44844

> 
> with gradient (a=c(1.7,-34.9)) list ((a+2)*(a+1), sin(a)^2+a)
[[1]]
[1]    9.99 1115.31

[[2]]
[1]   2.683399 -34.787222

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1]  [,2]
[1,]  6.4   0.0
[2,]  0.0 -66.8

attr(,"gradient")[[2]]
          [,1]      [,2]
[1,] 0.7444589 0.0000000
[2,] 0.0000000 0.3673567

> with gradient (a=1.7) list ((a+2)*(a+1), sin(a)^2+a)
[[1]]
[1] 9.99

[[2]]
[1] 2.683399

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 6.4

attr(,"gradient")[[2]]
[1] 0.7444589

> with gradient (a=-34.9) list ((a+2)*(a+1), sin(a)^2+a)
[[1]]
[1] 1115.31

[[2]]
[1] -34.78722

attr(,"gradient")
attr(,"gradient")[[1]]
[1] -66.8

attr(,"gradient")[[2]]
[1] 0.3673567

> 
> with gradient (a=1.7) 
+   list (a+3L, a-3L, a*3L, 3L*a, a^3L, a/3L, 3L/a, 3L^a)
[[1]]
[1] 4.7

[[2]]
[1] -1.3

[[3]]
[1] 5.1

[[4]]
[1] 5.1

[[5]]
[1] 4.913

[[6]]
[1] 0.5666667

[[7]]
[1] 1.764706

[[8]]
[1] 6.473008

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1

attr(,"gradient")[[2]]
[1] 1

attr(,"gradient")[[3]]
[1] 3

attr(,"gradient")[[4]]
[1] 3

attr(,"gradient")[[5]]
[1] 8.67

attr(,"gradient")[[6]]
[1] 0.3333333

attr(,"gradient")[[7]]
[1] -1.038062

attr(,"gradient")[[8]]
[1] 7.111326

> with gradient (a=c(1.7,1.7)) 
+   list (a+3L, a-3L, a*3L, 3L*a, a^3L, a/3L, 3L/a, 3L^a)
[[1]]
[1] 4.7 4.7

[[2]]
[1] -1.3 -1.3

[[3]]
[1] 5.1 5.1

[[4]]
[1] 5.1 5.1

[[5]]
[1] 4.913 4.913

[[6]]
[1] 0.5666667 0.5666667

[[7]]
[1] 1.764706 1.764706

[[8]]
[1] 6.473008 6.473008

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")[[2]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")[[3]]
     [,1] [,2]
[1,]    3    0
[2,]    0    3

attr(,"gradient")[[4]]
     [,1] [,2]
[1,]    3    0
[2,]    0    3

attr(,"gradient")[[5]]
     [,1] [,2]
[1,] 8.67 0.00
[2,] 0.00 8.67

attr(,"gradient")[[6]]
          [,1]      [,2]
[1,] 0.3333333 0.0000000
[2,] 0.0000000 0.3333333

attr(,"gradient")[[7]]
          [,1]      [,2]
[1,] -1.038062  0.000000
[2,]  0.000000 -1.038062

attr(,"gradient")[[8]]
         [,1]     [,2]
[1,] 7.111326 0.000000
[2,] 0.000000 7.111326

> with gradient (a=1.7)
+   list (a+3, a-3, a*3, 3*a, a^3, a/3, 3/a, 3^a)
[[1]]
[1] 4.7

[[2]]
[1] -1.3

[[3]]
[1] 5.1

[[4]]
[1] 5.1

[[5]]
[1] 4.913

[[6]]
[1] 0.5666667

[[7]]
[1] 1.764706

[[8]]
[1] 6.473008

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1

attr(,"gradient")[[2]]
[1] 1

attr(,"gradient")[[3]]
[1] 3

attr(,"gradient")[[4]]
[1] 3

attr(,"gradient")[[5]]
[1] 8.67

attr(,"gradient")[[6]]
[1] 0.3333333

attr(,"gradient")[[7]]
[1] -1.038062

attr(,"gradient")[[8]]
[1] 7.111326

> with gradient (a=c(1.7,1.7))
+   list (a+3, a-3, a*3, 3*a, a^3, a/3, 3/a, 3^a)
[[1]]
[1] 4.7 4.7

[[2]]
[1] -1.3 -1.3

[[3]]
[1] 5.1 5.1

[[4]]
[1] 5.1 5.1

[[5]]
[1] 4.913 4.913

[[6]]
[1] 0.5666667 0.5666667

[[7]]
[1] 1.764706 1.764706

[[8]]
[1] 6.473008 6.473008

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")[[2]]
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")[[3]]
     [,1] [,2]
[1,]    3    0
[2,]    0    3

attr(,"gradient")[[4]]
     [,1] [,2]
[1,]    3    0
[2,]    0    3

attr(,"gradient")[[5]]
     [,1] [,2]
[1,] 8.67 0.00
[2,] 0.00 8.67

attr(,"gradient")[[6]]
          [,1]      [,2]
[1,] 0.3333333 0.0000000
[2,] 0.0000000 0.3333333

attr(,"gradient")[[7]]
          [,1]      [,2]
[1,] -1.038062  0.000000
[2,]  0.000000 -1.038062

attr(,"gradient")[[8]]
         [,1]     [,2]
[1,] 7.111326 0.000000
[2,] 0.000000 7.111326

> 
> set.seed(179)
> with gradient (a=3.1) rexp(1,a)
[1] 0.08403653
attr(,"gradient")
[1] -0.02710856
> with gradient (a=0.2) rexp(1,a)
[1] 3.193164
attr(,"gradient")
[1] -15.96582
> with gradient (a=7.5) rexp(1,a)
[1] 0.05260134
attr(,"gradient")
[1] -0.007013512
> with gradient (a=3.1) rexp(1,a^2)
[1] 0.01189765
attr(,"gradient")
[1] -0.007675904
> with gradient (a=0.2) rexp(1,a^2)
[1] 62.80972
attr(,"gradient")
[1] -628.0972
> with gradient (a=7.5) rexp(1,a^2)
[1] 0.01199416
attr(,"gradient")
[1] -0.003198441
> 
> set.seed(179)
> with gradient (a=c(3.1,0.2,7.5)) rexp(3,a)
[1] 0.08403653 3.19316357 0.05260134
attr(,"gradient")
            [,1]      [,2]         [,3]
[1,] -0.02710856   0.00000  0.000000000
[2,]  0.00000000 -15.96582  0.000000000
[3,]  0.00000000   0.00000 -0.007013512
> with gradient (a=c(3.1,0.2,7.5)) rexp(3,a^2)
[1]  0.01189765 62.80972133  0.01199416
attr(,"gradient")
             [,1]      [,2]         [,3]
[1,] -0.007675904    0.0000  0.000000000
[2,]  0.000000000 -628.0972  0.000000000
[3,]  0.000000000    0.0000 -0.003198441
> 
> set.seed(179)
> with gradient (a=3.1,b=2.4) rnorm(1,a,b)
[1] 3.898079
attr(,"gradient")
attr(,"gradient")$a
[1] 1

attr(,"gradient")$b
[1] 0.3325331

> with gradient (a=0.2,b=0.9) rnorm(1,a,b)
[1] 0.6648697
attr(,"gradient")
attr(,"gradient")$a
[1] 1

attr(,"gradient")$b
[1] 0.5165219

> with gradient (a=3.1,b=2.4) rnorm(1,cos(a),sin(b)^2)
[1] -1.392109
attr(,"gradient")
attr(,"gradient")$a
[1] -0.04158066

attr(,"gradient")$b
[1] 0.8580087

> with gradient (a=0.2,b=0.9) rnorm(1,cos(a),sin(b)^2)
[1] 0.1557093
attr(,"gradient")
attr(,"gradient")$a
[1] -0.1986693

attr(,"gradient")$b
[1] -1.308339

> with gradient (a=3.1,b=2.4) rnorm(1,a,3)
[1] 2.990818
attr(,"gradient")
attr(,"gradient")$a
[1] 1

attr(,"gradient")$b
[1] 0

> with gradient (a=0.2,b=0.9) rnorm(1,a,3)
[1] 2.683433
attr(,"gradient")
attr(,"gradient")$a
[1] 1

attr(,"gradient")$b
[1] 0

> with gradient (a=3.1,b=2.4) rnorm(1,4,b)
[1] 4.17983
attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$b
[1] 0.0749291

> with gradient (a=0.2,b=0.9) rnorm(1,4,b)
[1] 5.014541
attr(,"gradient")
attr(,"gradient")$a
[1] 0

attr(,"gradient")$b
[1] 1.127268

> with gradient (a=0.7,b=1.8) rnorm(1,a^2,b)
[1] 1.333681
attr(,"gradient")
attr(,"gradient")$a
[1] 1.4

attr(,"gradient")$b
[1] 0.4687117

> with gradient (a=0.9,b=1.6) rnorm(1,a^2,b)
[1] 1.896644
attr(,"gradient")
attr(,"gradient")$a
[1] 1.8

attr(,"gradient")$b
[1] 0.6791523

> with gradient (a=0.7,b=1.2) rnorm(1,a^2,b)
[1] 0.7410938
attr(,"gradient")
attr(,"gradient")$a
[1] 1.4

attr(,"gradient")$b
[1] 0.2092448

> 
> set.seed(179)
> with gradient (a=c(3.1,0.2),b=c(2.4,0.9)) rnorm(2,a,b)
[1] 3.8980794 0.6648697
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")$b
          [,1]      [,2]
[1,] 0.3325331 0.0000000
[2,] 0.0000000 0.5165219

> with gradient (a=c(3.1,0.2),b=c(2.4,0.9)) rnorm(2,cos(a),sin(b)^2)
[1] -1.3921093  0.1557093
attr(,"gradient")
attr(,"gradient")$a
            [,1]       [,2]
[1,] -0.04158066  0.0000000
[2,]  0.00000000 -0.1986693

attr(,"gradient")$b
          [,1]      [,2]
[1,] 0.8580087  0.000000
[2,] 0.0000000 -1.308339

> with gradient (a=c(3.1,0.2),b=c(2.4,0.9)) rnorm(2,a,3)
[1] 2.990818 2.683433
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2]
[1,]    1    0
[2,]    0    1

attr(,"gradient")$b
     [,1] [,2]
[1,]    0    0
[2,]    0    0

> with gradient (a=c(3.1,0.2),b=c(2.4,0.9)) rnorm(2,4,b)
[1] 4.179830 5.014541
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2]
[1,]    0    0
[2,]    0    0

attr(,"gradient")$b
          [,1]     [,2]
[1,] 0.0749291 0.000000
[2,] 0.0000000 1.127268

> with gradient (a=c(0.7,0.9),b=c(1.8,1.6,1.2)) rnorm(3,a^2,b)
[1] 1.3336810 1.8966437 0.7410938
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2]
[1,]  1.4  0.0
[2,]  0.0  1.8
[3,]  1.4  0.0

attr(,"gradient")$b
          [,1]      [,2]      [,3]
[1,] 0.4687117 0.0000000 0.0000000
[2,] 0.0000000 0.6791523 0.0000000
[3,] 0.0000000 0.0000000 0.2092448

> 
> 
> # Test preservation of gradients through attribute setting.
> 
> with gradient (a=c(33,11,0.7,99)) { attr(a,"fred") <- 123; a }
[1] 33.0 11.0  0.7 99.0
attr(,"fred")
[1] 123
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> with gradient (a=c(33,11,0.7,99)) { attr(a,"fred") <- NULL; a }
[1] 33.0 11.0  0.7 99.0
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> 
> with gradient (a=c(33,11,0.7,99)) { class(a) <- "fred"; a }
[1] 33.0 11.0  0.7 99.0
attr(,"class")
[1] "fred"
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> with gradient (a=c(33,11,0.7,99)) { class(a) <- NULL; a }
[1] 33.0 11.0  0.7 99.0
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> 
> with gradient (a=c(33,11,0.7,99)) { oldClass(a) <- "fred"; a }
[1] 33.0 11.0  0.7 99.0
attr(,"class")
[1] "fred"
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> with gradient (a=c(33,11,0.7,99)) { oldClass(a) <- NULL; a }
[1] 33.0 11.0  0.7 99.0
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> 
> with gradient (a=c(33,11,0.7,99)) { attributes(a) <- list(X=1,y=2); a }
[1] 33.0 11.0  0.7 99.0
attr(,"X")
[1] 1
attr(,"y")
[1] 2
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> with gradient (a=c(33,11,0.7,99)) { attributes(a) <- NULL; a }
[1] 33.0 11.0  0.7 99.0
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> 
> with gradient (a=c(33,11,0.7,99)) { dim(a) <- c(2,2); a }
     [,1] [,2]
[1,]   33  0.7
[2,]   11 99.0
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> with gradient (a=c(33,11,0.7,99)) { dim(a) <- NULL; a }
[1] 33.0 11.0  0.7 99.0
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> 
> with gradient (a=c(33,11,0.7,99)) { names(a) <- c("ww","xx","yy","zz"); a }
  ww   xx   yy   zz 
33.0 11.0  0.7 99.0 
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> with gradient (a=c(33,11,0.7,99)) { names(a) <- NULL; a }
[1] 33.0 11.0  0.7 99.0
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> 
> with gradient (a=matrix(c(33,11,0.7,99),2,2)) {
+   dimnames(a) <- list(c("ww","xx"),c("yy","zz"))
+   a
+ }
   yy   zz
ww 33  0.7
xx 11 99.0
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> 
> with gradient (a=matrix(c(33,11,0.7,99),2,2)) { dimnames(a) <- NULL; a }
     [,1] [,2]
[1,]   33  0.7
[2,]   11 99.0
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> 
> 
> # Test matrix operations.
> 
> (A <- matrix(c(3,6,1,2),2,2))
     [,1] [,2]
[1,]    3    1
[2,]    6    2
> (B <- matrix(c(9,8,4,3,1,3),2,3))
     [,1] [,2] [,3]
[1,]    9    4    1
[2,]    8    3    3
> with gradient (A,B) A %*% B
     [,1] [,2] [,3]
[1,]   35   15    6
[2,]   70   30   12
attr(,"gradient")
attr(,"gradient")$A
     [,1] [,2] [,3] [,4]
[1,]    9    0    8    0
[2,]    0    9    0    8
[3,]    4    0    3    0
[4,]    0    4    0    3
[5,]    1    0    3    0
[6,]    0    1    0    3

attr(,"gradient")$B
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    3    1    0    0    0    0
[2,]    6    2    0    0    0    0
[3,]    0    0    3    1    0    0
[4,]    0    0    6    2    0    0
[5,]    0    0    0    0    3    1
[6,]    0    0    0    0    6    2

> At <- t(A)
> Bt <- t(B)
> with gradient (At,B) t(At) %*% B
     [,1] [,2] [,3]
[1,]   35   15    6
[2,]   70   30   12
attr(,"gradient")
attr(,"gradient")$At
     [,1] [,2] [,3] [,4]
[1,]    9    8    0    0
[2,]    0    0    9    8
[3,]    4    3    0    0
[4,]    0    0    4    3
[5,]    1    3    0    0
[6,]    0    0    1    3

attr(,"gradient")$B
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    3    1    0    0    0    0
[2,]    6    2    0    0    0    0
[3,]    0    0    3    1    0    0
[4,]    0    0    6    2    0    0
[5,]    0    0    0    0    3    1
[6,]    0    0    0    0    6    2

> with gradient (At,B) crossprod(At,B)
     [,1] [,2] [,3]
[1,]   35   15    6
[2,]   70   30   12
attr(,"gradient")
attr(,"gradient")$At
     [,1] [,2] [,3] [,4]
[1,]    9    8    0    0
[2,]    0    0    9    8
[3,]    4    3    0    0
[4,]    0    0    4    3
[5,]    1    3    0    0
[6,]    0    0    1    3

attr(,"gradient")$B
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    3    1    0    0    0    0
[2,]    6    2    0    0    0    0
[3,]    0    0    3    1    0    0
[4,]    0    0    6    2    0    0
[5,]    0    0    0    0    3    1
[6,]    0    0    0    0    6    2

> with gradient (A,Bt) A %*% t(Bt)
     [,1] [,2] [,3]
[1,]   35   15    6
[2,]   70   30   12
attr(,"gradient")
attr(,"gradient")$A
     [,1] [,2] [,3] [,4]
[1,]    9    0    8    0
[2,]    0    9    0    8
[3,]    4    0    3    0
[4,]    0    4    0    3
[5,]    1    0    3    0
[6,]    0    1    0    3

attr(,"gradient")$Bt
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    3    0    0    1    0    0
[2,]    6    0    0    2    0    0
[3,]    0    3    0    0    1    0
[4,]    0    6    0    0    2    0
[5,]    0    0    3    0    0    1
[6,]    0    0    6    0    0    2

> with gradient (A,Bt) tcrossprod(A,Bt)
     [,1] [,2] [,3]
[1,]   35   15    6
[2,]   70   30   12
attr(,"gradient")
attr(,"gradient")$A
     [,1] [,2] [,3] [,4]
[1,]    9    0    8    0
[2,]    0    9    0    8
[3,]    4    0    3    0
[4,]    0    4    0    3
[5,]    1    0    3    0
[6,]    0    1    0    3

attr(,"gradient")$Bt
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    3    0    0    1    0    0
[2,]    6    0    0    2    0    0
[3,]    0    3    0    0    1    0
[4,]    0    6    0    0    2    0
[5,]    0    0    3    0    0    1
[6,]    0    0    6    0    0    2

> with gradient (B) t(B) %*% B
     [,1] [,2] [,3]
[1,]  145   60   33
[2,]   60   25   13
[3,]   33   13   10
attr(,"gradient")
      [,1] [,2] [,3] [,4] [,5] [,6]
 [1,]   18   16    0    0    0    0
 [2,]    4    3    9    8    0    0
 [3,]    1    3    0    0    9    8
 [4,]    4    3    9    8    0    0
 [5,]    0    0    8    6    0    0
 [6,]    0    0    1    3    4    3
 [7,]    1    3    0    0    9    8
 [8,]    0    0    1    3    4    3
 [9,]    0    0    0    0    2    6
> with gradient (B) crossprod(B)
     [,1] [,2] [,3]
[1,]  145   60   33
[2,]   60   25   13
[3,]   33   13   10
attr(,"gradient")
      [,1] [,2] [,3] [,4] [,5] [,6]
 [1,]   18   16    0    0    0    0
 [2,]    4    3    9    8    0    0
 [3,]    1    3    0    0    9    8
 [4,]    4    3    9    8    0    0
 [5,]    0    0    8    6    0    0
 [6,]    0    0    1    3    4    3
 [7,]    1    3    0    0    9    8
 [8,]    0    0    1    3    4    3
 [9,]    0    0    0    0    2    6
> with gradient (B) B %*% t(B)
     [,1] [,2]
[1,]   98   87
[2,]   87   82
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]   18    0    8    0    2    0
[2,]    8    9    3    4    3    1
[3,]    8    9    3    4    3    1
[4,]    0   16    0    6    0    6
> with gradient (B) tcrossprod(B)
     [,1] [,2]
[1,]   98   87
[2,]   87   82
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]   18    0    8    0    2    0
[2,]    8    9    3    4    3    1
[3,]    8    9    3    4    3    1
[4,]    0   16    0    6    0    6
> (u <- c(11,21))
[1] 11 21
> (v <- c(10,20))
[1] 10 20
> with gradient (A,v) A %*% v
     [,1]
[1,]   50
[2,]  100
attr(,"gradient")
attr(,"gradient")$A
     [,1] [,2] [,3] [,4]
[1,]   10    0   20    0
[2,]    0   10    0   20

attr(,"gradient")$v
     [,1] [,2]
[1,]    3    1
[2,]    6    2

> with gradient (A,v) v %*% A
     [,1] [,2]
[1,]  150   50
attr(,"gradient")
attr(,"gradient")$A
     [,1] [,2] [,3] [,4]
[1,]   10   20    0    0
[2,]    0    0   10   20

attr(,"gradient")$v
     [,1] [,2]
[1,]    3    6
[2,]    1    2

> with gradient (u,v) u %*% v
     [,1]
[1,]  530
attr(,"gradient")
attr(,"gradient")$u
[1] 10 20

attr(,"gradient")$v
[1] 11 21

> with gradient (u,v) u %*% t(v)
     [,1] [,2]
[1,]  110  220
[2,]  210  420
attr(,"gradient")
attr(,"gradient")$u
     [,1] [,2]
[1,]   10    0
[2,]    0   10
[3,]   20    0
[4,]    0   20

attr(,"gradient")$v
     [,1] [,2]
[1,]   11    0
[2,]   21    0
[3,]    0   11
[4,]    0   21

> rm(A,B,At,Bt)
> 
> with gradient (a=3,b=4) { x <- matrix(c(a,b,a),3,3); drop(x) }
     [,1] [,2] [,3]
[1,]    3    3    3
[2,]    4    4    4
[3,]    3    3    3
attr(,"gradient")
attr(,"gradient")$a
[1] 1 0 1 1 0 1 1 0 1

attr(,"gradient")$b
[1] 0 1 0 0 1 0 0 1 0

> with gradient (a=3,b=4) { x <- matrix(c(a,b,a),9,1); drop(x) }
[1] 3 4 3 3 4 3 3 4 3
attr(,"gradient")
attr(,"gradient")$a
[1] 1 0 1 1 0 1 1 0 1

attr(,"gradient")$b
[1] 0 1 0 0 1 0 0 1 0

> 
> with gradient (a=matrix(list(3,1,9,4),2,2)) t(a)
     [,1] [,2]
[1,] 3    1   
[2,] 9    4   
attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
[1] 0

attr(,"gradient")[[1]][[4]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 0

attr(,"gradient")[[2]][[3]]
[1] 1

attr(,"gradient")[[2]][[4]]
[1] 0


attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]]
[1] 1

attr(,"gradient")[[3]][[3]]
[1] 0

attr(,"gradient")[[3]][[4]]
[1] 0


attr(,"gradient")[[4]]
attr(,"gradient")[[4]][[1]]
[1] 0

attr(,"gradient")[[4]][[2]]
[1] 0

attr(,"gradient")[[4]][[3]]
[1] 0

attr(,"gradient")[[4]][[4]]
[1] 1


> with gradient (a=matrix(c(3,1,9,4),2,2)) t(a)
     [,1] [,2]
[1,]    3    1
[2,]    9    4
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    0    1    0
[3,]    0    1    0    0
[4,]    0    0    0    1
> with gradient (a=7) { b <- matrix(c(a,1,a^2,4,a^3,a^4),3,2); t(b) }
     [,1] [,2] [,3]
[1,]    7    1   49
[2,]    4  343 2401
attr(,"gradient")
[1]    1    0    0  147   14 1372
> 
> with gradient (a=matrix(list(3,1,9,4),2,2)) diag(a)
[[1]]
[1] 3

[[2]]
[1] 4

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 0


attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]]
[1] 0


attr(,"gradient")[[4]]
attr(,"gradient")[[4]][[1]]
[1] 0

attr(,"gradient")[[4]][[2]]
[1] 1


> with gradient (a=matrix(c(3,1,9,4),2,2)) diag(a)
[1] 3 4
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    0    0    1
> 
> with gradient (a=list(8,7)) diag(a)
     [,1] [,2]
[1,]    8    0
[2,]    0    7
attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1 0 0 0

attr(,"gradient")[[2]]
[1] 0 0 0 1

> with gradient (a=c(8,7)) diag(a)
     [,1] [,2]
[1,]    8    0
[2,]    0    7
attr(,"gradient")
     [,1] [,2]
[1,]    1    0
[2,]    0    0
[3,]    0    0
[4,]    0    1
> with gradient (a=8,b=7) diag(c(a,a+3*b,b),3,3)
     [,1] [,2] [,3]
[1,]    8    0    0
[2,]    0   29    0
[3,]    0    0    7
attr(,"gradient")
attr(,"gradient")$a
[1] 1 0 0 0 1 0 0 0 0

attr(,"gradient")$b
[1] 0 0 0 0 3 0 0 0 1

> 
> with gradient (a=3) { M <- matrix(7,2,2); diag(M) <- a; M }
     [,1] [,2]
[1,]    3    7
[2,]    7    3
attr(,"gradient")
[1] 1 0 0 1
> with gradient (a=3) { M <- matrix(7,2,2); diag(M) <- c(a,a^2); M }
     [,1] [,2]
[1,]    3    7
[2,]    7    9
attr(,"gradient")
[1] 1 0 0 6
> 
> with gradient (A=matrix(c(3,1,5,2,-3,9),2,3)) rowSums(A)
[1]  5 12
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    1    0    1    0    1    0
[2,]    0    1    0    1    0    1
> with gradient (A=matrix(c(3,1,5,2,-3,9),2,3)) colSums(A)
[1] 4 7 6
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    1    1    0    0    0    0
[2,]    0    0    1    1    0    0
[3,]    0    0    0    0    1    1
> with gradient (A=matrix(c(3,1,5,2,-3,9),2,3)) rowMeans(A)
[1] 1.666667 4.000000
attr(,"gradient")
          [,1]      [,2]      [,3]      [,4]      [,5]      [,6]
[1,] 0.3333333 0.0000000 0.3333333 0.0000000 0.3333333 0.0000000
[2,] 0.0000000 0.3333333 0.0000000 0.3333333 0.0000000 0.3333333
> with gradient (A=matrix(c(3,1,5,2,-3,9),2,3)) colMeans(A)
[1] 2.0 3.5 3.0
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]  0.5  0.5  0.0  0.0  0.0  0.0
[2,]  0.0  0.0  0.5  0.5  0.0  0.0
[3,]  0.0  0.0  0.0  0.0  0.5  0.5
> 
> with gradient (A=matrix(c(3,1,NA,2,-3,9),2,3)) rowSums(A,na.rm=TRUE)
[1]  0 12
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    1    0    0    0    1    0
[2,]    0    1    0    1    0    1
> with gradient (A=matrix(c(3,1,NA,2,-3,9),2,3)) colSums(A,na.rm=TRUE)
[1] 4 2 6
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    1    1    0    0    0    0
[2,]    0    0    0    1    0    0
[3,]    0    0    0    0    1    1
> with gradient (A=matrix(c(3,1,NA,2,-3,9),2,3)) rowMeans(A,na.rm=TRUE)
[1] 0 4
attr(,"gradient")
     [,1]      [,2] [,3]      [,4] [,5]      [,6]
[1,]  0.5 0.0000000    0 0.0000000  0.5 0.0000000
[2,]  0.0 0.3333333    0 0.3333333  0.0 0.3333333
> with gradient (A=matrix(c(3,1,NA,2,-3,9),2,3)) colMeans(A,na.rm=TRUE)
[1] 2 2 3
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]  0.5  0.5    0    0  0.0  0.0
[2,]  0.0  0.0    0    1  0.0  0.0
[3,]  0.0  0.0    0    0  0.5  0.5
> 
> # next loses dim attribute, which is strange, but accept that for now...
> with gradient (a=list(3)) { M <- matrix(7,2,2); diag(M) <- a; M }
[[1]]
[1] 3

[[2]]
[1] 7

[[3]]
[1] 7

[[4]]
[1] 3

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
[1] 0

attr(,"gradient")[[1]][[4]]
[1] 1


> 
> X <- matrix(c(3.1,2,7, 0,1.7,5, 9,-3.2,6), 3, 3)
> with gradient (X) det(X)
[1] 64.12
attr(,"gradient")
[1]  26.20  45.00 -15.30 -34.40 -44.40  27.92  -1.90 -15.50   5.27
> numericDeriv (quote(det(X)), "X")
[1] 64.12
attr(,"gradient")
     [,1] [,2]  [,3]  [,4]  [,5]  [,6] [,7]  [,8] [,9]
[1,] 26.2   45 -15.3 -34.4 -44.4 27.92 -1.9 -15.5 5.27
> with gradient (X) determinant(X)
$modulus
[1] 4.160756
attr(,"logarithm")
[1] TRUE

$sign
[1] 1

attr(,"class")
[1] "det"
attr(,"gradient")
attr(,"gradient")$modulus
[1]  0.40860886  0.70180911 -0.23861510 -0.53649407 -0.69245165  0.43543356
[7] -0.02963194 -0.24173425  0.08218964

attr(,"gradient")$sign
NULL

> numericDeriv (quote(determinant(X)$modulus), "X")
[1] 4.160756
attr(,"logarithm")
[1] TRUE
attr(,"gradient")
          [,1]      [,2]       [,3]       [,4]       [,5]      [,6]        [,7]
[1,] 0.4086089 0.7018091 -0.2386151 -0.5364941 -0.6924517 0.4354336 -0.02963194
           [,8]       [,9]
[1,] -0.2417343 0.08218964
> with gradient (X) determinant(X,logarithm=FALSE)
$modulus
[1] 64.12
attr(,"logarithm")
[1] FALSE

$sign
[1] 1

attr(,"class")
[1] "det"
attr(,"gradient")
attr(,"gradient")$modulus
[1]  26.20  45.00 -15.30 -34.40 -44.40  27.92  -1.90 -15.50   5.27

attr(,"gradient")$sign
NULL

> numericDeriv (quote(determinant(X,logarithm=FALSE)$modulus), "X")
[1] 64.12
attr(,"logarithm")
[1] FALSE
attr(,"gradient")
     [,1] [,2]  [,3]  [,4]  [,5]  [,6] [,7]  [,8] [,9]
[1,] 26.2   45 -15.3 -34.4 -44.4 27.92 -1.9 -15.5 5.27
> 
> X <- matrix(c(-31,2,7, 0,1.7,5, 9,-3.2,6), 3, 3)
> with gradient (X) det(X)
[1] -829.3
attr(,"gradient")
[1]   26.2   45.0  -15.3  -34.4 -249.0  -81.2   -1.9  155.0  -52.7
> numericDeriv (quote(det(X)), "X")
[1] -829.3
attr(,"gradient")
     [,1]     [,2]  [,3]      [,4] [,5]  [,6]      [,7] [,8]  [,9]
[1,] 26.2 45.00001 -15.3 -34.40001 -249 -81.2 -1.900001  155 -52.7
> with gradient (X) determinant(X)
$modulus
[1] 6.720582
attr(,"logarithm")
[1] TRUE

$sign
[1] -1

attr(,"class")
[1] "det"
attr(,"gradient")
attr(,"gradient")$modulus
[1] -0.031592910 -0.054262631  0.018449295  0.041480767  0.300253226
[6]  0.097913903  0.002291089 -0.186904618  0.063547570

attr(,"gradient")$sign
NULL

> numericDeriv (quote(determinant(X)$modulus), "X")
[1] 6.720582
attr(,"logarithm")
[1] TRUE
attr(,"gradient")
            [,1]        [,2]      [,3]       [,4]      [,5]      [,6]
[1,] -0.03159291 -0.05426264 0.0184493 0.04148078 0.3002532 0.0979139
           [,7]       [,8]       [,9]
[1,] 0.00229109 -0.1869046 0.06354757
> with gradient (X) determinant(X,logarithm=FALSE)
$modulus
[1] 829.3
attr(,"logarithm")
[1] FALSE

$sign
[1] -1

attr(,"class")
[1] "det"
attr(,"gradient")
attr(,"gradient")$modulus
[1]  -26.2  -45.0   15.3   34.4  249.0   81.2    1.9 -155.0   52.7

attr(,"gradient")$sign
NULL

> numericDeriv (quote(determinant(X,logarithm=FALSE)$modulus), "X")
[1] 829.3
attr(,"logarithm")
[1] FALSE
attr(,"gradient")
      [,1] [,2] [,3]     [,4] [,5] [,6] [,7] [,8] [,9]
[1,] -26.2  -45 15.3 34.39999  249 81.2  1.9 -155 52.7
> 
> A <- matrix(c(7,1,8.1,2.2),2,2)
> v <- c(55,33)
> V <- matrix(c(55,33,550,330,5500,3300),2,3)
> 
> with gradient (A) solve(A)
           [,1]       [,2]
[1,]  0.3013699 -1.1095890
[2,] -0.1369863  0.9589041
attr(,"gradient")
            [,1]       [,2]        [,3]       [,4]
[1,] -0.09082379  0.3343967  0.04128354 -0.1519985
[2,]  0.04128354 -0.2889848 -0.01876525  0.1313567
[3,]  0.33439670 -1.2311878 -0.28898480  1.0639895
[4,] -0.15199850  1.0639895  0.13135673 -0.9194971
> numericDeriv (quote(as.vector(solve(A))),"A")
[1]  0.3013699 -0.1369863 -1.1095890  0.9589041
attr(,"gradient")
            [,1]       [,2]        [,3]       [,4]
[1,] -0.09082379  0.3343967  0.04128354 -0.1519985
[2,]  0.04128354 -0.2889848 -0.01876525  0.1313567
[3,]  0.33439669 -1.2311879 -0.28898480  1.0639895
[4,] -0.15199849  1.0639895  0.13135673 -0.9194971
> 
> with gradient (A) solve(A,v)
[1] -20.04110  24.10959
attr(,"gradient")
          [,1]      [,2]      [,3]      [,4]
[1,]  6.039782 -22.23738 -7.265904  26.75174
[2,] -2.745356  19.21749  3.302683 -23.11878
> with gradient (v) solve(A,v)
[1] -20.04110  24.10959
attr(,"gradient")
           [,1]       [,2]
[1,]  0.3013699 -1.1095890
[2,] -0.1369863  0.9589041
> with gradient (A,v) solve(A,v)
[1] -20.04110  24.10959
attr(,"gradient")
attr(,"gradient")$A
          [,1]      [,2]      [,3]      [,4]
[1,]  6.039782 -22.23738 -7.265904  26.75174
[2,] -2.745356  19.21749  3.302683 -23.11878

attr(,"gradient")$v
           [,1]       [,2]
[1,]  0.3013699 -1.1095890
[2,] -0.1369863  0.9589041

> numericDeriv (quote(as.vector(solve(A,v))),"A")
[1] -20.04110  24.10959
attr(,"gradient")
          [,1]      [,2]      [,3]      [,4]
[1,]  6.039782 -22.23738 -7.265904  26.75173
[2,] -2.745356  19.21749  3.302684 -23.11878
> numericDeriv (quote(as.vector(solve(A,v))),"v")
[1] -20.04110  24.10959
attr(,"gradient")
           [,1]       [,2]
[1,]  0.3013699 -1.1095890
[2,] -0.1369863  0.9589041
> 
> with gradient (A) solve(A,V)
          [,1]      [,2]      [,3]
[1,] -20.04110 -200.4110 -2004.110
[2,]  24.10959  241.0959  2410.959
attr(,"gradient")
            [,1]        [,2]        [,3]        [,4]
[1,]    6.039782   -22.23738   -7.265904    26.75174
[2,]   -2.745356    19.21749    3.302683   -23.11878
[3,]   60.397823  -222.37380  -72.659035   267.51736
[4,]  -27.453556   192.17489   33.026834  -231.18784
[5,]  603.978232 -2223.73804 -726.590355  2675.17358
[6,] -274.535560  1921.74892  330.268343 -2311.87840
> with gradient (V) solve(A,V)
          [,1]      [,2]      [,3]
[1,] -20.04110 -200.4110 -2004.110
[2,]  24.10959  241.0959  2410.959
attr(,"gradient")
           [,1]       [,2]       [,3]       [,4]       [,5]       [,6]
[1,]  0.3013699 -1.1095890  0.0000000  0.0000000  0.0000000  0.0000000
[2,] -0.1369863  0.9589041  0.0000000  0.0000000  0.0000000  0.0000000
[3,]  0.0000000  0.0000000  0.3013699 -1.1095890  0.0000000  0.0000000
[4,]  0.0000000  0.0000000 -0.1369863  0.9589041  0.0000000  0.0000000
[5,]  0.0000000  0.0000000  0.0000000  0.0000000  0.3013699 -1.1095890
[6,]  0.0000000  0.0000000  0.0000000  0.0000000 -0.1369863  0.9589041
> with gradient (A,V) solve(A,V)
          [,1]      [,2]      [,3]
[1,] -20.04110 -200.4110 -2004.110
[2,]  24.10959  241.0959  2410.959
attr(,"gradient")
attr(,"gradient")$A
            [,1]        [,2]        [,3]        [,4]
[1,]    6.039782   -22.23738   -7.265904    26.75174
[2,]   -2.745356    19.21749    3.302683   -23.11878
[3,]   60.397823  -222.37380  -72.659035   267.51736
[4,]  -27.453556   192.17489   33.026834  -231.18784
[5,]  603.978232 -2223.73804 -726.590355  2675.17358
[6,] -274.535560  1921.74892  330.268343 -2311.87840

attr(,"gradient")$V
           [,1]       [,2]       [,3]       [,4]       [,5]       [,6]
[1,]  0.3013699 -1.1095890  0.0000000  0.0000000  0.0000000  0.0000000
[2,] -0.1369863  0.9589041  0.0000000  0.0000000  0.0000000  0.0000000
[3,]  0.0000000  0.0000000  0.3013699 -1.1095890  0.0000000  0.0000000
[4,]  0.0000000  0.0000000 -0.1369863  0.9589041  0.0000000  0.0000000
[5,]  0.0000000  0.0000000  0.0000000  0.0000000  0.3013699 -1.1095890
[6,]  0.0000000  0.0000000  0.0000000  0.0000000 -0.1369863  0.9589041

> numericDeriv (quote(as.vector(solve(A,V))),"A")
[1]   -20.04110    24.10959  -200.41096   241.09589 -2004.10959  2410.95890
attr(,"gradient")
            [,1]        [,2]        [,3]        [,4]
[1,]    6.039782   -22.23738   -7.265904    26.75173
[2,]   -2.745356    19.21749    3.302684   -23.11878
[3,]   60.397821  -222.37381  -72.659037   267.51735
[4,]  -27.453555   192.17490   33.026835  -231.18783
[5,]  603.978208 -2223.73814 -726.590373  2675.17348
[6,] -274.535549  1921.74899  330.268351 -2311.87832
> numericDeriv (quote(as.vector(solve(A,V))),"V")
[1]   -20.04110    24.10959  -200.41096   241.09589 -2004.10959  2410.95890
attr(,"gradient")
           [,1]       [,2]       [,3]       [,4]       [,5]       [,6]
[1,]  0.3013699 -1.1095890  0.0000000  0.0000000  0.0000000  0.0000000
[2,] -0.1369863  0.9589041  0.0000000  0.0000000  0.0000000  0.0000000
[3,]  0.0000000  0.0000000  0.3013699 -1.1095890  0.0000000  0.0000000
[4,]  0.0000000  0.0000000 -0.1369863  0.9589041  0.0000000  0.0000000
[5,]  0.0000000  0.0000000  0.0000000  0.0000000  0.3013699 -1.1095891
[6,]  0.0000000  0.0000000  0.0000000  0.0000000 -0.1369863  0.9589041
> 
> A <- matrix(c(3,1,7,4),2,2)
> B <- matrix(c(4,8,2,9,3,6),2,3)
> 
> with gradient (A,B) ((3*A) %*% sin(A+0.1)) %*% (7*B)
           [,1]      [,2]      [,3]
[1,]  -60.38523 -402.0010 -45.28892
[2,] -124.47697 -329.3731 -93.35773
attr(,"gradient")
attr(,"gradient")$A
           [,1]     [,2]      [,3]      [,4]
[1,] -125.82248 266.7145 282.40238 -675.9930
[2,]  -83.92735 278.3679 115.00384 -448.8908
[3,]   13.63051 133.3573 270.91430 -760.4921
[4,]  -41.96368 215.7257 129.37932 -551.7906
[5,]  -94.36686 200.0359 211.80179 -506.9947
[6,]  -62.94551 208.7759  86.25288 -336.6681

attr(,"gradient")$B
          [,1]      [,2]      [,3]      [,4]      [,5]      [,6]
[1,] 133.62706 -74.36169   0.00000   0.00000   0.00000   0.00000
[2,]  75.73461 -53.42693   0.00000   0.00000   0.00000   0.00000
[3,]   0.00000   0.00000 133.62706 -74.36169   0.00000   0.00000
[4,]   0.00000   0.00000  75.73461 -53.42693   0.00000   0.00000
[5,]   0.00000   0.00000   0.00000   0.00000 133.62706 -74.36169
[6,]   0.00000   0.00000   0.00000   0.00000  75.73461 -53.42693

> 
> numericDeriv (quote(((3*A) %*% sin(A+0.1)) %*% (7*B)), "A")
           [,1]      [,2]      [,3]
[1,]  -60.38523 -402.0010 -45.28892
[2,] -124.47697 -329.3731 -93.35773
attr(,"gradient")
, , 1

           [,1]      [,2]      [,3]
[1,] -125.82249  13.63050 -94.36687
[2,]  -83.92735 -41.96368 -62.94552

, , 2

         [,1]     [,2]     [,3]
[1,] 266.7145 133.3573 200.0359
[2,] 278.3679 215.7257 208.7759

, , 3

         [,1]     [,2]      [,3]
[1,] 282.4024 270.9143 211.80177
[2,] 115.0038 129.3793  86.25288

, , 4

          [,1]      [,2]      [,3]
[1,] -675.9929 -760.4920 -506.9947
[2,] -448.8908 -551.7906 -336.6681

> numericDeriv (quote(((3*A) %*% sin(A+0.1)) %*% (7*B)), "B")
           [,1]      [,2]      [,3]
[1,]  -60.38523 -402.0010 -45.28892
[2,] -124.47697 -329.3731 -93.35773
attr(,"gradient")
, , 1

          [,1] [,2] [,3]
[1,] 133.62706    0    0
[2,]  75.73461    0    0

, , 2

          [,1] [,2] [,3]
[1,] -74.36169    0    0
[2,] -53.42693    0    0

, , 3

     [,1]      [,2] [,3]
[1,]    0 133.62706    0
[2,]    0  75.73461    0

, , 4

     [,1]      [,2] [,3]
[1,]    0 -74.36169    0
[2,]    0 -53.42693    0

, , 5

     [,1] [,2]      [,3]
[1,]    0    0 133.62706
[2,]    0    0  75.73461

, , 6

     [,1] [,2]      [,3]
[1,]    0    0 -74.36169
[2,]    0    0 -53.42693

> 
> 
> 
> # Tests with data frames.
> 
> p <- function (df) { print(df); print(attr(df,"gradient")); }
> 
> a <- c(3,7,1)
> b <- c(9,2,4)
> 
> p( with gradient (a,b) 
+      data.frame(x=a,y=c(a[1]-b[1],a[1]+b[1],a[1]*b[2]),z=a+b) )
  x  y  z
1 3 -6 12
2 7 12  9
3 1  6  5
$a
$a$x
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1

$a$y
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    1    0    0
[3,]    2    0    0

$a$z
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1


$b
$b$x
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0

$b$y
     [,1] [,2] [,3]
[1,]   -1    0    0
[2,]    1    0    0
[3,]    0    3    0

$b$z
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1


> 
> p( with gradient (a,b) 
+      data.frame(list(x=a,y=c(a[1]-b[1],a[1]+b[1],a[1]*b[2]),z=a+b)) )
  x  y  z
1 3 -6 12
2 7 12  9
3 1  6  5
$a
$a$x
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1

$a$y
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    1    0    0
[3,]    2    0    0

$a$z
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1


$b
$b$x
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0

$b$y
     [,1] [,2] [,3]
[1,]   -1    0    0
[2,]    1    0    0
[3,]    0    3    0

$b$z
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1


> 
> p( with gradient (a,b) data.frame(matrix(c(a,b,a,a^2),4,3)) )
  X1 X2 X3
1  3  2  1
2  7  4  9
3  1  3 49
4  9  7  1
$a
$a$X1
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1
[4,]    0    0    0

$a$X2
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    1    0    0
[4,]    0    1    0

$a$X3
     [,1] [,2] [,3]
[1,]    0    0    1
[2,]    6    0    0
[3,]    0   14    0
[4,]    0    0    2


$b
$b$X1
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0
[4,]    1    0    0

$b$X2
     [,1] [,2] [,3]
[1,]    0    1    0
[2,]    0    0    1
[3,]    0    0    0
[4,]    0    0    0

$b$X3
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0
[4,]    0    0    0


> 
> with gradient (a=c(2,3,1),b=c(9,8,7)) 
+   { df <- data.frame(x=a,y=b^2); df$y }
[1] 81 64 49
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0

attr(,"gradient")$b
     [,1] [,2] [,3]
[1,]   18    0    0
[2,]    0   16    0
[3,]    0    0   14

> with gradient (a=c(2,3,1),b=c(9,8,7)) 
+   { df <- data.frame(x=a,y=b^2); df[,"y"] }
[1] 81 64 49
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0

attr(,"gradient")$b
     [,1] [,2] [,3]
[1,]   18    0    0
[2,]    0   16    0
[3,]    0    0   14

> with gradient (a=c(2,3,1),b=c(9,8,7)) 
+   { df <- data.frame(x=a,y=b^2); df[2:3,"y"] }
[1] 64 49
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0

attr(,"gradient")$b
     [,1] [,2] [,3]
[1,]    0   16    0
[2,]    0    0   14

> with gradient (a=c(2,3,1),b=c(9,8,7)) 
+   { df <- data.frame(x=a,y=b^2); df[[2,"y"]] }
[1] 64
attr(,"gradient")
attr(,"gradient")$a
[1] 0 0 0

attr(,"gradient")$b
[1]  0 16  0

> 
> p( with gradient (a=c(2,3,1),b=c(9,8,7)) 
+   { df <- data.frame(x=a,y=b^2); df } )
  x  y
1 2 81
2 3 64
3 1 49
$a
$a$x
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1

$a$y
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0


$b
$b$x
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0

$b$y
     [,1] [,2] [,3]
[1,]   18    0    0
[2,]    0   16    0
[3,]    0    0   14


> p( with gradient (a=c(2,3,1),b=c(9,8,7)) 
+   { df <- data.frame(x=a,y=b^2); df$y <- a^3; df } )
  x  y
1 2  8
2 3 27
3 1  1
$a
$a$x
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1

$a$y
     [,1] [,2] [,3]
[1,]   12    0    0
[2,]    0   27    0
[3,]    0    0    3


$b
$b$x
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0

$b$y
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0


> p( with gradient (a=c(2,3,1),b=c(9,8,7)) 
+   { df <- data.frame(x=a,y=b^2); df["y"] <- a^3; df } )
  x  y
1 2  8
2 3 27
3 1  1
$a
$a$x
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1

$a$y
     [,1] [,2] [,3]
[1,]   12    0    0
[2,]    0   27    0
[3,]    0    0    3


$b
$b$x
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0

$b$y
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0


> p( with gradient (a=c(2,3,1),b=c(9,8,7)) 
+   { df <- data.frame(x=a,y=b^2); df[,"y"] <- a^3; df } )
  x  y
1 2  8
2 3 27
3 1  1
$a
$a$x
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1

$a$y
     [,1] [,2] [,3]
[1,]   12    0    0
[2,]    0   27    0
[3,]    0    0    3


$b
$b$x
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0

$b$y
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0


> p( with gradient (a=c(2,3,1),b=c(9,8,7)) 
+   { df <- data.frame(x=a,y=b^2); df[2:3,"y"] <- a[1..2]^3; df } )
  x  y
1 2 81
2 3  8
3 1 27
$a
$a$x
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1

$a$y
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]   12    0    0
[3,]    0   27    0


$b
$b$x
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0

$b$y
     [,1] [,2] [,3]
[1,]   18    0    0
[2,]    0    0    0
[3,]    0    0    0


> p( with gradient (a=c(2,3,1),b=c(9,8,7)) 
+   { df <- data.frame(x=a,y=b^2); df[[2,"y"]] <- a[2]; df } )
  x  y
1 2 81
2 3  3
3 1 49
$a
$a$x
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1

$a$y
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    1    0
[3,]    0    0    0


$b
$b$x
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0

$b$y
     [,1] [,2] [,3]
[1,]   18    0    0
[2,]    0    0    0
[3,]    0    0   14


> 
> df1 <- data.frame(x=a)
> df2 <- data.frame(x=b)
> df3 <- data.frame(y=b)
> p( with gradient (df1,df2) rbind(df1,df2) )
  x
1 3
2 7
3 1
4 9
5 2
6 4
$df1
$df1$x
$df1$x$x
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1
[4,]    0    0    0
[5,]    0    0    0
[6,]    0    0    0



$df2
$df2$x
$df2$x$x
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0
[4,]    1    0    0
[5,]    0    1    0
[6,]    0    0    1



> p( with gradient (df1,df3) cbind(df1,df3) )
  x y
1 3 9
2 7 2
3 1 4
$df1
$df1$x
$df1$x$x
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1

$df1$x$y
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0



$df3
$df3$y
$df3$y$x
     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    0    0    0

$df3$y$y
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1



> 
> 
> # Miscellaneous tests.
> 
> with gradient (a=7) invisible(a)
[1] 7
attr(,"gradient")
[1] 1
> 
> with gradient (a=c(3,1,5,4),b=7) mean(c(a,b,a))
[1] 3.666667
attr(,"gradient")
attr(,"gradient")$a
[1] 0.2222222 0.2222222 0.2222222 0.2222222

attr(,"gradient")$b
[1] 0.1111111

> with gradient (a=c(3,1,5,4),b=7) mean(c(a,b,NA,a))
[1] NA
attr(,"gradient")
attr(,"gradient")$a
[1] 0 0 0 0

attr(,"gradient")$b
[1] 0

> 
> with gradient (a=c(3,1,5,4),b=7) cumsum(c(a,b,NA,a))
 [1]  3  4  9 13 20 NA NA NA NA NA
attr(,"gradient")
attr(,"gradient")$a
      [,1] [,2] [,3] [,4]
 [1,]    1    0    0    0
 [2,]    1    1    0    0
 [3,]    1    1    1    0
 [4,]    1    1    1    1
 [5,]    1    1    1    1
 [6,]    0    0    0    0
 [7,]    0    0    0    0
 [8,]    0    0    0    0
 [9,]    0    0    0    0
[10,]    0    0    0    0

attr(,"gradient")$b
 [1] 0 0 0 0 1 0 0 0 0 0

> with gradient (a=c(3,1,5,4),b=7) { x <- a^2; x[2] <- a[3]; cumsum(c(x,b^3)) }
[1]   9  14  39  55 398
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2] [,3] [,4]
[1,]    6    0    0    0
[2,]    6    0    1    0
[3,]    6    0   11    0
[4,]    6    0   11    8
[5,]    6    0   11    8

attr(,"gradient")$b
[1]   0   0   0   0 147

> with gradient (a=c(3,1,5,4),b=7) cumprod(c(a,b,NA,a))
 [1]   3   3  15  60 420  NA  NA  NA  NA  NA
attr(,"gradient")
attr(,"gradient")$a
      [,1] [,2] [,3] [,4]
 [1,]    1    0    0    0
 [2,]    1    3    0    0
 [3,]    5   15    3    0
 [4,]   20   60   12   15
 [5,]  140  420   84  105
 [6,]    0    0    0    0
 [7,]    0    0    0    0
 [8,]    0    0    0    0
 [9,]    0    0    0    0
[10,]    0    0    0    0

attr(,"gradient")$b
 [1]  0  0  0  0 60  0  0  0  0  0

> with gradient (a=c(3,1,5,4),b=7) { x <- a^2; x[2] <- a[3]; cumprod(c(x,b^3)) }
[1]       9      45    1125   18000 6174000
attr(,"gradient")
attr(,"gradient")$a
        [,1] [,2]    [,3]    [,4]
[1,]       6    0       0       0
[2,]      30    0       9       0
[3,]     750    0     675       0
[4,]   12000    0   10800    9000
[5,] 4116000    0 3704400 3087000

attr(,"gradient")$b
[1]       0       0       0       0 2646000

> with gradient (a=c(3,1,5,4),b=7) cummax(c(a,b,NA,a))
 [1]  3  3  5  5  7 NA NA NA NA NA
attr(,"gradient")
attr(,"gradient")$a
      [,1] [,2] [,3] [,4]
 [1,]    1    0    0    0
 [2,]    1    0    0    0
 [3,]    0    0    1    0
 [4,]    0    0    1    0
 [5,]    0    0    0    0
 [6,]    0    0    0    0
 [7,]    0    0    0    0
 [8,]    0    0    0    0
 [9,]    0    0    0    0
[10,]    0    0    0    0

attr(,"gradient")$b
 [1] 0 0 0 0 1 0 0 0 0 0

> with gradient (a=c(3,1,5,4),b=7) { x <- a^2; x[2] <- a[3]; cummax(c(x,b^3)) }
[1]   9   9  25  25 343
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2] [,3] [,4]
[1,]    6    0    0    0
[2,]    6    0    0    0
[3,]    0    0   10    0
[4,]    0    0   10    0
[5,]    0    0    0    0

attr(,"gradient")$b
[1]   0   0   0   0 147

> with gradient (a=c(3,1,5,4),b=7) { x <- a^2; x[2] <- sum(a); cummax(c(x,b^3)) }
[1]   9  13  25  25 343
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2] [,3] [,4]
[1,]    6    0    0    0
[2,]    1    1    1    1
[3,]    0    0   10    0
[4,]    0    0   10    0
[5,]    0    0    0    0

attr(,"gradient")$b
[1]   0   0   0   0 147

> with gradient (a=c(3,1,5,4),b=7) cummin(c(a,b,NA,a))
 [1]  3  1  1  1  1 NA NA NA NA NA
attr(,"gradient")
attr(,"gradient")$a
      [,1] [,2] [,3] [,4]
 [1,]    1    0    0    0
 [2,]    0    1    0    0
 [3,]    0    1    0    0
 [4,]    0    1    0    0
 [5,]    0    1    0    0
 [6,]    0    0    0    0
 [7,]    0    0    0    0
 [8,]    0    0    0    0
 [9,]    0    0    0    0
[10,]    0    0    0    0

attr(,"gradient")$b
 [1] 0 0 0 0 0 0 0 0 0 0

> with gradient (a=c(3,1,5,4),b=2) { x <- a^2; x[2] <- a[3]; cummin(c(x,b^3)) }
[1] 9 5 5 5 5
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2] [,3] [,4]
[1,]    6    0    0    0
[2,]    0    0    1    0
[3,]    0    0    1    0
[4,]    0    0    1    0
[5,]    0    0    1    0

attr(,"gradient")$b
[1] 0 0 0 0 0

> with gradient (a=c(3,1,5,4),b=2) { x <- a^2; x[2] <- -sum(a); cummin(c(x,b^3)) }
[1]   9 -13 -13 -13 -13
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2] [,3] [,4]
[1,]    6    0    0    0
[2,]   -1   -1   -1   -1
[3,]   -1   -1   -1   -1
[4,]   -1   -1   -1   -1
[5,]   -1   -1   -1   -1

attr(,"gradient")$b
[1] 0 0 0 0 0

> 
> with gradient (a=c(3,1,5)) sum(a)
[1] 9
attr(,"gradient")
[1] 1 1 1
> with gradient (a=c(3,1,5)) sum(a^2+a)
[1] 44
attr(,"gradient")
[1]  7  3 11
> with gradient (a=c(3,1,5)) sum(a^2,a)
[1] 44
attr(,"gradient")
[1]  7  3 11
> with gradient (a=c(3,1,5),b=7) sum(a^2+a,3*b)
[1] 65
attr(,"gradient")
attr(,"gradient")$a
[1]  7  3 11

attr(,"gradient")$b
[1] 3

> with gradient (a=c(3,1,NA,5),b=7) sum(a^2+a,3*b,na.rm=FALSE)
[1] NA
attr(,"gradient")
attr(,"gradient")$a
[1]  7  3 NA 11

attr(,"gradient")$b
[1] 3

> with gradient (a=c(3,1,NA,5),b=7) sum(a^2+a,3*b,na.rm=TRUE)
[1] 65
attr(,"gradient")
attr(,"gradient")$a
[1]  7  3  0 11

attr(,"gradient")$b
[1] 3

> 
> with gradient (a=c(3,1,5)) prod(a)
[1] 15
attr(,"gradient")
[1]  5 15  3
> with gradient (a=c(3,1,5)) prod(a^2+a)
[1] 720
attr(,"gradient")
[1]  420 1080  264
> with gradient (a=c(3,1,5)) prod(a^2,a)
[1] 3375
attr(,"gradient")
[1]  3375 10125  2025
> with gradient (a=c(3,1,5),b=7) prod(a^2+a,3*b)
[1] 15120
attr(,"gradient")
attr(,"gradient")$a
[1]  8820 22680  5544

attr(,"gradient")$b
[1] 2160

> with gradient (a=c(3,1,NA,5),b=7) prod(a^2+a,3*b,na.rm=FALSE)
[1] NA
attr(,"gradient")
attr(,"gradient")$a
[1] 0 0 0 0

attr(,"gradient")$b
[1] 0

> with gradient (a=c(3,1,NA,5),b=7) prod(a^2+a,3*b,na.rm=TRUE)
[1] 15120
attr(,"gradient")
attr(,"gradient")$a
[1]  8820 22680     0  5544

attr(,"gradient")$b
[1] 2160

> 
> with gradient (a=c(3,1,5)) max(a)
[1] 5
attr(,"gradient")
[1] 0 0 1
> with gradient (a=c(3,1,5)) max(a-a^2)
[1] 0
attr(,"gradient")
[1]  0 -1  0
> with gradient (a=c(3,1,5)) max(a^2,a)
[1] 25
attr(,"gradient")
[1]  0  0 10
> with gradient (a=c(3,1,5),b=7) max(a^2+a,3*b)
[1] 30
attr(,"gradient")
attr(,"gradient")$a
[1]  0  0 11

attr(,"gradient")$b
[1] 0

> with gradient (a=c(3,1,NA,5),b=7) max(a^2+a,3*b,na.rm=FALSE)
[1] NA
attr(,"gradient")
attr(,"gradient")$a
[1] 0 0 0 0

attr(,"gradient")$b
[1] 0

> with gradient (a=c(3,1,NA,5),b=7) max(a^2+a,3*b,na.rm=TRUE)
[1] 30
attr(,"gradient")
attr(,"gradient")$a
[1]  0  0  0 11

attr(,"gradient")$b
[1] 0

> 
> with gradient (a=c(3,1,5)) min(a)
[1] 1
attr(,"gradient")
[1] 0 1 0
> with gradient (a=c(3,1,5)) min(a-a^2)
[1] -20
attr(,"gradient")
[1]  0  0 -9
> with gradient (a=c(3,1,5)) min(a^2,a)
[1] 1
attr(,"gradient")
[1] 0 2 0
> with gradient (a=c(3,1,5),b=0.1) min(a^2+a,3*b)
[1] 0.3
attr(,"gradient")
attr(,"gradient")$a
[1] 0 0 0

attr(,"gradient")$b
[1] 3

> with gradient (a=c(3,1,NA,5),b=7) min(a^2+a,3*b,na.rm=FALSE)
[1] NA
attr(,"gradient")
attr(,"gradient")$a
[1] 0 0 0 0

attr(,"gradient")$b
[1] 0

> with gradient (a=c(3,1,NA,5),b=7) min(a^2+a,3*b,na.rm=TRUE)
[1] 2
attr(,"gradient")
attr(,"gradient")$a
[1] 0 3 0 0

attr(,"gradient")$b
[1] 0

> 
> a <- c(7,1,8,9)
> b <- c(3,4,8,6)
> 
> with gradient (a,b) pmin(a,b)
[1] 3 1 8 6
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2] [,3] [,4]
[1,]    0    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    0

attr(,"gradient")$b
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    0    0    0
[3,]    0    0    0    0
[4,]    0    0    0    1

> with gradient (a,b) pmax(a,b)
[1] 7 4 8 9
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    0    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1

attr(,"gradient")$b
     [,1] [,2] [,3] [,4]
[1,]    0    0    0    0
[2,]    0    1    0    0
[3,]    0    0    0    0
[4,]    0    0    0    0

> with gradient (a,b) pmax(a,b,a[1]+1)
[1] 8 8 8 9
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    1    0    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1

attr(,"gradient")$b
     [,1] [,2] [,3] [,4]
[1,]    0    0    0    0
[2,]    0    0    0    0
[3,]    0    0    0    0
[4,]    0    0    0    0

> with gradient (a,b) pmax(a[1]+1,b,a)
[1] 8 8 8 9
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    1    0    0    0
[3,]    1    0    0    0
[4,]    0    0    0    1

attr(,"gradient")$b
     [,1] [,2] [,3] [,4]
[1,]    0    0    0    0
[2,]    0    0    0    0
[3,]    0    0    0    0
[4,]    0    0    0    0

> with gradient (a,b) pmax(a,b,a*b)
[1] 21  4 64 54
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2] [,3] [,4]
[1,]    3    0    0    0
[2,]    0    0    0    0
[3,]    0    0    8    0
[4,]    0    0    0    6

attr(,"gradient")$b
     [,1] [,2] [,3] [,4]
[1,]    7    0    0    0
[2,]    0    1    0    0
[3,]    0    0    8    0
[4,]    0    0    0    9

> 
> rm(a,b)
> 
> d <- c(5,-7,8,-2)
> 
> with gradient (d) abs(d+1)
[1] 6 6 9 1
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0   -1    0    0
[3,]    0    0    1    0
[4,]    0    0    0   -1
> with gradient (d) sin(d+1)
[1] -0.2794155  0.2794155  0.4121185 -0.8414710
attr(,"gradient")
          [,1]      [,2]       [,3]      [,4]
[1,] 0.9601703 0.0000000  0.0000000 0.0000000
[2,] 0.0000000 0.9601703  0.0000000 0.0000000
[3,] 0.0000000 0.0000000 -0.9111303 0.0000000
[4,] 0.0000000 0.0000000  0.0000000 0.5403023
> with gradient (d) log(d+10)
[1] 2.708050 1.098612 2.890372 2.079442
attr(,"gradient")
           [,1]      [,2]       [,3]  [,4]
[1,] 0.06666667 0.0000000 0.00000000 0.000
[2,] 0.00000000 0.3333333 0.00000000 0.000
[3,] 0.00000000 0.0000000 0.05555556 0.000
[4,] 0.00000000 0.0000000 0.00000000 0.125
> 
> rm(d)
> 
> with gradient (a=list(3,list(9,2))) as.vector(a)
[[1]]
[1] 3

[[2]]
[[2]][[1]]
[1] 9

[[2]][[2]]
[1] 2


attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
attr(,"gradient")[[1]][[2]][[1]]
[1] 0

attr(,"gradient")[[1]][[2]][[2]]
[1] 0



attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
attr(,"gradient")[[2]][[1]][[1]]
[1] 0

attr(,"gradient")[[2]][[1]][[2]]
attr(,"gradient")[[2]][[1]][[2]][[1]]
[1] 1

attr(,"gradient")[[2]][[1]][[2]][[2]]
[1] 0



attr(,"gradient")[[2]][[2]]
attr(,"gradient")[[2]][[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]][[2]]
attr(,"gradient")[[2]][[2]][[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]][[2]][[2]]
[1] 1




> with gradient (a=c(3,1,9,2)) as.vector(a)
[1] 3 1 9 2
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> 
> with gradient (a=list(3,2,9)) as.vector(a,"double")
[1] 3 2 9
attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1 0 0

attr(,"gradient")[[2]]
[1] 0 1 0

attr(,"gradient")[[3]]
[1] 0 0 1

> with gradient (a=list(3,2,9)) as.double(a)
[1] 3 2 9
attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1 0 0

attr(,"gradient")[[2]]
[1] 0 1 0

attr(,"gradient")[[3]]
[1] 0 0 1

> with gradient (a=c(3,2,9)) as.vector(a,"list")
[[1]]
[1] 3

[[2]]
[1] 2

[[3]]
[1] 9

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1 0 0

attr(,"gradient")[[2]]
[1] 0 1 0

attr(,"gradient")[[3]]
[1] 0 0 1

> with gradient (a=c(3,2,9)) as.list(a)
[[1]]
[1] 3

[[2]]
[1] 2

[[3]]
[1] 9

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1 0 0

attr(,"gradient")[[2]]
[1] 0 1 0

attr(,"gradient")[[3]]
[1] 0 0 1

> 
> with gradient (a=list(9,0,2)) { a[[2]] <- "x"; as.vector(a,"double") }
[1]  9 NA  2
attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1 0 0

attr(,"gradient")[[2]]
[1] 0 0 0

attr(,"gradient")[[3]]
[1] 0 0 1

Warning message:
In as.vector(a, "double") : NAs introduced by coercion
> 
> a <- c(9,8); class(a)<-"fred"; as.list.fred <- function(x) list(x[2],x[1])
> with gradient (a) as.list(a)
[[1]]
[1] 8

[[2]]
[1] 9

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 0 1

attr(,"gradient")[[2]]
[1] 1 0

> rm(a)
> 
> with gradient (a=c(3,9)) { storage.mode(a) <- "double"; a }
[1] 3 9
attr(,"gradient")
     [,1] [,2]
[1,]    1    0
[2,]    0    1
> with gradient (a=list(3,9)) { storage.mode(a) <- "list"; a }
[[1]]
[1] 3

[[2]]
[1] 9

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 1


> with gradient (a=c(3,9)) { storage.mode(a) <- "list"; a }
[[1]]
[1] 3

[[2]]
[1] 9

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1 0

attr(,"gradient")[[2]]
[1] 0 1

> with gradient (a=list(3,9)) { storage.mode(a) <- "double"; a }
[1] 3 9
attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1 0

attr(,"gradient")[[2]]
[1] 0 1

> with gradient (a=c(3,9)) { storage.mode(a) <- "character"; a }
[1] "3" "9"
> 
> with gradient (a=list(3,list(9,2),9,8)) matrix(a,2,2)
     [,1]   [,2]
[1,] 3      9   
[2,] List,2 8   
attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
attr(,"gradient")[[1]][[2]][[1]]
[1] 0

attr(,"gradient")[[1]][[2]][[2]]
[1] 0


attr(,"gradient")[[1]][[3]]
[1] 0

attr(,"gradient")[[1]][[4]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
attr(,"gradient")[[2]][[1]][[1]]
[1] 0

attr(,"gradient")[[2]][[1]][[2]]
attr(,"gradient")[[2]][[1]][[2]][[1]]
[1] 1

attr(,"gradient")[[2]][[1]][[2]][[2]]
[1] 0


attr(,"gradient")[[2]][[1]][[3]]
[1] 0

attr(,"gradient")[[2]][[1]][[4]]
[1] 0


attr(,"gradient")[[2]][[2]]
attr(,"gradient")[[2]][[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]][[2]]
attr(,"gradient")[[2]][[2]][[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]][[2]][[2]]
[1] 1


attr(,"gradient")[[2]][[2]][[3]]
[1] 0

attr(,"gradient")[[2]][[2]][[4]]
[1] 0



attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]]
attr(,"gradient")[[3]][[2]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]][[2]]
[1] 0


attr(,"gradient")[[3]][[3]]
[1] 1

attr(,"gradient")[[3]][[4]]
[1] 0


attr(,"gradient")[[4]]
attr(,"gradient")[[4]][[1]]
[1] 0

attr(,"gradient")[[4]][[2]]
attr(,"gradient")[[4]][[2]][[1]]
[1] 0

attr(,"gradient")[[4]][[2]][[2]]
[1] 0


attr(,"gradient")[[4]][[3]]
[1] 0

attr(,"gradient")[[4]][[4]]
[1] 1


> with gradient (a=list(3,8)) matrix(a,2,2)
     [,1] [,2]
[1,] 3    3   
[2,] 8    8   
attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
[1] 1

attr(,"gradient")[[1]][[4]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 1

attr(,"gradient")[[2]][[3]]
[1] 0

attr(,"gradient")[[2]][[4]]
[1] 1


> with gradient (a=c(3,1,9,2)) matrix(a,2,2)
     [,1] [,2]
[1,]    3    9
[2,]    1    2
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0
[3,]    0    0    1    0
[4,]    0    0    0    1
> with gradient (a=12) matrix(a,2,2)
     [,1] [,2]
[1,]   12   12
[2,]   12   12
attr(,"gradient")
[1] 1 1 1 1
> with gradient (a=c(12,10)) matrix(a,3,2)
     [,1] [,2]
[1,]   12   10
[2,]   10   12
[3,]   12   10
attr(,"gradient")
     [,1] [,2]
[1,]    1    0
[2,]    0    1
[3,]    1    0
[4,]    0    1
[5,]    1    0
[6,]    0    1
> with gradient (a=12) { M <- matrix(a,2,2); M[1,2] }
[1] 12
attr(,"gradient")
[1] 1
> 
> with gradient (a=list(3,list(9,2),9,8)) matrix(a,2,2,byrow=TRUE)
     [,1] [,2]  
[1,] 3    List,2
[2,] 9    8     
attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
attr(,"gradient")[[1]][[3]][[1]]
[1] 0

attr(,"gradient")[[1]][[3]][[2]]
[1] 0


attr(,"gradient")[[1]][[4]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
attr(,"gradient")[[2]][[1]][[1]]
[1] 0

attr(,"gradient")[[2]][[1]][[2]]
[1] 0

attr(,"gradient")[[2]][[1]][[3]]
attr(,"gradient")[[2]][[1]][[3]][[1]]
[1] 1

attr(,"gradient")[[2]][[1]][[3]][[2]]
[1] 0


attr(,"gradient")[[2]][[1]][[4]]
[1] 0


attr(,"gradient")[[2]][[2]]
attr(,"gradient")[[2]][[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]][[2]]
[1] 0

attr(,"gradient")[[2]][[2]][[3]]
attr(,"gradient")[[2]][[2]][[3]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]][[3]][[2]]
[1] 1


attr(,"gradient")[[2]][[2]][[4]]
[1] 0



attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]]
[1] 1

attr(,"gradient")[[3]][[3]]
attr(,"gradient")[[3]][[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[3]][[2]]
[1] 0


attr(,"gradient")[[3]][[4]]
[1] 0


attr(,"gradient")[[4]]
attr(,"gradient")[[4]][[1]]
[1] 0

attr(,"gradient")[[4]][[2]]
[1] 0

attr(,"gradient")[[4]][[3]]
attr(,"gradient")[[4]][[3]][[1]]
[1] 0

attr(,"gradient")[[4]][[3]][[2]]
[1] 0


attr(,"gradient")[[4]][[4]]
[1] 1


> with gradient (a=list(3,8)) matrix(a,2,2,byrow=TRUE)
     [,1] [,2]
[1,] 3    8   
[2,] 3    8   
attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 1

attr(,"gradient")[[1]][[3]]
[1] 0

attr(,"gradient")[[1]][[4]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 0

attr(,"gradient")[[2]][[3]]
[1] 1

attr(,"gradient")[[2]][[4]]
[1] 1


> with gradient (a=c(3,1,9,2)) matrix(a,2,2,byrow=TRUE)
     [,1] [,2]
[1,]    3    1
[2,]    9    2
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    0    1    0
[3,]    0    1    0    0
[4,]    0    0    0    1
> with gradient (a=12) matrix(a,2,2,byrow=TRUE)
     [,1] [,2]
[1,]   12   12
[2,]   12   12
attr(,"gradient")
[1] 1 1 1 1
> with gradient (a=c(12,10)) matrix(a,3,2,byrow=TRUE)
     [,1] [,2]
[1,]   12   10
[2,]   12   10
[3,]   12   10
attr(,"gradient")
     [,1] [,2]
[1,]    1    0
[2,]    1    0
[3,]    1    0
[4,]    0    1
[5,]    0    1
[6,]    0    1
> with gradient (a=12) { M <- matrix(a,2,2,byrow=TRUE); M[1,2] }
[1] 12
attr(,"gradient")
[1] 1
> 
> with gradient (a=list(3,list(9,2),9,8)) array(a,c(2,2))
     [,1]   [,2]
[1,] 3      9   
[2,] List,2 8   
attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
attr(,"gradient")[[1]][[2]][[1]]
[1] 0

attr(,"gradient")[[1]][[2]][[2]]
[1] 0


attr(,"gradient")[[1]][[3]]
[1] 0

attr(,"gradient")[[1]][[4]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
attr(,"gradient")[[2]][[1]][[1]]
[1] 0

attr(,"gradient")[[2]][[1]][[2]]
attr(,"gradient")[[2]][[1]][[2]][[1]]
[1] 1

attr(,"gradient")[[2]][[1]][[2]][[2]]
[1] 0


attr(,"gradient")[[2]][[1]][[3]]
[1] 0

attr(,"gradient")[[2]][[1]][[4]]
[1] 0


attr(,"gradient")[[2]][[2]]
attr(,"gradient")[[2]][[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]][[2]]
attr(,"gradient")[[2]][[2]][[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]][[2]][[2]]
[1] 1


attr(,"gradient")[[2]][[2]][[3]]
[1] 0

attr(,"gradient")[[2]][[2]][[4]]
[1] 0



attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]]
attr(,"gradient")[[3]][[2]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]][[2]]
[1] 0


attr(,"gradient")[[3]][[3]]
[1] 1

attr(,"gradient")[[3]][[4]]
[1] 0


attr(,"gradient")[[4]]
attr(,"gradient")[[4]][[1]]
[1] 0

attr(,"gradient")[[4]][[2]]
attr(,"gradient")[[4]][[2]][[1]]
[1] 0

attr(,"gradient")[[4]][[2]][[2]]
[1] 0


attr(,"gradient")[[4]][[3]]
[1] 0

attr(,"gradient")[[4]][[4]]
[1] 1


> with gradient (a=list(3,8)) array(a,c(2,2))
     [,1] [,2]
[1,] 3    3   
[2,] 8    8   
attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
[1] 1

attr(,"gradient")[[1]][[4]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 1

attr(,"gradient")[[2]][[3]]
[1] 0

attr(,"gradient")[[2]][[4]]
[1] 1


> with gradient (a=c(3,1,9,2,8,1,0,3,9,8,7,6)) array(a,c(2,3,2))
, , 1

     [,1] [,2] [,3]
[1,]    3    9    8
[2,]    1    2    1

, , 2

     [,1] [,2] [,3]
[1,]    0    9    7
[2,]    3    8    6

attr(,"gradient")
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12]
 [1,]    1    0    0    0    0    0    0    0    0     0     0     0
 [2,]    0    1    0    0    0    0    0    0    0     0     0     0
 [3,]    0    0    1    0    0    0    0    0    0     0     0     0
 [4,]    0    0    0    1    0    0    0    0    0     0     0     0
 [5,]    0    0    0    0    1    0    0    0    0     0     0     0
 [6,]    0    0    0    0    0    1    0    0    0     0     0     0
 [7,]    0    0    0    0    0    0    1    0    0     0     0     0
 [8,]    0    0    0    0    0    0    0    1    0     0     0     0
 [9,]    0    0    0    0    0    0    0    0    1     0     0     0
[10,]    0    0    0    0    0    0    0    0    0     1     0     0
[11,]    0    0    0    0    0    0    0    0    0     0     1     0
[12,]    0    0    0    0    0    0    0    0    0     0     0     1
> with gradient (a=12) array(a,c(2,2,2))
, , 1

     [,1] [,2]
[1,]   12   12
[2,]   12   12

, , 2

     [,1] [,2]
[1,]   12   12
[2,]   12   12

attr(,"gradient")
[1] 1 1 1 1 1 1 1 1
> 
> with gradient (a = list(3,9)) { for (v in a) print(gradient_of(v)); a }
[[1]]
[1] 1

[[2]]
[1] 0

[[1]]
[1] 0

[[2]]
[1] 1

[[1]]
[1] 3

[[2]]
[1] 9

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 1


> with gradient (a = c(3,1,9)) { for (v in a^2) print(gradient_of(v)); a }
[1] 6 0 0
[1] 0 2 0
[1]  0  0 18
[1] 3 1 9
attr(,"gradient")
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1
> 
> with gradient (a=list(99,33,11)) { length(a) <- 2; a }
[[1]]
[1] 99

[[2]]
[1] 33

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 1


attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]]
[1] 0


> with gradient (a=list(99,33,11)) { length(a) <- 3; a }
[[1]]
[1] 99

[[2]]
[1] 33

[[3]]
[1] 11

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 1

attr(,"gradient")[[2]][[3]]
[1] 0


attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]]
[1] 0

attr(,"gradient")[[3]][[3]]
[1] 1


> with gradient (a=list(99,33,11)) { length(a) <- 4; a }
[[1]]
[1] 99

[[2]]
[1] 33

[[3]]
[1] 11

[[4]]
NULL

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
[1] 0

attr(,"gradient")[[1]][[4]]
NULL


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 1

attr(,"gradient")[[2]][[3]]
[1] 0

attr(,"gradient")[[2]][[4]]
NULL


attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]]
[1] 0

attr(,"gradient")[[3]][[3]]
[1] 1

attr(,"gradient")[[3]][[4]]
NULL


> 
> with gradient (a=c(99,33,11)) { length(a) <- 2; a }
[1] 99 33
attr(,"gradient")
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
> with gradient (a=c(99,33,11)) { length(a) <- 3; a }
[1] 99 33 11
attr(,"gradient")
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1
> with gradient (a=c(99,33,11)) { length(a) <- 4; a }
[1] 99 33 11 NA
attr(,"gradient")
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1
[4,]    0    0    0
> 
> with gradient (a=c(3,5)) rep_len(c(a[2]^2,a[1]^3),length.out=7)
[1] 25 27 25 27 25 27 25
attr(,"gradient")
     [,1] [,2]
[1,]    0   10
[2,]   27    0
[3,]    0   10
[4,]   27    0
[5,]    0   10
[6,]   27    0
[7,]    0   10
> with gradient (a=list(3,5)) rep_len(a,5)
[[1]]
[1] 3

[[2]]
[1] 5

[[3]]
[1] 3

[[4]]
[1] 5

[[5]]
[1] 3

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
[1] 1

attr(,"gradient")[[1]][[4]]
[1] 0

attr(,"gradient")[[1]][[5]]
[1] 1


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 1

attr(,"gradient")[[2]][[3]]
[1] 0

attr(,"gradient")[[2]][[4]]
[1] 1

attr(,"gradient")[[2]][[5]]
[1] 0


> 
> with gradient (a=c(3,5)) rep.int(c(a[2]^2,a[1]^3),c(2,3))
[1] 25 25 27 27 27
attr(,"gradient")
     [,1] [,2]
[1,]    0   10
[2,]    0   10
[3,]   27    0
[4,]   27    0
[5,]   27    0
> with gradient (a=c(3,5)) rep.int(c(a[2]^2,a[1]^3),2)
[1] 25 27 25 27
attr(,"gradient")
     [,1] [,2]
[1,]    0   10
[2,]   27    0
[3,]    0   10
[4,]   27    0
> with gradient (a=list(3,5)) rep.int(a,c(2,3))
[[1]]
[1] 3

[[2]]
[1] 3

[[3]]
[1] 5

[[4]]
[1] 5

[[5]]
[1] 5

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 1

attr(,"gradient")[[1]][[3]]
[1] 0

attr(,"gradient")[[1]][[4]]
[1] 0

attr(,"gradient")[[1]][[5]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 0

attr(,"gradient")[[2]][[3]]
[1] 1

attr(,"gradient")[[2]][[4]]
[1] 1

attr(,"gradient")[[2]][[5]]
[1] 1


> with gradient (a=list(3,5)) rep.int(a,2)
[[1]]
[1] 3

[[2]]
[1] 5

[[3]]
[1] 3

[[4]]
[1] 5

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
[1] 1

attr(,"gradient")[[1]][[4]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 1

attr(,"gradient")[[2]][[3]]
[1] 0

attr(,"gradient")[[2]][[4]]
[1] 1


> 
> with gradient (a=c(3,5)) rep(c(a[2]^2,a[1]^3),length.out=7)
[1] 25 27 25 27 25 27 25
attr(,"gradient")
     [,1] [,2]
[1,]    0   10
[2,]   27    0
[3,]    0   10
[4,]   27    0
[5,]    0   10
[6,]   27    0
[7,]    0   10
> with gradient (a=c(3,5)) rep(c(a[2]^2,a[1]^3),times=4)
[1] 25 27 25 27 25 27 25 27
attr(,"gradient")
     [,1] [,2]
[1,]    0   10
[2,]   27    0
[3,]    0   10
[4,]   27    0
[5,]    0   10
[6,]   27    0
[7,]    0   10
[8,]   27    0
> with gradient (a=c(3,5)) rep(c(a[2]^2,a[1]^3),times=c(2,3))
[1] 25 25 27 27 27
attr(,"gradient")
     [,1] [,2]
[1,]    0   10
[2,]    0   10
[3,]   27    0
[4,]   27    0
[5,]   27    0
> with gradient (a=list(3,5)) rep(c(a[[2]]^2,a[[1]]^3),times=c(2,3))
[1] 25 25 27 27 27
attr(,"gradient")
attr(,"gradient")[[1]]
[1]  0  0 27 27 27

attr(,"gradient")[[2]]
[1] 10 10  0  0  0

> with gradient (a=list(3,5)) rep(list(a[[2]]^2,a[[1]]^3),times=2)
[[1]]
[1] 25

[[2]]
[1] 27

[[3]]
[1] 25

[[4]]
[1] 27

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 0

attr(,"gradient")[[1]][[2]]
[1] 27

attr(,"gradient")[[1]][[3]]
[1] 0

attr(,"gradient")[[1]][[4]]
[1] 27


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 10

attr(,"gradient")[[2]][[2]]
[1] 0

attr(,"gradient")[[2]][[3]]
[1] 10

attr(,"gradient")[[2]][[4]]
[1] 0


> with gradient (a=list(3,5)) rep(list(a[[2]]^2,a[[1]]^3),times=c(2,3))
[[1]]
[1] 25

[[2]]
[1] 25

[[3]]
[1] 27

[[4]]
[1] 27

[[5]]
[1] 27

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 0

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
[1] 27

attr(,"gradient")[[1]][[4]]
[1] 27

attr(,"gradient")[[1]][[5]]
[1] 27


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 10

attr(,"gradient")[[2]][[2]]
[1] 10

attr(,"gradient")[[2]][[3]]
[1] 0

attr(,"gradient")[[2]][[4]]
[1] 0

attr(,"gradient")[[2]][[5]]
[1] 0


> 
> rep.fred <- function (x, times) x*times
> a <- c(9,10); class(a) <- "fred"
> with gradient (a) rep(a,100)
[1]  900 1000
attr(,"class")
[1] "fred"
attr(,"gradient")
     [,1] [,2]
[1,]  100    0
[2,]    0  100
> rm(a)
> 
> with gradient (a=list(3,5),b=c(9,8),x=2) cbind(a,b,x)
     a b x
[1,] 3 9 2
[2,] 5 8 2
attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
attr(,"gradient")$a[[1]][[1]]
[1] 1

attr(,"gradient")$a[[1]][[2]]
[1] 0

attr(,"gradient")$a[[1]][[3]]
[1] 0

attr(,"gradient")$a[[1]][[4]]
[1] 0

attr(,"gradient")$a[[1]][[5]]
[1] 0

attr(,"gradient")$a[[1]][[6]]
[1] 0


attr(,"gradient")$a[[2]]
attr(,"gradient")$a[[2]][[1]]
[1] 0

attr(,"gradient")$a[[2]][[2]]
[1] 1

attr(,"gradient")$a[[2]][[3]]
[1] 0

attr(,"gradient")$a[[2]][[4]]
[1] 0

attr(,"gradient")$a[[2]][[5]]
[1] 0

attr(,"gradient")$a[[2]][[6]]
[1] 0



attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 0 0

attr(,"gradient")$b[[2]]
[1] 0 0

attr(,"gradient")$b[[3]]
[1] 1 0

attr(,"gradient")$b[[4]]
[1] 0 1

attr(,"gradient")$b[[5]]
[1] 0 0

attr(,"gradient")$b[[6]]
[1] 0 0


attr(,"gradient")$x
attr(,"gradient")$x[[1]]
[1] 0

attr(,"gradient")$x[[2]]
[1] 0

attr(,"gradient")$x[[3]]
[1] 0

attr(,"gradient")$x[[4]]
[1] 0

attr(,"gradient")$x[[5]]
[1] 1

attr(,"gradient")$x[[6]]
[1] 1


> with gradient (a=c(3,5),b=c(9,8),x=2) cbind(a,b,x,a^2)
     a b x   
[1,] 3 9 2  9
[2,] 5 8 2 25
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2]
[1,]    1    0
[2,]    0    1
[3,]    0    0
[4,]    0    0
[5,]    0    0
[6,]    0    0
[7,]    6    0
[8,]    0   10

attr(,"gradient")$b
     [,1] [,2]
[1,]    0    0
[2,]    0    0
[3,]    1    0
[4,]    0    1
[5,]    0    0
[6,]    0    0
[7,]    0    0
[8,]    0    0

attr(,"gradient")$x
[1] 0 0 0 0 1 1 0 0

> 
> with gradient (a=list(3,5),b=c(9,8),x=2) rbind(a,b,x)
  [,1] [,2]
a 3    5   
b 9    8   
x 2    2   
attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
attr(,"gradient")$a[[1]][[1]]
[1] 1

attr(,"gradient")$a[[1]][[2]]
[1] 0

attr(,"gradient")$a[[1]][[3]]
[1] 0

attr(,"gradient")$a[[1]][[4]]
[1] 0

attr(,"gradient")$a[[1]][[5]]
[1] 0

attr(,"gradient")$a[[1]][[6]]
[1] 0


attr(,"gradient")$a[[2]]
attr(,"gradient")$a[[2]][[1]]
[1] 0

attr(,"gradient")$a[[2]][[2]]
[1] 0

attr(,"gradient")$a[[2]][[3]]
[1] 0

attr(,"gradient")$a[[2]][[4]]
[1] 1

attr(,"gradient")$a[[2]][[5]]
[1] 0

attr(,"gradient")$a[[2]][[6]]
[1] 0



attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 0 0

attr(,"gradient")$b[[2]]
[1] 1 0

attr(,"gradient")$b[[3]]
[1] 0 0

attr(,"gradient")$b[[4]]
[1] 0 0

attr(,"gradient")$b[[5]]
[1] 0 1

attr(,"gradient")$b[[6]]
[1] 0 0


attr(,"gradient")$x
attr(,"gradient")$x[[1]]
[1] 0

attr(,"gradient")$x[[2]]
[1] 0

attr(,"gradient")$x[[3]]
[1] 1

attr(,"gradient")$x[[4]]
[1] 0

attr(,"gradient")$x[[5]]
[1] 0

attr(,"gradient")$x[[6]]
[1] 1


> with gradient (a=c(3,5),b=c(9,8),x=2) rbind(a,b,x,a^2)
  [,1] [,2]
a    3    5
b    9    8
x    2    2
     9   25
attr(,"gradient")
attr(,"gradient")$a
     [,1] [,2]
[1,]    1    0
[2,]    0    0
[3,]    0    0
[4,]    6    0
[5,]    0    1
[6,]    0    0
[7,]    0    0
[8,]    0   10

attr(,"gradient")$b
     [,1] [,2]
[1,]    0    0
[2,]    1    0
[3,]    0    0
[4,]    0    0
[5,]    0    0
[6,]    0    1
[7,]    0    0
[8,]    0    0

attr(,"gradient")$x
[1] 0 0 1 0 0 0 1 0

> 
> with gradient (a=9) { b <- a^2; get_rm(b) }
[1] 81
attr(,"gradient")
[1] 18
> with gradient (a=9) structure(a^2,fred=9999)
[1] 81
attr(,"fred")
[1] 9999
attr(,"gradient")
[1] 18
> 
> with gradient (a=c(8,9,7)) unlist(a)
[1] 8 9 7
attr(,"gradient")
     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1
> with gradient (a=list(8,x=9,7)) unlist(a)
  x   
8 9 7 
attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1 0 0

attr(,"gradient")$x
[1] 0 1 0

attr(,"gradient")[[3]]
[1] 0 0 1

> with gradient (a=list(8,x=9,7),b=12) { a[2] <- b^2; unlist(a) }
      x     
  8 144   7 
attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 1 0 0

attr(,"gradient")$a$x
[1] 0 0 0

attr(,"gradient")$a[[3]]
[1] 0 0 1


attr(,"gradient")$b
[1]  0 24  0

> with gradient (a=list(8,list(9,7))) unlist(a)
[1] 8 9 7
attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1 0 0

attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0 1 0

attr(,"gradient")[[2]][[2]]
[1] 0 0 1


> with gradient (a=list(8,list(9,7))) unlist(a,recursive=FALSE)
[[1]]
[1] 8

[[2]]
[1] 9

[[3]]
[1] 7

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
attr(,"gradient")[[2]][[1]][[1]]
[1] 0

attr(,"gradient")[[2]][[1]][[2]]
[1] 1

attr(,"gradient")[[2]][[1]][[3]]
[1] 0


attr(,"gradient")[[2]][[2]]
attr(,"gradient")[[2]][[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]][[2]]
[1] 0

attr(,"gradient")[[2]][[2]][[3]]
[1] 1



> 
> with gradient (a=c(3,8)) c(a,a^2)
[1]  3  8  9 64
attr(,"gradient")
     [,1] [,2]
[1,]    1    0
[2,]    0    1
[3,]    6    0
[4,]    0   16
> with gradient (a=list(3,8)) c(a,a[[2]]^2,a)
[[1]]
[1] 3

[[2]]
[1] 8

[[3]]
[1] 64

[[4]]
[1] 3

[[5]]
[1] 8

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0

attr(,"gradient")[[1]][[3]]
[1] 0

attr(,"gradient")[[1]][[4]]
[1] 1

attr(,"gradient")[[1]][[5]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 1

attr(,"gradient")[[2]][[3]]
[1] 16

attr(,"gradient")[[2]][[4]]
[1] 0

attr(,"gradient")[[2]][[5]]
[1] 1


> with gradient (a=list(3,list(8,7))) c(a,a[[1]]^2)
[[1]]
[1] 3

[[2]]
[[2]][[1]]
[1] 8

[[2]][[2]]
[1] 7


[[3]]
[1] 9

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
attr(,"gradient")[[1]][[2]][[1]]
[1] 0

attr(,"gradient")[[1]][[2]][[2]]
[1] 0


attr(,"gradient")[[1]][[3]]
[1] 6


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
attr(,"gradient")[[2]][[1]][[1]]
[1] 0

attr(,"gradient")[[2]][[1]][[2]]
attr(,"gradient")[[2]][[1]][[2]][[1]]
[1] 1

attr(,"gradient")[[2]][[1]][[2]][[2]]
[1] 0


attr(,"gradient")[[2]][[1]][[3]]
[1] 0


attr(,"gradient")[[2]][[2]]
attr(,"gradient")[[2]][[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]][[2]]
attr(,"gradient")[[2]][[2]][[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]][[2]][[2]]
[1] 1


attr(,"gradient")[[2]][[2]][[3]]
[1] 0



> with gradient (a=list(3,list(8,7))) c(a,a[[1]]^2,recursive=TRUE)
[1] 3 8 7 9
attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1 0 0 6

attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0 1 0 0

attr(,"gradient")[[2]][[2]]
[1] 0 0 1 0


> 
> with gradient (a=matrix(c(9,1,4,2),2,2)) apply(a,1,sqrt)
     [,1]     [,2]
[1,]    3 1.000000
[2,]    2 1.414214
attr(,"gradient")
          [,1] [,2] [,3]      [,4]
[1,] 0.1666667  0.0 0.00 0.0000000
[2,] 0.0000000  0.0 0.25 0.0000000
[3,] 0.0000000  0.5 0.00 0.0000000
[4,] 0.0000000  0.0 0.00 0.3535534
> with gradient (a=matrix(c(9,1,4,2),2,2)) apply(a,1,function(x)10*x[1]+x[2])
[1] 94 12
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]   10    0    1    0
[2,]    0   10    0    1
> with gradient (a=matrix(c(9,1,4,2),2,2)) apply(a,2,function(x)list(x,2*x))
[[1]]
[[1]][[1]]
[1] 9 1

[[1]][[2]]
[1] 18  2


[[2]]
[[2]][[1]]
[1] 4 2

[[2]][[2]]
[1] 8 4


attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    0    1    0    0

attr(,"gradient")[[1]][[2]]
     [,1] [,2] [,3] [,4]
[1,]    2    0    0    0
[2,]    0    2    0    0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
     [,1] [,2] [,3] [,4]
[1,]    0    0    1    0
[2,]    0    0    0    1

attr(,"gradient")[[2]][[2]]
     [,1] [,2] [,3] [,4]
[1,]    0    0    2    0
[2,]    0    0    0    2


> 
> with gradient (a=c(36,1,25)) lapply(a,sqrt)
[[1]]
[1] 6

[[2]]
[1] 1

[[3]]
[1] 5

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 0.08333333 0.00000000 0.00000000

attr(,"gradient")[[2]]
[1] 0.0 0.5 0.0

attr(,"gradient")[[3]]
[1] 0.0 0.0 0.1

> with gradient (a=list(36,1,25)) lapply(a,function(x)c(x,sqrt(x)))
[[1]]
[1] 36  6

[[2]]
[1] 1 1

[[3]]
[1] 25  5

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1.00000000 0.08333333

attr(,"gradient")[[1]][[2]]
[1] 0 0

attr(,"gradient")[[1]][[3]]
[1] 0 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0 0

attr(,"gradient")[[2]][[2]]
[1] 1.0 0.5

attr(,"gradient")[[2]][[3]]
[1] 0 0


attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0 0

attr(,"gradient")[[3]][[2]]
[1] 0 0

attr(,"gradient")[[3]][[3]]
[1] 1.0 0.1


> with gradient (a=5) lapply(list(10,100),function(x)x*a)
[[1]]
[1] 50

[[2]]
[1] 500

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 10

attr(,"gradient")[[2]]
[1] 100

> 
> with gradient (a=c(36,1,25)) vapply(a,sqrt,numeric(1))
[1] 6 1 5
attr(,"gradient")
           [,1] [,2] [,3]
[1,] 0.08333333  0.0  0.0
[2,] 0.00000000  0.5  0.0
[3,] 0.00000000  0.0  0.1
> with gradient (a=c(36,1,25)) vapply(a,function(x)c(x,sqrt(x)),c(0,0))
     [,1] [,2] [,3]
[1,]   36    1   25
[2,]    6    1    5
attr(,"gradient")
           [,1] [,2] [,3]
[1,] 1.00000000  0.0  0.0
[2,] 0.08333333  0.0  0.0
[3,] 0.00000000  1.0  0.0
[4,] 0.00000000  0.5  0.0
[5,] 0.00000000  0.0  1.0
[6,] 0.00000000  0.0  0.1
> with gradient (a=list(36,1,25)) vapply(a,function(x)list(x,sqrt(x)),list(0,0))
     [,1] [,2] [,3]
[1,] 36   1    25  
[2,] 6    1    5   
attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] 1

attr(,"gradient")[[1]][[2]]
[1] 0.08333333

attr(,"gradient")[[1]][[3]]
[1] 0

attr(,"gradient")[[1]][[4]]
[1] 0

attr(,"gradient")[[1]][[5]]
[1] 0

attr(,"gradient")[[1]][[6]]
[1] 0


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 0

attr(,"gradient")[[2]][[2]]
[1] 0

attr(,"gradient")[[2]][[3]]
[1] 1

attr(,"gradient")[[2]][[4]]
[1] 0.5

attr(,"gradient")[[2]][[5]]
[1] 0

attr(,"gradient")[[2]][[6]]
[1] 0


attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]]
[1] 0

attr(,"gradient")[[3]][[3]]
[1] 0

attr(,"gradient")[[3]][[4]]
[1] 0

attr(,"gradient")[[3]][[5]]
[1] 1

attr(,"gradient")[[3]][[6]]
[1] 0.1


> 
> with gradient (a=c(36,1,25)) sapply(a,sqrt)
[1] 6 1 5
attr(,"gradient")
           [,1] [,2] [,3]
[1,] 0.08333333  0.0  0.0
[2,] 0.00000000  0.5  0.0
[3,] 0.00000000  0.0  0.1
> with gradient (a=list(36,1,25)) sapply(a,function(x)c(x,sqrt(x)))
     [,1] [,2] [,3]
[1,]   36    1   25
[2,]    6    1    5
attr(,"gradient")
attr(,"gradient")[[1]]
[1] 1.00000000 0.08333333 0.00000000 0.00000000 0.00000000 0.00000000

attr(,"gradient")[[2]]
[1] 0.0 0.0 1.0 0.5 0.0 0.0

attr(,"gradient")[[3]]
[1] 0.0 0.0 0.0 0.0 1.0 0.1

> 
> set.seed(1); with gradient (a=2) replicate(10,runif(1,-a,a))
 [1] -0.9379653 -0.5115044  0.2914135  1.6328312 -1.1932723  1.5935587
 [7]  1.7787011  0.6431912  0.5164562 -1.7528549
attr(,"gradient")
 [1] -0.4689827 -0.2557522  0.1457067  0.8164156 -0.5966361  0.7967794
 [7]  0.8893505  0.3215956  0.2582281 -0.8764275
> 
> a <- c(4,9)
> class(a) <- "fred"
> with gradient (a) unclass(a)^2
[1] 16 81
attr(,"gradient")
     [,1] [,2]
[1,]    8    0
[2,]    0   18
> rm(a)
> 
> with gradient (a=c(9,7)) a^2+a[2]^3
[1] 424 392
attr(,"gradient")
     [,1] [,2]
[1,]   18  147
[2,]    0  161
> with gradient (a=c(9,7)) a[1]^2+a^3
[1] 810 424
attr(,"gradient")
     [,1] [,2]
[1,]  261    0
[2,]   18  147
> 
> a <- c(3,1,7,4)
> b <- a+0.1
> with gradient (a) sin(a+0.1)
[1]  0.04158066  0.89120736  0.72896904 -0.81827711
attr(,"gradient")
           [,1]      [,2]      [,3]       [,4]
[1,] -0.9991352 0.0000000 0.0000000  0.0000000
[2,]  0.0000000 0.4535961 0.0000000  0.0000000
[3,]  0.0000000 0.0000000 0.6845467  0.0000000
[4,]  0.0000000 0.0000000 0.0000000 -0.5748239
> with gradient (b) sin(b)
[1]  0.04158066  0.89120736  0.72896904 -0.81827711
attr(,"gradient")
           [,1]      [,2]      [,3]       [,4]
[1,] -0.9991352 0.0000000 0.0000000  0.0000000
[2,]  0.0000000 0.4535961 0.0000000  0.0000000
[3,]  0.0000000 0.0000000 0.6845467  0.0000000
[4,]  0.0000000 0.0000000 0.0000000 -0.5748239
> 
> 
> # Test backpropagation.
> 
> with gradient (a=5) 
+   with gradient (d=a^2) sin(d)
[1] -0.1323518
attr(,"gradient")
[1] 9.912028
> 
> with gradient (a=5,b=7) 
+   with gradient (d=a^2+b,e=a*b) sin(d)+sqrt(e)
[1] 6.467506
attr(,"gradient")
attr(,"gradient")$a
[1] 8.933842

attr(,"gradient")$b
[1] 1.2568

> 
> with gradient (a=5,b=7) 
+   with gradient (d=a^2+b,e=a*b) list(sin(d)+sqrt(e),55)
[[1]]
[1] 6.467506

[[2]]
[1] 55

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 8.933842

attr(,"gradient")$a[[2]]
[1] 0


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 1.2568

attr(,"gradient")$b[[2]]
[1] 0


> 
> with gradient (L=list(a=5,b=7))
+   with gradient (d=L$a^2+L$b,e=L$a*L$b) sin(d)+sqrt(e)
[1] 6.467506
attr(,"gradient")
attr(,"gradient")$a
[1] 8.933842

attr(,"gradient")$b
[1] 1.2568

> 
> with gradient (a=5,b=7)
+   with gradient (M=list(d=a^2+b,e=a*b)) sin(M$d)+sqrt(M$e)
[1] 6.467506
attr(,"gradient")
attr(,"gradient")$a
[1] 8.933842

attr(,"gradient")$b
[1] 1.2568

> 
> with gradient (a=5,b=7)
+   with gradient (M=list(d=a^2+b,e=a*b)) list(sin(M$d)+sqrt(M$e),55)
[[1]]
[1] 6.467506

[[2]]
[1] 55

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 8.933842

attr(,"gradient")$a[[2]]
[1] 0


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 1.2568

attr(,"gradient")$b[[2]]
[1] 0


> 
> with gradient (L=list(a=5,b=7))
+   with gradient (M=list(d=L$a^2+L$b,e=L$a*L$b)) sin(M$d)+sqrt(M$e)
[1] 6.467506
attr(,"gradient")
attr(,"gradient")$a
[1] 8.933842

attr(,"gradient")$b
[1] 1.2568

> 
> with gradient (L=list(a=5,b=7))
+   with gradient (d=L$a^2+L$b,e=L$a*L$b) list(sin(d)+sqrt(e),55)
[[1]]
[1] 6.467506

[[2]]
[1] 55

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 8.933842

attr(,"gradient")$a[[2]]
[1] 0


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 1.2568

attr(,"gradient")$b[[2]]
[1] 0


> 
> with gradient (L=list(a=5,b=7))
+   with gradient (M=list(d=L$a^2+L$b,e=L$a*L$b)) list(sin(M$d)+sqrt(M$e),55)
[[1]]
[1] 6.467506

[[2]]
[1] 55

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 8.933842

attr(,"gradient")$a[[2]]
[1] 0


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 1.2568

attr(,"gradient")$b[[2]]
[1] 0


> 
> with gradient (L=list(a=5,b=7))
+   track gradient (M=list(d=L$a^2+L$b,e=L$a*L$b)) list(sin(M$d)+sqrt(M$e),55)
[[1]]
[1] 6.467506

[[2]]
[1] 55

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 8.933842

attr(,"gradient")$a[[2]]
[1] 0


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 1.2568

attr(,"gradient")$b[[2]]
[1] 0


> 
> with gradient (L=list(a=5,b=7))
+   back gradient (M=list(d=L$a^2+L$b,e=L$a*L$b)) list(sin(M$d)+sqrt(M$e),55)
[[1]]
[1] 6.467506

[[2]]
[1] 55

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
[1] 8.933842

attr(,"gradient")$a[[2]]
[1] 0


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
[1] 1.2568

attr(,"gradient")$b[[2]]
[1] 0


> 
> with gradient (L=c(a=5,b=7)) {
+   M <- c(d=0,e=0)
+   M[[1]] <- L[["a"]]^2+L[["b"]]
+   M[[2]] <- L[["a"]]*L[["b"]]
+   back gradient (M) {
+     c <- c(0,55)
+     c[[1]] <- sin(M[["d"]])+sqrt(M[["e"]])
+     c
+   }
+ }
[1]  6.467506 55.000000
attr(,"gradient")
         [,1]   [,2]
[1,] 8.933842 1.2568
[2,] 0.000000 0.0000
> 
> with gradient (a=list(4.1,2.7,3.1,5.2)) {
+   back gradient (b=list(a[[2]],sin(a[[1]]+a[[4]]),a[[1]]^2)) {
+     c <- list(0,0)
+     c[[1]] <- b[[1]] + 4*b[[2]]
+     c[[2]] <- b[[3]]^2 + b[[2]]
+     c
+   }
+ }
[[1]]
[1] 3.197818

[[2]]
[1] 282.7006

attr(,"gradient")
attr(,"gradient")[[1]]
attr(,"gradient")[[1]][[1]]
[1] -3.968901

attr(,"gradient")[[1]][[2]]
[1] 274.6918


attr(,"gradient")[[2]]
attr(,"gradient")[[2]][[1]]
[1] 1

attr(,"gradient")[[2]][[2]]
[1] 0


attr(,"gradient")[[3]]
attr(,"gradient")[[3]][[1]]
[1] 0

attr(,"gradient")[[3]][[2]]
[1] 0


attr(,"gradient")[[4]]
attr(,"gradient")[[4]][[1]]
[1] -3.968901

attr(,"gradient")[[4]][[2]]
[1] -0.9922253


> 
> with gradient (a=c(4.1,2.7,3.1,5.2)) {
+   b <- numeric(3)
+   b[[1]] <- a[[2]]
+   b[[2]] <- sin(a[[1]]+a[[4]])
+   b[[3]] <- a[[1]]^2
+   back gradient (b) {
+     c <- numeric(2)
+     c[[1]] <- b[[1]] + 4*b[[2]]
+     c[[2]] <- b[[3]]^2 + b[[2]]
+     c
+   }
+ }
[1]   3.197818 282.700554
attr(,"gradient")
           [,1] [,2] [,3]       [,4]
[1,]  -3.968901    1    0 -3.9689013
[2,] 274.691775    0    0 -0.9922253
> 
> 
> # Test duplication when necessary and not when not.
> 
> A <- B <- C <- D <- E <- F <- NULL  # kludge to avoid RPROFMEM messages from
>                                     # expansion of hash table for global env
> 
> pr <- function (...) { 
+   Rprofmemt(NULL)
+   cat(...,"\n")
+   Rprofmemt(nelem=n,bytes=FALSE)
+ }
> 
> prp <- function (x) { 
+   Rprofmemt(NULL)
+   print(x)
+   Rprofmemt(nelem=n,bytes=FALSE)
+ }
> 
> n <- 100
> 
> pr("start")
start 
> track gradient (a=rep(3,n)) {
+   pr("A"); x <- a+2.1
+   pr("B"); x <- a-2.1
+   pr("C"); x <- a*2.1
+   pr("D"); x <- a/2.1
+   pr("E"); x <- a^2.1
+   NULL
+ }
RPROFMEM: (double 100):
A 
RPROFMEM: (double 100):
B 
RPROFMEM: (double 100):
C 
RPROFMEM: (double 100):
D 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
E 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
NULL
> pr("end")
end 
> 
> pr("start")
start 
> track gradient (b=rep(4,n)) {
+   pr("A"); x <- 2.1+b
+   pr("B"); x <- 2.1-b
+   pr("C"); x <- 2.1*b
+   pr("D"); x <- 2.1/b
+   pr("E"); x <- 2.1^b
+   NULL
+ }
RPROFMEM: (double 100):
A 
RPROFMEM: (double 100):
B 
RPROFMEM: (double 100):
C 
RPROFMEM: (double 100):
D 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
E 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
NULL
> pr("end")
end 
> 
> pr("start")
start 
> track gradient (q=7,a=rep(3,n)) {
+   pr("A"); x <- a+q
+   pr("B"); x <- a-q
+   pr("C"); x <- a*q
+   pr("D"); x <- a/q
+   pr("E"); x <- a^q
+   NULL
+ }
RPROFMEM: (double 100):
A 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
B 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
C 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
D 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
E 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
NULL
> pr("end")
end 
> 
> pr("start")
start 
> track gradient (q=7,b=rep(4,n)) {
+   pr("A"); x <- q+b
+   pr("B"); x <- q-b
+   pr("C"); x <- q*b
+   pr("D"); x <- q/b
+   pr("E"); x <- q^b
+   NULL
+ }
RPROFMEM: (double 100):
A 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
B 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
C 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
D 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
E 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
NULL
> pr("end")
end 
> 
> pr("start")
start 
> track gradient (a=rep(3,n),b=rep(4,n)) {
+   pr("A"); x <- a+b
+   pr("B"); x <- a-b
+   pr("C"); x <- a*b
+   pr("D"); x <- a/b
+   pr("E"); x <- a^b
+   NULL
+ }
RPROFMEM: (double 100):
RPROFMEM: (double 100):
A 
RPROFMEM: (double 100):
B 
RPROFMEM: (double 100):
C 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
D 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
E 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
NULL
> pr("end")
end 
> 
> pr("start")
start 
> r <- back gradient (a=rep(3,n)) {
+   pr("A"); b <- a^2.1
+   pr("B"); b[2] <- 7
+   c <- b
+   pr("C"); b[3] <- 8
+   pr("D"); b
+ }
RPROFMEM: (double 100):
A 
RPROFMEM: (double 100):
B 
C 
RPROFMEM: (double 100):
D 
> pr("end")
end 
> r[1..5]; attr(r,"gradient")[1..5,1..5]
[1] 10.04511  7.00000  8.00000 10.04511 10.04511
NULL
> 
> pr("start")
start 
> r <- with gradient (a=rep(3,n)) {
+   pr("A"); b <- a^2.1
+   pr("B"); b[2] <- 7
+   c <- b
+   pr("C"); b[3] <- 8
+   pr("D"); b
+ }
RPROFMEM: (double 100):
A 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
B 
RPROFMEM: (double 200):
C 
RPROFMEM: (double 100):
RPROFMEM: (double 200):
D 
RPROFMEM: (double 10000):
> pr("end")
end 
> r[1..5]; attr(r,"gradient")[1..5,1..5]
[1] 10.04511  7.00000  8.00000 10.04511 10.04511
         [,1] [,2] [,3]     [,4]     [,5]
[1,] 7.031576    0    0 0.000000 0.000000
[2,] 0.000000    0    0 0.000000 0.000000
[3,] 0.000000    0    0 0.000000 0.000000
[4,] 0.000000    0    0 7.031576 0.000000
[5,] 0.000000    0    0 0.000000 7.031576
> 
> pr("start")
start 
> r <- with gradient (a=rep(3,n)) {
+   pr("A"); L <- list(x=2,y=a^2.1)
+   pr("B"); L$y[2] <- 7
+   M <- L
+   pr("C"); L$y[3] <- 8
+   pr("D"); L$x <- a[2]
+   pr("E"); L
+ }
RPROFMEM: (double 100):
A 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 10000):
B 
C 
RPROFMEM: (double 100):
RPROFMEM: (double 10000):
D 
RPROFMEM: (double 100):
E 
> pr("end")
end 
> r$x; r$y[1..5]; attr(r,"gradient")$x[1..5]; attr(r,"gradient")$y[1..5,1..5]
[1] 3
[1] 10.04511  7.00000  8.00000 10.04511 10.04511
[1] 0 1 0 0 0
         [,1] [,2] [,3]     [,4]     [,5]
[1,] 7.031576    0    0 0.000000 0.000000
[2,] 0.000000    0    0 0.000000 0.000000
[3,] 0.000000    0    0 0.000000 0.000000
[4,] 0.000000    0    0 7.031576 0.000000
[5,] 0.000000    0    0 0.000000 7.031576
> 
> pr("start")
start 
> r <- with gradient (a=rep(3,n)) {
+   pr("A"); L <- list(x=2,y=a^2.1)
+   pr("B"); L[[2]][[2]] <- 7
+   M <- L
+   pr("C"); L[[2]][[3]] <- 8
+   pr("D"); L[[1]] <- a[[2]]
+   pr("E"); L
+ }
RPROFMEM: (double 100):
A 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 10000):
B 
C 
RPROFMEM: (double 100):
RPROFMEM: (double 10000):
D 
RPROFMEM: (double 100):
E 
> pr("end")
end 
> r$x; r$y[1..5]; attr(r,"gradient")$x[1..5]; attr(r,"gradient")$y[1..5,1..5]
[1] 3
[1] 10.04511  7.00000  8.00000 10.04511 10.04511
[1] 0 1 0 0 0
         [,1] [,2] [,3]     [,4]     [,5]
[1,] 7.031576    0    0 0.000000 0.000000
[2,] 0.000000    0    0 0.000000 0.000000
[3,] 0.000000    0    0 0.000000 0.000000
[4,] 0.000000    0    0 7.031576 0.000000
[5,] 0.000000    0    0 0.000000 7.031576
> 
> pr("start")
start 
> r <- with gradient (a=rep(3,n)) {
+   pr("A"); L <- c(list(x=2,y=a^2.1),rep(list(NULL),n))
+   pr("B"); L$y[2] <- 7
+   M <- L
+   pr("C"); L$y[3] <- 8
+   pr("D"); L$x <- a[2]
+   pr("E"); L
+ }
RPROFMEM: (double 100):
A 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 10000):
RPROFMEM: (list 100):
RPROFMEM: (list 102):
RPROFMEM: (list 102):
RPROFMEM: (character 102):
B 
C 
RPROFMEM: (list 102):
RPROFMEM: (double 100):
RPROFMEM: (double 10000):
RPROFMEM: (list 102):
D 
RPROFMEM: (double 100):
E 
RPROFMEM: (list 102):
> pr("end")
end 
> r$x; r$y[1..5]; attr(r,"gradient")$x[1..5]; attr(r,"gradient")$y[1..5,1..5]
[1] 3
[1] 10.04511  7.00000  8.00000 10.04511 10.04511
[1] 0 1 0 0 0
         [,1] [,2] [,3]     [,4]     [,5]
[1,] 7.031576    0    0 0.000000 0.000000
[2,] 0.000000    0    0 0.000000 0.000000
[3,] 0.000000    0    0 0.000000 0.000000
[4,] 0.000000    0    0 7.031576 0.000000
[5,] 0.000000    0    0 0.000000 7.031576
> 
> pr("start")
start 
> r <- with gradient (a=rep(3,n)) {
+   pr("A"); L <- c(list(x=2,y=a^2.1),rep(list(NULL),n))
+   pr("B"); L[[2]][[2]] <- 7
+   M <- L
+   pr("C"); L[[2]][[3]] <- 8
+   pr("D"); L[[1]] <- a[[2]]
+   pr("E"); L
+ }
RPROFMEM: (double 100):
A 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 10000):
RPROFMEM: (list 100):
RPROFMEM: (list 102):
RPROFMEM: (list 102):
RPROFMEM: (character 102):
B 
C 
RPROFMEM: (list 102):
RPROFMEM: (double 100):
RPROFMEM: (double 10000):
RPROFMEM: (list 102):
D 
RPROFMEM: (double 100):
E 
RPROFMEM: (list 102):
> pr("end")
end 
> r$x; r$y[1..5]; attr(r,"gradient")$x[1..5]; attr(r,"gradient")$y[1..5,1..5]
[1] 3
[1] 10.04511  7.00000  8.00000 10.04511 10.04511
[1] 0 1 0 0 0
         [,1] [,2] [,3]     [,4]     [,5]
[1,] 7.031576    0    0 0.000000 0.000000
[2,] 0.000000    0    0 0.000000 0.000000
[3,] 0.000000    0    0 0.000000 0.000000
[4,] 0.000000    0    0 7.031576 0.000000
[5,] 0.000000    0    0 0.000000 7.031576
> 
> pr("start")
start 
> r <- with gradient (a=rep(3,n)+(1..n)) {
+   pr("A"); L <- c(list(x=2,y=a^2.1),rep(list(NULL),n))
+   pr("B"); q <- list(a[4])
+   pr("C"); L[2..3] <- q
+   M <- L
+   pr("D"); L[2..4] <- list(a[5])
+   pr("E"); L[2..3] <- list(a[6])
+   pr("F"); L
+ }
RPROFMEM: (double 100):
RPROFMEM: (integer 100):
RPROFMEM: (double 100):
A 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 10000):
RPROFMEM: (list 100):
RPROFMEM: (list 102):
RPROFMEM: (list 102):
RPROFMEM: (character 102):
B 
RPROFMEM: (double 100):
C 
D 
RPROFMEM: (double 100):
RPROFMEM: (list 102):
RPROFMEM: (list 102):
E 
RPROFMEM: (double 100):
F 
RPROFMEM: (list 102):
RPROFMEM: (double 100):
> pr("end")
end 
> r$x; r$y; 
[1] 2
[1] 9
> attr(r,"gradient")$x[1..10]
 [1] 0 0 0 0 0 0 0 0 0 0
> attr(r,"gradient")$y[1..10]
 [1] 0 0 0 0 0 1 0 0 0 0
> attr(r,"gradient")[[3]][1..10]
 [1] 0 0 0 0 0 1 0 0 0 0
> attr(r,"gradient")[[4]][1..10]
 [1] 0 0 0 0 1 0 0 0 0 0
> attr(r,"gradient")[[5]][1..10]
NULL
> 
> pr("start")
start 
> r <- back gradient (a=rep(3,n)) {
+   pr("A"); a[2] <- 7
+   pr("B"); b <- c(a,a)
+   pr("C"); a[3] <- a[4]^2
+   pr("D"); c(a,b)
+ }
RPROFMEM: (double 100):
A 
B 
RPROFMEM: (double 200):
C 
D 
RPROFMEM: (double 300):
> pr("end")
end 
> r[1..10]
 [1] 3 7 9 3 3 3 3 3 3 3
> 
> pr("start")
start 
> r <- with gradient (a=rep(3,n)) {
+   pr("A"); a[2] <- 7
+   pr("B"); b <- c(a,a)
+   pr("C"); a[3] <- a[4]^2
+   pr("D"); c(a,b)
+ }
RPROFMEM: (double 100):
A 
RPROFMEM: (double 200):
B 
RPROFMEM: (double 200):
RPROFMEM: (double 400):
C 
D 
RPROFMEM: (double 300):
RPROFMEM: (double 600):
RPROFMEM: (double 30000):
> pr("end")
end 
> r[1..10]
 [1] 3 7 9 3 3 3 3 3 3 3
> attr(r,"gradient")[1..10,1..10]
RPROFMEM: (double 100):
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
 [1,]    1    0    0    0    0    0    0    0    0     0
 [2,]    0    0    0    0    0    0    0    0    0     0
 [3,]    0    6    0    0    0    0    0    0    0     0
 [4,]    0    0    0    1    0    0    0    0    0     0
 [5,]    0    0    0    0    1    0    0    0    0     0
 [6,]    0    0    0    0    0    1    0    0    0     0
 [7,]    0    0    0    0    0    0    1    0    0     0
 [8,]    0    0    0    0    0    0    0    1    0     0
 [9,]    0    0    0    0    0    0    0    0    1     0
[10,]    0    0    0    0    0    0    0    0    0     1
> 
> n <- 8
> 
> pr("start")
start 
> track gradient (a=rep(3,n)) {
+   pr("A"); L <- list(a,a,a); prp(gradient_of(L))
+   pr("B"); L[[2]][1] <- 9; prp(gradient_of(L))
+   pr("C"); M <- L; L[[3]][2] <- L[[1]][3]; prp(gradient_of(L))
+   pr("D"); prp(gradient_of(M))
+   NULL
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 64):
[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

[[3]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

B 
RPROFMEM: (double 8):
RPROFMEM: (double 64):
[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    0    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

[[3]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

C 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 64):
[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    0    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

[[3]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    0    0    1    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

D 
[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    0    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

[[3]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

NULL
> pr("end")
end 
> 
> pr("start")
start 
> track gradient (a=rep(3,n)) {
+   pr("A"); a[4] <- a[1]+a[2]
+   pr("B"); b <- a
+   pr("C"); b[2] <- a[5]
+   pr("D"); b[7] <- b[8]
+   pr("E"); b[1] <- b[6]+a[4]
+   pr("F"); a[6] <- a[1]
+   pr("G"); x <- a; x <- 7; a[8] <- 9
+   pr("H"); prp(gradient_of(a))
+   pr("I"); prp(gradient_of(b))
+   NULL
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 64):
B 
C 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 64):
D 
RPROFMEM: (double 8):
E 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
F 
RPROFMEM: (double 8):
RPROFMEM: (double 64):
G 
H 
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    1    1    0    0    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    1    0    0    0    0    0    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    0
I 
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    1    0    0    0    1    0    0
[2,]    0    0    0    0    1    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    1    1    0    0    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    0    1
[8,]    0    0    0    0    0    0    0    1
NULL
> pr("end")
end 
> 
> pr("start")
start 
> track gradient (a=3,b=rep(4,n)) {
+   prp(x <- gradient_of(b))
+   b[2] <- a
+   prp(y <- gradient_of(b))
+   q <- a*b
+   prp(z <- gradient_of(q))
+   q[7..8] <- b[1..2]
+   prp(w <- gradient_of(q))
+   list(x,y,z,w)
+ }
RPROFMEM: (double 8):
$a
[1] 0 0 0 0 0 0 0 0

$b
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

RPROFMEM: (double 16):
RPROFMEM: (double 8):
$a
[1] 0 1 0 0 0 0 0 0

$b
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    0    0    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

RPROFMEM: (double 8):
RPROFMEM: (double 8):
$a
[1] 4 6 4 4 4 4 4 4

$b
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    3    0    0    0    0    0    0    0
[2,]    0    0    0    0    0    0    0    0
[3,]    0    0    3    0    0    0    0    0
[4,]    0    0    0    3    0    0    0    0
[5,]    0    0    0    0    3    0    0    0
[6,]    0    0    0    0    0    3    0    0
[7,]    0    0    0    0    0    0    3    0
[8,]    0    0    0    0    0    0    0    3

RPROFMEM: (double 16):
RPROFMEM: (double 64):
RPROFMEM: (double 8):
$a
[1] 4 6 4 4 4 4 0 1

$b
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    3    0    0    0    0    0    0    0
[2,]    0    0    0    0    0    0    0    0
[3,]    0    0    3    0    0    0    0    0
[4,]    0    0    0    3    0    0    0    0
[5,]    0    0    0    0    3    0    0    0
[6,]    0    0    0    0    0    3    0    0
[7,]    1    0    0    0    0    0    0    0
[8,]    0    0    0    0    0    0    0    0

[[1]]
[[1]]$a
[1] 0 0 0 0 0 0 0 0

[[1]]$b
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1


[[2]]
[[2]]$a
[1] 0 1 0 0 0 0 0 0

[[2]]$b
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    0    0    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1


[[3]]
[[3]]$a
[1] 4 6 4 4 4 4 4 4

[[3]]$b
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    3    0    0    0    0    0    0    0
[2,]    0    0    0    0    0    0    0    0
[3,]    0    0    3    0    0    0    0    0
[4,]    0    0    0    3    0    0    0    0
[5,]    0    0    0    0    3    0    0    0
[6,]    0    0    0    0    0    3    0    0
[7,]    0    0    0    0    0    0    3    0
[8,]    0    0    0    0    0    0    0    3


[[4]]
[[4]]$a
[1] 4 6 4 4 4 4 0 1

[[4]]$b
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    3    0    0    0    0    0    0    0
[2,]    0    0    0    0    0    0    0    0
[3,]    0    0    3    0    0    0    0    0
[4,]    0    0    0    3    0    0    0    0
[5,]    0    0    0    0    3    0    0    0
[6,]    0    0    0    0    0    3    0    0
[7,]    1    0    0    0    0    0    0    0
[8,]    0    0    0    0    0    0    0    0


> pr("end")
end 
> 
> pr("start")
start 
> track gradient (a=7,b=6) {
+   pr("A"); L <- list(x=list(y=a,z=a)); prp(gradient_of(L))
+   pr("B"); L$x$z <- 2*b; prp(gradient_of(L))
+   pr("C"); L[[1]]$z <- 3*b; prp(gradient_of(L))
+   pr("D"); L[[1]][[2]] <- 4*b; prp(gradient_of(L))
+   pr("E"); L[[1]]$z <- 5*b; prp(gradient_of(L))
+   NULL
+ }
A 
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 1



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1] 0



B 
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1] 2



C 
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1] 3



D 
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1] 4



E 
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1] 5



NULL
> pr("end")
end 
> 
> pr("start")
start 
> track gradient (a=7,b=6) {
+   pr("A"); L <- list(x=list(y=a,z=c(a,b,a,b,a,a,b,b))); prp(gradient_of(L))
+   pr("B"); L$x$z[2] <- a+b; prp(gradient_of(L))
+   pr("C"); L$x$z[5] <- a-b; prp(gradient_of(L))
+   pr("D"); L$x$z[2] <- a*b; prp(gradient_of(L))
+   pr("E"); M <- L; L$x$z[3] <- a^2+b^2; prp(gradient_of(L))
+   pr("F"); prp(gradient_of(M))
+   NULL
+ }
A 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 1 0 1 0 1 1 0 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1] 0 1 0 1 0 0 1 1



B 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 1 1 1 0 1 1 0 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1] 0 1 0 1 0 0 1 1



C 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 1 1 1 0 1 1 0 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1]  0  1  0  1 -1  0  1  1



D 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 1 6 1 0 1 1 0 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1]  0  7  0  1 -1  0  1  1



E 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1]  1  6 14  0  1  1  0  0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1]  0  7 12  1 -1  0  1  1



F 
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 1 6 1 0 1 1 0 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1]  0  7  0  1 -1  0  1  1



NULL
> pr("end")
end 
> 
> pr("start")
start 
> track gradient (a=7,b=6) {
+   pr("A"); L <- list(x=list(y=a,z=c(a,b,a,b,a,a,b,b))); prp(gradient_of(L))
+   pr("B"); L[[1]][[2]][[2]] <- a+b; prp(gradient_of(L))
+   pr("C"); L[[1]][[2]][[5]] <- a-b; prp(gradient_of(L))
+   pr("D"); L[[1]][[2]][[2]] <- a*b; prp(gradient_of(L))
+   pr("E"); M <- L; L[[1]][[2]][[3]] <- a^2+b^2; prp(gradient_of(L))
+   pr("F"); prp(gradient_of(M))
+   NULL
+ }
A 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 1 0 1 0 1 1 0 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1] 0 1 0 1 0 0 1 1



B 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 1 1 1 0 1 1 0 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1] 0 1 0 1 0 0 1 1



C 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 1 1 1 0 1 1 0 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1]  0  1  0  1 -1  0  1  1



D 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 1 6 1 0 1 1 0 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1]  0  7  0  1 -1  0  1  1



E 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1]  1  6 14  0  1  1  0  0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1]  0  7 12  1 -1  0  1  1



F 
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 1 6 1 0 1 1 0 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1]  0  7  0  1 -1  0  1  1



NULL
> pr("end")
end 
> 
> pr("start")
start 
> track gradient (a=7,b=6) {
+   pr("A"); L <- list(x=list(y=a,z=c(a,b,a,b,a,a,b,b)));
+   pr("B"); L$x$z[2] <- a+b;
+   pr("C"); L$x$z[5] <- a-b;
+   pr("D"); L$x$z[2] <- a*b;
+   pr("E"); M <- L; L$x$z[3] <- a^2+b^2; prp(gradient_of(L))
+   pr("F"); prp(gradient_of(M))
+   NULL
+ }
A 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
B 
C 
D 
E 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1]  1  6 14  0  1  1  0  0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1]  0  7 12  1 -1  0  1  1



F 
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 1 6 1 0 1 1 0 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1]  0  7  0  1 -1  0  1  1



NULL
> pr("end")
end 
> 
> pr("start")
start 
> track gradient (a=7,b=6) {
+   pr("A"); L <- list(x=list(y=a,z=c(a,b,a,b,a,a,b,b)));
+   pr("B"); L[[1]][[2]][[2]] <- a+b;
+   pr("C"); L[[1]][[2]][[5]] <- a-b;
+   pr("D"); L[[1]][[2]][[2]] <- a*b;
+   pr("E"); M <- L; L[[1]][[2]][[3]] <- a^2+b^2; prp(gradient_of(L))
+   pr("F"); prp(gradient_of(M))
+   NULL
+ }
A 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
B 
C 
D 
E 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1]  1  6 14  0  1  1  0  0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1]  0  7 12  1 -1  0  1  1



F 
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 1 6 1 0 1 1 0 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1]  0  7  0  1 -1  0  1  1



NULL
> pr("end")
end 
> 
> pr("start")
start 
> track gradient (a=7,b=6) {
+   pr("A"); L <- list(x=list(y=a,z=c(a,b,a,b,a,a,b,b)));
+   pr("B"); L$x[[2]][2] <- a+b; # L$x[[2]][2] <- a+b;
+   pr("C"); L$x[[2]][5] <- a-b;
+   pr("D"); L$x[[2]][2] <- a*b;
+   pr("E"); M <- L; L[[1]][[2]][[3]] <- a^2+b^2; prp(gradient_of(L))
+   pr("F"); prp(gradient_of(M))
+   NULL
+ }
A 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
B 
C 
D 
E 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1]  1  6 14  0  1  1  0  0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1]  0  7 12  1 -1  0  1  1



F 
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 1 6 1 0 1 1 0 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1]  0  7  0  1 -1  0  1  1



NULL
> pr("end")
end 
> 
> pr("start")
start 
> track gradient (a=7,b=6) {
+   pr("A"); L <- list(x=list(y=a,z=c(a,b,a,b,a,a,b,b)))
+   pr("B"); L$x$z[[2]] <- a+b
+   pr("C"); L$x$z[[5]] <- a-b
+   pr("D"); L$x$z[[2]] <- a*b
+   pr("E"); M <- L; L$x$z[3] <- a^2+b^2; prp(gradient_of(L))
+   pr("F"); prp(gradient_of(M))
+   NULL
+ }
A 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
B 
C 
D 
E 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1]  1  6 14  0  1  1  0  0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1]  0  7 12  1 -1  0  1  1



F 
$a
$a$x
$a$x$y
[1] 1

$a$x$z
[1] 1 6 1 0 1 1 0 0



$b
$b$x
$b$x$y
[1] 0

$b$x$z
[1]  0  7  0  1 -1  0  1  1



NULL
> pr("end")
end 
> 
> pr("start")
start 
> track gradient (a=rep(7,n)) {
+   cat("W\n")
+   r <- compute gradient (a) {
+     cat("X\n")
+     list(5,1,9)
+   }
+   as {
+     cat("Y\n")
+     list(a*2,a*3,a*4)
+   }
+   cat("Z\n")
+   NULL
+ }
RPROFMEM: (double 8):
W
X
Y
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
Z
NULL
> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); L <- list(x=list(y=a))
+   pr("B"); b <- a
+   pr("C"); b[2] <- b[1]  # makes jacobian for b non-diagonal
+   pr("D"); L$x$y <- a+1
+   pr("E"); L$x$y <- 3*a
+   pr("F"); L$x$y <- b
+   L
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 64):
B 
C 
RPROFMEM: (double 8):
RPROFMEM: (double 16):
D 
RPROFMEM: (double 8):
E 
RPROFMEM: (double 8):
RPROFMEM: (double 64):
F 
RPROFMEM: (double 64):
$x
$x$y
[1] 3 3 7 4 2 6 5 8


attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x$y
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    1    0    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1


> pr("end")
end 
> 
> pr("start")
start 
> with gradient (L=list(x=list(y=c(3,9,7,4,2,6,5,8)))) {
+   pr("A"); b <- L$x$y
+   pr("B"); b[2] <- b[1]  # makes jacobian for b non-diagonal
+   pr("F"); L$x$y <- b
+   L
+ }
RPROFMEM: (double 8):
A 
B 
RPROFMEM: (double 8):
RPROFMEM: (double 16):
F 
RPROFMEM: (double 64):
$x
$x$y
[1] 3 3 7 4 2 6 5 8


attr(,"gradient")
attr(,"gradient")$x
attr(,"gradient")$x$y
attr(,"gradient")$x$y$x
attr(,"gradient")$x$y$x$y
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    1    0    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1




> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)+0.1) {
+   pr("A"); x <- a^a
+   pr("B"); y <- x^(1/a)
+   pr("C"); z <- dnorm(a,a+1,a+2)
+   pr("D"); list(x,y,z)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
B 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
C 
RPROFMEM: (double 8):"dnorm" 
RPROFMEM: (double 8):"dnorm" 
RPROFMEM: (double 8):"dnorm" 
RPROFMEM: (double 8):"dnorm" 
RPROFMEM: (double 8):"dnorm" 
RPROFMEM: (double 8):"dnorm" 
RPROFMEM: (double 8):"dnorm" 
D 
RPROFMEM: (double 64):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
[[1]]
[1] 3.335963e+01 5.336748e+08 1.106456e+06 3.253972e+02 4.749638e+00
[6] 6.173223e+04 4.060765e+03 2.284171e+07

[[2]]
[1] 3.1 9.1 7.1 4.1 2.1 6.1 5.1 8.1

[[3]]
[1] 0.07673461 0.03579519 0.04357591 0.06452745 0.09445141 0.04887822 0.05563449
[8] 0.03930610

attr(,"gradient")
attr(,"gradient")[[1]]
         [,1]       [,2]    [,3]     [,4]     [,5]     [,6]     [,7]     [,8]
[1,] 71.10279          0       0   0.0000 0.000000      0.0     0.00        0
[2,]  0.00000 1712175104       0   0.0000 0.000000      0.0     0.00        0
[3,]  0.00000          0 3275216   0.0000 0.000000      0.0     0.00        0
[4,]  0.00000          0       0 784.5284 0.000000      0.0     0.00        0
[5,]  0.00000          0       0   0.0000 8.273572      0.0     0.00        0
[6,]  0.00000          0       0   0.0000 0.000000 173361.9     0.00        0
[7,]  0.00000          0       0   0.0000 0.000000      0.0 10676.73        0
[8,]  0.00000          0       0   0.0000 0.000000      0.0     0.00 70623469

attr(,"gradient")[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

attr(,"gradient")[[3]]
            [,1]         [,2]         [,3]        [,4]       [,5]         [,6]
[1,] -0.01446753  0.000000000  0.000000000  0.00000000  0.0000000  0.000000000
[2,]  0.00000000 -0.003198619  0.000000000  0.00000000  0.0000000  0.000000000
[3,]  0.00000000  0.000000000 -0.004730735  0.00000000  0.0000000  0.000000000
[4,]  0.00000000  0.000000000  0.000000000 -0.01029398  0.0000000  0.000000000
[5,]  0.00000000  0.000000000  0.000000000  0.00000000 -0.0216665  0.000000000
[6,]  0.00000000  0.000000000  0.000000000  0.00000000  0.0000000 -0.005942375
[7,]  0.00000000  0.000000000  0.000000000  0.00000000  0.0000000  0.000000000
[8,]  0.00000000  0.000000000  0.000000000  0.00000000  0.0000000  0.000000000
             [,7]         [,8]
[1,]  0.000000000  0.000000000
[2,]  0.000000000  0.000000000
[3,]  0.000000000  0.000000000
[4,]  0.000000000  0.000000000
[5,]  0.000000000  0.000000000
[6,]  0.000000000  0.000000000
[7,] -0.007680401  0.000000000
[8,]  0.000000000 -0.003853543

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,0.04,4,0.16,6,5,8)) {
+   pr("A"); b <- c(a[2],a[-2])  # has non-diagonal jacobian
+   pr("B"); w <- pmax(a,sqrt(a))
+   pr("C"); x <- pmax(b,b)
+   pr("D"); y <- pmax(a,b)
+   pr("E"); z <- pmax(b,a)
+   pr("F"); list(w,x,y,z)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 14):
RPROFMEM: (double 8):
RPROFMEM: (double 16):
B 
RPROFMEM: (double 8):"pmax" 
RPROFMEM: (double 8):"pmax" 
RPROFMEM: (double 8):"pmax" 
RPROFMEM: (double 8):"pmax" 
RPROFMEM: (double 8):"pmax" 
RPROFMEM: (double 8):"pmax" 
C 
RPROFMEM: (double 8):"pmax" 
RPROFMEM: (double 8):"pmax" 
RPROFMEM: (double 64):"pmax" 
RPROFMEM: (double 64):"pmax" 
D 
RPROFMEM: (double 8):"pmax" 
RPROFMEM: (double 8):"pmax" 
RPROFMEM: (double 8):"pmax" 
RPROFMEM: (double 64):"pmax" 
E 
RPROFMEM: (double 8):"pmax" 
RPROFMEM: (double 8):"pmax" 
RPROFMEM: (double 64):"pmax" 
F 
RPROFMEM: (double 64):
[[1]]
[1] 3.0 9.0 0.2 4.0 0.4 6.0 5.0 8.0

[[2]]
[1] 9.00 3.00 0.04 4.00 0.16 6.00 5.00 8.00

[[3]]
[1] 9.00 9.00 0.04 4.00 0.16 6.00 5.00 8.00

[[4]]
[1] 9.00 9.00 0.04 4.00 0.16 6.00 5.00 8.00

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0  0.0    0 0.00    0    0    0
[2,]    0    1  0.0    0 0.00    0    0    0
[3,]    0    0  2.5    0 0.00    0    0    0
[4,]    0    0  0.0    1 0.00    0    0    0
[5,]    0    0  0.0    0 1.25    0    0    0
[6,]    0    0  0.0    0 0.00    1    0    0
[7,]    0    0  0.0    0 0.00    0    1    0
[8,]    0    0  0.0    0 0.00    0    0    1

attr(,"gradient")[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    1    0    0    0    0    0    0
[2,]    1    0    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

attr(,"gradient")[[3]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    1    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

attr(,"gradient")[[4]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    1    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)+0.1) {
+   pr("A"); x <- mean(a)
+   pr("B"); y <- mean(a^2)
+   pr("C"); b <- a; b[2] <- b[8]
+   pr("D"); z <- mean(b)
+   pr("E"); list(x,y,z)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):"mean.default" "mean" 
B 
RPROFMEM: (double 8):"mean" 
RPROFMEM: (double 8):"mean" 
RPROFMEM: (double 8):"mean" 
RPROFMEM: (double 8):"mean.default" "mean" 
C 
RPROFMEM: (double 8):
RPROFMEM: (double 16):
D 
RPROFMEM: (double 8):"mean.default" "mean" 
E 
[[1]]
[1] 5.6

[[2]]
[1] 36.61

[[3]]
[1] 5.475

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 0.125 0.125 0.125 0.125 0.125 0.125 0.125 0.125

attr(,"gradient")[[2]]
[1] 0.775 2.275 1.775 1.025 0.525 1.525 1.275 2.025

attr(,"gradient")[[3]]
[1] 0.125 0.000 0.125 0.125 0.125 0.125 0.125 0.250

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)+0.1) {
+   pr("A"); w <- 1-a
+   pr("B"); x <- 10-w
+   pr("C"); y <- cumsum(a)
+   pr("D"); z <- -y
+   pr("E"); list(x,y,z)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
B 
RPROFMEM: (double 8):
C 
RPROFMEM: (double 8):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
D 
RPROFMEM: (double 8):
E 
RPROFMEM: (double 64):
RPROFMEM: (double 64):
[[1]]
[1] 12.1 18.1 16.1 13.1 11.1 15.1 14.1 17.1

[[2]]
[1]  3.1 12.2 19.3 23.4 25.5 31.6 36.7 44.8

[[3]]
[1]  -3.1 -12.2 -19.3 -23.4 -25.5 -31.6 -36.7 -44.8

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    0    0    1    0    0    0    0    0
[4,]    0    0    0    1    0    0    0    0
[5,]    0    0    0    0    1    0    0    0
[6,]    0    0    0    0    0    1    0    0
[7,]    0    0    0    0    0    0    1    0
[8,]    0    0    0    0    0    0    0    1

attr(,"gradient")[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    1    1    0    0    0    0    0    0
[3,]    1    1    1    0    0    0    0    0
[4,]    1    1    1    1    0    0    0    0
[5,]    1    1    1    1    1    0    0    0
[6,]    1    1    1    1    1    1    0    0
[7,]    1    1    1    1    1    1    1    0
[8,]    1    1    1    1    1    1    1    1

attr(,"gradient")[[3]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]   -1    0    0    0    0    0    0    0
[2,]   -1   -1    0    0    0    0    0    0
[3,]   -1   -1   -1    0    0    0    0    0
[4,]   -1   -1   -1   -1    0    0    0    0
[5,]   -1   -1   -1   -1   -1    0    0    0
[6,]   -1   -1   -1   -1   -1   -1    0    0
[7,]   -1   -1   -1   -1   -1   -1   -1    0
[8,]   -1   -1   -1   -1   -1   -1   -1   -1

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); b <- a^2
+   pr("B"); w <- 2*b
+   pr("C"); x <- 5*w
+   pr("D"); y <- cumsum(b)
+   pr("E"); z <- 100*y
+   pr("F"); list(x,y,z)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
B 
RPROFMEM: (double 8):
C 
RPROFMEM: (double 8):
D 
RPROFMEM: (double 8):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
E 
RPROFMEM: (double 8):
F 
RPROFMEM: (double 64):
RPROFMEM: (double 64):
[[1]]
[1]  90 810 490 160  40 360 250 640

[[2]]
[1]   9  90 139 155 159 195 220 284

[[3]]
[1]   900  9000 13900 15500 15900 19500 22000 28400

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]   60    0    0    0    0    0    0    0
[2,]    0  180    0    0    0    0    0    0
[3,]    0    0  140    0    0    0    0    0
[4,]    0    0    0   80    0    0    0    0
[5,]    0    0    0    0   40    0    0    0
[6,]    0    0    0    0    0  120    0    0
[7,]    0    0    0    0    0    0  100    0
[8,]    0    0    0    0    0    0    0  160

attr(,"gradient")[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    6    0    0    0    0    0    0    0
[2,]    6   18    0    0    0    0    0    0
[3,]    6   18   14    0    0    0    0    0
[4,]    6   18   14    8    0    0    0    0
[5,]    6   18   14    8    4    0    0    0
[6,]    6   18   14    8    4   12    0    0
[7,]    6   18   14    8    4   12   10    0
[8,]    6   18   14    8    4   12   10   16

attr(,"gradient")[[3]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]  600    0    0    0    0    0    0    0
[2,]  600 1800    0    0    0    0    0    0
[3,]  600 1800 1400    0    0    0    0    0
[4,]  600 1800 1400  800    0    0    0    0
[5,]  600 1800 1400  800  400    0    0    0
[6,]  600 1800 1400  800  400 1200    0    0
[7,]  600 1800 1400  800  400 1200 1000    0
[8,]  600 1800 1400  800  400 1200 1000 1600

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8),
+                b=c(1,10,100,1000,10000,100000,1000000,10000000)) {
+   pr("A"); x <- 2*a
+   pr("B"); y <- a*b
+   pr("C"); z <- a/b
+   pr("D"); q <- c(a[1]*a[3],a[3],a[2],a[2]*a[8],a[1]*a[3],a[4],a[5],a[7]*a[8])
+   pr("E"); w <- q*b
+   pr("F"); list(x,y,z,q,w)
+ }
RPROFMEM: (double 8):
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
B 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
C 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
D 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 64):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
E 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
F 
RPROFMEM: (double 64):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
[[1]]
[1]  6 18 14  8  4 12 10 16

[[2]]
[1] 3e+00 9e+01 7e+02 4e+03 2e+04 6e+05 5e+06 8e+07

[[3]]
[1] 3e+00 9e-01 7e-02 4e-03 2e-04 6e-05 5e-06 8e-07

[[4]]
[1] 21  7  9 72 21  4  2 40

[[5]]
[1] 2.1e+01 7.0e+01 9.0e+02 7.2e+04 2.1e+05 4.0e+05 2.0e+06 4.0e+08

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    2    0    0    0    0    0    0    0
[2,]    0    2    0    0    0    0    0    0
[3,]    0    0    2    0    0    0    0    0
[4,]    0    0    0    2    0    0    0    0
[5,]    0    0    0    0    2    0    0    0
[6,]    0    0    0    0    0    2    0    0
[7,]    0    0    0    0    0    0    2    0
[8,]    0    0    0    0    0    0    0    2

attr(,"gradient")$a[[2]]
     [,1] [,2] [,3] [,4]  [,5]  [,6]  [,7]  [,8]
[1,]    1    0    0    0     0 0e+00 0e+00 0e+00
[2,]    0   10    0    0     0 0e+00 0e+00 0e+00
[3,]    0    0  100    0     0 0e+00 0e+00 0e+00
[4,]    0    0    0 1000     0 0e+00 0e+00 0e+00
[5,]    0    0    0    0 10000 0e+00 0e+00 0e+00
[6,]    0    0    0    0     0 1e+05 0e+00 0e+00
[7,]    0    0    0    0     0 0e+00 1e+06 0e+00
[8,]    0    0    0    0     0 0e+00 0e+00 1e+07

attr(,"gradient")$a[[3]]
     [,1] [,2] [,3]  [,4]  [,5]  [,6]  [,7]  [,8]
[1,]    1  0.0 0.00 0.000 0e+00 0e+00 0e+00 0e+00
[2,]    0  0.1 0.00 0.000 0e+00 0e+00 0e+00 0e+00
[3,]    0  0.0 0.01 0.000 0e+00 0e+00 0e+00 0e+00
[4,]    0  0.0 0.00 0.001 0e+00 0e+00 0e+00 0e+00
[5,]    0  0.0 0.00 0.000 1e-04 0e+00 0e+00 0e+00
[6,]    0  0.0 0.00 0.000 0e+00 1e-05 0e+00 0e+00
[7,]    0  0.0 0.00 0.000 0e+00 0e+00 1e-06 0e+00
[8,]    0  0.0 0.00 0.000 0e+00 0e+00 0e+00 1e-07

attr(,"gradient")$a[[4]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    7    0    3    0    0    0    0    0
[2,]    0    0    1    0    0    0    0    0
[3,]    0    1    0    0    0    0    0    0
[4,]    0    8    0    0    0    0    0    9
[5,]    7    0    3    0    0    0    0    0
[6,]    0    0    0    1    0    0    0    0
[7,]    0    0    0    0    1    0    0    0
[8,]    0    0    0    0    0    0    8    5

attr(,"gradient")$a[[5]]
      [,1] [,2]  [,3]  [,4]  [,5] [,6]  [,7]  [,8]
[1,]     7    0     3 0e+00 0e+00    0 0e+00 0e+00
[2,]     0    0    10 0e+00 0e+00    0 0e+00 0e+00
[3,]     0  100     0 0e+00 0e+00    0 0e+00 0e+00
[4,]     0 8000     0 0e+00 0e+00    0 0e+00 9e+03
[5,] 70000    0 30000 0e+00 0e+00    0 0e+00 0e+00
[6,]     0    0     0 1e+05 0e+00    0 0e+00 0e+00
[7,]     0    0     0 0e+00 1e+06    0 0e+00 0e+00
[8,]     0    0     0 0e+00 0e+00    0 8e+07 5e+07


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    0    0    0    0    0    0    0
[2,]    0    0    0    0    0    0    0    0
[3,]    0    0    0    0    0    0    0    0
[4,]    0    0    0    0    0    0    0    0
[5,]    0    0    0    0    0    0    0    0
[6,]    0    0    0    0    0    0    0    0
[7,]    0    0    0    0    0    0    0    0
[8,]    0    0    0    0    0    0    0    0

attr(,"gradient")$b[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    3    0    0    0    0    0    0    0
[2,]    0    9    0    0    0    0    0    0
[3,]    0    0    7    0    0    0    0    0
[4,]    0    0    0    4    0    0    0    0
[5,]    0    0    0    0    2    0    0    0
[6,]    0    0    0    0    0    6    0    0
[7,]    0    0    0    0    0    0    5    0
[8,]    0    0    0    0    0    0    0    8

attr(,"gradient")$b[[3]]
     [,1]  [,2]   [,3]   [,4]   [,5]   [,6]   [,7]   [,8]
[1,]   -3  0.00  0e+00  0e+00  0e+00  0e+00  0e+00  0e+00
[2,]    0 -0.09  0e+00  0e+00  0e+00  0e+00  0e+00  0e+00
[3,]    0  0.00 -7e-04  0e+00  0e+00  0e+00  0e+00  0e+00
[4,]    0  0.00  0e+00 -4e-06  0e+00  0e+00  0e+00  0e+00
[5,]    0  0.00  0e+00  0e+00 -2e-08  0e+00  0e+00  0e+00
[6,]    0  0.00  0e+00  0e+00  0e+00 -6e-10  0e+00  0e+00
[7,]    0  0.00  0e+00  0e+00  0e+00  0e+00 -5e-12  0e+00
[8,]    0  0.00  0e+00  0e+00  0e+00  0e+00  0e+00 -8e-14

attr(,"gradient")$b[[4]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    0    0    0    0    0    0    0
[2,]    0    0    0    0    0    0    0    0
[3,]    0    0    0    0    0    0    0    0
[4,]    0    0    0    0    0    0    0    0
[5,]    0    0    0    0    0    0    0    0
[6,]    0    0    0    0    0    0    0    0
[7,]    0    0    0    0    0    0    0    0
[8,]    0    0    0    0    0    0    0    0

attr(,"gradient")$b[[5]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]   21    0    0    0    0    0    0    0
[2,]    0    7    0    0    0    0    0    0
[3,]    0    0    9    0    0    0    0    0
[4,]    0    0    0   72    0    0    0    0
[5,]    0    0    0    0   21    0    0    0
[6,]    0    0    0    0    0    4    0    0
[7,]    0    0    0    0    0    0    2    0
[8,]    0    0    0    0    0    0    0   40


> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8),b=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); x <- cumsum(a)
+   pr("B"); y <- (c(10,20,30,40,50,60,70,80)*x) * c(8,7,6,5,4,3,2,1)
+   pr("C"); z <- a*x
+   pr("D"); w <- b*x
+   pr("E"); list(x,y,z,w)
+ }
RPROFMEM: (double 8):
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
B 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
C 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 64):
D 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
E 
RPROFMEM: (double 64):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
[[1]]
[1]  3 12 19 23 25 31 36 44

[[2]]
[1]  240 1680 3420 4600 5000 5580 5040 3520

[[3]]
[1]   9 108 133  92  50 186 180 352

[[4]]
[1]   9 108 133  92  50 186 180 352

attr(,"gradient")
attr(,"gradient")$a
attr(,"gradient")$a[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    1    1    0    0    0    0    0    0
[3,]    1    1    1    0    0    0    0    0
[4,]    1    1    1    1    0    0    0    0
[5,]    1    1    1    1    1    0    0    0
[6,]    1    1    1    1    1    1    0    0
[7,]    1    1    1    1    1    1    1    0
[8,]    1    1    1    1    1    1    1    1

attr(,"gradient")$a[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]   80    0    0    0    0    0    0    0
[2,]  140  140    0    0    0    0    0    0
[3,]  180  180  180    0    0    0    0    0
[4,]  200  200  200  200    0    0    0    0
[5,]  200  200  200  200  200    0    0    0
[6,]  180  180  180  180  180  180    0    0
[7,]  140  140  140  140  140  140  140    0
[8,]   80   80   80   80   80   80   80   80

attr(,"gradient")$a[[3]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    6    0    0    0    0    0    0    0
[2,]    9   21    0    0    0    0    0    0
[3,]    7    7   26    0    0    0    0    0
[4,]    4    4    4   27    0    0    0    0
[5,]    2    2    2    2   27    0    0    0
[6,]    6    6    6    6    6   37    0    0
[7,]    5    5    5    5    5    5   41    0
[8,]    8    8    8    8    8    8    8   52

attr(,"gradient")$a[[4]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    3    0    0    0    0    0    0    0
[2,]    9    9    0    0    0    0    0    0
[3,]    7    7    7    0    0    0    0    0
[4,]    4    4    4    4    0    0    0    0
[5,]    2    2    2    2    2    0    0    0
[6,]    6    6    6    6    6    6    0    0
[7,]    5    5    5    5    5    5    5    0
[8,]    8    8    8    8    8    8    8    8


attr(,"gradient")$b
attr(,"gradient")$b[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    0    0    0    0    0    0    0
[2,]    0    0    0    0    0    0    0    0
[3,]    0    0    0    0    0    0    0    0
[4,]    0    0    0    0    0    0    0    0
[5,]    0    0    0    0    0    0    0    0
[6,]    0    0    0    0    0    0    0    0
[7,]    0    0    0    0    0    0    0    0
[8,]    0    0    0    0    0    0    0    0

attr(,"gradient")$b[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    0    0    0    0    0    0    0
[2,]    0    0    0    0    0    0    0    0
[3,]    0    0    0    0    0    0    0    0
[4,]    0    0    0    0    0    0    0    0
[5,]    0    0    0    0    0    0    0    0
[6,]    0    0    0    0    0    0    0    0
[7,]    0    0    0    0    0    0    0    0
[8,]    0    0    0    0    0    0    0    0

attr(,"gradient")$b[[3]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    0    0    0    0    0    0    0
[2,]    0    0    0    0    0    0    0    0
[3,]    0    0    0    0    0    0    0    0
[4,]    0    0    0    0    0    0    0    0
[5,]    0    0    0    0    0    0    0    0
[6,]    0    0    0    0    0    0    0    0
[7,]    0    0    0    0    0    0    0    0
[8,]    0    0    0    0    0    0    0    0

attr(,"gradient")$b[[4]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    3    0    0    0    0    0    0    0
[2,]    0   12    0    0    0    0    0    0
[3,]    0    0   19    0    0    0    0    0
[4,]    0    0    0   23    0    0    0    0
[5,]    0    0    0    0   25    0    0    0
[6,]    0    0    0    0    0   31    0    0
[7,]    0    0    0    0    0    0   36    0
[8,]    0    0    0    0    0    0    0   44


> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); x <- cumsum(a)
+   pr("B"); y <- x^2 + sin(x)
+   pr("C"); z <- sqrt(dnorm(x,0,x+1))
+   pr("D"); list(x,y,z)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
B 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
C 
RPROFMEM: (double 8):"dnorm" 
RPROFMEM: (double 8):"dnorm" 
RPROFMEM: (double 8):"dnorm" 
RPROFMEM: (double 8):"dnorm" 
RPROFMEM: (double 8):"dnorm" 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
D 
RPROFMEM: (double 64):
RPROFMEM: (double 64):
[[1]]
[1]  3 12 19 23 25 31 36 44

[[2]]
[1]    9.14112  143.46343  361.14988  528.15378  624.86765  960.59596 1295.00822
[8] 1936.01770

[[3]]
[1] 0.27437995 0.14156990 0.11270738 0.10247905 0.09830734 0.08830519 0.08195399
[8] 0.07413905

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    1    1    0    0    0    0    0    0
[3,]    1    1    1    0    0    0    0    0
[4,]    1    1    1    1    0    0    0    0
[5,]    1    1    1    1    1    0    0    0
[6,]    1    1    1    1    1    1    0    0
[7,]    1    1    1    1    1    1    1    0
[8,]    1    1    1    1    1    1    1    1

attr(,"gradient")[[2]]
          [,1]     [,2]     [,3]     [,4]     [,5]     [,6]     [,7]     [,8]
[1,]  5.010008  0.00000  0.00000  0.00000  0.00000  0.00000  0.00000  0.00000
[2,] 24.843854 24.84385  0.00000  0.00000  0.00000  0.00000  0.00000  0.00000
[3,] 38.988705 38.98870 38.98870  0.00000  0.00000  0.00000  0.00000  0.00000
[4,] 45.467167 45.46717 45.46717 45.46717  0.00000  0.00000  0.00000  0.00000
[5,] 50.991203 50.99120 50.99120 50.99120 50.99120  0.00000  0.00000  0.00000
[6,] 62.914742 62.91474 62.91474 62.91474 62.91474 62.91474  0.00000  0.00000
[7,] 71.872036 71.87204 71.87204 71.87204 71.87204 71.87204 71.87204  0.00000
[8,] 88.999843 88.99984 88.99984 88.99984 88.99984 88.99984 88.99984 88.99984

attr(,"gradient")[[3]]
              [,1]          [,2]          [,3]          [,4]          [,5]
[1,] -0.0407282741  0.0000000000  0.0000000000  0.0000000000  0.0000000000
[2,] -0.0058316231 -0.0058316231  0.0000000000  0.0000000000  0.0000000000
[3,] -0.0029515244 -0.0029515244 -0.0029515244  0.0000000000  0.0000000000
[4,] -0.0022202312 -0.0022202312 -0.0022202312 -0.0022202312  0.0000000000
[5,] -0.0019604417 -0.0019604417 -0.0019604417 -0.0019604417 -0.0019604417
[6,] -0.0014215390 -0.0014215390 -0.0014215390 -0.0014215390 -0.0014215390
[7,] -0.0011366094 -0.0011366094 -0.0011366094 -0.0011366094 -0.0011366094
[8,] -0.0008416664 -0.0008416664 -0.0008416664 -0.0008416664 -0.0008416664
              [,6]          [,7]          [,8]
[1,]  0.0000000000  0.0000000000  0.0000000000
[2,]  0.0000000000  0.0000000000  0.0000000000
[3,]  0.0000000000  0.0000000000  0.0000000000
[4,]  0.0000000000  0.0000000000  0.0000000000
[5,]  0.0000000000  0.0000000000  0.0000000000
[6,] -0.0014215390  0.0000000000  0.0000000000
[7,] -0.0011366094 -0.0011366094  0.0000000000
[8,] -0.0008416664 -0.0008416664 -0.0008416664

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); w <- cumsum(a)
+   pr("B"); x <- 7*w
+   pr("C"); y <- cumsum(x)
+   pr("D"); z <- 3*x
+   pr("E"); list(w,x,y,z)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
B 
RPROFMEM: (double 8):
C 
RPROFMEM: (double 8):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
D 
RPROFMEM: (double 8):
E 
RPROFMEM: (double 64):
[[1]]
[1]  3 12 19 23 25 31 36 44

[[2]]
[1]  21  84 133 161 175 217 252 308

[[3]]
[1]   21  105  238  399  574  791 1043 1351

[[4]]
[1]  63 252 399 483 525 651 756 924

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    1    1    0    0    0    0    0    0
[3,]    1    1    1    0    0    0    0    0
[4,]    1    1    1    1    0    0    0    0
[5,]    1    1    1    1    1    0    0    0
[6,]    1    1    1    1    1    1    0    0
[7,]    1    1    1    1    1    1    1    0
[8,]    1    1    1    1    1    1    1    1

attr(,"gradient")[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    7    0    0    0    0    0    0    0
[2,]    7    7    0    0    0    0    0    0
[3,]    7    7    7    0    0    0    0    0
[4,]    7    7    7    7    0    0    0    0
[5,]    7    7    7    7    7    0    0    0
[6,]    7    7    7    7    7    7    0    0
[7,]    7    7    7    7    7    7    7    0
[8,]    7    7    7    7    7    7    7    7

attr(,"gradient")[[3]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    7    0    0    0    0    0    0    0
[2,]   14    7    0    0    0    0    0    0
[3,]   21   14    7    0    0    0    0    0
[4,]   28   21   14    7    0    0    0    0
[5,]   35   28   21   14    7    0    0    0
[6,]   42   35   28   21   14    7    0    0
[7,]   49   42   35   28   21   14    7    0
[8,]   56   49   42   35   28   21   14    7

attr(,"gradient")[[4]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]   21    0    0    0    0    0    0    0
[2,]   21   21    0    0    0    0    0    0
[3,]   21   21   21    0    0    0    0    0
[4,]   21   21   21   21    0    0    0    0
[5,]   21   21   21   21   21    0    0    0
[6,]   21   21   21   21   21   21    0    0
[7,]   21   21   21   21   21   21   21    0
[8,]   21   21   21   21   21   21   21   21

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); x <- cumsum(a)
+   pr("B"); y <- 3*x
+   pr("C"); z <- x + y
+   pr("D"); z <- z + x
+   pr("E"); list(x,y,z)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
B 
RPROFMEM: (double 8):
C 
RPROFMEM: (double 8):
D 
RPROFMEM: (double 8):
E 
RPROFMEM: (double 64):
RPROFMEM: (double 64):
[[1]]
[1]  3 12 19 23 25 31 36 44

[[2]]
[1]   9  36  57  69  75  93 108 132

[[3]]
[1]  15  60  95 115 125 155 180 220

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    1    1    0    0    0    0    0    0
[3,]    1    1    1    0    0    0    0    0
[4,]    1    1    1    1    0    0    0    0
[5,]    1    1    1    1    1    0    0    0
[6,]    1    1    1    1    1    1    0    0
[7,]    1    1    1    1    1    1    1    0
[8,]    1    1    1    1    1    1    1    1

attr(,"gradient")[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    3    0    0    0    0    0    0    0
[2,]    3    3    0    0    0    0    0    0
[3,]    3    3    3    0    0    0    0    0
[4,]    3    3    3    3    0    0    0    0
[5,]    3    3    3    3    3    0    0    0
[6,]    3    3    3    3    3    3    0    0
[7,]    3    3    3    3    3    3    3    0
[8,]    3    3    3    3    3    3    3    3

attr(,"gradient")[[3]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    5    0    0    0    0    0    0    0
[2,]    5    5    0    0    0    0    0    0
[3,]    5    5    5    0    0    0    0    0
[4,]    5    5    5    5    0    0    0    0
[5,]    5    5    5    5    5    0    0    0
[6,]    5    5    5    5    5    5    0    0
[7,]    5    5    5    5    5    5    5    0
[8,]    5    5    5    5    5    5    5    5

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); x <- cumsum(a)
+   pr("B"); y <- x^2
+   pr("C"); z <- y + x
+   pr("D"); z <- x + z
+   pr("E"); list(x,y,z)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
B 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
C 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
D 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
E 
RPROFMEM: (double 64):
RPROFMEM: (double 64):
[[1]]
[1]  3 12 19 23 25 31 36 44

[[2]]
[1]    9  144  361  529  625  961 1296 1936

[[3]]
[1]   15  168  399  575  675 1023 1368 2024

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    1    0    0    0    0    0    0    0
[2,]    1    1    0    0    0    0    0    0
[3,]    1    1    1    0    0    0    0    0
[4,]    1    1    1    1    0    0    0    0
[5,]    1    1    1    1    1    0    0    0
[6,]    1    1    1    1    1    1    0    0
[7,]    1    1    1    1    1    1    1    0
[8,]    1    1    1    1    1    1    1    1

attr(,"gradient")[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    6    0    0    0    0    0    0    0
[2,]   24   24    0    0    0    0    0    0
[3,]   38   38   38    0    0    0    0    0
[4,]   46   46   46   46    0    0    0    0
[5,]   50   50   50   50   50    0    0    0
[6,]   62   62   62   62   62   62    0    0
[7,]   72   72   72   72   72   72   72    0
[8,]   88   88   88   88   88   88   88   88

attr(,"gradient")[[3]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    8    0    0    0    0    0    0    0
[2,]   26   26    0    0    0    0    0    0
[3,]   40   40   40    0    0    0    0    0
[4,]   48   48   48   48    0    0    0    0
[5,]   52   52   52   52   52    0    0    0
[6,]   64   64   64   64   64   64    0    0
[7,]   74   74   74   74   74   74   74    0
[8,]   90   90   90   90   90   90   90   90

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A")
+   r <- back gradient (b = a^2) {
+     pr("B"); 3*b
+   }
+   pr("C"); r
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
B 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
C 
RPROFMEM: (double 64):
[1]  27 243 147  48  12 108  75 192
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]   18    0    0    0    0    0    0    0
[2,]    0   54    0    0    0    0    0    0
[3,]    0    0   42    0    0    0    0    0
[4,]    0    0    0   24    0    0    0    0
[5,]    0    0    0    0   12    0    0    0
[6,]    0    0    0    0    0   36    0    0
[7,]    0    0    0    0    0    0   30    0
[8,]    0    0    0    0    0    0    0   48
> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A")
+   r <- back gradient (b = a^2, c = a^3) {
+     pr("B"); 3*b + 4*c
+   }
+   pr("C"); r
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
B 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
C 
[1]  135 3159 1519  304   44  972  575 2240
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]  126    0    0    0    0    0    0    0
[2,]    0 1026    0    0    0    0    0    0
[3,]    0    0  630    0    0    0    0    0
[4,]    0    0    0  216    0    0    0    0
[5,]    0    0    0    0   60    0    0    0
[6,]    0    0    0    0    0  468    0    0
[7,]    0    0    0    0    0    0  330    0
[8,]    0    0    0    0    0    0    0  816
> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); b <- a^2
+   pr("B"); r <- 3*b
+   pr("C"); r
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
B 
RPROFMEM: (double 8):
C 
RPROFMEM: (double 64):
RPROFMEM: (double 64):
[1]  27 243 147  48  12 108  75 192
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]   18    0    0    0    0    0    0    0
[2,]    0   54    0    0    0    0    0    0
[3,]    0    0   42    0    0    0    0    0
[4,]    0    0    0   24    0    0    0    0
[5,]    0    0    0    0   12    0    0    0
[6,]    0    0    0    0    0   36    0    0
[7,]    0    0    0    0    0    0   30    0
[8,]    0    0    0    0    0    0    0   48
> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); x <- a[3]
+   pr("B"); r <- a*x
+   pr("C"); s <- x*a
+   pr("D"); list(r,s)
+ }
RPROFMEM: (double 8):
A 
B 
RPROFMEM: (double 8):
RPROFMEM: (double 64):
RPROFMEM: (double 8):
C 
RPROFMEM: (double 8):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
D 
[[1]]
[1] 21 63 49 28 14 42 35 56

[[2]]
[1] 21 63 49 28 14 42 35 56

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    7    0    3    0    0    0    0    0
[2,]    0    7    9    0    0    0    0    0
[3,]    0    0   14    0    0    0    0    0
[4,]    0    0    4    7    0    0    0    0
[5,]    0    0    2    0    7    0    0    0
[6,]    0    0    6    0    0    7    0    0
[7,]    0    0    5    0    0    0    7    0
[8,]    0    0    8    0    0    0    0    7

attr(,"gradient")[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    7    0    3    0    0    0    0    0
[2,]    0    7    9    0    0    0    0    0
[3,]    0    0   14    0    0    0    0    0
[4,]    0    0    4    7    0    0    0    0
[5,]    0    0    2    0    7    0    0    0
[6,]    0    0    6    0    0    7    0    0
[7,]    0    0    5    0    0    0    7    0
[8,]    0    0    8    0    0    0    0    7

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A")
+   r <- compute gradient (b = a^2)
+          { pr("B"); 3*b }
+        as { pr("C"); diag(rep(3,length(b))) }
+   pr("D"); r
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
B 
RPROFMEM: (double 8):
C 
RPROFMEM: (double 8):"diag" 
RPROFMEM: (double 64):"diag" 
D 
RPROFMEM: (double 64):
[1]  27 243 147  48  12 108  75 192
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]   18    0    0    0    0    0    0    0
[2,]    0   54    0    0    0    0    0    0
[3,]    0    0   42    0    0    0    0    0
[4,]    0    0    0   24    0    0    0    0
[5,]    0    0    0    0   12    0    0    0
[6,]    0    0    0    0    0   36    0    0
[7,]    0    0    0    0    0    0   30    0
[8,]    0    0    0    0    0    0    0   48
> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A")
+   r <- compute gradient (b = a^2)
+          { pr("B"); 3*b }
+        as { pr("C"); function () diag(rep(3,length(b))) }
+   pr("D"); r
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
B 
RPROFMEM: (double 8):
C 
RPROFMEM: (double 8):"diag" "<Anonymous>" 
RPROFMEM: (double 64):"diag" "<Anonymous>" 
D 
RPROFMEM: (double 64):
[1]  27 243 147  48  12 108  75 192
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]   18    0    0    0    0    0    0    0
[2,]    0   54    0    0    0    0    0    0
[3,]    0    0   42    0    0    0    0    0
[4,]    0    0    0   24    0    0    0    0
[5,]    0    0    0    0   12    0    0    0
[6,]    0    0    0    0    0   36    0    0
[7,]    0    0    0    0    0    0   30    0
[8,]    0    0    0    0    0    0    0   48
> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A")
+   r <- compute gradient (b = a^2)
+          { pr("B"); 3*b }
+        as { pr("C"); rep(3,length(b)) }
+   pr("D"); r
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
B 
RPROFMEM: (double 8):
C 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
D 
RPROFMEM: (double 64):
[1]  27 243 147  48  12 108  75 192
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]   18    0    0    0    0    0    0    0
[2,]    0   54    0    0    0    0    0    0
[3,]    0    0   42    0    0    0    0    0
[4,]    0    0    0   24    0    0    0    0
[5,]    0    0    0    0   12    0    0    0
[6,]    0    0    0    0    0   36    0    0
[7,]    0    0    0    0    0    0   30    0
[8,]    0    0    0    0    0    0    0   48
> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A")
+   r <- compute gradient (b = a^2)
+          { pr("B"); 3*b }
+        as { pr("C"); function () rep(3,length(b)) }
+   pr("D"); r
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
B 
RPROFMEM: (double 8):
C 
RPROFMEM: (double 8):"<Anonymous>" 
RPROFMEM: (double 64):
D 
RPROFMEM: (double 64):
[1]  27 243 147  48  12 108  75 192
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]   18    0    0    0    0    0    0    0
[2,]    0   54    0    0    0    0    0    0
[3,]    0    0   42    0    0    0    0    0
[4,]    0    0    0   24    0    0    0    0
[5,]    0    0    0    0   12    0    0    0
[6,]    0    0    0    0    0   36    0    0
[7,]    0    0    0    0    0    0   30    0
[8,]    0    0    0    0    0    0    0   48
> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); b <- a[3..10]
+   pr("B"); c <- b[2..4]
+   pr("C"); d <- 3*c
+   pr("D"); list(b,c,d)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 16):
B 
C 
D 
RPROFMEM: (double 64):
RPROFMEM: (double 24):
RPROFMEM: (double 24):
[[1]]
[1]  7  4  2  6  5  8 NA NA

[[2]]
[1] 4 2 6

[[3]]
[1] 12  6 18

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    0    1    0    0    0    0    0
[2,]    0    0    0    1    0    0    0    0
[3,]    0    0    0    0    1    0    0    0
[4,]    0    0    0    0    0    1    0    0
[5,]    0    0    0    0    0    0    1    0
[6,]    0    0    0    0    0    0    0    1
[7,]    0    0    0    0    0    0    0    0
[8,]    0    0    0    0    0    0    0    0

attr(,"gradient")[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    0    0    1    0    0    0    0
[2,]    0    0    0    0    1    0    0    0
[3,]    0    0    0    0    0    1    0    0

attr(,"gradient")[[3]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    0    0    3    0    0    0    0
[2,]    0    0    0    0    3    0    0    0
[3,]    0    0    0    0    0    3    0    0

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); b <- 7*cumsum(a)[3..10]
+   pr("B"); c <- b[2..5]
+   pr("C"); d <- c[2..3]
+   pr("D"); e <- 3*d
+   pr("E"); list(b,c,d,e)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
RPROFMEM: (double 8):
RPROFMEM: (double 64):
RPROFMEM: (double 8):
B 
RPROFMEM: (double 64):
RPROFMEM: (double 32):
C 
RPROFMEM: (double 16):
D 
E 
RPROFMEM: (double 16):
[[1]]
[1] 133 161 175 217 252 308  NA  NA

[[2]]
[1] 161 175 217 252

[[3]]
[1] 175 217

[[4]]
[1] 525 651

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    7    7    7    0    0    0    0    0
[2,]    7    7    7    7    0    0    0    0
[3,]    7    7    7    7    7    0    0    0
[4,]    7    7    7    7    7    7    0    0
[5,]    7    7    7    7    7    7    7    0
[6,]    7    7    7    7    7    7    7    7
[7,]    0    0    0    0    0    0    0    0
[8,]    0    0    0    0    0    0    0    0

attr(,"gradient")[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    7    7    7    7    0    0    0    0
[2,]    7    7    7    7    7    0    0    0
[3,]    7    7    7    7    7    7    0    0
[4,]    7    7    7    7    7    7    7    0

attr(,"gradient")[[3]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    7    7    7    7    7    0    0    0
[2,]    7    7    7    7    7    7    0    0

attr(,"gradient")[[4]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]   21   21   21   21   21    0    0    0
[2,]   21   21   21   21   21   21    0    0

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); b <- a[c(3,4,5,6,7,8,9,10)]
+   pr("B"); c <- b[c(2,3,4)]
+   pr("C"); d <- 3*c
+   pr("D"); list(b,c,d)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (integer 8):
RPROFMEM: (double 8):
RPROFMEM: (double 16):
B 
C 
D 
RPROFMEM: (double 64):
RPROFMEM: (double 24):
RPROFMEM: (double 24):
[[1]]
[1]  7  4  2  6  5  8 NA NA

[[2]]
[1] 4 2 6

[[3]]
[1] 12  6 18

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    0    1    0    0    0    0    0
[2,]    0    0    0    1    0    0    0    0
[3,]    0    0    0    0    1    0    0    0
[4,]    0    0    0    0    0    1    0    0
[5,]    0    0    0    0    0    0    1    0
[6,]    0    0    0    0    0    0    0    1
[7,]    0    0    0    0    0    0    0    0
[8,]    0    0    0    0    0    0    0    0

attr(,"gradient")[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    1    0    0    0    0    0    0
[2,]    0    1    0    0    0    0    0    0
[3,]    1    0    0    0    0    0    0    0

attr(,"gradient")[[3]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    0    3    0    0    0    0    0    0
[2,]    0    3    0    0    0    0    0    0
[3,]    3    0    0    0    0    0    0    0

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); b <- 7*cumsum(a)[c(3,4,5,6,7,8,9,10)]
+   pr("B"); c <- b[c(2,3,4,5)]
+   pr("C"); d <- c[c(2,3)]
+   pr("D"); e <- 3*d
+   pr("E"); list(b,c,d,e)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 64):
RPROFMEM: (double 64):
RPROFMEM: (double 8):
RPROFMEM: (integer 8):
RPROFMEM: (double 8):
RPROFMEM: (double 64):
RPROFMEM: (double 8):
B 
RPROFMEM: (double 64):
RPROFMEM: (double 32):
C 
RPROFMEM: (double 16):
D 
E 
RPROFMEM: (double 16):
[[1]]
[1] 133 161 175 217 252 308  NA  NA

[[2]]
[1] 161 175 217 252

[[3]]
[1] 175 217

[[4]]
[1] 525 651

attr(,"gradient")
attr(,"gradient")[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    7    7    7    0    0    0    0    0
[2,]    7    7    7    7    0    0    0    0
[3,]    7    7    7    7    7    0    0    0
[4,]    7    7    7    7    7    7    0    0
[5,]    7    7    7    7    7    7    7    0
[6,]    7    7    7    7    7    7    7    7
[7,]    0    0    0    0    0    0    0    0
[8,]    0    0    0    0    0    0    0    0

attr(,"gradient")[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    7    7    7    7    0    0    0    0
[2,]    7    7    7    7    7    0    0    0
[3,]    7    7    7    7    7    7    0    0
[4,]    7    7    7    7    7    7    7    0

attr(,"gradient")[[3]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]    7    7    7    7    7    0    0    0
[2,]    7    7    7    7    7    7    0    0

attr(,"gradient")[[4]]
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]   21   21   21   21   21    0    0    0
[2,]   21   21   21   21   21   21    0    0

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); b <- a[3]
+   pr("B"); c <- b + 2*a[3]
+   pr("C"); d <- b + 2*a[4]
+   pr("D"); list(b,c,d)
+ }
RPROFMEM: (double 8):
A 
B 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 8):
C 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
D 
[[1]]
[1] 7

[[2]]
[1] 21

[[3]]
[1] 15

attr(,"gradient")
attr(,"gradient")[[1]]
[1] 0 0 1 0 0 0 0 0

attr(,"gradient")[[2]]
[1] 0 0 3 0 0 0 0 0

attr(,"gradient")[[3]]
[1] 0 0 1 2 0 0 0 0

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); b <- numeric(10);
+   pr("B"); b[[3]] <- a[[5]];
+   pr("C"); b[[7]] <- a[[2]];
+   pr("D"); c <- 3*b
+   pr("E"); list(b,c)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 10):"numeric" 
B 
RPROFMEM: (double 20):
C 
D 
RPROFMEM: (double 10):
E 
RPROFMEM: (double 80):
RPROFMEM: (double 80):
[[1]]
 [1] 0 0 2 0 0 0 9 0 0 0

[[2]]
 [1]  0  0  6  0  0  0 27  0  0  0

attr(,"gradient")
attr(,"gradient")[[1]]
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
 [1,]    0    0    0    0    0    0    0    0
 [2,]    0    0    0    0    0    0    0    0
 [3,]    0    0    0    0    1    0    0    0
 [4,]    0    0    0    0    0    0    0    0
 [5,]    0    0    0    0    0    0    0    0
 [6,]    0    0    0    0    0    0    0    0
 [7,]    0    1    0    0    0    0    0    0
 [8,]    0    0    0    0    0    0    0    0
 [9,]    0    0    0    0    0    0    0    0
[10,]    0    0    0    0    0    0    0    0

attr(,"gradient")[[2]]
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
 [1,]    0    0    0    0    0    0    0    0
 [2,]    0    0    0    0    0    0    0    0
 [3,]    0    0    0    0    3    0    0    0
 [4,]    0    0    0    0    0    0    0    0
 [5,]    0    0    0    0    0    0    0    0
 [6,]    0    0    0    0    0    0    0    0
 [7,]    0    3    0    0    0    0    0    0
 [8,]    0    0    0    0    0    0    0    0
 [9,]    0    0    0    0    0    0    0    0
[10,]    0    0    0    0    0    0    0    0

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); b <- numeric(10);
+   pr("B"); b[[3]] <- a[5];
+   pr("C"); b[[7]] <- a[2];
+   pr("D"); c <- 3*b
+   pr("E"); list(b,c)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 10):"numeric" 
B 
RPROFMEM: (double 20):
C 
D 
RPROFMEM: (double 10):
E 
RPROFMEM: (double 80):
RPROFMEM: (double 80):
[[1]]
 [1] 0 0 2 0 0 0 9 0 0 0

[[2]]
 [1]  0  0  6  0  0  0 27  0  0  0

attr(,"gradient")
attr(,"gradient")[[1]]
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
 [1,]    0    0    0    0    0    0    0    0
 [2,]    0    0    0    0    0    0    0    0
 [3,]    0    0    0    0    1    0    0    0
 [4,]    0    0    0    0    0    0    0    0
 [5,]    0    0    0    0    0    0    0    0
 [6,]    0    0    0    0    0    0    0    0
 [7,]    0    1    0    0    0    0    0    0
 [8,]    0    0    0    0    0    0    0    0
 [9,]    0    0    0    0    0    0    0    0
[10,]    0    0    0    0    0    0    0    0

attr(,"gradient")[[2]]
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
 [1,]    0    0    0    0    0    0    0    0
 [2,]    0    0    0    0    0    0    0    0
 [3,]    0    0    0    0    3    0    0    0
 [4,]    0    0    0    0    0    0    0    0
 [5,]    0    0    0    0    0    0    0    0
 [6,]    0    0    0    0    0    0    0    0
 [7,]    0    3    0    0    0    0    0    0
 [8,]    0    0    0    0    0    0    0    0
 [9,]    0    0    0    0    0    0    0    0
[10,]    0    0    0    0    0    0    0    0

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); b <- numeric(10);
+   pr("B"); b[3..4] <- a[5];
+   pr("C"); b[7..9] <- a[2..4];
+   pr("D"); c <- 3*b
+   pr("E"); list(b,c)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 10):"numeric" 
B 
RPROFMEM: (double 20):
C 
D 
RPROFMEM: (double 10):
E 
RPROFMEM: (double 80):
RPROFMEM: (double 80):
[[1]]
 [1] 0 0 2 2 0 0 9 7 4 0

[[2]]
 [1]  0  0  6  6  0  0 27 21 12  0

attr(,"gradient")
attr(,"gradient")[[1]]
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
 [1,]    0    0    0    0    0    0    0    0
 [2,]    0    0    0    0    0    0    0    0
 [3,]    0    0    0    0    1    0    0    0
 [4,]    0    0    0    0    1    0    0    0
 [5,]    0    0    0    0    0    0    0    0
 [6,]    0    0    0    0    0    0    0    0
 [7,]    0    1    0    0    0    0    0    0
 [8,]    0    0    1    0    0    0    0    0
 [9,]    0    0    0    1    0    0    0    0
[10,]    0    0    0    0    0    0    0    0

attr(,"gradient")[[2]]
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
 [1,]    0    0    0    0    0    0    0    0
 [2,]    0    0    0    0    0    0    0    0
 [3,]    0    0    0    0    3    0    0    0
 [4,]    0    0    0    0    3    0    0    0
 [5,]    0    0    0    0    0    0    0    0
 [6,]    0    0    0    0    0    0    0    0
 [7,]    0    3    0    0    0    0    0    0
 [8,]    0    0    3    0    0    0    0    0
 [9,]    0    0    0    3    0    0    0    0
[10,]    0    0    0    0    0    0    0    0

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); b <- numeric(10);
+   pr("B"); b[c(4,3)] <- a[5];
+   pr("C"); b[c(7,9,8)] <- a[c(2,4,3)];
+   pr("D"); c <- 3*b
+   pr("E"); list(b,c)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 10):"numeric" 
B 
RPROFMEM: (double 20):
C 
D 
RPROFMEM: (double 10):
E 
RPROFMEM: (double 80):
RPROFMEM: (double 80):
[[1]]
 [1] 0 0 2 2 0 0 9 7 4 0

[[2]]
 [1]  0  0  6  6  0  0 27 21 12  0

attr(,"gradient")
attr(,"gradient")[[1]]
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
 [1,]    0    0    0    0    0    0    0    0
 [2,]    0    0    0    0    0    0    0    0
 [3,]    0    0    0    0    1    0    0    0
 [4,]    0    0    0    0    1    0    0    0
 [5,]    0    0    0    0    0    0    0    0
 [6,]    0    0    0    0    0    0    0    0
 [7,]    0    1    0    0    0    0    0    0
 [8,]    0    0    1    0    0    0    0    0
 [9,]    0    0    0    1    0    0    0    0
[10,]    0    0    0    0    0    0    0    0

attr(,"gradient")[[2]]
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
 [1,]    0    0    0    0    0    0    0    0
 [2,]    0    0    0    0    0    0    0    0
 [3,]    0    0    0    0    3    0    0    0
 [4,]    0    0    0    0    3    0    0    0
 [5,]    0    0    0    0    0    0    0    0
 [6,]    0    0    0    0    0    0    0    0
 [7,]    0    3    0    0    0    0    0    0
 [8,]    0    0    3    0    0    0    0    0
 [9,]    0    0    0    3    0    0    0    0
[10,]    0    0    0    0    0    0    0    0

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); b <- numeric(10);
+   pr("B"); b[c(4,3)] <- a[5]+a[7];
+   pr("C"); b[c(7,9,8)] <- a[c(2,4,3)];
+   pr("D"); c <- 3*b
+   pr("E"); list(b,c)
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 10):"numeric" 
B 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
RPROFMEM: (double 80):
C 
RPROFMEM: (double 24):
D 
RPROFMEM: (double 10):
E 
RPROFMEM: (double 80):
[[1]]
 [1] 0 0 7 7 0 0 9 7 4 0

[[2]]
 [1]  0  0 21 21  0  0 27 21 12  0

attr(,"gradient")
attr(,"gradient")[[1]]
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
 [1,]    0    0    0    0    0    0    0    0
 [2,]    0    0    0    0    0    0    0    0
 [3,]    0    0    0    0    1    0    1    0
 [4,]    0    0    0    0    1    0    1    0
 [5,]    0    0    0    0    0    0    0    0
 [6,]    0    0    0    0    0    0    0    0
 [7,]    0    1    0    0    0    0    0    0
 [8,]    0    0    1    0    0    0    0    0
 [9,]    0    0    0    1    0    0    0    0
[10,]    0    0    0    0    0    0    0    0

attr(,"gradient")[[2]]
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
 [1,]    0    0    0    0    0    0    0    0
 [2,]    0    0    0    0    0    0    0    0
 [3,]    0    0    0    0    3    0    3    0
 [4,]    0    0    0    0    3    0    3    0
 [5,]    0    0    0    0    0    0    0    0
 [6,]    0    0    0    0    0    0    0    0
 [7,]    0    3    0    0    0    0    0    0
 [8,]    0    0    3    0    0    0    0    0
 [9,]    0    0    0    3    0    0    0    0
[10,]    0    0    0    0    0    0    0    0

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (a=c(3,9,7,4,2,6,5,8)) {
+   pr("A"); b <- a[1]+a[8]
+   pr("B"); r <- back gradient (b) rep(b,9)
+   pr("C"); r
+ }
RPROFMEM: (double 8):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 8):
B 
RPROFMEM: (double 9):
RPROFMEM: (double 9):
C 
RPROFMEM: (double 72):
[1] 11 11 11 11 11 11 11 11 11
attr(,"gradient")
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
 [1,]    1    0    0    0    0    0    0    1
 [2,]    1    0    0    0    0    0    0    1
 [3,]    1    0    0    0    0    0    0    1
 [4,]    1    0    0    0    0    0    0    1
 [5,]    1    0    0    0    0    0    0    1
 [6,]    1    0    0    0    0    0    0    1
 [7,]    1    0    0    0    0    0    0    1
 [8,]    1    0    0    0    0    0    0    1
 [9,]    1    0    0    0    0    0    0    1
> pr("end")
end 
> 
> # Chains that might be done in reverse mode.
> 
> (A <- matrix(c(3,6,1,2),2,2))
     [,1] [,2]
[1,]    3    1
[2,]    6    2
> (B <- matrix(c(9,8,4,3,1,3),2,3))
     [,1] [,2] [,3]
[1,]    9    4    1
[2,]    8    3    3
> pr("start")
start 
> with gradient (A,B) {
+   pr("A"); X <- A %*% B
+   pr("B"); Y <- A %*% X
+   pr("C"); list(X,Y)
+ }
A 
B 
RPROFMEM: (double 24):
RPROFMEM: (double 24):
RPROFMEM: (double 24):
C 
RPROFMEM: (double 36):
RPROFMEM: (double 24):
RPROFMEM: (double 36):
[[1]]
     [,1] [,2] [,3]
[1,]   35   15    6
[2,]   70   30   12

[[2]]
     [,1] [,2] [,3]
[1,]  175   75   30
[2,]  350  150   60

attr(,"gradient")
attr(,"gradient")$A
attr(,"gradient")$A[[1]]
     [,1] [,2] [,3] [,4]
[1,]    9    0    8    0
[2,]    0    9    0    8
[3,]    4    0    3    0
[4,]    0    4    0    3
[5,]    1    0    3    0
[6,]    0    1    0    3

attr(,"gradient")$A[[2]]
     [,1] [,2] [,3] [,4]
[1,]   62    9   94    8
[2,]   54   53   48   86
[3,]   27    4   39    3
[4,]   24   23   18   36
[5,]    9    1   21    3
[6,]    6    8   18   18


attr(,"gradient")$B
attr(,"gradient")$B[[1]]
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    3    1    0    0    0    0
[2,]    6    2    0    0    0    0
[3,]    0    0    3    1    0    0
[4,]    0    0    6    2    0    0
[5,]    0    0    0    0    3    1
[6,]    0    0    0    0    6    2

attr(,"gradient")$B[[2]]
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]   15    5    0    0    0    0
[2,]   30   10    0    0    0    0
[3,]    0    0   15    5    0    0
[4,]    0    0   30   10    0    0
[5,]    0    0    0    0   15    5
[6,]    0    0    0    0   30   10


> pr("end")
end 
> 
> (A <- matrix(c(3,6,1,2),2,2))
     [,1] [,2]
[1,]    3    1
[2,]    6    2
> (B <- matrix(c(9,8,4,3,1,3),2,3))
     [,1] [,2] [,3]
[1,]    9    4    1
[2,]    8    3    3
> (C <- matrix(c(4,3,7),3,1))
     [,1]
[1,]    4
[2,]    3
[3,]    7
> pr("start")
start 
> with gradient (A,B,C) {
+   pr("A"); X <- A %*% B
+   pr("B"); Y <- X %*% C
+   pr("C"); Y
+ }
A 
B 
C 
RPROFMEM: (double 8):
RPROFMEM: (double 12):
RPROFMEM: (double 36):
     [,1]
[1,]  227
[2,]  454
attr(,"gradient")
attr(,"gradient")$A
     [,1] [,2] [,3] [,4]
[1,]   55    0   62    0
[2,]    0   55    0   62

attr(,"gradient")$B
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]   12    4    9    3   21    7
[2,]   24    8   18    6   42   14

attr(,"gradient")$C
     [,1] [,2] [,3]
[1,]   35   15    6
[2,]   70   30   12

> pr("end")
end 
> 
> (A <- matrix(c(3,6,1,2),2,2))
     [,1] [,2]
[1,]    3    1
[2,]    6    2
> (B <- matrix(c(9,8,4,3,1,3),2,3))
     [,1] [,2] [,3]
[1,]    9    4    1
[2,]    8    3    3
> (C <- matrix(c(4,3,7),3,1))
     [,1]
[1,]    4
[2,]    3
[3,]    7
> pr("start")
start 
> with gradient (A,B,C) {
+   pr("A"); X <- B %*% C
+   pr("B"); Y <- A %*% X
+   pr("C"); Y
+ }
A 
B 
C 
RPROFMEM: (double 8):
RPROFMEM: (double 12):
RPROFMEM: (double 12):
     [,1]
[1,]  227
[2,]  454
attr(,"gradient")
attr(,"gradient")$A
     [,1] [,2] [,3] [,4]
[1,]   55    0   62    0
[2,]    0   55    0   62

attr(,"gradient")$B
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]   12    4    9    3   21    7
[2,]   24    8   18    6   42   14

attr(,"gradient")$C
     [,1] [,2] [,3]
[1,]   35   15    6
[2,]   70   30   12

> pr("end")
end 
> 
> (A <- matrix(c(4,3,7),1,3))
     [,1] [,2] [,3]
[1,]    4    3    7
> (B <- matrix(c(9,8,4,3,1,3),3,2))
     [,1] [,2]
[1,]    9    3
[2,]    8    1
[3,]    4    3
> (C <- matrix(c(3,6,1,2),2,2))
     [,1] [,2]
[1,]    3    1
[2,]    6    2
> pr("start")
start 
> with gradient (A,B,C) {
+   pr("A"); X <- A %*% B
+   pr("B"); Y <- X %*% C
+   pr("C"); Y
+ }
A 
B 
C 
RPROFMEM: (double 12):
RPROFMEM: (double 12):
RPROFMEM: (double 8):
     [,1] [,2]
[1,]  480  160
attr(,"gradient")
attr(,"gradient")$A
     [,1] [,2] [,3]
[1,]   45   30   30
[2,]   15   10   10

attr(,"gradient")$B
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]   12    9   21   24   18   42
[2,]    4    3    7    8    6   14

attr(,"gradient")$C
     [,1] [,2] [,3] [,4]
[1,]   88   36    0    0
[2,]    0    0   88   36

> pr("end")
end 
> 
> (A <- matrix(c(4,3,7),1,3))
     [,1] [,2] [,3]
[1,]    4    3    7
> (B <- matrix(c(9,8,4,3,1,3),3,2))
     [,1] [,2]
[1,]    9    3
[2,]    8    1
[3,]    4    3
> (C <- matrix(c(3,6,1,2),2,2))
     [,1] [,2]
[1,]    3    1
[2,]    6    2
> pr("start")
start 
> with gradient (A,B,C) {
+   pr("A"); X <- B %*% C
+   pr("B"); Y <- A %*% X
+   pr("C"); Y
+ }
A 
B 
C 
RPROFMEM: (double 12):
RPROFMEM: (double 36):
RPROFMEM: (double 8):
     [,1] [,2]
[1,]  480  160
attr(,"gradient")
attr(,"gradient")$A
     [,1] [,2] [,3]
[1,]   45   30   30
[2,]   15   10   10

attr(,"gradient")$B
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]   12    9   21   24   18   42
[2,]    4    3    7    8    6   14

attr(,"gradient")$C
     [,1] [,2] [,3] [,4]
[1,]   88   36    0    0
[2,]    0    0   88   36

> pr("end")
end 
> 
> (A <- matrix(c(4,3,7),1,3))
     [,1] [,2] [,3]
[1,]    4    3    7
> (B <- matrix(c(9,8,4,3,1,3),3,2))
     [,1] [,2]
[1,]    9    3
[2,]    8    1
[3,]    4    3
> (C <- matrix(c(3,6,1,2),2,2))
     [,1] [,2]
[1,]    3    1
[2,]    6    2
> (D <- matrix(c(7,3,4,6,1,2,-2,8),2,4))
RPROFMEM: (double 8):"matrix" 
RPROFMEM: (double 8):"matrix" 
     [,1] [,2] [,3] [,4]
[1,]    7    4    1   -2
[2,]    3    6    2    8
> pr("start")
start 
> with gradient (D) {
+   pr("A"); X <- C %*% D
+   pr("B"); Y <- B %*% X
+   pr("C"); Z <- A %*% Y
+   pr("D"); Z
+ }
A 
RPROFMEM: (double 8):
B 
RPROFMEM: (double 12):
C 
D 
RPROFMEM: (double 32):
     [,1] [,2] [,3] [,4]
[1,] 3840 2880  800  320
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]  480  160    0    0    0    0    0    0
[2,]    0    0  480  160    0    0    0    0
[3,]    0    0    0    0  480  160    0    0
[4,]    0    0    0    0    0    0  480  160
> pr("end")
end 
> pr("start")
start 
> with gradient (A,B,C,D) {
+   pr("A"); X <- C %*% D
+   pr("B"); Y <- B %*% X
+   pr("C"); Z <- A %*% Y
+   pr("D"); Z
+ }
RPROFMEM: (list 8):
A 
RPROFMEM: (double 8):
B 
RPROFMEM: (double 12):
C 
D 
RPROFMEM: (double 12):
RPROFMEM: (double 24):
RPROFMEM: (double 72):
RPROFMEM: (double 16):
RPROFMEM: (double 32):
RPROFMEM: (double 32):
     [,1] [,2] [,3] [,4]
[1,] 3840 2880  800  320
attr(,"gradient")
attr(,"gradient")$A
     [,1] [,2] [,3]
[1,]  360  240  240
[2,]  270  180  180
[3,]   75   50   50
[4,]   30   20   20

attr(,"gradient")$B
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]   96   72  168  192  144  336
[2,]   72   54  126  144  108  252
[3,]   20   15   35   40   30   70
[4,]    8    6   14   16   12   28

attr(,"gradient")$C
     [,1] [,2] [,3] [,4]
[1,]  616  252  264  108
[2,]  352  144  528  216
[3,]   88   36  176   72
[4,] -176  -72  704  288

attr(,"gradient")$D
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]  480  160    0    0    0    0    0    0
[2,]    0    0  480  160    0    0    0    0
[3,]    0    0    0    0  480  160    0    0
[4,]    0    0    0    0    0    0  480  160

> pr("end")
end 
> 
> (A <- matrix(c(4,3,7),1,3))
     [,1] [,2] [,3]
[1,]    4    3    7
> (B <- matrix(c(9,8,4,3,1,3),3,2))
     [,1] [,2]
[1,]    9    3
[2,]    8    1
[3,]    4    3
> (C <- matrix(c(3,6,1,2),2,2))
     [,1] [,2]
[1,]    3    1
[2,]    6    2
> (D <- matrix(c(7,3,4,6,1,2,-2,8),2,4))
RPROFMEM: (double 8):"matrix" 
RPROFMEM: (double 8):"matrix" 
     [,1] [,2] [,3] [,4]
[1,]    7    4    1   -2
[2,]    3    6    2    8
> pr("start")
start 
> with gradient (A) {
+   pr("A"); X <- A %*% B
+   pr("B"); Y <- X %*% C
+   pr("C"); Z <- Y %*% D
+   pr("D"); Z
+ }
A 
B 
C 
D 
RPROFMEM: (double 8):
RPROFMEM: (double 12):
RPROFMEM: (double 12):
     [,1] [,2] [,3] [,4]
[1,] 3840 2880  800  320
attr(,"gradient")
     [,1] [,2] [,3]
[1,]  360  240  240
[2,]  270  180  180
[3,]   75   50   50
[4,]   30   20   20
> pr("end")
end 
> pr("start")
start 
> with gradient (A,B,C,D) {
+   pr("A"); X <- A %*% B
+   pr("B"); Y <- X %*% C
+   pr("C"); Z <- Y %*% D
+   pr("D"); Z
+ }
RPROFMEM: (list 8):
A 
B 
C 
D 
RPROFMEM: (double 8):
RPROFMEM: (double 12):
RPROFMEM: (double 12):
RPROFMEM: (double 8):
RPROFMEM: (double 24):
RPROFMEM: (double 12):
RPROFMEM: (double 16):
RPROFMEM: (double 8):
RPROFMEM: (double 32):
     [,1] [,2] [,3] [,4]
[1,] 3840 2880  800  320
attr(,"gradient")
attr(,"gradient")$A
     [,1] [,2] [,3]
[1,]  360  240  240
[2,]  270  180  180
[3,]   75   50   50
[4,]   30   20   20

attr(,"gradient")$B
     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]   96   72  168  192  144  336
[2,]   72   54  126  144  108  252
[3,]   20   15   35   40   30   70
[4,]    8    6   14   16   12   28

attr(,"gradient")$C
     [,1] [,2] [,3] [,4]
[1,]  616  252  264  108
[2,]  352  144  528  216
[3,]   88   36  176   72
[4,] -176  -72  704  288

attr(,"gradient")$D
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]  480  160    0    0    0    0    0    0
[2,]    0    0  480  160    0    0    0    0
[3,]    0    0    0    0  480  160    0    0
[4,]    0    0    0    0    0    0  480  160

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (D = matrix(c(7,3,4,6,1,2,-2,8),2,4)) {
+   A <- D[1..1,2..4]
+   B <- D[c(1,2,1),3..4]
+   C <- D[_,c(4,2)]
+   pr("A"); X <- C %*% D
+   pr("B"); Y <- B %*% X
+   pr("C"); Z <- A %*% Y
+   pr("D"); Z
+ }
RPROFMEM: (double 8):"matrix" 
RPROFMEM: (double 8):"matrix" 
RPROFMEM: (double 64):
RPROFMEM: (double 24):
RPROFMEM: (double 48):
RPROFMEM: (double 32):
A 
RPROFMEM: (double 8):
RPROFMEM: (double 64):
RPROFMEM: (double 8):
B 
RPROFMEM: (double 12):
RPROFMEM: (double 96):
RPROFMEM: (double 12):
C 
RPROFMEM: (double 32):
D 
     [,1] [,2] [,3] [,4]
[1,]  288  336  104  272
attr(,"gradient")
     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
[1,]   24   40 -138   12  584   -2   26  102
[2,]    0    0  -72   64  608   16   32   84
[3,]    0    0  -26    8  208   46   10   24
[4,]    0    0    4   32  400   36   52   64
> pr("end")
end 
> 
> A <- matrix(c(3,6,8,2),2,2)
> B <- A+1
> Bt <- t(B)
> 
> pr("start")
start 
> with gradient (A) B %*% (B %*% A)
RPROFMEM: (double 16):
     [,1] [,2]
[1,]  615  758
[2,]  579  536
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]   79   63    0    0
[2,]   49   72    0    0
[3,]    0    0   79   63
[4,]    0    0   49   72
> with gradient (A) B %*% crossprod(Bt,A)
RPROFMEM: (double 16):
RPROFMEM: (double 16):
     [,1] [,2]
[1,]  615  758
[2,]  579  536
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]   79   63    0    0
[2,]   49   72    0    0
[3,]    0    0   79   63
[4,]    0    0   49   72
> with gradient (A) crossprod (Bt, B %*% A)
RPROFMEM: (double 16):
RPROFMEM: (double 16):
     [,1] [,2]
[1,]  615  758
[2,]  579  536
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]   79   63    0    0
[2,]   49   72    0    0
[3,]    0    0   79   63
[4,]    0    0   49   72
> with gradient (A) crossprod (Bt, crossprod (Bt,A))
RPROFMEM: (double 16):
RPROFMEM: (double 16):
     [,1] [,2]
[1,]  615  758
[2,]  579  536
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]   79   63    0    0
[2,]   49   72    0    0
[3,]    0    0   79   63
[4,]    0    0   49   72
> with gradient (A) (A %*% B) %*% B
RPROFMEM: (double 16):
     [,1] [,2]
[1,]  629  765
[2,]  572  522
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]   79    0   49    0
[2,]    0   79    0   49
[3,]   63    0   72    0
[4,]    0   63    0   72
> with gradient (A) tcrossprod(A,Bt) %*% B
RPROFMEM: (double 16):
RPROFMEM: (double 16):
     [,1] [,2]
[1,]  629  765
[2,]  572  522
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]   79    0   49    0
[2,]    0   79    0   49
[3,]   63    0   72    0
[4,]    0   63    0   72
> with gradient (A) tcrossprod (A %*% B, Bt)
RPROFMEM: (double 16):
RPROFMEM: (double 16):
     [,1] [,2]
[1,]  629  765
[2,]  572  522
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]   79    0   49    0
[2,]    0   79    0   49
[3,]   63    0   72    0
[4,]    0   63    0   72
> with gradient (A) tcrossprod (tcrossprod(A,Bt), Bt)
RPROFMEM: (double 16):
RPROFMEM: (double 16):
     [,1] [,2]
[1,]  629  765
[2,]  572  522
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]   79    0   49    0
[2,]    0   79    0   49
[3,]   63    0   72    0
[4,]    0   63    0   72
> pr("end")
end 
> 
> pr("start")
start 
> with gradient (A) B %*% (3 * (B %*% A))
RPROFMEM: (double 16):
RPROFMEM: (double 16):
     [,1] [,2]
[1,] 1845 2274
[2,] 1737 1608
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]  237  189    0    0
[2,]  147  216    0    0
[3,]    0    0  237  189
[4,]    0    0  147  216
> with gradient (A) B %*% ((B %*% A) * 3)
RPROFMEM: (double 16):
RPROFMEM: (double 16):
     [,1] [,2]
[1,] 1845 2274
[2,] 1737 1608
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]  237  189    0    0
[2,]  147  216    0    0
[3,]    0    0  237  189
[4,]    0    0  147  216
> with gradient (A) (3 * (B %*% A)) %*% B
RPROFMEM: (double 16):
RPROFMEM: (double 16):
     [,1] [,2]
[1,] 1842 2232
[2,] 1770 1611
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]   48  108   84  189
[2,]   84   36  147   63
[3,]  108  243   36   81
[4,]  189   81   63   27
> with gradient (A) ((B %*% A) * 3) %*% B
RPROFMEM: (double 16):
RPROFMEM: (double 16):
     [,1] [,2]
[1,] 1842 2232
[2,] 1770 1611
attr(,"gradient")
     [,1] [,2] [,3] [,4]
[1,]   48  108   84  189
[2,]   84   36  147   63
[3,]  108  243   36   81
[4,]  189   81   63   27
> pr("end")
end 
> 
> A <- matrix(33,10,10)
RPROFMEM: (double 100):"matrix" 
> A2 <- matrix(22,10,10)
RPROFMEM: (double 100):"matrix" 
> B <- matrix(47,2,10)
RPROFMEM: (double 20):"matrix" 
> Bt <- t(B)
RPROFMEM: (double 20):"t.default" "t" 
> 
> pr("start")
start 
> with gradient (A) B %*% (3 * A)
RPROFMEM: (double 100):
RPROFMEM: (double 20):
RPROFMEM: (double 2000):
      [,1]  [,2]  [,3]  [,4]  [,5]  [,6]  [,7]  [,8]  [,9] [,10]
[1,] 46530 46530 46530 46530 46530 46530 46530 46530 46530 46530
[2,] 46530 46530 46530 46530 46530 46530 46530 46530 46530 46530
attr(,"gradient")
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
 [1,]  141  141  141  141  141  141  141  141  141   141     0     0     0
 [2,]  141  141  141  141  141  141  141  141  141   141     0     0     0
 [3,]    0    0    0    0    0    0    0    0    0     0   141   141   141
 [4,]    0    0    0    0    0    0    0    0    0     0   141   141   141
 [5,]    0    0    0    0    0    0    0    0    0     0     0     0     0
 [6,]    0    0    0    0    0    0    0    0    0     0     0     0     0
 [7,]    0    0    0    0    0    0    0    0    0     0     0     0     0
 [8,]    0    0    0    0    0    0    0    0    0     0     0     0     0
 [9,]    0    0    0    0    0    0    0    0    0     0     0     0     0
[10,]    0    0    0    0    0    0    0    0    0     0     0     0     0
[11,]    0    0    0    0    0    0    0    0    0     0     0     0     0
[12,]    0    0    0    0    0    0    0    0    0     0     0     0     0
[13,]    0    0    0    0    0    0    0    0    0     0     0     0     0
[14,]    0    0    0    0    0    0    0    0    0     0     0     0     0
[15,]    0    0    0    0    0    0    0    0    0     0     0     0     0
[16,]    0    0    0    0    0    0    0    0    0     0     0     0     0
[17,]    0    0    0    0    0    0    0    0    0     0     0     0     0
[18,]    0    0    0    0    0    0    0    0    0     0     0     0     0
[19,]    0    0    0    0    0    0    0    0    0     0     0     0     0
[20,]    0    0    0    0    0    0    0    0    0     0     0     0     0
      [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24] [,25]
 [1,]     0     0     0     0     0     0     0     0     0     0     0     0
 [2,]     0     0     0     0     0     0     0     0     0     0     0     0
 [3,]   141   141   141   141   141   141   141     0     0     0     0     0
 [4,]   141   141   141   141   141   141   141     0     0     0     0     0
 [5,]     0     0     0     0     0     0     0   141   141   141   141   141
 [6,]     0     0     0     0     0     0     0   141   141   141   141   141
 [7,]     0     0     0     0     0     0     0     0     0     0     0     0
 [8,]     0     0     0     0     0     0     0     0     0     0     0     0
 [9,]     0     0     0     0     0     0     0     0     0     0     0     0
[10,]     0     0     0     0     0     0     0     0     0     0     0     0
[11,]     0     0     0     0     0     0     0     0     0     0     0     0
[12,]     0     0     0     0     0     0     0     0     0     0     0     0
[13,]     0     0     0     0     0     0     0     0     0     0     0     0
[14,]     0     0     0     0     0     0     0     0     0     0     0     0
[15,]     0     0     0     0     0     0     0     0     0     0     0     0
[16,]     0     0     0     0     0     0     0     0     0     0     0     0
[17,]     0     0     0     0     0     0     0     0     0     0     0     0
[18,]     0     0     0     0     0     0     0     0     0     0     0     0
[19,]     0     0     0     0     0     0     0     0     0     0     0     0
[20,]     0     0     0     0     0     0     0     0     0     0     0     0
      [,26] [,27] [,28] [,29] [,30] [,31] [,32] [,33] [,34] [,35] [,36] [,37]
 [1,]     0     0     0     0     0     0     0     0     0     0     0     0
 [2,]     0     0     0     0     0     0     0     0     0     0     0     0
 [3,]     0     0     0     0     0     0     0     0     0     0     0     0
 [4,]     0     0     0     0     0     0     0     0     0     0     0     0
 [5,]   141   141   141   141   141     0     0     0     0     0     0     0
 [6,]   141   141   141   141   141     0     0     0     0     0     0     0
 [7,]     0     0     0     0     0   141   141   141   141   141   141   141
 [8,]     0     0     0     0     0   141   141   141   141   141   141   141
 [9,]     0     0     0     0     0     0     0     0     0     0     0     0
[10,]     0     0     0     0     0     0     0     0     0     0     0     0
[11,]     0     0     0     0     0     0     0     0     0     0     0     0
[12,]     0     0     0     0     0     0     0     0     0     0     0     0
[13,]     0     0     0     0     0     0     0     0     0     0     0     0
[14,]     0     0     0     0     0     0     0     0     0     0     0     0
[15,]     0     0     0     0     0     0     0     0     0     0     0     0
[16,]     0     0     0     0     0     0     0     0     0     0     0     0
[17,]     0     0     0     0     0     0     0     0     0     0     0     0
[18,]     0     0     0     0     0     0     0     0     0     0     0     0
[19,]     0     0     0     0     0     0     0     0     0     0     0     0
[20,]     0     0     0     0     0     0     0     0     0     0     0     0
      [,38] [,39] [,40] [,41] [,42] [,43] [,44] [,45] [,46] [,47] [,48] [,49]
 [1,]     0     0     0     0     0     0     0     0     0     0     0     0
 [2,]     0     0     0     0     0     0     0     0     0     0     0     0
 [3,]     0     0     0     0     0     0     0     0     0     0     0     0
 [4,]     0     0     0     0     0     0     0     0     0     0     0     0
 [5,]     0     0     0     0     0     0     0     0     0     0     0     0
 [6,]     0     0     0     0     0     0     0     0     0     0     0     0
 [7,]   141   141   141     0     0     0     0     0     0     0     0     0
 [8,]   141   141   141     0     0     0     0     0     0     0     0     0
 [9,]     0     0     0   141   141   141   141   141   141   141   141   141
[10,]     0     0     0   141   141   141   141   141   141   141   141   141
[11,]     0     0     0     0     0     0     0     0     0     0     0     0
[12,]     0     0     0     0     0     0     0     0     0     0     0     0
[13,]     0     0     0     0     0     0     0     0     0     0     0     0
[14,]     0     0     0     0     0     0     0     0     0     0     0     0
[15,]     0     0     0     0     0     0     0     0     0     0     0     0
[16,]     0     0     0     0     0     0     0     0     0     0     0     0
[17,]     0     0     0     0     0     0     0     0     0     0     0     0
[18,]     0     0     0     0     0     0     0     0     0     0     0     0
[19,]     0     0     0     0     0     0     0     0     0     0     0     0
[20,]     0     0     0     0     0     0     0     0     0     0     0     0
      [,50] [,51] [,52] [,53] [,54] [,55] [,56] [,57] [,58] [,59] [,60] [,61]
 [1,]     0     0     0     0     0     0     0     0     0     0     0     0
 [2,]     0     0     0     0     0     0     0     0     0     0     0     0
 [3,]     0     0     0     0     0     0     0     0     0     0     0     0
 [4,]     0     0     0     0     0     0     0     0     0     0     0     0
 [5,]     0     0     0     0     0     0     0     0     0     0     0     0
 [6,]     0     0     0     0     0     0     0     0     0     0     0     0
 [7,]     0     0     0     0     0     0     0     0     0     0     0     0
 [8,]     0     0     0     0     0     0     0     0     0     0     0     0
 [9,]   141     0     0     0     0     0     0     0     0     0     0     0
[10,]   141     0     0     0     0     0     0     0     0     0     0     0
[11,]     0   141   141   141   141   141   141   141   141   141   141     0
[12,]     0   141   141   141   141   141   141   141   141   141   141     0
[13,]     0     0     0     0     0     0     0     0     0     0     0   141
[14,]     0     0     0     0     0     0     0     0     0     0     0   141
[15,]     0     0     0     0     0     0     0     0     0     0     0     0
[16,]     0     0     0     0     0     0     0     0     0     0     0     0
[17,]     0     0     0     0     0     0     0     0     0     0     0     0
[18,]     0     0     0     0     0     0     0     0     0     0     0     0
[19,]     0     0     0     0     0     0     0     0     0     0     0     0
[20,]     0     0     0     0     0     0     0     0     0     0     0     0
      [,62] [,63] [,64] [,65] [,66] [,67] [,68] [,69] [,70] [,71] [,72] [,73]
 [1,]     0     0     0     0     0     0     0     0     0     0     0     0
 [2,]     0     0     0     0     0     0     0     0     0     0     0     0
 [3,]     0     0     0     0     0     0     0     0     0     0     0     0
 [4,]     0     0     0     0     0     0     0     0     0     0     0     0
 [5,]     0     0     0     0     0     0     0     0     0     0     0     0
 [6,]     0     0     0     0     0     0     0     0     0     0     0     0
 [7,]     0     0     0     0     0     0     0     0     0     0     0     0
 [8,]     0     0     0     0     0     0     0     0     0     0     0     0
 [9,]     0     0     0     0     0     0     0     0     0     0     0     0
[10,]     0     0     0     0     0     0     0     0     0     0     0     0
[11,]     0     0     0     0     0     0     0     0     0     0     0     0
[12,]     0     0     0     0     0     0     0     0     0     0     0     0
[13,]   141   141   141   141   141   141   141   141   141     0     0     0
[14,]   141   141   141   141   141   141   141   141   141     0     0     0
[15,]     0     0     0     0     0     0     0     0     0   141   141   141
[16,]     0     0     0     0     0     0     0     0     0   141   141   141
[17,]     0     0     0     0     0     0     0     0     0     0     0     0
[18,]     0     0     0     0     0     0     0     0     0     0     0     0
[19,]     0     0     0     0     0     0     0     0     0     0     0     0
[20,]     0     0     0     0     0     0     0     0     0     0     0     0
      [,74] [,75] [,76] [,77] [,78] [,79] [,80] [,81] [,82] [,83] [,84] [,85]
 [1,]     0     0     0     0     0     0     0     0     0     0     0     0
 [2,]     0     0     0     0     0     0     0     0     0     0     0     0
 [3,]     0     0     0     0     0     0     0     0     0     0     0     0
 [4,]     0     0     0     0     0     0     0     0     0     0     0     0
 [5,]     0     0     0     0     0     0     0     0     0     0     0     0
 [6,]     0     0     0     0     0     0     0     0     0     0     0     0
 [7,]     0     0     0     0     0     0     0     0     0     0     0     0
 [8,]     0     0     0     0     0     0     0     0     0     0     0     0
 [9,]     0     0     0     0     0     0     0     0     0     0     0     0
[10,]     0     0     0     0     0     0     0     0     0     0     0     0
[11,]     0     0     0     0     0     0     0     0     0     0     0     0
[12,]     0     0     0     0     0     0     0     0     0     0     0     0
[13,]     0     0     0     0     0     0     0     0     0     0     0     0
[14,]     0     0     0     0     0     0     0     0     0     0     0     0
[15,]   141   141   141   141   141   141   141     0     0     0     0     0
[16,]   141   141   141   141   141   141   141     0     0     0     0     0
[17,]     0     0     0     0     0     0     0   141   141   141   141   141
[18,]     0     0     0     0     0     0     0   141   141   141   141   141
[19,]     0     0     0     0     0     0     0     0     0     0     0     0
[20,]     0     0     0     0     0     0     0     0     0     0     0     0
      [,86] [,87] [,88] [,89] [,90] [,91] [,92] [,93] [,94] [,95] [,96] [,97]
 [1,]     0     0     0     0     0     0     0     0     0     0     0     0
 [2,]     0     0     0     0     0     0     0     0     0     0     0     0
 [3,]     0     0     0     0     0     0     0     0     0     0     0     0
 [4,]     0     0     0     0     0     0     0     0     0     0     0     0
 [5,]     0     0     0     0     0     0     0     0     0     0     0     0
 [6,]     0     0     0     0     0     0     0     0     0     0     0     0
 [7,]     0     0     0     0     0     0     0     0     0     0     0     0
 [8,]     0     0     0     0     0     0     0     0     0     0     0     0
 [9,]     0     0     0     0     0     0     0     0     0     0     0     0
[10,]     0     0     0     0     0     0     0     0     0     0     0     0
[11,]     0     0     0     0     0     0     0     0     0     0     0     0
[12,]     0     0     0     0     0     0     0     0     0     0     0     0
[13,]     0     0     0     0     0     0     0     0     0     0     0     0
[14,]     0     0     0     0     0     0     0     0     0     0     0     0
[15,]     0     0     0     0     0     0     0     0     0     0     0     0
[16,]     0     0     0     0     0     0     0     0     0     0     0     0
[17,]   141   141   141   141   141     0     0     0     0     0     0     0
[18,]   141   141   141   141   141     0     0     0     0     0     0     0
[19,]     0     0     0     0     0   141   141   141   141   141   141   141
[20,]     0     0     0     0     0   141   141   141   141   141   141   141
      [,98] [,99] [,100]
 [1,]     0     0      0
 [2,]     0     0      0
 [3,]     0     0      0
 [4,]     0     0      0
 [5,]     0     0      0
 [6,]     0     0      0
 [7,]     0     0      0
 [8,]     0     0      0
 [9,]     0     0      0
[10,]     0     0      0
[11,]     0     0      0
[12,]     0     0      0
[13,]     0     0      0
[14,]     0     0      0
[15,]     0     0      0
[16,]     0     0      0
[17,]     0     0      0
[18,]     0     0      0
[19,]   141   141    141
[20,]   141   141    141
> with gradient (A) (3 * A) %*% Bt
RPROFMEM: (double 100):
RPROFMEM: (double 20):
RPROFMEM: (double 2000):
       [,1]  [,2]
 [1,] 46530 46530
 [2,] 46530 46530
 [3,] 46530 46530
 [4,] 46530 46530
 [5,] 46530 46530
 [6,] 46530 46530
 [7,] 46530 46530
 [8,] 46530 46530
 [9,] 46530 46530
[10,] 46530 46530
attr(,"gradient")
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
 [1,]  141    0    0    0    0    0    0    0    0     0   141     0     0
 [2,]    0  141    0    0    0    0    0    0    0     0     0   141     0
 [3,]    0    0  141    0    0    0    0    0    0     0     0     0   141
 [4,]    0    0    0  141    0    0    0    0    0     0     0     0     0
 [5,]    0    0    0    0  141    0    0    0    0     0     0     0     0
 [6,]    0    0    0    0    0  141    0    0    0     0     0     0     0
 [7,]    0    0    0    0    0    0  141    0    0     0     0     0     0
 [8,]    0    0    0    0    0    0    0  141    0     0     0     0     0
 [9,]    0    0    0    0    0    0    0    0  141     0     0     0     0
[10,]    0    0    0    0    0    0    0    0    0   141     0     0     0
[11,]  141    0    0    0    0    0    0    0    0     0   141     0     0
[12,]    0  141    0    0    0    0    0    0    0     0     0   141     0
[13,]    0    0  141    0    0    0    0    0    0     0     0     0   141
[14,]    0    0    0  141    0    0    0    0    0     0     0     0     0
[15,]    0    0    0    0  141    0    0    0    0     0     0     0     0
[16,]    0    0    0    0    0  141    0    0    0     0     0     0     0
[17,]    0    0    0    0    0    0  141    0    0     0     0     0     0
[18,]    0    0    0    0    0    0    0  141    0     0     0     0     0
[19,]    0    0    0    0    0    0    0    0  141     0     0     0     0
[20,]    0    0    0    0    0    0    0    0    0   141     0     0     0
      [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24] [,25]
 [1,]     0     0     0     0     0     0     0   141     0     0     0     0
 [2,]     0     0     0     0     0     0     0     0   141     0     0     0
 [3,]     0     0     0     0     0     0     0     0     0   141     0     0
 [4,]   141     0     0     0     0     0     0     0     0     0   141     0
 [5,]     0   141     0     0     0     0     0     0     0     0     0   141
 [6,]     0     0   141     0     0     0     0     0     0     0     0     0
 [7,]     0     0     0   141     0     0     0     0     0     0     0     0
 [8,]     0     0     0     0   141     0     0     0     0     0     0     0
 [9,]     0     0     0     0     0   141     0     0     0     0     0     0
[10,]     0     0     0     0     0     0   141     0     0     0     0     0
[11,]     0     0     0     0     0     0     0   141     0     0     0     0
[12,]     0     0     0     0     0     0     0     0   141     0     0     0
[13,]     0     0     0     0     0     0     0     0     0   141     0     0
[14,]   141     0     0     0     0     0     0     0     0     0   141     0
[15,]     0   141     0     0     0     0     0     0     0     0     0   141
[16,]     0     0   141     0     0     0     0     0     0     0     0     0
[17,]     0     0     0   141     0     0     0     0     0     0     0     0
[18,]     0     0     0     0   141     0     0     0     0     0     0     0
[19,]     0     0     0     0     0   141     0     0     0     0     0     0
[20,]     0     0     0     0     0     0   141     0     0     0     0     0
      [,26] [,27] [,28] [,29] [,30] [,31] [,32] [,33] [,34] [,35] [,36] [,37]
 [1,]     0     0     0     0     0   141     0     0     0     0     0     0
 [2,]     0     0     0     0     0     0   141     0     0     0     0     0
 [3,]     0     0     0     0     0     0     0   141     0     0     0     0
 [4,]     0     0     0     0     0     0     0     0   141     0     0     0
 [5,]     0     0     0     0     0     0     0     0     0   141     0     0
 [6,]   141     0     0     0     0     0     0     0     0     0   141     0
 [7,]     0   141     0     0     0     0     0     0     0     0     0   141
 [8,]     0     0   141     0     0     0     0     0     0     0     0     0
 [9,]     0     0     0   141     0     0     0     0     0     0     0     0
[10,]     0     0     0     0   141     0     0     0     0     0     0     0
[11,]     0     0     0     0     0   141     0     0     0     0     0     0
[12,]     0     0     0     0     0     0   141     0     0     0     0     0
[13,]     0     0     0     0     0     0     0   141     0     0     0     0
[14,]     0     0     0     0     0     0     0     0   141     0     0     0
[15,]     0     0     0     0     0     0     0     0     0   141     0     0
[16,]   141     0     0     0     0     0     0     0     0     0   141     0
[17,]     0   141     0     0     0     0     0     0     0     0     0   141
[18,]     0     0   141     0     0     0     0     0     0     0     0     0
[19,]     0     0     0   141     0     0     0     0     0     0     0     0
[20,]     0     0     0     0   141     0     0     0     0     0     0     0
      [,38] [,39] [,40] [,41] [,42] [,43] [,44] [,45] [,46] [,47] [,48] [,49]
 [1,]     0     0     0   141     0     0     0     0     0     0     0     0
 [2,]     0     0     0     0   141     0     0     0     0     0     0     0
 [3,]     0     0     0     0     0   141     0     0     0     0     0     0
 [4,]     0     0     0     0     0     0   141     0     0     0     0     0
 [5,]     0     0     0     0     0     0     0   141     0     0     0     0
 [6,]     0     0     0     0     0     0     0     0   141     0     0     0
 [7,]     0     0     0     0     0     0     0     0     0   141     0     0
 [8,]   141     0     0     0     0     0     0     0     0     0   141     0
 [9,]     0   141     0     0     0     0     0     0     0     0     0   141
[10,]     0     0   141     0     0     0     0     0     0     0     0     0
[11,]     0     0     0   141     0     0     0     0     0     0     0     0
[12,]     0     0     0     0   141     0     0     0     0     0     0     0
[13,]     0     0     0     0     0   141     0     0     0     0     0     0
[14,]     0     0     0     0     0     0   141     0     0     0     0     0
[15,]     0     0     0     0     0     0     0   141     0     0     0     0
[16,]     0     0     0     0     0     0     0     0   141     0     0     0
[17,]     0     0     0     0     0     0     0     0     0   141     0     0
[18,]   141     0     0     0     0     0     0     0     0     0   141     0
[19,]     0   141     0     0     0     0     0     0     0     0     0   141
[20,]     0     0   141     0     0     0     0     0     0     0     0     0
      [,50] [,51] [,52] [,53] [,54] [,55] [,56] [,57] [,58] [,59] [,60] [,61]
 [1,]     0   141     0     0     0     0     0     0     0     0     0   141
 [2,]     0     0   141     0     0     0     0     0     0     0     0     0
 [3,]     0     0     0   141     0     0     0     0     0     0     0     0
 [4,]     0     0     0     0   141     0     0     0     0     0     0     0
 [5,]     0     0     0     0     0   141     0     0     0     0     0     0
 [6,]     0     0     0     0     0     0   141     0     0     0     0     0
 [7,]     0     0     0     0     0     0     0   141     0     0     0     0
 [8,]     0     0     0     0     0     0     0     0   141     0     0     0
 [9,]     0     0     0     0     0     0     0     0     0   141     0     0
[10,]   141     0     0     0     0     0     0     0     0     0   141     0
[11,]     0   141     0     0     0     0     0     0     0     0     0   141
[12,]     0     0   141     0     0     0     0     0     0     0     0     0
[13,]     0     0     0   141     0     0     0     0     0     0     0     0
[14,]     0     0     0     0   141     0     0     0     0     0     0     0
[15,]     0     0     0     0     0   141     0     0     0     0     0     0
[16,]     0     0     0     0     0     0   141     0     0     0     0     0
[17,]     0     0     0     0     0     0     0   141     0     0     0     0
[18,]     0     0     0     0     0     0     0     0   141     0     0     0
[19,]     0     0     0     0     0     0     0     0     0   141     0     0
[20,]   141     0     0     0     0     0     0     0     0     0   141     0
      [,62] [,63] [,64] [,65] [,66] [,67] [,68] [,69] [,70] [,71] [,72] [,73]
 [1,]     0     0     0     0     0     0     0     0     0   141     0     0
 [2,]   141     0     0     0     0     0     0     0     0     0   141     0
 [3,]     0   141     0     0     0     0     0     0     0     0     0   141
 [4,]     0     0   141     0     0     0     0     0     0     0     0     0
 [5,]     0     0     0   141     0     0     0     0     0     0     0     0
 [6,]     0     0     0     0   141     0     0     0     0     0     0     0
 [7,]     0     0     0     0     0   141     0     0     0     0     0     0
 [8,]     0     0     0     0     0     0   141     0     0     0     0     0
 [9,]     0     0     0     0     0     0     0   141     0     0     0     0
[10,]     0     0     0     0     0     0     0     0   141     0     0     0
[11,]     0     0     0     0     0     0     0     0     0   141     0     0
[12,]   141     0     0     0     0     0     0     0     0     0   141     0
[13,]     0   141     0     0     0     0     0     0     0     0     0   141
[14,]     0     0   141     0     0     0     0     0     0     0     0     0
[15,]     0     0     0   141     0     0     0     0     0     0     0     0
[16,]     0     0     0     0   141     0     0     0     0     0     0     0
[17,]     0     0     0     0     0   141     0     0     0     0     0     0
[18,]     0     0     0     0     0     0   141     0     0     0     0     0
[19,]     0     0     0     0     0     0     0   141     0     0     0     0
[20,]     0     0     0     0     0     0     0     0   141     0     0     0
      [,74] [,75] [,76] [,77] [,78] [,79] [,80] [,81] [,82] [,83] [,84] [,85]
 [1,]     0     0     0     0     0     0     0   141     0     0     0     0
 [2,]     0     0     0     0     0     0     0     0   141     0     0     0
 [3,]     0     0     0     0     0     0     0     0     0   141     0     0
 [4,]   141     0     0     0     0     0     0     0     0     0   141     0
 [5,]     0   141     0     0     0     0     0     0     0     0     0   141
 [6,]     0     0   141     0     0     0     0     0     0     0     0     0
 [7,]     0     0     0   141     0     0     0     0     0     0     0     0
 [8,]     0     0     0     0   141     0     0     0     0     0     0     0
 [9,]     0     0     0     0     0   141     0     0     0     0     0     0
[10,]     0     0     0     0     0     0   141     0     0     0     0     0
[11,]     0     0     0     0     0     0     0   141     0     0     0     0
[12,]     0     0     0     0     0     0     0     0   141     0     0     0
[13,]     0     0     0     0     0     0     0     0     0   141     0     0
[14,]   141     0     0     0     0     0     0     0     0     0   141     0
[15,]     0   141     0     0     0     0     0     0     0     0     0   141
[16,]     0     0   141     0     0     0     0     0     0     0     0     0
[17,]     0     0     0   141     0     0     0     0     0     0     0     0
[18,]     0     0     0     0   141     0     0     0     0     0     0     0
[19,]     0     0     0     0     0   141     0     0     0     0     0     0
[20,]     0     0     0     0     0     0   141     0     0     0     0     0
      [,86] [,87] [,88] [,89] [,90] [,91] [,92] [,93] [,94] [,95] [,96] [,97]
 [1,]     0     0     0     0     0   141     0     0     0     0     0     0
 [2,]     0     0     0     0     0     0   141     0     0     0     0     0
 [3,]     0     0     0     0     0     0     0   141     0     0     0     0
 [4,]     0     0     0     0     0     0     0     0   141     0     0     0
 [5,]     0     0     0     0     0     0     0     0     0   141     0     0
 [6,]   141     0     0     0     0     0     0     0     0     0   141     0
 [7,]     0   141     0     0     0     0     0     0     0     0     0   141
 [8,]     0     0   141     0     0     0     0     0     0     0     0     0
 [9,]     0     0     0   141     0     0     0     0     0     0     0     0
[10,]     0     0     0     0   141     0     0     0     0     0     0     0
[11,]     0     0     0     0     0   141     0     0     0     0     0     0
[12,]     0     0     0     0     0     0   141     0     0     0     0     0
[13,]     0     0     0     0     0     0     0   141     0     0     0     0
[14,]     0     0     0     0     0     0     0     0   141     0     0     0
[15,]     0     0     0     0     0     0     0     0     0   141     0     0
[16,]   141     0     0     0     0     0     0     0     0     0   141     0
[17,]     0   141     0     0     0     0     0     0     0     0     0   141
[18,]     0     0   141     0     0     0     0     0     0     0     0     0
[19,]     0     0     0   141     0     0     0     0     0     0     0     0
[20,]     0     0     0     0   141     0     0     0     0     0     0     0
      [,98] [,99] [,100]
 [1,]     0     0      0
 [2,]     0     0      0
 [3,]     0     0      0
 [4,]     0     0      0
 [5,]     0     0      0
 [6,]     0     0      0
 [7,]     0     0      0
 [8,]   141     0      0
 [9,]     0   141      0
[10,]     0     0    141
[11,]     0     0      0
[12,]     0     0      0
[13,]     0     0      0
[14,]     0     0      0
[15,]     0     0      0
[16,]     0     0      0
[17,]     0     0      0
[18,]   141     0      0
[19,]     0   141      0
[20,]     0     0    141
> with gradient (A) B %*% (3 * (A2 %*% A))
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 20):
RPROFMEM: (double 2000):
RPROFMEM: (double 2000):
         [,1]     [,2]     [,3]     [,4]     [,5]     [,6]     [,7]     [,8]
[1,] 10236600 10236600 10236600 10236600 10236600 10236600 10236600 10236600
[2,] 10236600 10236600 10236600 10236600 10236600 10236600 10236600 10236600
         [,9]    [,10]
[1,] 10236600 10236600
[2,] 10236600 10236600
attr(,"gradient")
       [,1]  [,2]  [,3]  [,4]  [,5]  [,6]  [,7]  [,8]  [,9] [,10] [,11] [,12]
 [1,] 31020 31020 31020 31020 31020 31020 31020 31020 31020 31020     0     0
 [2,] 31020 31020 31020 31020 31020 31020 31020 31020 31020 31020     0     0
 [3,]     0     0     0     0     0     0     0     0     0     0 31020 31020
 [4,]     0     0     0     0     0     0     0     0     0     0 31020 31020
 [5,]     0     0     0     0     0     0     0     0     0     0     0     0
 [6,]     0     0     0     0     0     0     0     0     0     0     0     0
 [7,]     0     0     0     0     0     0     0     0     0     0     0     0
 [8,]     0     0     0     0     0     0     0     0     0     0     0     0
 [9,]     0     0     0     0     0     0     0     0     0     0     0     0
[10,]     0     0     0     0     0     0     0     0     0     0     0     0
[11,]     0     0     0     0     0     0     0     0     0     0     0     0
[12,]     0     0     0     0     0     0     0     0     0     0     0     0
[13,]     0     0     0     0     0     0     0     0     0     0     0     0
[14,]     0     0     0     0     0     0     0     0     0     0     0     0
[15,]     0     0     0     0     0     0     0     0     0     0     0     0
[16,]     0     0     0     0     0     0     0     0     0     0     0     0
[17,]     0     0     0     0     0     0     0     0     0     0     0     0
[18,]     0     0     0     0     0     0     0     0     0     0     0     0
[19,]     0     0     0     0     0     0     0     0     0     0     0     0
[20,]     0     0     0     0     0     0     0     0     0     0     0     0
      [,13] [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24]
 [1,]     0     0     0     0     0     0     0     0     0     0     0     0
 [2,]     0     0     0     0     0     0     0     0     0     0     0     0
 [3,] 31020 31020 31020 31020 31020 31020 31020 31020     0     0     0     0
 [4,] 31020 31020 31020 31020 31020 31020 31020 31020     0     0     0     0
 [5,]     0     0     0     0     0     0     0     0 31020 31020 31020 31020
 [6,]     0     0     0     0     0     0     0     0 31020 31020 31020 31020
 [7,]     0     0     0     0     0     0     0     0     0     0     0     0
 [8,]     0     0     0     0     0     0     0     0     0     0     0     0
 [9,]     0     0     0     0     0     0     0     0     0     0     0     0
[10,]     0     0     0     0     0     0     0     0     0     0     0     0
[11,]     0     0     0     0     0     0     0     0     0     0     0     0
[12,]     0     0     0     0     0     0     0     0     0     0     0     0
[13,]     0     0     0     0     0     0     0     0     0     0     0     0
[14,]     0     0     0     0     0     0     0     0     0     0     0     0
[15,]     0     0     0     0     0     0     0     0     0     0     0     0
[16,]     0     0     0     0     0     0     0     0     0     0     0     0
[17,]     0     0     0     0     0     0     0     0     0     0     0     0
[18,]     0     0     0     0     0     0     0     0     0     0     0     0
[19,]     0     0     0     0     0     0     0     0     0     0     0     0
[20,]     0     0     0     0     0     0     0     0     0     0     0     0
      [,25] [,26] [,27] [,28] [,29] [,30] [,31] [,32] [,33] [,34] [,35] [,36]
 [1,]     0     0     0     0     0     0     0     0     0     0     0     0
 [2,]     0     0     0     0     0     0     0     0     0     0     0     0
 [3,]     0     0     0     0     0     0     0     0     0     0     0     0
 [4,]     0     0     0     0     0     0     0     0     0     0     0     0
 [5,] 31020 31020 31020 31020 31020 31020     0     0     0     0     0     0
 [6,] 31020 31020 31020 31020 31020 31020     0     0     0     0     0     0
 [7,]     0     0     0     0     0     0 31020 31020 31020 31020 31020 31020
 [8,]     0     0     0     0     0     0 31020 31020 31020 31020 31020 31020
 [9,]     0     0     0     0     0     0     0     0     0     0     0     0
[10,]     0     0     0     0     0     0     0     0     0     0     0     0
[11,]     0     0     0     0     0     0     0     0     0     0     0     0
[12,]     0     0     0     0     0     0     0     0     0     0     0     0
[13,]     0     0     0     0     0     0     0     0     0     0     0     0
[14,]     0     0     0     0     0     0     0     0     0     0     0     0
[15,]     0     0     0     0     0     0     0     0     0     0     0     0
[16,]     0     0     0     0     0     0     0     0     0     0     0     0
[17,]     0     0     0     0     0     0     0     0     0     0     0     0
[18,]     0     0     0     0     0     0     0     0     0     0     0     0
[19,]     0     0     0     0     0     0     0     0     0     0     0     0
[20,]     0     0     0     0     0     0     0     0     0     0     0     0
      [,37] [,38] [,39] [,40] [,41] [,42] [,43] [,44] [,45] [,46] [,47] [,48]
 [1,]     0     0     0     0     0     0     0     0     0     0     0     0
 [2,]     0     0     0     0     0     0     0     0     0     0     0     0
 [3,]     0     0     0     0     0     0     0     0     0     0     0     0
 [4,]     0     0     0     0     0     0     0     0     0     0     0     0
 [5,]     0     0     0     0     0     0     0     0     0     0     0     0
 [6,]     0     0     0     0     0     0     0     0     0     0     0     0
 [7,] 31020 31020 31020 31020     0     0     0     0     0     0     0     0
 [8,] 31020 31020 31020 31020     0     0     0     0     0     0     0     0
 [9,]     0     0     0     0 31020 31020 31020 31020 31020 31020 31020 31020
[10,]     0     0     0     0 31020 31020 31020 31020 31020 31020 31020 31020
[11,]     0     0     0     0     0     0     0     0     0     0     0     0
[12,]     0     0     0     0     0     0     0     0     0     0     0     0
[13,]     0     0     0     0     0     0     0     0     0     0     0     0
[14,]     0     0     0     0     0     0     0     0     0     0     0     0
[15,]     0     0     0     0     0     0     0     0     0     0     0     0
[16,]     0     0     0     0     0     0     0     0     0     0     0     0
[17,]     0     0     0     0     0     0     0     0     0     0     0     0
[18,]     0     0     0     0     0     0     0     0     0     0     0     0
[19,]     0     0     0     0     0     0     0     0     0     0     0     0
[20,]     0     0     0     0     0     0     0     0     0     0     0     0
      [,49] [,50] [,51] [,52] [,53] [,54] [,55] [,56] [,57] [,58] [,59] [,60]
 [1,]     0     0     0     0     0     0     0     0     0     0     0     0
 [2,]     0     0     0     0     0     0     0     0     0     0     0     0
 [3,]     0     0     0     0     0     0     0     0     0     0     0     0
 [4,]     0     0     0     0     0     0     0     0     0     0     0     0
 [5,]     0     0     0     0     0     0     0     0     0     0     0     0
 [6,]     0     0     0     0     0     0     0     0     0     0     0     0
 [7,]     0     0     0     0     0     0     0     0     0     0     0     0
 [8,]     0     0     0     0     0     0     0     0     0     0     0     0
 [9,] 31020 31020     0     0     0     0     0     0     0     0     0     0
[10,] 31020 31020     0     0     0     0     0     0     0     0     0     0
[11,]     0     0 31020 31020 31020 31020 31020 31020 31020 31020 31020 31020
[12,]     0     0 31020 31020 31020 31020 31020 31020 31020 31020 31020 31020
[13,]     0     0     0     0     0     0     0     0     0     0     0     0
[14,]     0     0     0     0     0     0     0     0     0     0     0     0
[15,]     0     0     0     0     0     0     0     0     0     0     0     0
[16,]     0     0     0     0     0     0     0     0     0     0     0     0
[17,]     0     0     0     0     0     0     0     0     0     0     0     0
[18,]     0     0     0     0     0     0     0     0     0     0     0     0
[19,]     0     0     0     0     0     0     0     0     0     0     0     0
[20,]     0     0     0     0     0     0     0     0     0     0     0     0
      [,61] [,62] [,63] [,64] [,65] [,66] [,67] [,68] [,69] [,70] [,71] [,72]
 [1,]     0     0     0     0     0     0     0     0     0     0     0     0
 [2,]     0     0     0     0     0     0     0     0     0     0     0     0
 [3,]     0     0     0     0     0     0     0     0     0     0     0     0
 [4,]     0     0     0     0     0     0     0     0     0     0     0     0
 [5,]     0     0     0     0     0     0     0     0     0     0     0     0
 [6,]     0     0     0     0     0     0     0     0     0     0     0     0
 [7,]     0     0     0     0     0     0     0     0     0     0     0     0
 [8,]     0     0     0     0     0     0     0     0     0     0     0     0
 [9,]     0     0     0     0     0     0     0     0     0     0     0     0
[10,]     0     0     0     0     0     0     0     0     0     0     0     0
[11,]     0     0     0     0     0     0     0     0     0     0     0     0
[12,]     0     0     0     0     0     0     0     0     0     0     0     0
[13,] 31020 31020 31020 31020 31020 31020 31020 31020 31020 31020     0     0
[14,] 31020 31020 31020 31020 31020 31020 31020 31020 31020 31020     0     0
[15,]     0     0     0     0     0     0     0     0     0     0 31020 31020
[16,]     0     0     0     0     0     0     0     0     0     0 31020 31020
[17,]     0     0     0     0     0     0     0     0     0     0     0     0
[18,]     0     0     0     0     0     0     0     0     0     0     0     0
[19,]     0     0     0     0     0     0     0     0     0     0     0     0
[20,]     0     0     0     0     0     0     0     0     0     0     0     0
      [,73] [,74] [,75] [,76] [,77] [,78] [,79] [,80] [,81] [,82] [,83] [,84]
 [1,]     0     0     0     0     0     0     0     0     0     0     0     0
 [2,]     0     0     0     0     0     0     0     0     0     0     0     0
 [3,]     0     0     0     0     0     0     0     0     0     0     0     0
 [4,]     0     0     0     0     0     0     0     0     0     0     0     0
 [5,]     0     0     0     0     0     0     0     0     0     0     0     0
 [6,]     0     0     0     0     0     0     0     0     0     0     0     0
 [7,]     0     0     0     0     0     0     0     0     0     0     0     0
 [8,]     0     0     0     0     0     0     0     0     0     0     0     0
 [9,]     0     0     0     0     0     0     0     0     0     0     0     0
[10,]     0     0     0     0     0     0     0     0     0     0     0     0
[11,]     0     0     0     0     0     0     0     0     0     0     0     0
[12,]     0     0     0     0     0     0     0     0     0     0     0     0
[13,]     0     0     0     0     0     0     0     0     0     0     0     0
[14,]     0     0     0     0     0     0     0     0     0     0     0     0
[15,] 31020 31020 31020 31020 31020 31020 31020 31020     0     0     0     0
[16,] 31020 31020 31020 31020 31020 31020 31020 31020     0     0     0     0
[17,]     0     0     0     0     0     0     0     0 31020 31020 31020 31020
[18,]     0     0     0     0     0     0     0     0 31020 31020 31020 31020
[19,]     0     0     0     0     0     0     0     0     0     0     0     0
[20,]     0     0     0     0     0     0     0     0     0     0     0     0
      [,85] [,86] [,87] [,88] [,89] [,90] [,91] [,92] [,93] [,94] [,95] [,96]
 [1,]     0     0     0     0     0     0     0     0     0     0     0     0
 [2,]     0     0     0     0     0     0     0     0     0     0     0     0
 [3,]     0     0     0     0     0     0     0     0     0     0     0     0
 [4,]     0     0     0     0     0     0     0     0     0     0     0     0
 [5,]     0     0     0     0     0     0     0     0     0     0     0     0
 [6,]     0     0     0     0     0     0     0     0     0     0     0     0
 [7,]     0     0     0     0     0     0     0     0     0     0     0     0
 [8,]     0     0     0     0     0     0     0     0     0     0     0     0
 [9,]     0     0     0     0     0     0     0     0     0     0     0     0
[10,]     0     0     0     0     0     0     0     0     0     0     0     0
[11,]     0     0     0     0     0     0     0     0     0     0     0     0
[12,]     0     0     0     0     0     0     0     0     0     0     0     0
[13,]     0     0     0     0     0     0     0     0     0     0     0     0
[14,]     0     0     0     0     0     0     0     0     0     0     0     0
[15,]     0     0     0     0     0     0     0     0     0     0     0     0
[16,]     0     0     0     0     0     0     0     0     0     0     0     0
[17,] 31020 31020 31020 31020 31020 31020     0     0     0     0     0     0
[18,] 31020 31020 31020 31020 31020 31020     0     0     0     0     0     0
[19,]     0     0     0     0     0     0 31020 31020 31020 31020 31020 31020
[20,]     0     0     0     0     0     0 31020 31020 31020 31020 31020 31020
      [,97] [,98] [,99] [,100]
 [1,]     0     0     0      0
 [2,]     0     0     0      0
 [3,]     0     0     0      0
 [4,]     0     0     0      0
 [5,]     0     0     0      0
 [6,]     0     0     0      0
 [7,]     0     0     0      0
 [8,]     0     0     0      0
 [9,]     0     0     0      0
[10,]     0     0     0      0
[11,]     0     0     0      0
[12,]     0     0     0      0
[13,]     0     0     0      0
[14,]     0     0     0      0
[15,]     0     0     0      0
[16,]     0     0     0      0
[17,]     0     0     0      0
[18,]     0     0     0      0
[19,] 31020 31020 31020  31020
[20,] 31020 31020 31020  31020
> with gradient (A) (3 * (A2 %*% A)) %*% Bt
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 20):
RPROFMEM: (double 2000):
RPROFMEM: (double 2000):
          [,1]     [,2]
 [1,] 10236600 10236600
 [2,] 10236600 10236600
 [3,] 10236600 10236600
 [4,] 10236600 10236600
 [5,] 10236600 10236600
 [6,] 10236600 10236600
 [7,] 10236600 10236600
 [8,] 10236600 10236600
 [9,] 10236600 10236600
[10,] 10236600 10236600
attr(,"gradient")
      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
 [1,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
 [2,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
 [3,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
 [4,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
 [5,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
 [6,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
 [7,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
 [8,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
 [9,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
[10,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
[11,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
[12,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
[13,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
[14,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
[15,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
[16,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
[17,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
[18,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
[19,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
[20,] 3102 3102 3102 3102 3102 3102 3102 3102 3102  3102  3102  3102  3102
      [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24] [,25]
 [1,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [2,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [3,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [4,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [5,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [6,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [7,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [8,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [9,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[10,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[11,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[12,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[13,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[14,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[15,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[16,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[17,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[18,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[19,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[20,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
      [,26] [,27] [,28] [,29] [,30] [,31] [,32] [,33] [,34] [,35] [,36] [,37]
 [1,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [2,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [3,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [4,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [5,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [6,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [7,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [8,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [9,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[10,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[11,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[12,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[13,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[14,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[15,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[16,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[17,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[18,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[19,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[20,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
      [,38] [,39] [,40] [,41] [,42] [,43] [,44] [,45] [,46] [,47] [,48] [,49]
 [1,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [2,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [3,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [4,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [5,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [6,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [7,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [8,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [9,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[10,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[11,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[12,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[13,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[14,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[15,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[16,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[17,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[18,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[19,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[20,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
      [,50] [,51] [,52] [,53] [,54] [,55] [,56] [,57] [,58] [,59] [,60] [,61]
 [1,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [2,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [3,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [4,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [5,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [6,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [7,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [8,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [9,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[10,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[11,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[12,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[13,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[14,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[15,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[16,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[17,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[18,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[19,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[20,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
      [,62] [,63] [,64] [,65] [,66] [,67] [,68] [,69] [,70] [,71] [,72] [,73]
 [1,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [2,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [3,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [4,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [5,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [6,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [7,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [8,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [9,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[10,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[11,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[12,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[13,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[14,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[15,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[16,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[17,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[18,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[19,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[20,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
      [,74] [,75] [,76] [,77] [,78] [,79] [,80] [,81] [,82] [,83] [,84] [,85]
 [1,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [2,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [3,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [4,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [5,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [6,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [7,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [8,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [9,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[10,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[11,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[12,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[13,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[14,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[15,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[16,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[17,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[18,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[19,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[20,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
      [,86] [,87] [,88] [,89] [,90] [,91] [,92] [,93] [,94] [,95] [,96] [,97]
 [1,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [2,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [3,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [4,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [5,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [6,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [7,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [8,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
 [9,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[10,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[11,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[12,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[13,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[14,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[15,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[16,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[17,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[18,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[19,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
[20,]  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102  3102
      [,98] [,99] [,100]
 [1,]  3102  3102   3102
 [2,]  3102  3102   3102
 [3,]  3102  3102   3102
 [4,]  3102  3102   3102
 [5,]  3102  3102   3102
 [6,]  3102  3102   3102
 [7,]  3102  3102   3102
 [8,]  3102  3102   3102
 [9,]  3102  3102   3102
[10,]  3102  3102   3102
[11,]  3102  3102   3102
[12,]  3102  3102   3102
[13,]  3102  3102   3102
[14,]  3102  3102   3102
[15,]  3102  3102   3102
[16,]  3102  3102   3102
[17,]  3102  3102   3102
[18,]  3102  3102   3102
[19,]  3102  3102   3102
[20,]  3102  3102   3102
> pr("end")
end 
> 
> Rprofmemt(NULL)
> 
> x <- rep(c(0.08,-0.04,0.14),5)
> W <- matrix(c(4,2),5,15)
Warning message:
In matrix(c(4, 2), 5, 15) :
  data length [2] is not a sub-multiple or multiple of the number of rows [5]
> Wt <- t(W)
> b <- c(0.4,0.3,0.1,-0.3,0.2)
> u <- c(2,-2,-1,4,5)
> 
> numericDeriv (quote (u %*% tanh (b + W %*% x)), "W")
         [,1]
[1,] 7.888979
attr(,"gradient")
             [,1]         [,2]          [,3]       [,4]        [,5]
[1,] 0.0007703304 -0.002646238 -0.0007004291 0.01723808 0.002869561
              [,6]        [,7]         [,8]         [,9]        [,10]
[1,] -0.0003851354 0.001323134 0.0003502071 -0.008619025 -0.001434803
           [,11]        [,12]       [,13]      [,14]       [,15]        [,16]
[1,] 0.001348063 -0.004630953 -0.00122574 0.03016663 0.005021751 0.0007703304
            [,17]         [,18]      [,19]       [,20]         [,21]
[1,] -0.002646253 -0.0007004142 0.01723807 0.002869546 -0.0003851503
           [,22]       [,23]       [,24]        [,25]       [,26]        [,27]
[1,] 0.001323134 0.000350222 -0.00861901 -0.001434788 0.001348078 -0.004630953
           [,28]      [,29]       [,30]        [,31]        [,32]         [,33]
[1,] -0.00122574 0.03016661 0.005021751 0.0007703304 -0.002646238 -0.0007004291
          [,34]       [,35]         [,36]       [,37]        [,38]        [,39]
[1,] 0.01723808 0.002869561 -0.0003851354 0.001323134 0.0003502071 -0.008619025
            [,40]       [,41]        [,42]       [,43]      [,44]       [,45]
[1,] -0.001434803 0.001348063 -0.004630953 -0.00122574 0.03016663 0.005021751
            [,46]        [,47]         [,48]      [,49]       [,50]
[1,] 0.0007703304 -0.002646253 -0.0007004142 0.01723807 0.002869546
             [,51]       [,52]       [,53]       [,54]        [,55]       [,56]
[1,] -0.0003851503 0.001323134 0.000350222 -0.00861901 -0.001434788 0.001348078
            [,57]       [,58]      [,59]       [,60]        [,61]        [,62]
[1,] -0.004630953 -0.00122574 0.03016661 0.005021751 0.0007703304 -0.002646238
             [,63]      [,64]       [,65]         [,66]       [,67]
[1,] -0.0007004291 0.01723808 0.002869561 -0.0003851354 0.001323134
            [,68]        [,69]        [,70]       [,71]        [,72]
[1,] 0.0003502071 -0.008619025 -0.001434803 0.001348063 -0.004630953
           [,73]      [,74]       [,75]
[1,] -0.00122574 0.03016663 0.005021751
> numericDeriv (quote (u %*% tanh (b + W %*% x)), "b")
         [,1]
[1,] 7.888979
attr(,"gradient")
           [,1]        [,2]         [,3]      [,4]       [,5]
[1,] 0.00962913 -0.03307819 -0.008755326 0.2154758 0.03586948
> numericDeriv (quote (u %*% tanh (b + W %*% x)), "u")
         [,1]
[1,] 7.888979
attr(,"gradient")
          [,1]     [,2]      [,3]      [,4]      [,5]
[1,] 0.9975899 0.991696 0.9956127 0.9726927 0.9964066
> 
> pr("start")
start 
> with gradient (W,b,u) u %*% tanh (b + W %*% x)
RPROFMEM: (double 75):
         [,1]
[1,] 7.888979
attr(,"gradient")
attr(,"gradient")$W
 [1]  0.0007703245 -0.0026462588 -0.0007004228  0.0172380630  0.0028695702
 [6] -0.0003851622  0.0013231294  0.0003502114 -0.0086190315 -0.0014347851
[11]  0.0013480678 -0.0046309528 -0.0012257399  0.0301666102  0.0050217478
[16]  0.0007703245 -0.0026462588 -0.0007004228  0.0172380630  0.0028695702
[21] -0.0003851622  0.0013231294  0.0003502114 -0.0086190315 -0.0014347851
[26]  0.0013480678 -0.0046309528 -0.0012257399  0.0301666102  0.0050217478
[31]  0.0007703245 -0.0026462588 -0.0007004228  0.0172380630  0.0028695702
[36] -0.0003851622  0.0013231294  0.0003502114 -0.0086190315 -0.0014347851
[41]  0.0013480678 -0.0046309528 -0.0012257399  0.0301666102  0.0050217478
[46]  0.0007703245 -0.0026462588 -0.0007004228  0.0172380630  0.0028695702
[51] -0.0003851622  0.0013231294  0.0003502114 -0.0086190315 -0.0014347851
[56]  0.0013480678 -0.0046309528 -0.0012257399  0.0301666102  0.0050217478
[61]  0.0007703245 -0.0026462588 -0.0007004228  0.0172380630  0.0028695702
[66] -0.0003851622  0.0013231294  0.0003502114 -0.0086190315 -0.0014347851
[71]  0.0013480678 -0.0046309528 -0.0012257399  0.0301666102  0.0050217478

attr(,"gradient")$b
[1]  0.009629056 -0.033078234 -0.008755285  0.215475787  0.035869627

attr(,"gradient")$u
[1] 0.9975898 0.9916960 0.9956127 0.9726927 0.9964066

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (W,b,u) sum (u * tanh (b + W %*% x))
RPROFMEM: (double 75):
[1] 7.888979
attr(,"gradient")
attr(,"gradient")$W
 [1]  0.0007703245 -0.0026462588 -0.0007004228  0.0172380630  0.0028695702
 [6] -0.0003851622  0.0013231294  0.0003502114 -0.0086190315 -0.0014347851
[11]  0.0013480678 -0.0046309528 -0.0012257399  0.0301666102  0.0050217478
[16]  0.0007703245 -0.0026462588 -0.0007004228  0.0172380630  0.0028695702
[21] -0.0003851622  0.0013231294  0.0003502114 -0.0086190315 -0.0014347851
[26]  0.0013480678 -0.0046309528 -0.0012257399  0.0301666102  0.0050217478
[31]  0.0007703245 -0.0026462588 -0.0007004228  0.0172380630  0.0028695702
[36] -0.0003851622  0.0013231294  0.0003502114 -0.0086190315 -0.0014347851
[41]  0.0013480678 -0.0046309528 -0.0012257399  0.0301666102  0.0050217478
[46]  0.0007703245 -0.0026462588 -0.0007004228  0.0172380630  0.0028695702
[51] -0.0003851622  0.0013231294  0.0003502114 -0.0086190315 -0.0014347851
[56]  0.0013480678 -0.0046309528 -0.0012257399  0.0301666102  0.0050217478
[61]  0.0007703245 -0.0026462588 -0.0007004228  0.0172380630  0.0028695702
[66] -0.0003851622  0.0013231294  0.0003502114 -0.0086190315 -0.0014347851
[71]  0.0013480678 -0.0046309528 -0.0012257399  0.0301666102  0.0050217478

attr(,"gradient")$b
[1]  0.009629056 -0.033078234 -0.008755285  0.215475787  0.035869627

attr(,"gradient")$u
[1] 0.9975898 0.9916960 0.9956127 0.9726927 0.9964066

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (Wt,b,u) tanh (b + x %*% Wt) %*% u
RPROFMEM: (double 75):
         [,1]
[1,] 7.888979
attr(,"gradient")
attr(,"gradient")$Wt
 [1]  0.0007703245 -0.0003851622  0.0013480678  0.0007703245 -0.0003851622
 [6]  0.0013480678  0.0007703245 -0.0003851622  0.0013480678  0.0007703245
[11] -0.0003851622  0.0013480678  0.0007703245 -0.0003851622  0.0013480678
[16] -0.0026462588  0.0013231294 -0.0046309528 -0.0026462588  0.0013231294
[21] -0.0046309528 -0.0026462588  0.0013231294 -0.0046309528 -0.0026462588
[26]  0.0013231294 -0.0046309528 -0.0026462588  0.0013231294 -0.0046309528
[31] -0.0007004228  0.0003502114 -0.0012257399 -0.0007004228  0.0003502114
[36] -0.0012257399 -0.0007004228  0.0003502114 -0.0012257399 -0.0007004228
[41]  0.0003502114 -0.0012257399 -0.0007004228  0.0003502114 -0.0012257399
[46]  0.0172380630 -0.0086190315  0.0301666102  0.0172380630 -0.0086190315
[51]  0.0301666102  0.0172380630 -0.0086190315  0.0301666102  0.0172380630
[56] -0.0086190315  0.0301666102  0.0172380630 -0.0086190315  0.0301666102
[61]  0.0028695702 -0.0014347851  0.0050217478  0.0028695702 -0.0014347851
[66]  0.0050217478  0.0028695702 -0.0014347851  0.0050217478  0.0028695702
[71] -0.0014347851  0.0050217478  0.0028695702 -0.0014347851  0.0050217478

attr(,"gradient")$b
[1]  0.009629056 -0.033078234 -0.008755285  0.215475787  0.035869627

attr(,"gradient")$u
[1] 0.9975898 0.9916960 0.9956127 0.9726927 0.9964066

> pr("end")
end 
> 
> pr("start")
start 
> with gradient (Wt,b,u) sum (u * tanh (b + x %*% Wt))
RPROFMEM: (double 75):
[1] 7.888979
attr(,"gradient")
attr(,"gradient")$Wt
 [1]  0.0007703245 -0.0003851622  0.0013480678  0.0007703245 -0.0003851622
 [6]  0.0013480678  0.0007703245 -0.0003851622  0.0013480678  0.0007703245
[11] -0.0003851622  0.0013480678  0.0007703245 -0.0003851622  0.0013480678
[16] -0.0026462588  0.0013231294 -0.0046309528 -0.0026462588  0.0013231294
[21] -0.0046309528 -0.0026462588  0.0013231294 -0.0046309528 -0.0026462588
[26]  0.0013231294 -0.0046309528 -0.0026462588  0.0013231294 -0.0046309528
[31] -0.0007004228  0.0003502114 -0.0012257399 -0.0007004228  0.0003502114
[36] -0.0012257399 -0.0007004228  0.0003502114 -0.0012257399 -0.0007004228
[41]  0.0003502114 -0.0012257399 -0.0007004228  0.0003502114 -0.0012257399
[46]  0.0172380630 -0.0086190315  0.0301666102  0.0172380630 -0.0086190315
[51]  0.0301666102  0.0172380630 -0.0086190315  0.0301666102  0.0172380630
[56] -0.0086190315  0.0301666102  0.0172380630 -0.0086190315  0.0301666102
[61]  0.0028695702 -0.0014347851  0.0050217478  0.0028695702 -0.0014347851
[66]  0.0050217478  0.0028695702 -0.0014347851  0.0050217478  0.0028695702
[71] -0.0014347851  0.0050217478  0.0028695702 -0.0014347851  0.0050217478

attr(,"gradient")$b
[1]  0.009629056 -0.033078234 -0.008755285  0.215475787  0.035869627

attr(,"gradient")$u
[1] 0.9975898 0.9916960 0.9956127 0.9726927 0.9964066

> pr("end")
end 
> 
> A <- matrix(c(3,1,7,2),2,2)
> B <- matrix(c(10,20,30,-10),2,2)
> 
> with gradient (A) { C <- B%*%A; dim(C) <- c(1,4); c(100,200,500,700)%*%C }
RPROFMEM: (double 16):
RPROFMEM: (double 64):
RPROFMEM: (double 16):
      [,1]  [,2]  [,3]  [,4]
[1,]  6000  5000 13000 12000
[2,] 12000 10000 26000 24000
[3,] 30000 25000 65000 60000
[4,] 42000 35000 91000 84000
attr(,"gradient")
       [,1]  [,2]  [,3]  [,4]
 [1,]  1000  3000     0     0
 [2,]  2000  6000     0     0
 [3,]  5000 15000     0     0
 [4,]  7000 21000     0     0
 [5,]  2000 -1000     0     0
 [6,]  4000 -2000     0     0
 [7,] 10000 -5000     0     0
 [8,] 14000 -7000     0     0
 [9,]     0     0  1000  3000
[10,]     0     0  2000  6000
[11,]     0     0  5000 15000
[12,]     0     0  7000 21000
[13,]     0     0  2000 -1000
[14,]     0     0  4000 -2000
[15,]     0     0 10000 -5000
[16,]     0     0 14000 -7000
> with gradient (A) { C <- A%*%B; dim(C) <- NULL; C%*%c(100,200,500,700) }
RPROFMEM: (double 16):
      [,1]
[1,] 44000
attr(,"gradient")
[1] 16000 23000 -3000 -3000
> 
> Rprofmemt(NULL)
> 
> n <- 4
> 
> ff <- function (x) compute gradient (x) c(3,4,2) as rep(c(7,2,8),length(x))
> gg <- function (x) compute gradient (x) sum(x) as rep(1,length(x))
> 
> pr("start")
start 
> with gradient (x=c(3,1,4,2)) gg(ff(ff(ff(x))))
RPROFMEM: (double 4):
RPROFMEM: (double 12):"ff" "ff" "ff" "gg" 
RPROFMEM: (double 9):"ff" "ff" "gg" 
RPROFMEM: (double 12):"ff" "ff" "gg" 
RPROFMEM: (double 9):"ff" "gg" 
RPROFMEM: (double 12):"ff" "gg" 
RPROFMEM: (double 12):"gg" 
RPROFMEM: (double 4):
[1] 9
attr(,"gradient")
[1] 4913 4913 4913 4913
> pr("end")
end 
> 
> pr("start")
start 
> with gradient (x=c(3,1,4,2)) sum(ff(ff(ff(x))))
RPROFMEM: (double 4):
RPROFMEM: (double 12):"ff" "ff" "ff" 
RPROFMEM: (double 9):"ff" "ff" 
RPROFMEM: (double 12):"ff" "ff" 
RPROFMEM: (double 9):"ff" 
RPROFMEM: (double 12):"ff" 
RPROFMEM: (double 4):
[1] 9
attr(,"gradient")
[1] 4913 4913 4913 4913
> pr("end")
end 
> 
> pr("start")
start 
> with gradient (x=c(3,1,4,2)) c(1,1,1) %*% ff(ff(ff(x)))
RPROFMEM: (double 4):
RPROFMEM: (double 12):"ff" "ff" "ff" 
RPROFMEM: (double 9):"ff" "ff" 
RPROFMEM: (double 12):"ff" "ff" 
RPROFMEM: (double 9):"ff" 
RPROFMEM: (double 12):"ff" 
RPROFMEM: (expression 5):
RPROFMEM: (double 4):
     [,1]
[1,]    9
attr(,"gradient")
[1] 4913 4913 4913 4913
> pr("end")
end 
> 
> pr("start")
start 
> with gradient (x=c(3,1,4,2)) ff(ff(ff(x))) %*% c(1,1,1)
RPROFMEM: (double 4):
RPROFMEM: (double 12):"ff" "ff" "ff" 
RPROFMEM: (double 9):"ff" "ff" 
RPROFMEM: (double 12):"ff" "ff" 
RPROFMEM: (double 9):"ff" 
RPROFMEM: (double 12):"ff" 
RPROFMEM: (expression 5):
RPROFMEM: (double 4):
     [,1]
[1,]    9
attr(,"gradient")
[1] 4913 4913 4913 4913
> pr("end")
end 
> 
> Rprofmemt(NULL)
> 
> n <- 100
> 
> F <- seq(from=1,by=0.01,length=n)
> F1 <- rep(1,length=n)
> 
> f <- function (x) 2*x
> 
> pr("start")
start 
> r1 <- with gradient (a = numeric(n)) f(f(a))
RPROFMEM: (double 100):"numeric" 
RPROFMEM: (double 100):"f" "f" 
RPROFMEM: (double 100):"f" 
RPROFMEM: (double 10000):
> print(attr(r1,"gradient")[1..3,1..3])
     [,1] [,2] [,3]
[1,]    4    0    0
[2,]    0    4    0
[3,]    0    0    4
> pr("end")
end 
> 
> pr("start")
start 
> r1 <- with gradient (a = numeric(n)) f(f(f(a)))
RPROFMEM: (double 100):"numeric" 
RPROFMEM: (double 100):"f" "f" "f" 
RPROFMEM: (double 100):"f" "f" 
RPROFMEM: (double 100):"f" 
RPROFMEM: (double 10000):
> print(attr(r1,"gradient")[1..3,1..3])
     [,1] [,2] [,3]
[1,]    8    0    0
[2,]    0    8    0
[3,]    0    0    8
> pr("end")
end 
> 
> pr("start")
start 
> r1 <- with gradient (a = numeric(n)) F*f(10*f(F*f(a)))
RPROFMEM: (double 100):"numeric" 
RPROFMEM: (double 100):"f" "f" "f" 
RPROFMEM: (double 100):"f" "f" 
RPROFMEM: (double 100):"f" "f" 
RPROFMEM: (double 100):"f" "f" 
RPROFMEM: (double 100):"f" 
RPROFMEM: (double 100):"f" 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 10000):
RPROFMEM: (double 10000):
> print(attr(r1,"gradient")[1..3,1..3])
     [,1]   [,2]   [,3]
[1,]   80  0.000  0.000
[2,]    0 81.608  0.000
[3,]    0  0.000 83.232
> pr("end")
end 
> 
> g <- function (x) compute gradient (x) 2*x as D
> 
> D <- diag(2,n)
RPROFMEM: (double 10000):"diag" 
> 
> pr("start")
start 
> r2 <- with gradient (a = numeric(n)) g(g(a))
RPROFMEM: (double 100):"numeric" 
RPROFMEM: (double 100):"g" "g" 
RPROFMEM: (double 10000):"g" "g" 
RPROFMEM: (double 100):"g" 
RPROFMEM: (double 10000):"g" 
RPROFMEM: (double 10000):"g" 
RPROFMEM: (double 10000):
> print(attr(r2,"gradient")[1..3,1..3])
     [,1] [,2] [,3]
[1,]    4    0    0
[2,]    0    4    0
[3,]    0    0    4
> pr("end")
end 
> 
> pr("start")
start 
> r2 <- with gradient (a = numeric(n)) g(g(g(a)))
RPROFMEM: (double 100):"numeric" 
RPROFMEM: (double 100):"g" "g" "g" 
RPROFMEM: (double 10000):"g" "g" "g" 
RPROFMEM: (double 100):"g" "g" 
RPROFMEM: (double 10000):"g" "g" 
RPROFMEM: (double 10000):"g" "g" 
RPROFMEM: (double 100):"g" 
RPROFMEM: (double 10000):"g" 
RPROFMEM: (double 10000):"g" 
RPROFMEM: (double 10000):
> print(attr(r2,"gradient")[1..3,1..3])
     [,1] [,2] [,3]
[1,]    8    0    0
[2,]    0    8    0
[3,]    0    0    8
> pr("end")
end 
> 
> pr("start")
start 
> r2 <- with gradient (a = numeric(n)) F*g(10*g(F*g(a)))
RPROFMEM: (double 100):"numeric" 
RPROFMEM: (double 100):"g" "g" "g" 
RPROFMEM: (double 10000):"g" "g" "g" 
RPROFMEM: (double 100):"g" "g" 
RPROFMEM: (double 100):"g" "g" 
RPROFMEM: (double 100):"g" "g" 
RPROFMEM: (double 10000):"g" "g" 
RPROFMEM: (double 100):"g" 
RPROFMEM: (double 100):"g" 
RPROFMEM: (double 10000):"g" 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 10000):
RPROFMEM: (double 10000):
RPROFMEM: (double 10000):
RPROFMEM: (double 10000):
RPROFMEM: (double 10000):
RPROFMEM: (double 10000):
> print(attr(r2,"gradient")[1..3,1..3])
     [,1]   [,2]   [,3]
[1,]   80  0.000  0.000
[2,]    0 81.608  0.000
[3,]    0  0.000 83.232
> pr("end")
end 
> 
> D <- rep(2,n)
RPROFMEM: (double 100):
> 
> pr("start")
start 
> r2 <- with gradient (a = numeric(n)) g(g(a))
RPROFMEM: (double 100):"numeric" 
RPROFMEM: (double 100):"g" "g" 
RPROFMEM: (double 100):"g" "g" 
RPROFMEM: (double 100):"g" "g" 
RPROFMEM: (double 100):"g" 
RPROFMEM: (double 100):"g" 
RPROFMEM: (double 100):"g" 
RPROFMEM: (double 10000):
> print(attr(r2,"gradient")[1..3,1..3])
     [,1] [,2] [,3]
[1,]    4    0    0
[2,]    0    4    0
[3,]    0    0    4
> pr("end")
end 
> 
> pr("start")
start 
> r2 <- with gradient (a = numeric(n)) g(g(g(a)))
RPROFMEM: (double 100):"numeric" 
RPROFMEM: (double 100):"g" "g" "g" 
RPROFMEM: (double 100):"g" "g" "g" 
RPROFMEM: (double 100):"g" "g" "g" 
RPROFMEM: (double 100):"g" "g" 
RPROFMEM: (double 100):"g" "g" 
RPROFMEM: (double 100):"g" "g" 
RPROFMEM: (double 100):"g" 
RPROFMEM: (double 100):"g" 
RPROFMEM: (double 100):"g" 
RPROFMEM: (double 10000):
> print(attr(r2,"gradient")[1..3,1..3])
     [,1] [,2] [,3]
[1,]    8    0    0
[2,]    0    8    0
[3,]    0    0    8
> pr("end")
end 
> 
> pr("start")
start 
> r2 <- with gradient (a = numeric(n)) F*g(10*g(F*g(a)))
RPROFMEM: (double 100):"numeric" 
RPROFMEM: (double 100):"g" "g" "g" 
RPROFMEM: (double 100):"g" "g" "g" 
RPROFMEM: (double 100):"g" "g" "g" 
RPROFMEM: (double 100):"g" "g" 
RPROFMEM: (double 100):"g" "g" 
RPROFMEM: (double 100):"g" "g" 
RPROFMEM: (double 100):"g" "g" 
RPROFMEM: (double 100):"g" "g" 
RPROFMEM: (double 100):"g" 
RPROFMEM: (double 100):"g" 
RPROFMEM: (double 100):"g" 
RPROFMEM: (double 100):"g" 
RPROFMEM: (double 100):
RPROFMEM: (double 100):
RPROFMEM: (double 10000):
> print(attr(r2,"gradient")[1..3,1..3])
     [,1]   [,2]   [,3]
[1,]   80  0.000  0.000
[2,]    0 81.608  0.000
[3,]    0  0.000 83.232
> pr("end")
end 
> 
> 
> Rprofmemt(NULL)
> 
> n <- 3
> 
> Z <- matrix(c(-3,1,3,8,2),6,5)
> A <- matrix(c(3,9,7,2,2,-1,3,-2),4,6)
> B <- matrix(c(8,4),3,4)
> C <- matrix(c(-1,2,5),6,3)
> D <- matrix(c(7,5,3,1),8,6)
> x <- c(7,-1,2,4,9)
> 
> (r <- numericDeriv (quote ({
+   Y <- Z %*% x
+   Y <- A %*% Y
+   Y <- B %*% Y
+   Y <- C %*% Y
+   Y <- D %*% Y
+   Y
+ }), "x"))
        [,1]
[1,] 5267136
[2,] 3762240
[3,] 2257344
[4,]  752448
[5,] 5267136
[6,] 3762240
[7,] 2257344
[8,]  752448
attr(,"gradient")
      [,1]   [,2]   [,3]   [,4]   [,5]
[1,] 89376 215712 224448 300720 356160
[2,] 63840 154080 160320 214800 254400
[3,] 38304  92448  96192 128880 152640
[4,] 12768  30816  32064  42960  50880
[5,] 89376 215712 224448 300720 356160
[6,] 63840 154080 160320 214800 254400
[7,] 38304  92448  96192 128880 152640
[8,] 12768  30816  32064  42960  50880
> g <- attr(r,"gradient")
> 
> pr("start")
start 
> (r <- with gradient (x) {
+   pr("Z"); Y <- Z %*% x
+   pr("A"); Y <- A %*% Y
+   pr("B"); Y <- B %*% Y
+   pr("C"); Y <- C %*% Y
+   pr("D"); Y <- D %*% Y
+   pr("E"); Y
+ })
Z 
RPROFMEM: (double 6):
RPROFMEM: (expression 5):
A 
RPROFMEM: (double 4):
RPROFMEM: (expression 5):
B 
RPROFMEM: (double 3):
RPROFMEM: (expression 5):
C 
RPROFMEM: (double 6):
RPROFMEM: (expression 5):
D 
RPROFMEM: (double 8):
RPROFMEM: (expression 5):
E 
RPROFMEM: (double 24):
RPROFMEM: (double 32):
RPROFMEM: (double 48):
RPROFMEM: (double 40):
RPROFMEM: (double 40):
        [,1]
[1,] 5267136
[2,] 3762240
[3,] 2257344
[4,]  752448
[5,] 5267136
[6,] 3762240
[7,] 2257344
[8,]  752448
attr(,"gradient")
      [,1]   [,2]   [,3]   [,4]   [,5]
[1,] 89376 215712 224448 300720 356160
[2,] 63840 154080 160320 214800 254400
[3,] 38304  92448  96192 128880 152640
[4,] 12768  30816  32064  42960  50880
[5,] 89376 215712 224448 300720 356160
[6,] 63840 154080 160320 214800 254400
[7,] 38304  92448  96192 128880 152640
[8,] 12768  30816  32064  42960  50880
> pr("end")
end 
> 
> identical(attr(r,"gradient"),g)
[1] TRUE
> 
> pr("start")
start 
> (r <- with gradient (x) {
+   back gradient (Y = Z %*% x)
+     back gradient (Y = A %*% Y)
+       back gradient (Y = B %*% Y)
+         back gradient (Y = C %*% Y)
+           D %*% Y
+ })
RPROFMEM: (double 6):
RPROFMEM: (expression 5):
RPROFMEM: (double 4):
RPROFMEM: (expression 5):
RPROFMEM: (double 3):
RPROFMEM: (expression 5):
RPROFMEM: (double 6):
RPROFMEM: (expression 5):
RPROFMEM: (double 8):
RPROFMEM: (expression 5):
RPROFMEM: (double 48):
RPROFMEM: (double 18):
RPROFMEM: (double 24):
RPROFMEM: (double 12):
RPROFMEM: (double 32):
RPROFMEM: (double 24):
RPROFMEM: (double 48):
RPROFMEM: (double 30):
RPROFMEM: (double 40):
        [,1]
[1,] 5267136
[2,] 3762240
[3,] 2257344
[4,]  752448
[5,] 5267136
[6,] 3762240
[7,] 2257344
[8,]  752448
attr(,"gradient")
      [,1]   [,2]   [,3]   [,4]   [,5]
[1,] 89376 215712 224448 300720 356160
[2,] 63840 154080 160320 214800 254400
[3,] 38304  92448  96192 128880 152640
[4,] 12768  30816  32064  42960  50880
[5,] 89376 215712 224448 300720 356160
[6,] 63840 154080 160320 214800 254400
[7,] 38304  92448  96192 128880 152640
[8,] 12768  30816  32064  42960  50880
> pr("end")
end 
> 
> identical(attr(r,"gradient"),g)
[1] TRUE
> 
RPROFMEM: (char 5):
